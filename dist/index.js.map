{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../lib/type-r/object-plus/tools.js","../lib/type-r/object-plus/mixins.js","../lib/type-r/object-plus/eventsource.js","../lib/type-r/object-plus/events.js","../lib/type-r/traversable.js","../lib/type-r/record/attributes/updates.js","../lib/type-r/record/attributes/any.js","../lib/type-r/record/attributes/attrDef.js","../lib/type-r/record/attributes/date.js","../lib/type-r/record/attributes/basic.js","../lib/type-r/record/attributes/shared.js","../lib/type-r/record/attributes/index.js","../lib/type-r/record/record.js","../lib/type-r/record/index.js","../lib/type-r/collection/commons.js","../lib/type-r/collection/add.js","../lib/type-r/collection/set.js","../lib/type-r/collection/remove.js","../lib/type-r/collection/index.js","../lib/type-r/relations/commons.js","../lib/type-r/relations/subsetOf.js","../lib/type-r/index.js","../lib/backbone.js","../lib/rest.js","../lib/underscore-mixin.js","../lib/index.js","../lib/type-r/object-plus/index.js","../lib/type-r/validation.js","../lib/type-r/transactions.js","../lib/type-r/record/attributes/owned.js","../lib/type-r/relations/from.js","../lib/type-r/relations/store.js","../lib/sync.js","../lib/rest-store.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n","var levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", props[name_1]);\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nObject.setPrototypeOf || (Object.setPrototypeOf = defaults);\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\n//# sourceMappingURL=tools.js.map","import * as tslib_1 from \"tslib\";\nimport { assign, getBaseClass, defaults, transform } from './tools';\nimport { __extends } from 'tslib';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = tslib_1.__rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                tslib_1.__extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(rules, mixins.definitionRules);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || {};\n        this.definitionRules = (mixins && mixins.definitionRules) || {};\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = {}, Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    if (getBaseClass(mixin) !== Object) {\n                        console.log('Mixin error');\n                    }\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults({}, this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults({}, this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: {\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    },\n    object: {\n        constructor: true,\n        toString: false,\n        valueOf: false\n    }\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.getOwnPropertyNames(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        ignore[name_2] || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","import * as tslib_1 from \"tslib\";\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    return Messenger;\n}());\nMessenger = tslib_1.__decorate([\n    define,\n    definitions({\n        properties: mixinRules.merge,\n        localEvents: mixinRules.merge\n    })\n], Messenger);\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        path.unshift('self');\n        this.resolve = new Function('self', \"return \" + path.join('.') + \";\");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || new ChainableAttributeSpec({\n            type: this,\n            value: this._attribute.defaultValue,\n            hasCustomDefault: this._attribute.defaultValue !== void 0\n        });\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type = inferType(spec);\n        if (type && type.prototype instanceof Transactional) {\n            attrSpec = type.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    tslib_1.__extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    tslib_1.__extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    tslib_1.__extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    tslib_1.__extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    tslib_1.__extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    tslib_1.__extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    tslib_1.__extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    tslib_1.__extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    tslib_1.__extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    tslib_1.__extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                options.unset || prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","import * as tslib_1 from \"tslib\";\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return tslib_1.__assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes));\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = Record_1 = (function (_super) {\n    tslib_1.__extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this._previousAttributes = _this.attributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), tslib_1.__assign({ unset: true }, options));\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        if (values === void 0) { values = {}; }\n        var defaults = {}, _attributesArray = this._attributesArray;\n        for (var _i = 0, _attributesArray_1 = _attributesArray; _i < _attributesArray_1.length; _i++) {\n            var attr = _attributesArray_1[_i];\n            var key = attr.name, value = values[key];\n            defaults[key] = value === void 0 ? attr.defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, tslib_1.__assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    return Record;\n}(Transactional));\nRecord = Record_1 = tslib_1.__decorate([\n    define({\n        cidPrefix: 'm',\n        _changeEventName: 'change',\n        idAttribute: 'id'\n    }),\n    definitions({\n        defaults: mixinRules.merge,\n        attributes: mixinRules.merge,\n        collection: mixinRules.merge,\n        Collection: mixinRules.value,\n        idAttribute: mixinRules.protoValue\n    })\n], Record);\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\nvar Record_1;\n//# sourceMappingURL=record.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        tslib_1.__extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    DefaultCollection.model = Class;\n    DefaultCollection = tslib_1.__decorate([\n        predefine\n    ], DefaultCollection);\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = tslib_1.__rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id != null) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id != null) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove, options.unset);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove, unset) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model, unset);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","import * as tslib_1 from \"tslib\";\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, dispose, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    tslib_1.__extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return CollectionRefsType;\n}(SharedType));\nCollectionRefsType.defaultValue = [];\nvar Collection = Collection_1 = (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = dispose(this);\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, tslib_1.__assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    return Collection;\n}(Transactional));\nCollection._attribute = AggregatedType;\nCollection = Collection_1 = tslib_1.__decorate([\n    define({\n        cidPrefix: 'c',\n        model: Record,\n        _changeEventName: 'changes',\n        _aggregationError: null\n    }),\n    definitions({\n        comparator: mixinRules.value,\n        model: mixinRules.protoValue,\n        itemEvents: mixinRules.merge\n    })\n], Collection);\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\nvar Collection_1;\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        tslib_1.__extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd.slice();\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs.slice();\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    SubsetOfCollection = tslib_1.__decorate([\n        define\n    ], SubsetOfCollection);\n    SubsetOfCollection.prototype._itemEvents = void 0;\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements.slice();\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return elements ? (Array.isArray(elements) ? elements : [elements]) : [];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tslib_1 from \"tslib\";\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        tslib_1.__extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        return DefaultRecord;\n    }(Model));\n    DefaultRecord.attributes = attrDefs;\n    DefaultRecord = tslib_1.__decorate([\n        define\n    ], DefaultRecord);\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map","import * as _ from 'underscore';\nimport * as jQuery from 'jquery';\nvar previousBackbone = window.Backbone;\nvar slice = Array.prototype.slice;\nvar exported = {\n    $: jQuery,\n    history: null,\n    VERSION: '1.2.3',\n    View: View, History: History, Router: Router, noConflict: noConflict\n};\nexport default exported;\nfunction noConflict() {\n    window.Backbone = previousBackbone;\n    return this;\n}\n;\nexport function View(options) {\n    this.cid = _.uniqueId('view');\n    options || (options = {});\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n    this.delegateEvents();\n}\n;\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n_.extend(View.prototype, {\n    tagName: 'div',\n    $: function (selector) {\n        return this.$el.find(selector);\n    },\n    initialize: function () { },\n    render: function () {\n        return this;\n    },\n    remove: function () {\n        this.$el.remove();\n        this.stopListening();\n        return this;\n    },\n    setElement: function (element, delegate) {\n        if (this.$el)\n            this.undelegateEvents();\n        this.$el = element instanceof exported.$ ? element : exported.$(element);\n        this.el = this.$el[0];\n        if (delegate !== false)\n            this.delegateEvents();\n        return this;\n    },\n    delegateEvents: function (events) {\n        if (!(events || (events = _.result(this, 'events'))))\n            return this;\n        this.undelegateEvents();\n        for (var key in events) {\n            var method = events[key];\n            if (!_.isFunction(method))\n                method = this[events[key]];\n            if (!method)\n                continue;\n            var match = key.match(delegateEventSplitter);\n            var eventName = match[1], selector = match[2];\n            method = _.bind(method, this);\n            eventName += '.delegateEvents' + this.cid;\n            if (selector === '') {\n                this.$el.on(eventName, method);\n            }\n            else {\n                this.$el.on(eventName, selector, method);\n            }\n        }\n        return this;\n    },\n    undelegateEvents: function () {\n        this.$el.off('.delegateEvents' + this.cid);\n        return this;\n    },\n    _ensureElement: function () {\n        if (!this.el) {\n            var attrs = _.extend({}, _.result(this, 'attributes'));\n            if (this.id)\n                attrs.id = _.result(this, 'id');\n            if (this.className)\n                attrs['class'] = _.result(this, 'className');\n            var $el = exported.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n            this.setElement($el, false);\n        }\n        else {\n            this.setElement(_.result(this, 'el'), false);\n        }\n    }\n});\nexport function Router(options) {\n    options || (options = {});\n    if (options.routes)\n        this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n}\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam = /(\\(\\?)?:\\w+/g;\nvar splatParam = /\\*\\w+/g;\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n_.extend(Router.prototype, {\n    initialize: function () { },\n    route: function (route, name, callback) {\n        if (!_.isRegExp(route))\n            route = this._routeToRegExp(route);\n        if (_.isFunction(name)) {\n            callback = name;\n            name = '';\n        }\n        if (!callback)\n            callback = this[name];\n        var router = this;\n        exported.history.route(route, function (fragment) {\n            var args = router._extractParameters(route, fragment);\n            if (router.execute(callback, args, name) !== false) {\n                router.trigger.apply(router, ['route:' + name].concat(args));\n                router.trigger('route', name, args);\n                exported.history.trigger('route', router, name, args);\n            }\n        });\n        return this;\n    },\n    execute: function (callback, args, name) {\n        if (callback)\n            callback.apply(this, args);\n    },\n    navigate: function (fragment, options) {\n        exported.history.navigate(fragment, options);\n        return this;\n    },\n    _bindRoutes: function () {\n        if (!this.routes)\n            return;\n        this.routes = _.result(this, 'routes');\n        var route, routes = _.keys(this.routes);\n        while ((route = routes.pop()) != null) {\n            this.route(route, this.routes[route]);\n        }\n    },\n    _routeToRegExp: function (route) {\n        route = route.replace(escapeRegExp, '\\\\$&')\n            .replace(optionalParam, '(?:$1)?')\n            .replace(namedParam, function (match, optional) {\n            return optional ? match : '([^/?]+)';\n        })\n            .replace(splatParam, '([^?]*?)');\n        return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n    _extractParameters: function (route, fragment) {\n        var params = route.exec(fragment).slice(1);\n        return _.map(params, function (param, i) {\n            if (i === params.length - 1)\n                return param || null;\n            return param ? decodeURIComponent(param) : null;\n        });\n    }\n});\nexport function History() {\n    this.handlers = [];\n    this.checkUrl = _.bind(this.checkUrl, this);\n    if (typeof window !== 'undefined') {\n        this.location = window.location;\n        this.history = window.history;\n    }\n}\n;\nvar routeStripper = /^[#\\/]|\\s+$/g;\nvar rootStripper = /^\\/+|\\/+$/g;\nvar pathStripper = /#.*$/;\nHistory.started = false;\n_.extend(History.prototype, {\n    interval: 50,\n    atRoot: function () {\n        var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n        return path === this.root && !this.getSearch();\n    },\n    matchRoot: function () {\n        var path = this.decodeFragment(this.location.pathname);\n        var root = path.slice(0, this.root.length - 1) + '/';\n        return root === this.root;\n    },\n    decodeFragment: function (fragment) {\n        return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n    getSearch: function () {\n        var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n        return match ? match[0] : '';\n    },\n    getHash: function (window) {\n        var match = (window || this).location.href.match(/#(.*)$/);\n        return match ? match[1] : '';\n    },\n    getPath: function () {\n        var path = this.decodeFragment(this.location.pathname + this.getSearch()).slice(this.root.length - 1);\n        return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n    getFragment: function (fragment) {\n        if (fragment == null) {\n            if (this._usePushState || !this._wantsHashChange) {\n                fragment = this.getPath();\n            }\n            else {\n                fragment = this.getHash();\n            }\n        }\n        return fragment.replace(routeStripper, '');\n    },\n    start: function (options) {\n        if (History.started)\n            throw new Error('Backbone.history has already been started');\n        History.started = true;\n        this.options = _.extend({ root: '/' }, this.options, options);\n        this.root = this.options.root;\n        this._wantsHashChange = this.options.hashChange !== false;\n        this._hasHashChange = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n        this._useHashChange = this._wantsHashChange && this._hasHashChange;\n        this._wantsPushState = !!this.options.pushState;\n        this._hasPushState = !!(this.history && this.history.pushState);\n        this._usePushState = this._wantsPushState && this._hasPushState;\n        this.fragment = this.getFragment();\n        this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n        if (this._wantsHashChange && this._wantsPushState) {\n            if (!this._hasPushState && !this.atRoot()) {\n                var root = this.root.slice(0, -1) || '/';\n                this.location.replace(root + '#' + this.getPath());\n                return true;\n            }\n            else if (this._hasPushState && this.atRoot()) {\n                this.navigate(this.getHash(), { replace: true });\n            }\n        }\n        if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n            this.iframe = document.createElement('iframe');\n            this.iframe.src = 'javascript:0';\n            this.iframe.style.display = 'none';\n            this.iframe.tabIndex = -1;\n            var body = document.body;\n            var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n            iWindow.document.open();\n            iWindow.document.close();\n            iWindow.location.hash = '#' + this.fragment;\n        }\n        var addEventListener = window.addEventListener || function (eventName, listener) {\n            return attachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            addEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            addEventListener('hashchange', this.checkUrl, false);\n        }\n        else if (this._wantsHashChange) {\n            this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n        }\n        if (!this.options.silent)\n            return this.loadUrl();\n    },\n    stop: function () {\n        var removeEventListener = window.removeEventListener || function (eventName, listener) {\n            return detachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            removeEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            removeEventListener('hashchange', this.checkUrl, false);\n        }\n        if (this.iframe) {\n            document.body.removeChild(this.iframe);\n            this.iframe = null;\n        }\n        if (this._checkUrlInterval)\n            clearInterval(this._checkUrlInterval);\n        History.started = false;\n    },\n    route: function (route, callback) {\n        this.handlers.unshift({ route: route, callback: callback });\n    },\n    checkUrl: function (e) {\n        var current = this.getFragment();\n        if (current === this.fragment && this.iframe) {\n            current = this.getHash(this.iframe.contentWindow);\n        }\n        if (current === this.fragment)\n            return false;\n        if (this.iframe)\n            this.navigate(current);\n        this.loadUrl();\n    },\n    loadUrl: function (fragment) {\n        if (!this.matchRoot())\n            return false;\n        fragment = this.fragment = this.getFragment(fragment);\n        return _.some(this.handlers, function (handler) {\n            if (handler.route.test(fragment)) {\n                handler.callback(fragment);\n                return true;\n            }\n        });\n    },\n    navigate: function (fragment, options) {\n        if (!History.started)\n            return false;\n        if (!options || options === true)\n            options = { trigger: !!options };\n        fragment = this.getFragment(fragment || '');\n        var root = this.root;\n        if (fragment === '' || fragment.charAt(0) === '?') {\n            root = root.slice(0, -1) || '/';\n        }\n        var url = root + fragment;\n        fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n        if (this.fragment === fragment)\n            return;\n        this.fragment = fragment;\n        if (this._usePushState) {\n            this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        }\n        else if (this._wantsHashChange) {\n            this._updateHash(this.location, fragment, options.replace);\n            if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n                var iWindow = this.iframe.contentWindow;\n                if (!options.replace) {\n                    iWindow.document.open();\n                    iWindow.document.close();\n                }\n                this._updateHash(iWindow.location, fragment, options.replace);\n            }\n        }\n        else {\n            return this.location.assign(url);\n        }\n        if (options.trigger)\n            return this.loadUrl(fragment);\n    },\n    _updateHash: function (location, fragment, replace) {\n        if (replace) {\n            var href = location.href.replace(/(javascript:|#).*$/, '');\n            location.replace(href + '#' + fragment);\n        }\n        else {\n            location.hash = '#' + fragment;\n        }\n    }\n});\nexported.history = new History;\n//# sourceMappingURL=backbone.js.map","import * as tslib_1 from \"tslib\";\nimport Sync from './sync';\nimport * as _ from 'underscore';\nimport { define, Model, Collection, tools, definitions, mixinRules } from './type-r';\nvar defaults = tools.defaults;\nvar transactionalProto = tools.getBaseClass(Model).prototype;\nvar RestCollection = (function (_super) {\n    tslib_1.__extends(RestCollection, _super);\n    function RestCollection() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestCollection.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestCollection.prototype.url = function () { return this.model.prototype.urlRoot || ''; };\n    RestCollection.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            this.trigger('invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestCollection.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var success = options.success;\n        var collection = this;\n        options.success = function (resp) {\n            var method = options.reset ? 'reset' : 'set';\n            collection[method](resp, options);\n            if (collection._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, collection, resp, options);\n            collection.trigger('sync', collection, resp, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestCollection.prototype.create = function (a_model, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var model = a_model instanceof RestModel ?\n            a_model :\n            this.model.create(a_model, options);\n        model._owner || (model._owner = this);\n        options.wait || this.add([model], options);\n        var collection = this;\n        var success = options.success;\n        options.success = function (model, resp, callbackOpts) {\n            if (options.wait)\n                _this.add([model], defaults({ parse: false }, callbackOpts));\n            if (success)\n                success.call(callbackOpts.context, model, resp, callbackOpts);\n        };\n        model.save(null, options);\n        return model;\n    };\n    RestCollection.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    return RestCollection;\n}(Collection));\nRestCollection = tslib_1.__decorate([\n    define({\n        itemEvents: {\n            destroy: function (model) { this.remove(model); }\n        }\n    })\n], RestCollection);\nexport { RestCollection };\n;\nvar RestModel = (function (_super) {\n    tslib_1.__extends(RestModel, _super);\n    function RestModel() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestModel.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            triggerAndBubble(this, 'invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestModel.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestModel.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var model = this;\n        var success = options.success;\n        options.success = function (serverAttrs) {\n            model.set(serverAttrs, options);\n            if (model._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestModel.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestModel.prototype.save = function (key, val, a_options) {\n        var _this = this;\n        var attrs, originalOptions;\n        if (key == null || typeof key === 'object') {\n            attrs = key;\n            originalOptions = val || {};\n        }\n        else {\n            (attrs = {})[key] = val;\n            originalOptions = a_options || {};\n        }\n        var options = _.extend({ validate: true, parse: true }, originalOptions), wait = options.wait;\n        if (attrs && !wait) {\n            this.set(attrs, originalOptions);\n        }\n        if (this._invalidate(options)) {\n            if (attrs && wait)\n                this.set(attrs, originalOptions);\n            return Sync.errorPromise(this.validationError);\n        }\n        var model = this;\n        var success = options.success;\n        var attributes = this.attributes;\n        options.success = function (serverAttrs) {\n            model.attributes = attributes;\n            if (wait)\n                serverAttrs = _.extend({}, attrs, serverAttrs);\n            if (serverAttrs) {\n                transactionalProto.set.call(_this, serverAttrs, options);\n                if (model._invalidate(options))\n                    return false;\n            }\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        if (attrs && wait)\n            this.attributes = _.extend({}, attributes, attrs);\n        var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n        if (method === 'patch' && !options.attrs)\n            options.attrs = attrs;\n        var xhr = _sync(method, this, options);\n        this.attributes = attributes;\n        return xhr;\n    };\n    RestModel.prototype.destroy = function (options) {\n        options = options ? _.clone(options) : {};\n        var model = this;\n        var success = options.success;\n        var wait = options.wait;\n        var destroy = function () {\n            model.stopListening();\n            model.trigger('destroy', model, model.collection, options);\n        };\n        options.success = function (resp) {\n            if (wait)\n                destroy();\n            if (success)\n                success.call(options.context, model, resp, options);\n            if (!model.isNew())\n                triggerAndBubble(model, 'sync', model, resp, options);\n        };\n        var xhr;\n        if (this.isNew()) {\n            _.defer(options.success);\n        }\n        else {\n            wrapError(this, options);\n            xhr = _sync('delete', this, options);\n        }\n        if (!wait)\n            destroy();\n        return xhr || false;\n    };\n    RestModel.prototype.url = function () {\n        var base = _.result(this, 'urlRoot') ||\n            _.result(this.collection, 'url') ||\n            Sync.urlError();\n        if (this.isNew())\n            return base;\n        var id = this.get(this.idAttribute);\n        return base.replace(/[^\\/]$/, '$&/') + encodeURIComponent(id);\n    };\n    RestModel.prototype.set = function (a, b, c) {\n        if (typeof a === 'string') {\n            if (c) {\n                return _super.prototype.set.call(this, (_a = {}, _a[a] = b, _a), c);\n            }\n            else {\n                this[a] = b;\n                return this;\n            }\n        }\n        else {\n            return _super.prototype.set.call(this, a, b);\n        }\n        var _a;\n    };\n    return RestModel;\n}(Model));\nRestModel.Collection = RestCollection;\nRestModel = tslib_1.__decorate([\n    define({\n        urlRoot: ''\n    }),\n    definitions({\n        urlRoot: mixinRules.protoValue\n    })\n], RestModel);\nexport { RestModel };\nfunction _sync(method, _this, options) {\n    _this._xhr && _this._xhr.abort && _this._xhr.abort();\n    var xhr = _this._xhr = _this.sync(method, _this, options);\n    xhr && xhr.always && xhr.always(function () { _this._xhr = void 0; });\n    return xhr;\n}\nfunction wrapError(model, options) {\n    var error = options.error;\n    options.error = function (resp) {\n        if (error)\n            error.call(options.context, model, resp, options);\n        triggerAndBubble(model, 'error', model, resp, options);\n    };\n}\nfunction triggerAndBubble(model) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    model.trigger.apply(model, args);\n    var collection = model.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=rest.js.map","import * as _ from 'underscore';\nexport var ModelMixin = {\n    pick: function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return _.pick(this, args);\n    },\n    escape: function (attr) {\n        return _.escape(this[attr]);\n    },\n    matches: function (attrs) {\n        return !!_.iteratee(attrs, this)(this);\n    },\n    omit: function () {\n        var keys = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            keys[_i] = arguments[_i];\n        }\n        return this.mapObject(function (value, key) {\n            if (keys.indexOf(key) < 0) {\n                return value;\n            }\n        });\n    },\n    invert: function () {\n        var inverted = {};\n        this.each(function (value, key) { return inverted[value] = key; });\n        return inverted;\n    },\n    pairs: function () {\n        return this.map(function (value, key) { return [key, value]; });\n    },\n    isEmpty: function () {\n        return !this.values().length;\n    },\n    chain: function () {\n        return _.chain(this.mapObject(function (x) { return x; }));\n    }\n};\nexport var CollectionMixin = {\n    where: function (attrs, first) {\n        return this[first ? 'find' : 'filter'](attrs);\n    },\n    findWhere: function (attrs) {\n        return this.where(attrs, true);\n    }\n};\naddUnderscoreMethods(CollectionMixin, 'models', {\n    forEach: 3, each: 3, map: 3, collect: 3, reduce: 4,\n    foldl: 4, inject: 4, reduceRight: 4, foldr: 4, find: 3, findIndex: 3, findLastIndex: 3, detect: 3, filter: 3,\n    select: 3, reject: 3, every: 3, all: 3, some: 3, any: 3, include: 3, includes: 3,\n    contains: 3, invoke: 0, max: 3, min: 3, toArray: 1, size: 1, first: 3,\n    head: 3, take: 3, initial: 3, rest: 3, tail: 3, drop: 3, last: 3,\n    without: 0, difference: 0, indexOf: 3, shuffle: 1, lastIndexOf: 3,\n    isEmpty: 1, chain: 1, sample: 3, partition: 3, groupBy: 3, countBy: 3,\n    sortBy: 3, indexBy: 3\n});\nfunction addUnderscoreMethods(Mixin, attribute, methods) {\n    _.each(methods, function (length, method) {\n        if (_[method])\n            Mixin[method] = addMethod(length, method, attribute);\n    });\n}\nfunction addMethod(length, method, attribute) {\n    switch (length) {\n        case 1: return function () {\n            return _[method](this[attribute]);\n        };\n        case 2: return function (value) {\n            return _[method](this[attribute], value);\n        };\n        case 3: return function (iteratee, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, context)\n                : _[method](value, callback);\n        };\n        case 4: return function (iteratee, defaultVal, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, defaultVal, context)\n                : _[method](value, callback);\n        };\n        default: return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            args.unshift(this[attribute]);\n            return _[method].apply(_, args);\n        };\n    }\n}\nfunction cb(iteratee, instance) {\n    switch (typeof iteratee) {\n        case 'function': return iteratee;\n        case 'string': return function (model) { return model.get(iteratee); };\n        case 'object':\n            if (!(iteratee instanceof instance.model))\n                return _.matches(iteratee);\n    }\n    return iteratee;\n}\n//# sourceMappingURL=underscore-mixin.js.map","import * as TypeR from './type-r';\nexport * from './type-r';\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\nimport { Store as BaseStore, tools, MixinsState } from './type-r';\nimport Sync from './sync';\nimport { ModelMixin, CollectionMixin } from './underscore-mixin';\nimport { RestStore, LazyStore } from './rest-store';\nexport var Class = TypeR.Messenger;\nvar Nested = Object.create(TypeR, tools.defaults({\n    'sync': linkProperty(Sync, 'sync'),\n    'errorPromise': linkProperty(Sync, 'errorPromise'),\n    'ajax': linkProperty(Sync, 'ajax'),\n    'history': linkProperty(Backbone, 'history'),\n    'store': linkProperty(BaseStore, 'global'),\n    '$': {\n        get: function () { return Backbone.$; },\n        set: function (value) { Backbone.$ = Sync.$ = value; }\n    }\n}, toProps({ Backbone: Backbone, Class: Class, Model: RestModel, Collection: RestCollection, LazyStore: LazyStore, Store: RestStore, defaults: defaults }), toProps(Backbone)));\nexport default Nested;\nexport { Backbone, RestStore as Store, LazyStore, RestCollection as Collection, RestModel as Model };\nexport function defaults(x) {\n    return Nested.Model.defaults(x);\n}\nexport * from './backbone';\nMixinsState.get(Nested.Mixable).merge([Nested.Events]);\nNested.Messenger.mixins.populate(Backbone.View, Backbone.Router, Backbone.History);\nNested.Record.mixins.merge([ModelMixin]);\nNested.Record.Collection.mixins.merge([CollectionMixin]);\nfunction linkProperty(Namespace, name) {\n    return {\n        get: function () { return Namespace[name]; },\n        set: function (value) { Namespace[name] = value; }\n    };\n}\nfunction toProps(obj) {\n    return tools.transform({}, obj, function (x) { return ({ value: x }); });\n}\n//# sourceMappingURL=index.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","import * as tslib_1 from \"tslib\";\nimport { Messenger, tools, mixins, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = Transactional_1 = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        return this.set(source.__inner_state__ || source, { merge: true });\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    return Transactional;\n}());\nTransactional = Transactional_1 = tslib_1.__decorate([\n    define,\n    mixins(Messenger)\n], Transactional);\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\nvar Transactional_1;\n//# sourceMappingURL=transactions.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    tslib_1.__extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            free(record, prev);\n            options.unset || prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    tslib_1.__extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    tslib_1.__extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","import * as _ from 'underscore';\nimport Backbone from './backbone';\nimport { tools } from './type-r';\nvar defaults = tools.defaults;\nvar methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch': 'PATCH',\n    'delete': 'DELETE',\n    'read': 'GET'\n};\nvar exported = {\n    $: Backbone.$,\n    errorPromise: function (error) {\n        var x = $.Deferred();\n        x.reject(error);\n        return x;\n    },\n    ajax: function (options) {\n        return $.ajax.apply($, arguments);\n    },\n    sync: sync,\n    urlError: function () {\n        throw new Error('A \"url\" property or function must be specified');\n    }\n};\nexport default exported;\nfunction sync(method, model, options) {\n    if (options === void 0) { options = {}; }\n    var type = methodMap[method];\n    var params = { type: type, dataType: 'json' };\n    if (!options.url) {\n        params.url = _.result(model, 'url') || exported.urlError();\n    }\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n        params.contentType = 'application/json';\n        params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n    if (params.type !== 'GET') {\n        params.processData = false;\n    }\n    var error = options.error;\n    options.error = function (xhr, textStatus, errorThrown) {\n        options.textStatus = textStatus;\n        options.errorThrown = errorThrown;\n        if (error)\n            error.call(options.context, xhr, textStatus, errorThrown);\n    };\n    var xhr = options.xhr = exported.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    model.collection && model.collection.trigger('request', model, xhr, options);\n    return xhr;\n}\n//# sourceMappingURL=sync.js.map","import * as tslib_1 from \"tslib\";\nimport Backbone from './backbone';\nimport * as _ from 'underscore';\nimport { define, Store } from './type-r';\nimport { RestModel, RestCollection } from './rest';\nvar RestStore = (function (_super) {\n    tslib_1.__extends(RestStore, _super);\n    function RestStore() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return RestStore;\n}(RestModel));\nRestStore = tslib_1.__decorate([\n    define({\n        getStore: Store.prototype.getStore,\n        get: Store.prototype.get,\n    })\n], RestStore);\nexport { RestStore };\nvar LazyStore = (function (_super) {\n    tslib_1.__extends(LazyStore, _super);\n    function LazyStore() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._resolved = {};\n        return _this;\n    }\n    LazyStore.prototype.initialize = function () {\n        var _this = this;\n        this.each(function (element, name) {\n            if (!element)\n                return;\n            element.store = _this;\n            var fetch = element.fetch;\n            if (fetch) {\n                var self_1 = _this;\n                element.fetch = function () {\n                    return self_1._resolved[name] = fetch.apply(this, arguments);\n                };\n            }\n            if (element instanceof RestCollection && element.length) {\n                _this._resolved[name] = true;\n            }\n        });\n    };\n    LazyStore.prototype.fetch = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_1 = objsToFetch; _a < objsToFetch_1.length; _a++) {\n            var name_1 = objsToFetch_1[_a];\n            var attr = this.attributes[name_1];\n            attr && attr.fetch && xhr.push(attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.fetchOnce = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], self = this, objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_2 = objsToFetch; _a < objsToFetch_2.length; _a++) {\n            var name_2 = objsToFetch_2[_a];\n            var attr = self.attributes[name_2];\n            xhr.push(self._resolved[name_2] || attr && attr.fetch && attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.clear = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var objsToClear = args.length ? args : this.keys();\n        for (var _a = 0, objsToClear_1 = objsToClear; _a < objsToClear_1.length; _a++) {\n            var name_3 = objsToClear_1[_a];\n            var element = this.attributes[name_3];\n            if (element instanceof RestCollection) {\n                element.reset();\n            }\n            else if (element instanceof Store) {\n                element.clear();\n            }\n            else if (element instanceof RestModel) {\n                element.set(element.defaults());\n            }\n            this._resolved[name_3] = false;\n        }\n        return this;\n    };\n    LazyStore.onDefine = function (definitions, BaseClass) {\n        var attributes = definitions.defaults || definitions.attributes;\n        _.each(attributes, function (Type, name) {\n            if (Type.has) {\n                attributes[name] = Type.has\n                    .set(function (value) {\n                    if (!value || !value.length) {\n                        var resolved = this._resolved || (this._resolved = {});\n                        resolved[name] = false;\n                    }\n                    return value;\n                });\n            }\n        });\n        RestModel.onDefine.call(this, definitions, BaseClass);\n    };\n    return LazyStore;\n}(RestStore));\nLazyStore = tslib_1.__decorate([\n    define\n], LazyStore);\nexport { LazyStore };\n//# sourceMappingURL=rest-store.js.map"],"names":["__extends","d","b","__","this","constructor","extendStatics","prototype","Object","create","__rest","s","e","t","p","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","isValidJSON","value","proto","getPrototypeOf","Array","every","getBaseClass","Class","isEmpty","obj","someArray","arr","fun","result","someObject","some","ArrayProto","predicate","x","omit","source","dest","discard","name","transform","assign","other","defaults","once","func","memo","first","apply","notEqual","a","protoA","DateProto","arraysNotEqual","ObjectProto","objectsNotEqual","keysA","keys","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","definitionDecorator","definitionKey","mergeObject","_a","_b","forEachOwnProp","object","ignore","dontMix","_i","getOwnPropertyNames","name_2","assignProperty","sourceProp","rule","unshift","destProp","configurable","resolveRule","getBubblingHandler","event","_bubblingHandlers","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend2","listSend3","listSend4","listSend5","listSend6","f","on","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","names_1","split","self","queue","all","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","setAttribute","record","isRoot","begin","options","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","wrapIsRequired","validate","emptyFunction","toAttributeOptions","spec","attrSpec","has","ChainableAttributeSpec","type","inferType","Transactional","shared","hasCustomDefault","Number","String","Boolean","supportsDate","date","isNaN","Date","getTime","safeParseDate","timestamp","struct","minutesOffset","isoDatePattern","exec","k","numericKeys","undefined","UTC","parse","Integer","Math","round","doNothing","createAttribute","AnyType","parseMixin","attrsWithParse","filter","_parse","createToJSON","toJSON","createSharedTypeSpec","Attribute","_attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","createWatcherFromRef","wrapWatcher","watcher","ref","CompiledReference","local","resolve","tail","typeCheck","unknown","push","getAttributes","idAttribute","definition","attrName","asProp","getMetadata","prop","dispose","collection","models","_byId","freeAll","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","unsubscribe","children","children_1","sortElements","_comparator","sort","addIndex","index","id","removeIndex","updateIndex","previous","logAggregationError","addTransaction","items","nested","added","appendElements","needSort","sortOrMoveElements","CollectionTransaction","at","length_1","moveElements","j","a_items","a_options","forceMerge","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","slice","emptySetTransaction","silent","_reallocateEmpty","silentOptions","setTransaction","_reallocate","reusedCount","removed","_garbageCollect","addedOrChanged","sorted","previous_1","_prevById","prevModels","toAdd","orderKept","len","src","removeOne","el","splice","notify","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","toPredicateFunction","iteratee","parseReference","collectionRef","defineSubsetCollection","CollectionConstructor","SubsetOfCollection","_super","recordsOrIds","_this","subsetOfBehavior","resolvedWith","refs","toArray","tslib_1.__extends","enumerable","add","a_elements","resolveRefs","transactionApi","concat","reset","delaySet","objOrId","_validateNested","copy","comparator","raw","getModelIds","toggle","modelOrId","val","addAll","set","Error","toggleAll","tslib_1.__decorate","master","records","elements_1","tools.notEqual","DefaultRecord","Model","method","args","View","_.uniqueId","_.extend","_.pick","viewOptions","_ensureElement","initialize","delegateEvents","Router","routes","_bindRoutes","History","handlers","checkUrl","_.bind","window","location","history","_sync","_xhr","abort","xhr","sync","always","wrapError","error","resp","triggerAndBubble","trigger","addMethod","attribute","_","cb","defaultVal","instance","_.matches","Nested","linkProperty","Namespace","toProps","tools.transform","setPrototypeOf","__proto__","__assign","n","levelToNumber","none","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","console","name_1","names","o","protoProps","staticProps","defineMixin","tslib_1.__rest","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","ctors","ctors_1","mixinRules","protoValue","baseProto","function","caller","toString","valueOf","list","pipe","classFirst","classLast","EventMap","addEventsMap","bubbleEvents","EventDescriptor","event_1","event_2","handler","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","exports","Messenger","localEvents","properties","eventsMap","defineProperties","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","each","eachError","splitTail","substr","pop","eventsApi.trigger3","eventsApi.on","eventsApi.off","Transactional_1","_changeToken","_transaction","_isDirty","_owner","_ownerKey","_validationError","cidPrefix","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","__inner_state__","data","deepGet","_defaultStore","mapObject","getValidationError","validationError","deepValidationError","eachValidationError","isValid","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","propagateChanges","forceAttributeChange","a_values","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","changeEvents","defaultValue","tools.isValidJSON","JSON","stringify","isRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","_has","DateType","toISOString","msDatePattern","MSDateType","msDate","TimestampType","microsoft","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","tslib_1.__assign","_attributesArray","_toJSON","tools.isEmpty","_cidCounter","previousAttributes","changedAttributes","diff","old","isNew","clear","nullify","forEachAttr","_attributesArray_1","pinStore","deepClone","errors","json","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","compile","dynamicMixin","eventsApi.trigger2","_c","_d","added_1","_e","removed_1","_count","CollectionRefsType","Collection_1","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","find","mapped","count","last","a_index","aggregated","previousModels","remove","pluck","shift","modelId","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","Store","store","global","previousBackbone","Backbone","exported","$","jQuery","VERSION","noConflict","delegateEventSplitter","tagName","selector","$el","render","setElement","element","delegate","undelegateEvents","_.result","_.isFunction","eventName","className","optionalParam","namedParam","splatParam","escapeRegExp","route","_.isRegExp","_routeToRegExp","router","fragment","_extractParameters","execute","navigate","_.keys","replace","optional","RegExp","params","_.map","param","decodeURIComponent","routeStripper","rootStripper","pathStripper","started","interval","atRoot","pathname","getSearch","matchRoot","decodeFragment","decodeURI","href","getHash","getPath","charAt","getFragment","_usePushState","_wantsHashChange","start","hashChange","_hasHashChange","document","documentMode","_useHashChange","_wantsPushState","pushState","_hasPushState","iframe","createElement","style","display","tabIndex","body","iWindow","insertBefore","firstChild","contentWindow","open","close","hash","addEventListener","attachEvent","_checkUrlInterval","setInterval","loadUrl","removeEventListener","detachEvent","removeChild","clearInterval","current","_.some","url","title","_updateHash","methodMap","patch","delete","read","errorPromise","Deferred","reject","ajax","dataType","urlError","contentType","processData","textStatus","errorThrown","transactionalProto","tools.getBaseClass","RestCollection","urlRoot","_invalidate","fetch","success","a_model","RestModel","wait","callbackOpts","save","Sync","destroy","serverAttrs","_.clone","_.defer","base","encodeURIComponent","ModelMixin","pick","escape","_.escape","matches","_.iteratee","invert","inverted","pairs","chain","_.chain","CollectionMixin","where","findWhere","Mixin","methods","_.each","addUnderscoreMethods","forEach","collect","foldl","inject","reduceRight","foldr","findIndex","findLastIndex","detect","select","any","include","includes","contains","invoke","max","min","size","take","initial","rest","drop","without","difference","shuffle","lastIndexOf","sample","partition","groupBy","countBy","sortBy","indexBy","RestStore","LazyStore","_resolved","self_1","objsToFetch_1","when","fetchOnce","objsToFetch_2","objsToClear_1","Type","TypeR.Messenger","TypeR","BaseStore"],"mappings":"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"}