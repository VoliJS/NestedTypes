{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../lib/type-r/object-plus/tools.js","../lib/type-r/object-plus/mixins.js","../lib/type-r/object-plus/eventsource.js","../lib/type-r/object-plus/events.js","../lib/type-r/traversable.js","../lib/type-r/io-tools.js","../lib/type-r/transactions.js","../lib/type-r/record/attributes/updates.js","../lib/type-r/record/attributes/any.js","../lib/type-r/record/attributes/attrDef.js","../lib/type-r/record/attributes/date.js","../lib/type-r/record/attributes/basic.js","../lib/type-r/record/attributes/index.js","../lib/type-r/record/index.js","../lib/type-r/collection/commons.js","../lib/type-r/collection/add.js","../lib/type-r/collection/set.js","../lib/type-r/collection/remove.js","../lib/type-r/collection/index.js","../lib/type-r/relations/commons.js","../lib/type-r/relations/subsetOf.js","../lib/type-r/index.js","../lib/backbone.js","../lib/rest.js","../lib/underscore-mixin.js","../lib/index.js","../lib/type-r/object-plus/index.js","../lib/type-r/validation.js","../lib/type-r/record/attributes/owned.js","../lib/type-r/record/attributes/shared.js","../lib/type-r/record/io-mixin.js","../lib/type-r/record/record.js","../lib/type-r/relations/from.js","../lib/type-r/relations/store.js","../lib/sync.js","../lib/rest-store.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nvar levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nvar toString = typeof window === 'undefined' ?\n    function toString(something) {\n        if (something && typeof something === 'object') {\n            var value = something.__inner_state__ || something, isTransactional = Boolean(something.__inner_state__), isArray = Array.isArray(value);\n            var keys_1 = Object.keys(value).join(', '), body = isArray ? \"[ length = \" + value.length + \" ]\" : \"{ \" + keys_1 + \" }\";\n            return something.constructor.name + ' ' + body;\n        }\n        return something;\n    } : function toString(x) { return x; };\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", toString(props[name_1]));\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\nvar HashProto = Object.create(null);\nHashProto.hasOwnProperty = ObjectProto.hasOwnProperty;\nexport function hashMap(obj) {\n    var hash = Object.create(HashProto);\n    return obj ? assign(hash, obj) : hash;\n}\n//# sourceMappingURL=tools.js.map","import * as tslib_1 from \"tslib\";\nimport { assign, hashMap, getBaseClass, defaults, transform } from './tools';\nimport { __extends } from 'tslib';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = tslib_1.__rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                tslib_1.__extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(hashMap(), rules, mixins.definitionRules);\n    };\n}\nexport function propertyListDecorator(listName) {\n    return function propList(proto, name) {\n        var list = proto.hasOwnProperty(listName) ?\n            proto[listName] : (proto[listName] = (proto[listName] || []).slice());\n        list.push(name);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || hashMap();\n        this.definitionRules = (mixins && mixins.definitionRules) || hashMap();\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = hashMap(), Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults(hashMap(), this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults(hashMap(), this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: hashMap({\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    }),\n    object: hashMap({\n        constructor: true\n    })\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.keys(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        ignore[name_2] || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","import * as tslib_1 from \"tslib\";\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = tslib_1.__decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|(store\\.[^.]+)|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^' || key === 'owner')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            if (key.indexOf('store.') === 0)\n                return \"getStore().get(\\\"\" + key.substr(6) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        this.resolve = new Function('self', \"\\n            var v = self.\" + path.shift() + \";\\n                           \\n            \" + path.map(function (x) { return \"\\n                v = v && v.\" + x + \";\\n            \"; }).join('') + \"\\n\\n            return v;\\n        \");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","export function getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\nexport function createIOPromise(initialize) {\n    var resolve, reject, onAbort;\n    function abort(fn) {\n        onAbort = fn;\n    }\n    var promise = new Promise(function (a_resolve, a_reject) {\n        reject = a_reject;\n        resolve = a_resolve;\n        initialize(resolve, reject, abort);\n    });\n    promise.abort = function () {\n        onAbort ? onAbort(resolve, reject) : reject(new Error(\"I/O Aborted\"));\n    };\n    return promise;\n}\nexport function startIO(self, promise, options, thenDo) {\n    abortIO(self);\n    options.ioUpdate = true;\n    self._ioPromise = promise\n        .then(function (resp) {\n        self._ioPromise = null;\n        var result = thenDo ? thenDo(resp) : resp;\n        triggerAndBubble(self, 'sync', self, resp, options);\n        return result;\n    })\n        .catch(function (err) {\n        self._ioPromise = null;\n        console.error(err);\n        triggerAndBubble(self, 'error', self, err, options);\n        throw err;\n    });\n    self._ioPromise.abort = promise.abort;\n    return self._ioPromise;\n}\nexport function abortIO(self) {\n    if (self._ioPromise && self._ioPromise.abort) {\n        self._ioPromise.abort();\n        self._ioPromise = null;\n    }\n}\nexport function triggerAndBubble(eventSource) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    eventSource.trigger.apply(eventSource, args);\n    var collection = eventSource.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=io-tools.js.map","import * as tslib_1 from \"tslib\";\nimport { Messenger, tools, mixins, mixinRules, definitions, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nimport { abortIO } from './io-tools';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onDefine = function (definitions, BaseClass) {\n        if (definitions.endpoint)\n            this.prototype._endpoint = definitions.endpoint;\n        Messenger.onDefine.call(this, definitions, BaseClass);\n    };\n    ;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        abortIO(this);\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        var _this = this;\n        this.transaction(function () {\n            _this.set(source.__inner_state__ || source, { merge: true });\n            var _changeToken = source._changeToken;\n            if (_changeToken) {\n                _this._changeToken = _changeToken;\n            }\n        });\n        return this;\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.hasPendingIO = function () { return this._ioPromise; };\n    Transactional.prototype.fetch = function (options) { throw new Error(\"Not implemented\"); };\n    Transactional.prototype.getEndpoint = function () {\n        return getOwnerEndpoint(this) || this._endpoint;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = tslib_1.__decorate([\n        define,\n        definitions({\n            endpoint: mixinRules.value\n        }),\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\nfunction getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\n//# sourceMappingURL=transactions.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"as\", {\n        get: function () { return this.asProp; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.endpoint = function (endpoint) {\n        return this.metadata({ endpoint: endpoint });\n    };\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nexport function type(spec) {\n    return spec instanceof ChainableAttributeSpec ? spec : new ChainableAttributeSpec({\n        type: spec,\n        value: spec._attribute.defaultValue,\n        hasCustomDefault: spec._attribute.defaultValue !== void 0\n    });\n    ;\n}\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || type(this);\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type_1 = inferType(spec);\n        if (type_1 && type_1.prototype instanceof Transactional) {\n            attrSpec = type_1.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type_1, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    tslib_1.__extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    tslib_1.__extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    tslib_1.__extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    tslib_1.__extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    tslib_1.__extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    tslib_1.__extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    tslib_1.__extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    tslib_1.__extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    tslib_1.__extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.dispose = function () { };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","import * as tslib_1 from \"tslib\";\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return tslib_1.__assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes), { _endpoints: _.transform({}, allAttributes, function (attrDef) { return attrDef.options.endpoint; }) });\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        tslib_1.__extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = tslib_1.__decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = tslib_1.__rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n    if (definition.endpoint)\n        this.Collection.prototype._endpoint = definition.endpoint;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id || id === 0) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id || id === 0) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove, options.unset);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove, unset) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model, unset);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","import * as tslib_1 from \"tslib\";\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nimport { startIO } from '../io-tools';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    tslib_1.__extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator !== void 0)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.forEach = function (iteratee, context) {\n        return this.each(iteratee, context);\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.liveUpdates = function (enabled) {\n        var _this = this;\n        if (enabled) {\n            this.liveUpdates(false);\n            var filter_1 = typeof enabled === 'function' ? enabled : function () { return true; };\n            this._liveUpdates = {\n                updated: function (json) {\n                    filter_1(json) && _this.add(json, { parse: true, merge: true });\n                },\n                removed: function (id) { return _this.remove(id); }\n            };\n            return this.getEndpoint().subscribe(this._liveUpdates, this);\n        }\n        else {\n            if (this._liveUpdates) {\n                this.getEndpoint().unsubscribe(this._liveUpdates, this);\n                this._liveUpdates = null;\n            }\n        }\n    };\n    Collection.prototype.fetch = function (a_options) {\n        var _this = this;\n        if (a_options === void 0) { a_options = {}; }\n        var options = tslib_1.__assign({ parse: true }, a_options), endpoint = this.getEndpoint();\n        return startIO(this, endpoint.list(options, this), options, function (json) {\n            var result = _this.set(json, tslib_1.__assign({ parse: true }, options));\n            if (options.liveUpdates) {\n                result = _this.liveUpdates(options.liveUpdates);\n            }\n            return result;\n        });\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        this.liveUpdates(false);\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = this.models;\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        else {\n            this._byId = {};\n            this.models = [];\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        var _byId = this._byId;\n        for (var _i = 0, previousModels_1 = previousModels; _i < previousModels_1.length; _i++) {\n            var toDispose = previousModels_1[_i];\n            _byId[toDispose.cid] || free(this, toDispose);\n        }\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, tslib_1.__assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        tslib_1.__extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            if (options === void 0) { options = {}; }\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd.slice();\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            if (options === void 0) { options = {}; }\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        Object.defineProperty(SubsetOfCollection.prototype, \"length\", {\n            get: function () {\n                return this.models.length || (this.refs ? this.refs.length : 0);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.refs = null;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs.slice();\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = tslib_1.__decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    SubsetOfCollection.prototype._itemEvents = void 0;\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements.slice();\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return elements ? (Array.isArray(elements) ? elements : [elements]) : [];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tslib_1 from \"tslib\";\nimport { tools } from './object-plus';\nObject.setPrototypeOf || (Object.setPrototypeOf = tools.defaults);\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nexport * from './transactions';\nexport * from './io-tools';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        tslib_1.__extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = tslib_1.__decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map","import * as _ from 'underscore';\nimport * as jQuery from 'jquery';\nvar previousBackbone = window.Backbone;\nvar slice = Array.prototype.slice;\nvar exported = {\n    $: jQuery,\n    history: null,\n    VERSION: '1.2.3',\n    View: View, History: History, Router: Router, noConflict: noConflict\n};\nexport default exported;\nfunction noConflict() {\n    window.Backbone = previousBackbone;\n    return this;\n}\n;\nexport function View(options) {\n    this.cid = _.uniqueId('view');\n    options || (options = {});\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n    this.delegateEvents();\n}\n;\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n_.extend(View.prototype, {\n    tagName: 'div',\n    $: function (selector) {\n        return this.$el.find(selector);\n    },\n    initialize: function () { },\n    render: function () {\n        return this;\n    },\n    remove: function () {\n        this.$el.remove();\n        this.stopListening();\n        return this;\n    },\n    setElement: function (element, delegate) {\n        if (this.$el)\n            this.undelegateEvents();\n        this.$el = element instanceof exported.$ ? element : exported.$(element);\n        this.el = this.$el[0];\n        if (delegate !== false)\n            this.delegateEvents();\n        return this;\n    },\n    delegateEvents: function (events) {\n        if (!(events || (events = _.result(this, 'events'))))\n            return this;\n        this.undelegateEvents();\n        for (var key in events) {\n            var method = events[key];\n            if (!_.isFunction(method))\n                method = this[events[key]];\n            if (!method)\n                continue;\n            var match = key.match(delegateEventSplitter);\n            var eventName = match[1], selector = match[2];\n            method = _.bind(method, this);\n            eventName += '.delegateEvents' + this.cid;\n            if (selector === '') {\n                this.$el.on(eventName, method);\n            }\n            else {\n                this.$el.on(eventName, selector, method);\n            }\n        }\n        return this;\n    },\n    undelegateEvents: function () {\n        this.$el.off('.delegateEvents' + this.cid);\n        return this;\n    },\n    _ensureElement: function () {\n        if (!this.el) {\n            var attrs = _.extend({}, _.result(this, 'attributes'));\n            if (this.id)\n                attrs.id = _.result(this, 'id');\n            if (this.className)\n                attrs['class'] = _.result(this, 'className');\n            var $el = exported.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n            this.setElement($el, false);\n        }\n        else {\n            this.setElement(_.result(this, 'el'), false);\n        }\n    }\n});\nexport function Router(options) {\n    options || (options = {});\n    if (options.routes)\n        this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n}\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam = /(\\(\\?)?:\\w+/g;\nvar splatParam = /\\*\\w+/g;\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n_.extend(Router.prototype, {\n    initialize: function () { },\n    route: function (route, name, callback) {\n        if (!_.isRegExp(route))\n            route = this._routeToRegExp(route);\n        if (_.isFunction(name)) {\n            callback = name;\n            name = '';\n        }\n        if (!callback)\n            callback = this[name];\n        var router = this;\n        exported.history.route(route, function (fragment) {\n            var args = router._extractParameters(route, fragment);\n            if (router.execute(callback, args, name) !== false) {\n                router.trigger.apply(router, ['route:' + name].concat(args));\n                router.trigger('route', name, args);\n                exported.history.trigger('route', router, name, args);\n            }\n        });\n        return this;\n    },\n    execute: function (callback, args, name) {\n        if (callback)\n            callback.apply(this, args);\n    },\n    navigate: function (fragment, options) {\n        exported.history.navigate(fragment, options);\n        return this;\n    },\n    _bindRoutes: function () {\n        if (!this.routes)\n            return;\n        this.routes = _.result(this, 'routes');\n        var route, routes = _.keys(this.routes);\n        while ((route = routes.pop()) != null) {\n            this.route(route, this.routes[route]);\n        }\n    },\n    _routeToRegExp: function (route) {\n        route = route.replace(escapeRegExp, '\\\\$&')\n            .replace(optionalParam, '(?:$1)?')\n            .replace(namedParam, function (match, optional) {\n            return optional ? match : '([^/?]+)';\n        })\n            .replace(splatParam, '([^?]*?)');\n        return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n    _extractParameters: function (route, fragment) {\n        var params = route.exec(fragment).slice(1);\n        return _.map(params, function (param, i) {\n            if (i === params.length - 1)\n                return param || null;\n            return param ? decodeURIComponent(param) : null;\n        });\n    }\n});\nexport function History() {\n    this.handlers = [];\n    this.checkUrl = _.bind(this.checkUrl, this);\n    if (typeof window !== 'undefined') {\n        this.location = window.location;\n        this.history = window.history;\n    }\n}\n;\nvar routeStripper = /^[#\\/]|\\s+$/g;\nvar rootStripper = /^\\/+|\\/+$/g;\nvar pathStripper = /#.*$/;\nHistory.started = false;\n_.extend(History.prototype, {\n    interval: 50,\n    atRoot: function () {\n        var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n        return path === this.root && !this.getSearch();\n    },\n    matchRoot: function () {\n        var path = this.decodeFragment(this.location.pathname);\n        var root = path.slice(0, this.root.length - 1) + '/';\n        return root === this.root;\n    },\n    decodeFragment: function (fragment) {\n        return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n    getSearch: function () {\n        var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n        return match ? match[0] : '';\n    },\n    getHash: function (window) {\n        var match = (window || this).location.href.match(/#(.*)$/);\n        return match ? match[1] : '';\n    },\n    getPath: function () {\n        var path = this.decodeFragment(this.location.pathname + this.getSearch()).slice(this.root.length - 1);\n        return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n    getFragment: function (fragment) {\n        if (fragment == null) {\n            if (this._usePushState || !this._wantsHashChange) {\n                fragment = this.getPath();\n            }\n            else {\n                fragment = this.getHash();\n            }\n        }\n        return fragment.replace(routeStripper, '');\n    },\n    start: function (options) {\n        if (History.started)\n            throw new Error('Backbone.history has already been started');\n        History.started = true;\n        this.options = _.extend({ root: '/' }, this.options, options);\n        this.root = this.options.root;\n        this._wantsHashChange = this.options.hashChange !== false;\n        this._hasHashChange = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n        this._useHashChange = this._wantsHashChange && this._hasHashChange;\n        this._wantsPushState = !!this.options.pushState;\n        this._hasPushState = !!(this.history && this.history.pushState);\n        this._usePushState = this._wantsPushState && this._hasPushState;\n        this.fragment = this.getFragment();\n        this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n        if (this._wantsHashChange && this._wantsPushState) {\n            if (!this._hasPushState && !this.atRoot()) {\n                var root = this.root.slice(0, -1) || '/';\n                this.location.replace(root + '#' + this.getPath());\n                return true;\n            }\n            else if (this._hasPushState && this.atRoot()) {\n                this.navigate(this.getHash(), { replace: true });\n            }\n        }\n        if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n            this.iframe = document.createElement('iframe');\n            this.iframe.src = 'javascript:0';\n            this.iframe.style.display = 'none';\n            this.iframe.tabIndex = -1;\n            var body = document.body;\n            var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n            iWindow.document.open();\n            iWindow.document.close();\n            iWindow.location.hash = '#' + this.fragment;\n        }\n        var addEventListener = window.addEventListener || function (eventName, listener) {\n            return attachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            addEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            addEventListener('hashchange', this.checkUrl, false);\n        }\n        else if (this._wantsHashChange) {\n            this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n        }\n        if (!this.options.silent)\n            return this.loadUrl();\n    },\n    stop: function () {\n        var removeEventListener = window.removeEventListener || function (eventName, listener) {\n            return detachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            removeEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            removeEventListener('hashchange', this.checkUrl, false);\n        }\n        if (this.iframe) {\n            document.body.removeChild(this.iframe);\n            this.iframe = null;\n        }\n        if (this._checkUrlInterval)\n            clearInterval(this._checkUrlInterval);\n        History.started = false;\n    },\n    route: function (route, callback) {\n        this.handlers.unshift({ route: route, callback: callback });\n    },\n    checkUrl: function (e) {\n        var current = this.getFragment();\n        if (current === this.fragment && this.iframe) {\n            current = this.getHash(this.iframe.contentWindow);\n        }\n        if (current === this.fragment)\n            return false;\n        if (this.iframe)\n            this.navigate(current);\n        this.loadUrl();\n    },\n    loadUrl: function (fragment) {\n        if (!this.matchRoot())\n            return false;\n        fragment = this.fragment = this.getFragment(fragment);\n        return _.some(this.handlers, function (handler) {\n            if (handler.route.test(fragment)) {\n                handler.callback(fragment);\n                return true;\n            }\n        });\n    },\n    navigate: function (fragment, options) {\n        if (!History.started)\n            return false;\n        if (!options || options === true)\n            options = { trigger: !!options };\n        fragment = this.getFragment(fragment || '');\n        var root = this.root;\n        if (fragment === '' || fragment.charAt(0) === '?') {\n            root = root.slice(0, -1) || '/';\n        }\n        var url = root + fragment;\n        fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n        if (this.fragment === fragment)\n            return;\n        this.fragment = fragment;\n        if (this._usePushState) {\n            this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        }\n        else if (this._wantsHashChange) {\n            this._updateHash(this.location, fragment, options.replace);\n            if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n                var iWindow = this.iframe.contentWindow;\n                if (!options.replace) {\n                    iWindow.document.open();\n                    iWindow.document.close();\n                }\n                this._updateHash(iWindow.location, fragment, options.replace);\n            }\n        }\n        else {\n            return this.location.assign(url);\n        }\n        if (options.trigger)\n            return this.loadUrl(fragment);\n    },\n    _updateHash: function (location, fragment, replace) {\n        if (replace) {\n            var href = location.href.replace(/(javascript:|#).*$/, '');\n            location.replace(href + '#' + fragment);\n        }\n        else {\n            location.hash = '#' + fragment;\n        }\n    }\n});\nexported.history = new History;\n//# sourceMappingURL=backbone.js.map","import * as tslib_1 from \"tslib\";\nimport Sync from './sync';\nimport * as _ from 'underscore';\nimport { define, Model, Collection, tools, definitions, mixinRules } from './type-r';\nvar defaults = tools.defaults;\nvar transactionalProto = tools.getBaseClass(Model).prototype;\nvar RestCollection = (function (_super) {\n    tslib_1.__extends(RestCollection, _super);\n    function RestCollection() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestCollection.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestCollection.prototype.url = function () { return this.model.prototype.urlRoot || ''; };\n    RestCollection.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            this.trigger('invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestCollection.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var success = options.success;\n        var collection = this;\n        options.success = function (resp) {\n            var method = options.reset ? 'reset' : 'set';\n            collection[method](resp, options);\n            if (collection._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, collection, resp, options);\n            collection.trigger('sync', collection, resp, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestCollection.prototype.create = function (a_model, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var model = a_model instanceof RestModel ?\n            a_model :\n            this.model.create(a_model, options);\n        model._owner || (model._owner = this);\n        options.wait || this.add([model], options);\n        var collection = this;\n        var success = options.success;\n        options.success = function (model, resp, callbackOpts) {\n            if (options.wait)\n                _this.add([model], defaults({ parse: false }, callbackOpts));\n            if (success)\n                success.call(callbackOpts.context, model, resp, callbackOpts);\n        };\n        model.save(null, options);\n        return model;\n    };\n    RestCollection.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestCollection = tslib_1.__decorate([\n        define({\n            itemEvents: {\n                destroy: function (model) { this.remove(model); }\n            }\n        })\n    ], RestCollection);\n    return RestCollection;\n}(Collection));\nexport { RestCollection };\n;\nvar RestModel = (function (_super) {\n    tslib_1.__extends(RestModel, _super);\n    function RestModel() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestModel.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            triggerAndBubble(this, 'invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestModel.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestModel.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var model = this;\n        var success = options.success;\n        options.success = function (serverAttrs) {\n            model.set(serverAttrs, options);\n            if (model._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestModel.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestModel.prototype.save = function (key, val, a_options) {\n        var _this = this;\n        var attrs, originalOptions;\n        if (key == null || typeof key === 'object') {\n            attrs = key;\n            originalOptions = val || {};\n        }\n        else {\n            (attrs = {})[key] = val;\n            originalOptions = a_options || {};\n        }\n        var options = _.extend({ validate: true, parse: true }, originalOptions), wait = options.wait;\n        if (attrs && !wait) {\n            this.set(attrs, originalOptions);\n        }\n        if (this._invalidate(options)) {\n            if (attrs && wait)\n                this.set(attrs, originalOptions);\n            return Sync.errorPromise(this.validationError);\n        }\n        var model = this;\n        var success = options.success;\n        var attributes = this.attributes;\n        options.success = function (serverAttrs) {\n            model.attributes = attributes;\n            if (wait)\n                serverAttrs = _.extend({}, attrs, serverAttrs);\n            if (serverAttrs) {\n                transactionalProto.set.call(_this, serverAttrs, options);\n                if (model._invalidate(options))\n                    return false;\n            }\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        if (attrs && wait)\n            this.attributes = _.extend({}, attributes, attrs);\n        var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n        if (method === 'patch' && !options.attrs)\n            options.attrs = attrs;\n        var xhr = _sync(method, this, options);\n        this.attributes = attributes;\n        return xhr;\n    };\n    RestModel.prototype.destroy = function (options) {\n        options = options ? _.clone(options) : {};\n        var model = this;\n        var success = options.success;\n        var wait = options.wait;\n        var destroy = function () {\n            model.stopListening();\n            model.trigger('destroy', model, model.collection, options);\n        };\n        options.success = function (resp) {\n            if (wait)\n                destroy();\n            if (success)\n                success.call(options.context, model, resp, options);\n            if (!model.isNew())\n                triggerAndBubble(model, 'sync', model, resp, options);\n        };\n        var xhr;\n        if (this.isNew()) {\n            _.defer(options.success);\n        }\n        else {\n            wrapError(this, options);\n            xhr = _sync('delete', this, options);\n        }\n        if (!wait)\n            destroy();\n        return xhr || false;\n    };\n    RestModel.prototype.url = function () {\n        var base = _.result(this, 'urlRoot') ||\n            _.result(this.collection, 'url') ||\n            Sync.urlError();\n        if (this.isNew())\n            return base;\n        var id = this.get(this.idAttribute);\n        return base.replace(/[^\\/]$/, '$&/') + encodeURIComponent(id);\n    };\n    RestModel.prototype.set = function (a, b, c) {\n        if (typeof a === 'string') {\n            if (c) {\n                return _super.prototype.set.call(this, (_a = {}, _a[a] = b, _a), c);\n            }\n            else {\n                this[a] = b;\n                return this;\n            }\n        }\n        else {\n            return _super.prototype.set.call(this, a, b);\n        }\n        var _a;\n    };\n    RestModel.Collection = RestCollection;\n    RestModel = tslib_1.__decorate([\n        define({\n            urlRoot: ''\n        }),\n        definitions({\n            urlRoot: mixinRules.protoValue\n        })\n    ], RestModel);\n    return RestModel;\n}(Model));\nexport { RestModel };\nfunction _sync(method, _this, options) {\n    _this._xhr && _this._xhr.abort && _this._xhr.abort();\n    var xhr = _this._xhr = _this.sync(method, _this, options);\n    xhr && xhr.always && xhr.always(function () { _this._xhr = void 0; });\n    return xhr;\n}\nfunction wrapError(model, options) {\n    var error = options.error;\n    options.error = function (resp) {\n        if (error)\n            error.call(options.context, model, resp, options);\n        triggerAndBubble(model, 'error', model, resp, options);\n    };\n}\nfunction triggerAndBubble(model) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    model.trigger.apply(model, args);\n    var collection = model.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=rest.js.map","import * as _ from 'underscore';\nexport var ModelMixin = {\n    pick: function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return _.pick(this, args);\n    },\n    escape: function (attr) {\n        return _.escape(this[attr]);\n    },\n    matches: function (attrs) {\n        return !!_.iteratee(attrs, this)(this);\n    },\n    omit: function () {\n        var keys = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            keys[_i] = arguments[_i];\n        }\n        return this.mapObject(function (value, key) {\n            if (keys.indexOf(key) < 0) {\n                return value;\n            }\n        });\n    },\n    invert: function () {\n        var inverted = {};\n        this.each(function (value, key) { return inverted[value] = key; });\n        return inverted;\n    },\n    pairs: function () {\n        return this.map(function (value, key) { return [key, value]; });\n    },\n    isEmpty: function () {\n        return !this.values().length;\n    },\n    chain: function () {\n        return _.chain(this.mapObject(function (x) { return x; }));\n    }\n};\nexport var CollectionMixin = {\n    where: function (attrs, first) {\n        return this[first ? 'find' : 'filter'](attrs);\n    },\n    findWhere: function (attrs) {\n        return this.where(attrs, true);\n    }\n};\naddUnderscoreMethods(CollectionMixin, 'models', {\n    forEach: 3, each: 3, map: 3, collect: 3, reduce: 4,\n    foldl: 4, inject: 4, reduceRight: 4, foldr: 4, find: 3, findIndex: 3, findLastIndex: 3, detect: 3, filter: 3,\n    select: 3, reject: 3, every: 3, all: 3, some: 3, any: 3, include: 3, includes: 3,\n    contains: 3, invoke: 0, max: 3, min: 3, toArray: 1, size: 1, first: 3,\n    head: 3, take: 3, initial: 3, rest: 3, tail: 3, drop: 3, last: 3,\n    without: 0, difference: 0, indexOf: 3, shuffle: 1, lastIndexOf: 3,\n    isEmpty: 1, chain: 1, sample: 3, partition: 3, groupBy: 3, countBy: 3,\n    sortBy: 3, indexBy: 3\n});\nfunction addUnderscoreMethods(Mixin, attribute, methods) {\n    _.each(methods, function (length, method) {\n        if (_[method])\n            Mixin[method] = addMethod(length, method, attribute);\n    });\n}\nfunction addMethod(length, method, attribute) {\n    switch (length) {\n        case 1: return function () {\n            return _[method](this[attribute]);\n        };\n        case 2: return function (value) {\n            return _[method](this[attribute], value);\n        };\n        case 3: return function (iteratee, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, context)\n                : _[method](value, callback);\n        };\n        case 4: return function (iteratee, defaultVal, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, defaultVal, context)\n                : _[method](value, callback);\n        };\n        default: return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            args.unshift(this[attribute]);\n            return _[method].apply(_, args);\n        };\n    }\n}\nfunction cb(iteratee, instance) {\n    switch (typeof iteratee) {\n        case 'function': return iteratee;\n        case 'string': return function (model) { return model.get(iteratee); };\n        case 'object':\n            if (!(iteratee instanceof instance.model))\n                return _.matches(iteratee);\n    }\n    return iteratee;\n}\n//# sourceMappingURL=underscore-mixin.js.map","import * as TypeR from './type-r';\nexport * from './type-r';\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\nimport { Store as BaseStore, tools, MixinsState } from './type-r';\nimport Sync from './sync';\nimport { ModelMixin, CollectionMixin } from './underscore-mixin';\nimport { RestStore, LazyStore } from './rest-store';\nexport var Class = TypeR.Messenger;\nvar Nested = Object.create(TypeR, tools.defaults({\n    'sync': linkProperty(Sync, 'sync'),\n    'errorPromise': linkProperty(Sync, 'errorPromise'),\n    'ajax': linkProperty(Sync, 'ajax'),\n    'history': linkProperty(Backbone, 'history'),\n    'store': linkProperty(BaseStore, 'global'),\n    '$': {\n        get: function () { return Backbone.$; },\n        set: function (value) { Backbone.$ = Sync.$ = value; }\n    }\n}, toProps({ Backbone: Backbone, Class: Class, Model: RestModel, Collection: RestCollection, LazyStore: LazyStore, Store: RestStore, defaults: defaults }), toProps(Backbone)));\nexport default Nested;\nexport { Backbone, RestStore, LazyStore, RestCollection as Collection, RestModel as Model };\nexport function defaults(x) {\n    return Nested.Model.defaults(x);\n}\nexport * from './backbone';\nMixinsState.get(Nested.Mixable).merge([Nested.Events]);\nNested.Messenger.mixins.populate(Backbone.View, Backbone.Router, Backbone.History);\nNested.Record.mixins.merge([ModelMixin]);\nNested.Record.Collection.mixins.merge([CollectionMixin]);\nfunction linkProperty(Namespace, name) {\n    return {\n        get: function () { return Namespace[name]; },\n        set: function (value) { Namespace[name] = value; }\n    };\n}\nfunction toProps(obj) {\n    return tools.transform({}, obj, function (x) { return ({ value: x }); });\n}\n//# sourceMappingURL=index.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    tslib_1.__extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            free(record, prev);\n            options.unset || prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    tslib_1.__extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                options.unset || prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","import * as tslib_1 from \"tslib\";\nimport { startIO } from '../io-tools';\nexport var IORecordMixin = {\n    save: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var endpoint = this.getEndpoint(), json = this.toJSON();\n        return startIO(this, this.isNew() ?\n            endpoint.create(json, options, this) :\n            endpoint.update(this.id, json, options, this), options, function (update) {\n            _this.set(update, tslib_1.__assign({ parse: true }, options));\n        });\n    },\n    fetch: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().read(this.id, options, this), options, function (json) { return _this.set(json, tslib_1.__assign({ parse: true }, options)); });\n    },\n    destroy: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().destroy(this.id, options, this), options, function () {\n            var collection = _this.collection;\n            if (collection) {\n                collection.remove(_this, options);\n            }\n            else {\n                _this.dispose();\n            }\n        });\n    }\n};\n//# sourceMappingURL=io-mixin.js.map","import * as tslib_1 from \"tslib\";\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nimport { IORecordMixin } from './io-mixin';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    tslib_1.__extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this._previousAttributes = _this.attributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.save = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.destroy = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), tslib_1.__assign({ unset: true }, options));\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        if (values === void 0) { values = {}; }\n        var defaults = {}, _attributesArray = this._attributesArray;\n        for (var _i = 0, _attributesArray_1 = _attributesArray; _i < _attributesArray_1.length; _i++) {\n            var attr = _attributesArray_1[_i];\n            var key = attr.name, value = values[key];\n            defaults[key] = value === void 0 ? attr.defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, tslib_1.__assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin, IORecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    tslib_1.__extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    tslib_1.__extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","import * as _ from 'underscore';\nimport Backbone from './backbone';\nimport { tools } from './type-r';\nvar defaults = tools.defaults;\nvar methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch': 'PATCH',\n    'delete': 'DELETE',\n    'read': 'GET'\n};\nvar exported = {\n    $: Backbone.$,\n    errorPromise: function (error) {\n        var x = $.Deferred();\n        x.reject(error);\n        return x;\n    },\n    ajax: function (options) {\n        return $.ajax.apply($, arguments);\n    },\n    sync: sync,\n    urlError: function () {\n        throw new Error('A \"url\" property or function must be specified');\n    }\n};\nexport default exported;\nfunction sync(method, model, options) {\n    if (options === void 0) { options = {}; }\n    var type = methodMap[method];\n    var params = { type: type, dataType: 'json' };\n    if (!options.url) {\n        params.url = _.result(model, 'url') || exported.urlError();\n    }\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n        params.contentType = 'application/json';\n        params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n    if (params.type !== 'GET') {\n        params.processData = false;\n    }\n    var error = options.error;\n    options.error = function (xhr, textStatus, errorThrown) {\n        options.textStatus = textStatus;\n        options.errorThrown = errorThrown;\n        if (error)\n            error.call(options.context, xhr, textStatus, errorThrown);\n    };\n    var xhr = options.xhr = exported.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    model.collection && model.collection.trigger('request', model, xhr, options);\n    return xhr;\n}\n//# sourceMappingURL=sync.js.map","import * as tslib_1 from \"tslib\";\nimport Backbone from './backbone';\nimport * as _ from 'underscore';\nimport { define, Store } from './type-r';\nimport { RestModel, RestCollection } from './rest';\nvar RestStore = (function (_super) {\n    tslib_1.__extends(RestStore, _super);\n    function RestStore() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestStore = tslib_1.__decorate([\n        define({\n            getStore: Store.prototype.getStore,\n            get: Store.prototype.get,\n        })\n    ], RestStore);\n    return RestStore;\n}(RestModel));\nexport { RestStore };\nvar LazyStore = (function (_super) {\n    tslib_1.__extends(LazyStore, _super);\n    function LazyStore() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._resolved = {};\n        return _this;\n    }\n    LazyStore.prototype.initialize = function () {\n        var _this = this;\n        this.each(function (element, name) {\n            if (!element)\n                return;\n            element.store = _this;\n            var fetch = element.fetch;\n            if (fetch) {\n                var self_1 = _this;\n                element.fetch = function () {\n                    return self_1._resolved[name] = fetch.apply(this, arguments);\n                };\n            }\n            if (element instanceof RestCollection && element.length) {\n                _this._resolved[name] = true;\n            }\n        });\n    };\n    LazyStore.prototype.fetch = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_1 = objsToFetch; _a < objsToFetch_1.length; _a++) {\n            var name_1 = objsToFetch_1[_a];\n            var attr = this.attributes[name_1];\n            attr && attr.fetch && xhr.push(attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.fetchOnce = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], self = this, objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_2 = objsToFetch; _a < objsToFetch_2.length; _a++) {\n            var name_2 = objsToFetch_2[_a];\n            var attr = self.attributes[name_2];\n            xhr.push(self._resolved[name_2] || attr && attr.fetch && attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.clear = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var objsToClear = args.length ? args : this.keys();\n        for (var _a = 0, objsToClear_1 = objsToClear; _a < objsToClear_1.length; _a++) {\n            var name_3 = objsToClear_1[_a];\n            var element = this.attributes[name_3];\n            if (element instanceof RestCollection) {\n                element.reset();\n            }\n            else if (element instanceof Store) {\n                element.clear();\n            }\n            else if (element instanceof RestModel) {\n                element.set(element.defaults());\n            }\n            this._resolved[name_3] = false;\n        }\n        return this;\n    };\n    LazyStore.onDefine = function (definitions, BaseClass) {\n        var attributes = definitions.defaults || definitions.attributes;\n        _.each(attributes, function (Type, name) {\n            if (Type.has) {\n                attributes[name] = Type.has\n                    .set(function (value) {\n                    if (!value || !value.length) {\n                        var resolved = this._resolved || (this._resolved = {});\n                        resolved[name] = false;\n                    }\n                    return value;\n                });\n            }\n        });\n        RestModel.onDefine.call(this, definitions, BaseClass);\n    };\n    LazyStore = tslib_1.__decorate([\n        define\n    ], LazyStore);\n    return LazyStore;\n}(RestStore));\nexport { LazyStore };\n//# sourceMappingURL=rest-store.js.map"],"names":["__extends","d","b","__","this","constructor","extendStatics","prototype","Object","create","__rest","s","e","t","p","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","defaults","dest","source","name","other","isValidJSON","value","proto","getPrototypeOf","Array","every","getBaseClass","Class","isEmpty","obj","some","fun","ArrayProto","arr","result","someArray","someObject","predicate","x","omit","discard","transform","assign","once","func","memo","first","apply","notEqual","a","protoA","DateProto","arraysNotEqual","ObjectProto","keysA","keys","objectsNotEqual","hashMap","hash","HashProto","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","propertyListDecorator","listName","slice","push","definitionDecorator","definitionKey","mergeObject","_a","_b","assignProperty","sourceProp","rule","unshift","destProp","configurable","resolveRule","getBubblingHandler","event","_bubblingHandlers","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend3","on","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","_i","names_1","split","self","queue","all","listSend2","listSend4","listSend5","f","listSend6","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","getOwnerEndpoint","collection","_owner","_endpoints","_ownerKey","createIOPromise","initialize","abort","fn","onAbort","resolve","reject","promise","Promise","a_resolve","a_reject","Error","startIO","options","thenDo","abortIO","ioUpdate","_ioPromise","then","resp","triggerAndBubble","catch","err","console","error","eventSource","args","trigger","setAttribute","record","isRoot","begin","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","type","spec","ChainableAttributeSpec","_attribute","defaultValue","hasCustomDefault","toAttributeOptions","attrSpec","has","type_1","Number","String","Boolean","inferType","Transactional","shared","supportsDate","date","isNaN","Date","getTime","Integer","Math","round","doNothing","createAttribute","AnyType","createSharedTypeSpec","Attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","ref","CompiledReference","local","tail","createWatcherFromRef","watcher","wrapWatcher","attrName","asProp","getMetadata","prop","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","dispose","unsubscribe","sortElements","_comparator","sort","models","addIndex","index","id","removeIndex","updateIndex","previous","idAttribute","logAggregationError","addTransaction","items","nested","added","a_items","a_options","forceMerge","_byId","parse","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","appendElements","needSort","at","length_1","j","moveElements","sortOrMoveElements","CollectionTransaction","emptySetTransaction","silent","len","src","_reallocateEmpty","silentOptions","setTransaction","_prevById","prevModels","toAdd","orderKept","sorted","_reallocate","reusedCount","removed","previous_1","_garbageCollect","children","children_1","freeAll","addedOrChanged","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","k","toPredicateFunction","iteratee","parseReference","collectionRef","resolveRefs","master","records","elements_1","el","delaySet","tools.notEqual","refs","transactionApi","toArray","_super","DefaultRecord","tslib_1.__extends","tslib_1.__decorate","Model","method","_this","View","_.uniqueId","_.extend","_.pick","viewOptions","_ensureElement","delegateEvents","Router","routes","_bindRoutes","History","handlers","checkUrl","_.bind","window","location","history","_sync","_xhr","xhr","sync","always","wrapError","addUnderscoreMethods","Mixin","attribute","methods","_.each","_","cb","defaultVal","addMethod","instance","_.matches","Nested","linkProperty","Namespace","set","toProps","tools.transform","setPrototypeOf","__proto__","__assign","n","levelToNumber","none","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","toString","something","__inner_state__","keys_1","body","name_1","definition","names","name_2","o","protoProps","staticProps","defineMixin","tslib_1.__rest","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","concat","ctors","ctors_1","object","ignore","dontMix","forEachOwnProp","mixinRules","protoValue","baseProto","function","caller","list","pipe","classFirst","classLast","EventMap","addEventsMap","bubbleEvents","EventDescriptor","event_1","event_2","handler","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","localEvents","properties","eventsMap","defineProperties","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","_validateNested","validate","each","eachError","splitTail","substr","pop","shift","eventsApi.trigger3","eventsApi.on","eventsApi.off","_changeToken","_transaction","_isDirty","_validationError","cidPrefix","Transactional_1","endpoint","_endpoint","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","data","deepGet","_defaultStore","val","hasPendingIO","fetch","getEndpoint","mapObject","enumerable","getValidationError","validationError","deepValidationError","eachValidationError","isValid","valueOf","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","propagateChanges","forceAttributeChange","a_values","unknown","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","toJSON","changeEvents","tools.isValidJSON","JSON","stringify","isRequired","wrapIsRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","_has","DateType","timestamp","toISOString","msDatePattern","MSDateType","msDate","exec","TimestampType","microsoft","struct","minutesOffset","isoDatePattern","numericKeys","undefined","UTC","safeParseDate","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","IORecordMixin","save","json","isNew","tslib_1.__assign","read","destroy","remove","tools.isEmpty","_cidCounter","typeCheck","previousAttributes","_attributesArray","changedAttributes","diff","old","clear","nullify","forEachAttr","_toJSON","_parse","_attributesArray_1","copy","pinStore","deepClone","errors","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","createToJSON","attrsWithParse","filter","parseMixin","attrDef","compile","getAttributes","dynamicMixin","eventsApi.trigger2","_d","added_1","_e","removed_1","_count","CollectionRefsType","comparator","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","objOrId","forEach","find","mapped","count","last","a_index","add","reset","liveUpdates","enabled","filter_1","_liveUpdates","updated","aggregated","a_elements","previousModels","previousModels_1","toDispose","recordsOrIds","splice","notify","removeOne","pluck","modelOrId","modelId","toggle","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","CollectionConstructor","SubsetOfCollection","subsetOfBehavior","resolvedWith","raw","getModelIds","addAll","toggleAll","defineSubsetCollection","Store","store","global","previousBackbone","Backbone","exported","$","jQuery","VERSION","noConflict","delegateEventSplitter","tagName","selector","$el","render","setElement","element","delegate","undelegateEvents","_.result","_.isFunction","eventName","className","optionalParam","namedParam","splatParam","escapeRegExp","route","_.isRegExp","_routeToRegExp","router","fragment","_extractParameters","execute","navigate","_.keys","replace","optional","RegExp","params","_.map","param","decodeURIComponent","routeStripper","rootStripper","pathStripper","started","interval","atRoot","pathname","getSearch","matchRoot","decodeFragment","decodeURI","href","getHash","getPath","charAt","getFragment","_usePushState","_wantsHashChange","start","hashChange","_hasHashChange","document","documentMode","_useHashChange","_wantsPushState","pushState","_hasPushState","iframe","createElement","style","display","tabIndex","iWindow","insertBefore","firstChild","contentWindow","open","close","addEventListener","attachEvent","_checkUrlInterval","setInterval","loadUrl","removeEventListener","detachEvent","removeChild","clearInterval","current","_.some","url","title","_updateHash","methodMap","patch","delete","errorPromise","Deferred","ajax","dataType","urlError","contentType","processData","textStatus","errorThrown","transactionalProto","tools.getBaseClass","RestCollection","urlRoot","_invalidate","success","a_model","RestModel","wait","callbackOpts","Sync","serverAttrs","_.clone","_.defer","base","encodeURIComponent","ModelMixin","pick","escape","_.escape","matches","_.iteratee","invert","inverted","pairs","chain","_.chain","CollectionMixin","where","findWhere","collect","foldl","inject","reduceRight","foldr","findIndex","findLastIndex","detect","select","any","include","includes","contains","invoke","max","min","size","take","initial","rest","drop","without","difference","shuffle","lastIndexOf","sample","partition","groupBy","countBy","sortBy","indexBy","RestStore","LazyStore","_resolved","self_1","objsToFetch_1","when","fetchOnce","objsToFetch_2","objsToClear_1","Type","TypeR.Messenger","TypeR","BaseStore"],"mappings":"mQAoBA,SAAgBA,EAAUC,EAAGC,GAEzB,SAASC,IAAOC,KAAKC,YAAcJ,EADnCK,GAAcL,EAAGC,GAEjBD,EAAEM,UAAkB,OAANL,EAAaM,OAAOC,OAAOP,IAAMC,EAAGI,UAAYL,EAAEK,UAAW,IAAIJ,GAWnF,SAAgBO,EAAOC,EAAGC,GACtB,IAAIC,KACJ,IAAK,IAAIC,KAAKH,EAAOH,OAAOD,UAAUQ,eAAeC,KAAKL,EAAGG,IAAMF,EAAEK,QAAQH,GAAK,IAC9ED,EAAEC,GAAKH,EAAEG,IACb,GAAS,MAALH,GAAqD,mBAAjCH,OAAOU,sBAC3B,IAAK,IAAIC,EAAI,EAAGL,EAAIN,OAAOU,sBAAsBP,GAAIQ,EAAIL,EAAEM,OAAQD,IAASP,EAAEK,QAAQH,EAAEK,IAAM,IAC1FN,EAAEC,EAAEK,IAAMR,EAAEG,EAAEK,KACtB,OAAON,EAGX,SAAgBQ,EAAWC,EAAYC,EAAQC,EAAKC,GAChD,IAA2HxB,EAAvHyB,EAAIC,UAAUP,OAAQQ,EAAIF,EAAI,EAAIH,EAAkB,OAATE,EAAgBA,EAAOjB,OAAOqB,yBAAyBN,EAAQC,GAAOC,EACrH,GAAuB,iBAAZK,SAAoD,mBAArBA,QAAQC,SAAyBH,EAAIE,QAAQC,SAAST,EAAYC,EAAQC,EAAKC,QACpH,IAAK,IAAIN,EAAIG,EAAWF,OAAS,EAAGD,GAAK,EAAGA,KAASlB,EAAIqB,EAAWH,MAAIS,GAAKF,EAAI,EAAIzB,EAAE2B,GAAKF,EAAI,EAAIzB,EAAEsB,EAAQC,EAAKI,GAAK3B,EAAEsB,EAAQC,KAASI,GAChJ,OAAOF,EAAI,GAAKE,GAAKpB,OAAOwB,eAAeT,EAAQC,EAAKI,GAAIA,EChDzD,SAASK,EAASC,EAAMC,GAC3B,IAAK,IAAIC,KAAQD,EACTA,EAAOpB,eAAeqB,KAAUF,EAAKnB,eAAeqB,KACpDF,EAAKE,GAAQD,EAAOC,IAG5B,GAAIT,UAAUP,OAAS,EACnB,IAAK,IAAID,EAAI,EAAGA,EAAIQ,UAAUP,OAAQD,IAAK,CACvC,IAAIkB,EAAQV,UAAUR,GACtBkB,GAASJ,EAASC,EAAMG,GAGhC,OAAOH,EAmDX,SAAgBI,EAAYC,GACxB,GAAc,OAAVA,EACA,OAAO,EAEX,cAAeA,GACX,IAAK,SACL,IAAK,SACL,IAAK,UACD,OAAO,EACX,IAAK,SACD,IAAIC,EAAQhC,OAAOiC,eAAeF,GAClC,GAAIC,IAAUhC,OAAOD,WAAaiC,IAAUE,MAAMnC,UAC9C,OAAOoC,EAAMJ,EAAOD,GAGhC,OAAO,EAEX,SAAgBM,EAAaC,GACzB,OAAOrC,OAAOiC,eAAeI,EAAMtC,WAAWF,YAalD,SAAgByC,EAAQC,GACpB,GAAIA,EACA,IAAK,IAAIvB,KAAOuB,EACZ,GAAIA,EAAIhC,eAAeS,GACnB,OAAO,EAInB,OAAO,EAoBX,SAAgBwB,EAAKD,EAAKE,GACtB,OAAIzC,OAAOiC,eAAeM,KAASG,GAnBvC,SAAmBC,EAAKF,GAEpB,IAAK,IADDG,EACKjC,EAAI,EAAGA,EAAIgC,EAAI/B,OAAQD,IAC5B,GAAIiC,EAASH,EAAIE,EAAIhC,GAAIA,GACrB,OAAOiC,EAgBJC,CAAUN,EAAKE,GAZ9B,SAAoBF,EAAKE,GACrB,IAAIG,EACJ,IAAK,IAAI5B,KAAOuB,EACZ,GAAIA,EAAIhC,eAAeS,KACf4B,EAASH,EAAIF,EAAIvB,GAAMA,IACvB,OAAO4B,EAURE,CAAWP,EAAKE,GAG/B,SAAgBN,EAAMI,EAAKQ,GACvB,OAAQP,EAAKD,EAAK,SAAUS,GAAK,OAAQD,EAAUC,KASvD,SAAgBC,EAAKtB,GAEjB,IAAK,IADDD,KAAWwB,KACNvC,EAAI,EAAGA,EAAIQ,UAAUP,OAAQD,IAClCuC,EAAQ/B,UAAUR,KAAM,EAE5B,IAAK,IAAIiB,KAAQD,GACRuB,EAAQ3C,eAAeqB,IAASD,EAAOpB,eAAeqB,KACvDF,EAAKE,GAAQD,EAAOC,IAG5B,OAAOF,EAEX,SAAgByB,EAAUzB,EAAMC,EAAQc,GACpC,IAAK,IAAIb,KAAQD,EACb,GAAIA,EAAOpB,eAAeqB,GAAO,CAC7B,IAAIG,EAAQU,EAAId,EAAOC,GAAOA,QACpB,IAAVG,IAAqBL,EAAKE,GAAQG,GAG1C,OAAOL,EAgBX,SAAgB0B,EAAO1B,EAAMC,GACzB,IAAK,IAAIC,KAAQD,EACTA,EAAOpB,eAAeqB,KACtBF,EAAKE,GAAQD,EAAOC,IAG5B,GAAIT,UAAUP,OAAS,EACnB,IAAK,IAAID,EAAI,EAAGA,EAAIQ,UAAUP,OAAQD,IAAK,CACvC,IAAIkB,EAAQV,UAAUR,GACtBkB,GAASuB,EAAO1B,EAAMG,GAG9B,OAAOH,EAKX,SAAgB2B,EAAKC,GACjB,IAAIC,EAAMC,GAAQ,EAClB,OAAO,WAMH,OALIA,IACAA,GAAQ,EACRD,EAAOD,EAAKG,MAAM7D,KAAMuB,WACxBmC,EAAO,MAEJC,GAIf,SAAgBG,EAASC,EAAGjE,GACxB,GAAIiE,IAAMjE,EACN,OAAO,EACX,GAAIiE,GAAKjE,GAAiB,iBAALiE,GAA6B,iBAALjE,EAAe,CACxD,IAAIkE,EAAS5D,OAAOiC,eAAe0B,GACnC,GAAIC,IAAW5D,OAAOiC,eAAevC,GACjC,OAAO,EACX,OAAQkE,GACJ,KAAKC,GAAW,OAAQF,IAAOjE,EAC/B,KAAKgD,GAAY,OAoB7B,SAAwBiB,EAAGjE,GACvB,GAAIiE,EAAE/C,SAAWlB,EAAEkB,OACf,OAAO,EACX,IAAK,IAAID,EAAI,EAAGA,EAAIgD,EAAE/C,OAAQD,IAC1B,GAAI+C,EAASC,EAAEhD,GAAIjB,EAAEiB,IACjB,OAAO,EAEf,OAAO,EA3ByBmD,CAAeH,EAAGjE,GAC1C,KAAKqE,GACL,KAAK,KACD,OAKhB,SAAyBJ,EAAGjE,GACxB,IAAIsE,EAAQhE,OAAOiE,KAAKN,GACxB,GAAIK,EAAMpD,SAAWZ,OAAOiE,KAAKvE,GAAGkB,OAChC,OAAO,EACX,IAAK,IAAID,EAAI,EAAGA,EAAIqD,EAAMpD,OAAQD,IAAK,CACnC,IAAIK,EAAMgD,EAAMrD,GAChB,IAAKjB,EAAEa,eAAeS,IAAQ0C,EAASC,EAAE3C,GAAMtB,EAAEsB,IAC7C,OAAO,EAGf,OAAO,EAfYkD,CAAgBP,EAAGjE,IAGtC,OAAO,EAyBX,SAAgByE,EAAQ5B,GACpB,IAAI6B,EAAOpE,OAAOC,OAAOoE,IACzB,OAAO9B,EAAMa,EAAOgB,EAAM7B,GAAO6B,EC/MrC,SACgBE,EAAUC,GACtB,IAAIC,EAAYpC,EAAamC,GAC7BA,EAAYE,UAAYD,EAAUzE,UAClCwE,EAAYG,QAAUC,GAAYC,IAAIC,IAASC,SAASP,GACxDI,GAAYC,IAAIL,GAChBA,EAAYQ,UAAYR,EAAYQ,SAASP,GAEjD,SAAgBE,EAAOM,GACnB,GAAiC,mBAAtBA,EAKP,OAAO,SAAUC,GACbX,EAAUW,GACVA,EAAKP,OAAOM,IANhBV,EAAUU,GACVA,EAAkBN,SAS1B,SAAgBQ,EAAYC,GACxB,OAAO,SAAU9C,GACb,IAAI+C,EAAST,GAAYC,IAAIvC,GAC7B+C,EAAOC,gBAAkB5D,EAAS0C,IAAWgB,EAAOC,EAAOC,kBAGnE,SAAgBC,EAAsBC,GAClC,OAAO,SAAkBvD,EAAOJ,IACjBI,EAAMzB,eAAegF,GAC5BvD,EAAMuD,GAAavD,EAAMuD,IAAavD,EAAMuD,QAAiBC,SAC5DC,KAAK7D,IAGlB,SAAgB8D,EAAoBC,EAAe5D,GAC/C,OAAO,SAAUC,EAAOJ,GACpB+C,GACKC,IAAI5C,EAAMnC,aACV+F,YAAY5D,GAAQ6D,KACrBA,EAAGF,IAAkBG,KACjBA,EAAGlE,GAAQG,EACX+D,GACJD,IACJ,IAAIA,EAAIC,GA+IhB,SAASC,EAAerE,EAAME,EAAMoE,EAAYC,EAAMC,GAClD,GAAIxE,EAAKnB,eAAeqB,GAAO,CAC3B,IAAIuE,EAAWnG,OAAOqB,yBAAyBK,EAAME,GACjDuE,EAASC,cAAgB,UAAWD,IACpCzE,EAAKE,GAAQsE,EACTG,EAAYL,EAAWjE,MAAOoE,EAASpE,MAAOkE,GAC9CI,EAAYF,EAASpE,MAAOiE,EAAWjE,MAAOkE,SAItDjG,OAAOwB,eAAeE,EAAME,EAAMoE,GAG1C,SAASK,EAAY3E,EAAMC,EAAQsE,GAC/B,YAAa,IAATvE,EACOC,EACNsE,QAAmB,IAAXtE,EAENsE,EAAKvE,EAAMC,GADPD,EC3Kf,SAAS4E,EAAmBC,GACxB,OAAOC,GAAkBD,KAAWC,GAAkBD,GAAS,SAAU5C,EAAGjE,EAAGwB,EAAGzB,EAAGW,QACvE,IAANX,QAAsB,IAANW,GAChBqG,EAAS7G,KAAM2G,EAAO5C,EAAGjE,EAAGwB,EAAGzB,EAAGW,QAC5B,IAANc,EACAwF,EAAS9G,KAAM2G,EAAO5C,EAAGjE,EAAGwB,GAE5ByF,EAAS/G,KAAM2G,EAAO5C,EAAGjE,KAYrC,SACSkH,EAAQC,EAASjF,EAAMkF,EAAUC,GAGtC,IAAK,IADDC,EAAcC,EADdC,EAAOL,EAAQjF,GAEVuF,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KACvBN,GAAYA,IAAaK,EAAGL,UAAYA,IAAaK,EAAGL,SAASO,WACjEN,GAAWA,IAAYI,EAAGJ,SAC3BE,EAAOE,EACPH,IAAiBA,EAAeG,IAG5BF,IACAA,EAAKG,KAAOD,EAAGC,MAGvBF,IAASF,IACTH,EAAQjF,GAAQoF,GAMxB,SAASM,EAAUJ,EAAMvD,EAAGjE,EAAGwB,GAC3B,IAAK,IAAIiG,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAAStG,KAAK2G,EAAGJ,QAASpD,EAAGjE,EAAGwB,GAc3C,SAAgBqG,EAAG5F,EAAQC,EAAMkF,EAAUC,GACvC,GAAID,EAAU,CACV,IAAID,EAAUlF,EAAOkF,UAAYlF,EAAOkF,QAAU7G,OAAOC,OAAO,OAChE4G,EAAQjF,GAAQ,IAAI4F,GAAaV,EAAUC,EAASF,EAAQjF,KAGpE,SAAgByB,EAAK1B,EAAQC,EAAMkF,EAAUC,GACzC,GAAID,EAAU,CACV,IAAIW,EAASC,EAAM,WACfC,EAAIhG,EAAQC,EAAM6F,GAClBX,EAASrD,MAAM7D,KAAMuB,aAEzBsG,EAAOJ,UAAYP,EACnBS,EAAG5F,EAAQC,EAAM6F,EAAQV,IAGjC,SAAgBY,EAAIhG,EAAQC,EAAMkF,EAAUC,GACxC,IAAIF,EAAUlF,EAAOkF,QACrB,GAAIA,EACA,GAAIC,GAAYC,EACZ,GAAInF,EACAgF,EAAQC,EAASjF,EAAMkF,EAAUC,QAGjC,IAAK,IAAIa,KAAUf,EACfD,EAAQC,EAASe,EAAQd,EAAUC,QAItCnF,EACLiF,EAAQjF,QAAQ,EAGhBD,EAAOkF,aAAU,EAK7B,SAAgBgB,EAAQC,EAAKnG,EAAQoG,EAAQjB,EAAUC,GACnD,GAAIiB,GAAcC,KAAKF,GAEnB,IAAK,IAAIG,EAAK,EAAGC,EADLJ,EAAOK,MAAMJ,IACSE,EAAKC,EAAQvH,OAAQsH,IAAM,CAEzDJ,EAAInG,EADSwG,EAAQD,GACDpB,EAAUC,QAIlCe,EAAInG,EAAQoG,EAAQjB,EAAUC,GAEtC,SAAgBJ,EAAS0B,EAAMzG,EAAM+B,EAAGjE,GACpC,IAAImH,EAAUwB,EAAKxB,QACnB,GAAIA,EAAS,CACT,IAAIyB,EAAQzB,EAAQjF,GAAO2G,EAAM1B,EAAQ0B,KAxEjD,SAAmBrB,EAAMvD,EAAGjE,GACxB,IAAK,IAAIyH,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAAStG,KAAK2G,EAAGJ,QAASpD,EAAGjE,GAuEhC8I,CAAUF,EAAO3E,EAAGjE,GACpB4H,EAAUiB,EAAK3G,EAAM+B,EAAGjE,IAIhC,SAAgBgH,EAAS2B,EAAMzG,EAAM+B,EAAGjE,EAAGwB,GACvC,IAAI2F,EAAUwB,EAAKxB,QACnB,GAAIA,EAAS,CACT,IAAIyB,EAAQzB,EAAQjF,GAAO2G,EAAM1B,EAAQ0B,IACzCjB,EAAUgB,EAAO3E,EAAGjE,EAAGwB,GA1E/B,SAAmBgG,EAAMvD,EAAGjE,EAAGwB,EAAGzB,GAC9B,IAAK,IAAI0H,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAAStG,KAAK2G,EAAGJ,QAASpD,EAAGjE,EAAGwB,EAAGzB,GAyEtCgJ,CAAUF,EAAK3G,EAAM+B,EAAGjE,EAAGwB,IAInC,SAAgBuF,EAAS4B,EAAMzG,EAAM+B,EAAGjE,EAAGwB,EAAGzB,EAAGW,GAC7C,IAAIyG,EAAUwB,EAAKxB,QACnB,GAAIA,EAAS,CACT,IAAIyB,EAAQzB,EAAQjF,GAAO2G,EAAM1B,EAAQ0B,KA9EjD,SAAmBrB,EAAMvD,EAAGjE,EAAGwB,EAAGzB,EAAGW,GACjC,IAAK,IAAI+G,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAAStG,KAAK2G,EAAGJ,QAASpD,EAAGjE,EAAGwB,EAAGzB,EAAGW,GA6EzCsI,CAAUJ,EAAO3E,EAAGjE,EAAGwB,EAAGzB,EAAGW,GA3ErC,SAAmB8G,EAAMvD,EAAGjE,EAAGwB,EAAGzB,EAAGW,EAAGuI,GACpC,IAAK,IAAIxB,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAAStG,KAAK2G,EAAGJ,QAASpD,EAAGjE,EAAGwB,EAAGzB,EAAGW,EAAGuI,GA0E5CC,CAAUL,EAAK3G,EAAM+B,EAAGjE,EAAGwB,EAAGzB,EAAGW,IC/LzC,SAASyI,IACL,MAAO,IAAMC,KA+GjB,SAASC,EAAqB/F,GAC1B,GAAIA,EACA,MAAoB,mBAANA,GAAqB4B,IAAK5B,GAAMA,EAGtD,SAASgG,EAAaC,EAAUtH,IACVsH,EAASC,eAAiBD,EAASC,aAAelJ,OAAOC,OAAO,QAAc0B,EAAOwH,MAAQxH,EAAOwH,IAAMN,MACzGlH,EC1GvB,SACgByH,EAAiBC,EAAMC,EAAWC,GAG9C,IAAK,IAFDC,EAAOF,EAAUG,MAAMC,IAAgBC,EAAOH,EAAK5I,OAAS,EAC5DyH,EAAOgB,EACF1I,EAAI,EAAGA,EAAIgJ,EAAMhJ,IAAK,CAC3B,IAAIK,EAAMwI,EAAK7I,GACf,OAAQK,GACJ,IAAK,IACDqH,EAAOA,EAAKuB,WACZ,MACJ,IAAK,IACDvB,EAAOA,EAAKwB,WACZ,MACJ,QAASxB,EAAOA,EAAKzD,IAAI5D,GAE7B,IAAKqH,EACD,OAER,OAAOkB,EAAOlB,EAAMmB,EAAKG,ICvCtB,SAASG,EAAiBzB,GAC7B,IAAI0B,EAAa1B,EAAK0B,WACtB,GAAIA,EACA,OAAOD,EAAiBC,GAE5B,GAAI1B,EAAK2B,OAAQ,CACb,IAAIC,EAAa5B,EAAK2B,OAAOC,WAC7B,OAAOA,GAAcA,EAAW5B,EAAK6B,YAG7C,SAAgBC,EAAgBC,GAE5B,SAASC,EAAMC,GACXC,EAAUD,EAFd,IAAIE,EAASC,EAAQF,EAIjBG,EAAU,IAAIC,QAAQ,SAAUC,EAAWC,GAG3CT,EADAI,EAAUI,EADVH,EAASI,EAEmBR,KAKhC,OAHAK,EAAQL,MAAQ,WACZE,EAAUA,EAAQC,EAASC,GAAUA,EAAO,IAAIK,MAAM,iBAEnDJ,EAEX,SAAgBK,EAAQ1C,EAAMqC,EAASM,EAASC,GAiB5C,OAhBAC,EAAQ7C,GACR2C,EAAQG,UAAW,EACnB9C,EAAK+C,WAAaV,EACbW,KAAK,SAAUC,GAChBjD,EAAK+C,WAAa,KAClB,IAAIxI,EAASqI,EAASA,EAAOK,GAAQA,EAErC,OADAC,EAAiBlD,EAAM,OAAQA,EAAMiD,EAAMN,GACpCpI,IAEN4I,MAAM,SAAUC,GAIjB,MAHApD,EAAK+C,WAAa,KAClBM,QAAQC,MAAMF,GACdF,EAAiBlD,EAAM,QAASA,EAAMoD,EAAKT,GACrCS,IAEVpD,EAAK+C,WAAWf,MAAQK,EAAQL,MACzBhC,EAAK+C,WAEhB,SAAgBF,EAAQ7C,GAChBA,EAAK+C,YAAc/C,EAAK+C,WAAWf,QACnChC,EAAK+C,WAAWf,QAChBhC,EAAK+C,WAAa,MAG1B,SAAgBG,EAAiBK,GAE7B,IAAK,IADDC,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,EAAK,GAAK/G,UAAU+G,GAE7B0D,EAAYE,QAAQrI,MAAMmI,EAAaC,GACvC,IAAI9B,EAAa6B,EAAY7B,WAC7BA,GAAcA,EAAW+B,QAAQrI,MAAMsG,EAAY8B,GCwJvD,SAAS/B,EAAiBzB,GACtB,IAAI0B,EAAa1B,EAAK0B,WACtB,GAAIA,EACA,OAAOD,EAAiBC,GAE5B,GAAI1B,EAAK2B,OAAQ,CACb,IAAIC,EAAa5B,EAAK2B,OAAOC,WAC7B,OAAOA,GAAcA,EAAW5B,EAAK6B,YCpN7C,SAAgB6B,EAAaC,EAAQpK,EAAMG,GACvC,IAAIkK,EAASC,EAAMF,GAAShB,KACxBgB,EAAOG,YAAYvK,GAAMwK,SAASrK,EAAOiK,EAAQhB,KACjDqB,EAAYL,EAAQhB,GACpBtE,GAASsF,EAAQ,UAAYpK,EAAMoK,EAAQA,EAAOM,WAAW1K,GAAOoJ,IAExEiB,GAAUM,GAAOP,GAErB,SAASE,EAAMF,GACX,QAAIQ,GAAOR,KACPA,EAAOS,oBAAsB,IAAIT,EAAOU,eAAeV,EAAOM,YAC9DN,EAAOW,mBAAqB,MACrB,GAIf,SAASN,EAAYL,EAAQhB,GAIzB,OAHIgB,EAAOW,qBACPX,EAAOW,mBAAqB,MAEzBC,GAAaZ,EAAQhB,GAoDhC,SAAgB6B,EAAkBC,GAC9B,IAAIC,EAAQ/M,OAAOiE,KAAK6I,GACpBJ,EAAiB,IAAIM,SAAS,SAAU,aAAeD,EAAME,IAAI,SAAUC,GAAQ,MAAO,sBAAwBA,EAAO,aAAeA,EAAO,gBAAkBC,KAAK,IAAM,UAChLT,EAAe3M,UAAYC,OAAOD,UAClC,IAAIqN,EAAa,IAAIJ,SAAS,SAAU,SAAU,UAAW,yDAA2DD,EAAME,IAAI,SAAUC,GAAQ,MAAO,sBAAwBA,EAAO,aAAeA,EAAO,mBAAqBA,EAAO,mCAAqCC,KAAK,IAAM,UAE5R,OADAC,EAAWrN,UAAYC,OAAOD,WACrBqN,WAAYA,EAAYV,eAAgBA,GAErD,SAAgBW,EAAiBrB,EAAQsB,GACrC,SAAIA,GAAUA,EAAOzN,cAAgBG,UAErCgM,EAAOuB,KAAK,OAAQ,sCAAwCD,OAAQA,KAC7D,GCwBX,SACSE,EAAcC,EAAUC,GAC7B,OAAO,SAAU3L,EAAOH,GACpB,OAAO8L,EAASlN,KAAKZ,KAAM6N,EAASjN,KAAKZ,KAAMmC,EAAOH,GAAOA,IAGrE,SAAS+L,EAAgBC,EAAeC,GACpC,OAAO,SAAUzG,EAAMH,EAAM+E,EAAQhB,GACjC,OAAO6C,EAAcrN,KAAKZ,KAAMgO,EAAcpN,KAAKZ,KAAMwH,EAAMH,EAAM+E,EAAQhB,GAAU/D,EAAM+E,EAAQhB,IAG7G,SAAS8C,EAAoBC,EAAaC,GACtC,OAAO,SAAU5G,EAAMH,EAAM+E,EAAQhB,GACjC+C,EAAYvN,KAAKZ,KAAMwH,EAAMH,EAAM+E,EAAQhB,GAC3CgD,EAAYxN,KAAKZ,KAAMwH,EAAMH,EAAM+E,EAAQhB,ICrBnD,SAAgBiD,GAAKC,GACjB,OAAOA,aAAgBC,GAAyBD,EAAO,IAAIC,IACvDF,KAAMC,EACNnM,MAAOmM,EAAKE,WAAWC,aACvBC,sBAAmD,IAAjCJ,EAAKE,WAAWC,eAoB1C,SAAgBE,GAAmBL,GAC/B,IAAIM,EACJ,GAAoB,mBAATN,EACPM,EAAWN,EAAKO,SAEf,GAAIP,GAAQA,aAAgBC,GAC7BK,EAAWN,MAEV,CACD,IAAIQ,EAUZ,SAAmB3M,GACf,cAAeA,GACX,IAAK,SACD,OAAO4M,OACX,IAAK,SACD,OAAOC,OACX,IAAK,UACD,OAAOC,QACX,IAAK,YACD,OACJ,IAAK,SACD,OAAO9M,EAAQA,EAAMlC,iBAAc,GArB1BiP,CAAUZ,GAEnBM,EADAE,GAAUA,EAAO3O,qBAAqBgP,GAC3BL,EAAOM,OAAOjN,MAAMmM,GAGpB,IAAIC,IAAyBF,KAAMS,EAAQ3M,MAAOmM,EAAMI,kBAAkB,IAG7F,OAAOE,EAASxD,QCzDpB,SAASiE,GAAaC,GAClB,OAAQC,MAAM,IAAKC,KAAKF,GAAOG,WCdnC,SAASC,GAAQtM,GACb,OAAOA,EAAIuM,KAAKC,MAAMxM,GAAK,EA4C/B,SAAgByM,MCvGhB,SAAgBC,GAAgBxB,EAAMtM,GAClC,OAAO+N,GAAQ1P,OAAOsO,GAAmBL,GAAOtM,GAepD,SAAgBgO,GAAqBrL,EAAasL,GACzCtL,EAAYhE,eAAe,WAC5BP,OAAOwB,eAAe+C,EAAa,UAC/BK,IAAK,WACD,OAAO,IAAIuJ,IACPpM,MAAO,KACPkM,KAAM1J,EACN6J,WAAYyB,OAMhC,SAASC,GAAiBC,GACtB,IAAIC,EACJ,IAAK,IAAIhP,KAAO+O,EAAW,CACvB,IAAgCE,EAAhBF,EAAU/O,GAA4BgK,QAAQiF,UAC1DA,IACAD,IAAiBA,EAAe,IAAIE,IACpCF,EAAaG,SAAS,UAAYnP,EAA0B,iBAAdiP,EAY1D,SAA8BG,EAAKpP,GAC/B,IAAI6E,EAAK,IAAIwK,GAAkBD,GAAK,GAAOE,EAAQzK,EAAGyK,MAAO9F,EAAU3E,EAAG2E,QAAS+F,EAAO1K,EAAG0K,KAC7F,OAAOD,EACH,SAAUtE,EAAQjK,GACdiK,EAAOuE,GAAMxO,EAAOf,IAExB,SAAUgL,EAAQjK,GACdyI,EAAQwB,GAAQuE,GAAMxO,EAAOf,IAlBzBwP,CAAqBP,EAAWjP,GAMhD,SAAqByP,EAASzP,GAC1B,OAAO,SAAUgL,EAAQjK,GACrB0O,EAAQjQ,KAAKwL,EAAQjK,EAAOf,IAPpB0P,CAAYT,EAAWjP,KAGnC,OAAOgP,GAAiBA,aAAcA,MCN1C,SAAgB9C,GAAKlL,EAAO2O,GACxB,IAAIA,EAWA,OAAO3O,EAAM4O,OAVU,oBAAZtP,SAA2BA,QAAQuP,YAC1CvP,QACKuP,YAAY,cAAe7O,EAAO2O,GAClCC,OAAO5O,EAAO2O,GAGnB3O,EAAMuL,KAAK,QAAS,iEAOhC,SAAgBuD,GAAK5C,GACjB,OAAOA,EAAK0C,OC1DhB,SAAgBG,GAAiBhH,EAAYgD,EAAO/B,GAChD,IACIgB,EADAgF,EAAQjH,EAAWiH,MAEvB,GAAIjH,EAAWkH,QACXjF,EAASe,aAAiBiE,EAAQjE,EAAQiE,EAAM/Q,OAAO8M,EAAO/B,GAC1DjB,EAAWkH,QAAUC,gBAAcC,QACnC5J,GAAGyE,EAAQA,EAAOoF,iBAAkBrH,EAAWsH,kBAAmBtH,QAKtE,GADAiC,EAASe,aAAiBiE,EAAShG,EAAQsG,MAAQvE,EAAMwE,QAAUxE,EAASiE,EAAM/Q,OAAO8M,EAAO/B,IAC3FwG,GAAQzH,EAAYiC,GAAS,EACjBjC,EAAW0H,oBAAsB1H,EAAW0H,uBAClDhM,KAAKuG,GAGpB,IAAI0F,EAAc3H,EAAW2H,YAE7B,OADAA,GAAeA,EAAYC,UAAU5H,EAAYiC,GAC1CA,EAEX,SAAgB4F,GAAKC,EAAOC,EAAOC,GAC3BF,EAAMZ,QACFY,EAAMZ,QAAUC,gBAAcC,QAC9BxJ,GAAImK,EAAOA,EAAMV,iBAAkBS,EAAMR,kBAAmBQ,IAIhEG,GAAMH,EAAOC,GACbC,GAASD,EAAMG,WAEnB,IAAIP,EAAcG,EAAMH,YACxBA,GAAeA,EAAYQ,YAAYL,EAAOC,GASlD,SAAgBK,GAAapI,EAAYiB,GACrC,IAAIoH,EAAcrI,EAAWqI,YAC7B,SAAIA,IAAgC,IAAjBpH,EAAQqH,QACvBtI,EAAWuI,OAAOD,KAAKD,IAChB,GAIf,SAAgBG,GAASC,EAAOxB,GAC5BwB,EAAMxB,EAAM7H,KAAO6H,EACnB,IAAIyB,EAAKzB,EAAMyB,IACXA,GAAa,IAAPA,KACND,EAAMC,GAAMzB,GAGpB,SAAgB0B,GAAYF,EAAOxB,UACxBwB,EAAMxB,EAAM7H,KACnB,IAAIsJ,EAAKzB,EAAMyB,IACXA,GAAa,IAAPA,WACCD,EAAMC,GAGrB,SAAgBE,GAAYH,EAAOxB,UACxBwB,EAAMxB,EAAM4B,SAAS5B,EAAM6B,cAClC,IAAIJ,EAAKzB,EAAMyB,GACT,MAANA,IAAeD,EAAMC,GAAMzB,GA6C/B,SACgB8B,GAAoB/I,GAChCA,EAAWwD,KAAK,QAAS,sCAAuCxD,EAAW0H,mBAC3E1H,EAAW0H,uBAAoB,ECxHnC,SAAgBsB,GAAehJ,EAAYiJ,EAAOhI,EAASsG,GACvD,IAAIrF,EAASC,GAAMnC,GAAakJ,KAC5BC,EAoCR,SAAwBnJ,EAAYoJ,EAASF,EAAQG,EAAWC,GAE5D,IAAK,IADDC,EAAQvJ,EAAWuJ,MAAOhB,EAASvI,EAAWuI,OAAQhB,GAAS+B,GAAcD,EAAU9B,SAAWvH,EAAWkH,QAAkC4B,GAAjBO,EAAUG,MAAqBxJ,EAAWiH,MAAMjR,UAAU8S,aAAaW,EAAalB,EAAO1R,OACpNsH,EAAK,EAAGuL,EAAYN,EAASjL,EAAKuL,EAAU7S,OAAQsH,IAAM,CAC/D,IAAIwL,EAAOD,EAAUvL,GACjB8I,EAAQ0C,EAAOJ,EAAMI,EAAKb,KAAiBS,EAAMI,EAAKvK,KAAO,KACjE,GAAI6H,GACA,GAAIM,GAASoC,IAAS1C,EAAO,CACzB,IAAIjE,EAAQ2G,EAAKpH,YAAcoH,EAC3BC,EAAc3C,EAAM4C,mBAAmB7G,EAAOqG,GAClDO,GAAeV,EAAOxN,KAAKkO,GACvB3C,EAAM6C,WAAWhB,IACjBF,GAAYW,EAAOtC,SAK3BA,EAAQD,GAAiBhH,EAAY2J,EAAMN,GAC3Cd,EAAO7M,KAAKuL,GACZuB,GAASe,EAAOtC,GAGxB,OAAOsB,EAAO9M,MAAMgO,GAzDRM,CAAe/J,EAAYiJ,EAAOC,EAAQjI,EAASsG,GAC/D,GAAI4B,EAAMtS,QAAUqS,EAAOrS,OAAQ,CAC/B,IAAImT,EAUZ,SAA4BhK,EAAYmJ,EAAOlI,GAC3C,IAAIgJ,EAAKhJ,EAAQgJ,GACjB,GAAU,MAANA,EAAY,CACZ,IAAIC,EAAWlK,EAAWuI,OAAO1R,OAASsS,EAAMtS,OAShD,OARAoT,EAAKrF,OAAOqF,IACH,IACLA,GAAMC,EAAW,GACjBD,EAAK,IACLA,EAAK,GACLA,EAAKC,IACLD,EAAKC,GAMjB,SAAsBtS,EAAQqS,EAAId,GAC9B,IAAK,IAAIgB,EAAIvS,EAAOf,OAAS,EAAGD,EAAIuT,EAAIhB,EAAMtS,OAAQD,GAAKqT,EAAIrT,IAAKuT,IAChEvS,EAAOuS,GAAKvS,EAAOhB,GAEvB,IAAKA,EAAI,EAAGuT,EAAIF,EAAIrT,EAAIuS,EAAMtS,OAAQD,IAAKuT,IACvCvS,EAAOuS,GAAKhB,EAAMvS,GAVlBwT,CAAapK,EAAWuI,OAAQ0B,EAAId,IAC7B,EAEX,OAAOf,GAAapI,EAAYiB,GAxBboJ,CAAmBrK,EAAYmJ,EAAOlI,GACrD,GAAIqB,GAAYtC,EAAYiB,GACxB,OAAO,IAAIqJ,GAAsBtK,EAAYkC,EAAQiH,KAAWD,EAAQc,GAExEhK,EAAW0H,mBACXqB,GAAoB/I,GAE5BkC,GAAUM,GAAOxC,GCVrB,SAAgBuK,GAAoBvK,EAAYiJ,EAAOhI,EAASuJ,GAC5D,IAAItI,EAASC,GAAMnC,GACfmJ,EAwER,SAA0B7K,EAAM1G,EAAQqJ,GAEpC,IAAK,IADDwJ,EAAM7S,EAASA,EAAOf,OAAS,EAAG0R,EAASpQ,MAAMsS,GAAMlB,KAAYT,EAAcxK,EAAK2I,MAAMjR,UAAU8S,YACjGlS,EAAI,EAAGuT,EAAI,EAAGvT,EAAI6T,EAAK7T,IAAK,CACjC,IAAI8T,EAAM9S,EAAOhB,GACjB,IAAI8T,IAAQnB,EAAMmB,EAAI5B,MAAiBS,EAAMmB,EAAItL,KAAjD,CAGA,IAAI6H,EAAQD,GAAiB1I,EAAMoM,EAAKzJ,GACxCsH,EAAO4B,KAAOlD,EACduB,GAASe,EAAOtC,IAIpB,OAFAsB,EAAO1R,OAASsT,EAChB7L,EAAKiL,MAAQA,EACNjL,EAAKiK,OAASA,EArFToC,CAAiB3K,EAAYiJ,EAAOhI,GAChD,GAAIkI,EAAMtS,OAAQ,CACd,IAAImT,EAAW5B,GAAapI,EAAYiB,GACxC,GAAIqB,GAAYtC,EAAYwK,EAASI,GAAgB3J,GACjD,OAAO,IAAIqJ,GAAsBtK,EAAYkC,EAAQiH,EAAM1N,cAAiBuO,GAE5EhK,EAAW0H,mBACXqB,GAAoB/I,GAE5BkC,GAAUM,GAAOxC,GAGrB,SAAgB6K,GAAe7K,EAAYiJ,EAAOhI,GAC9C,IAAIiB,EAASC,GAAMnC,GAAakJ,KAC5BL,EAAW7I,EAAWuI,OAAQY,EAyBtC,SAAqBnJ,EAAYpI,EAAQsR,EAAQjI,GAE7C,IAAK,IADDsH,EAASpQ,MAAMP,EAAOf,QAAS0S,KAAYhC,GAA0B,MAAjBtG,EAAQsG,OAAuBtG,EAAQsG,SAAWvH,EAAWkH,QAAS4D,EAAY9K,EAAWuJ,MAAOwB,EAAa/K,EAAWuI,OAAQO,EAAc9I,EAAWiH,MAAMjR,UAAU8S,YAAakC,KAAYC,GAAY,EACjQrU,EAAI,EAAGuT,EAAI,EAAGvT,EAAIgB,EAAOf,OAAQD,IAAK,CAC3C,IAAI+S,EAAO/R,EAAOhB,GAAIqQ,EAAQ,KAC9B,GAAI0C,EAAM,CACN,IAAIjB,EAAKiB,EAAKb,GAAc1J,EAAMuK,EAAKvK,IACvC,GAAImK,EAAMb,IAAOa,EAAMnK,GACnB,SACJ6H,EAAQ6D,EAAUpC,IAAOoC,EAAU1L,GAEvC,GAAI6H,GACA,GAAIM,GAASoC,IAAS1C,EAAO,CACrBgE,GAAaF,EAAWZ,KAAOlD,IAC/BgE,GAAY,GAChB,IAAIjI,EAAQ2G,EAAKpH,YAAcoH,EAC3BC,EAAc3C,EAAM4C,mBAAmB7G,EAAO/B,GAClD2I,GAAeV,EAAOxN,KAAKkO,SAI/B3C,EAAQD,GAAiBhH,EAAY2J,EAAM1I,GAC3C+J,EAAMtP,KAAKuL,GAEfsB,EAAO4B,KAAOlD,EACduB,GAASe,EAAOtC,GAEpBsB,EAAO1R,OAASsT,EAChBnK,EAAWuI,OAASA,EACpBvI,EAAWuJ,MAAQA,EACd0B,IACDhK,EAAQiK,QAAS,GACrB,OAAOF,EAxDmCG,CAAYnL,EAAYiJ,EAAOC,EAAQjI,GAC7EmK,EAAcpL,EAAWuI,OAAO1R,OAASsS,EAAMtS,OAAQwU,EAAUD,EAAcvC,EAAShS,OAAUuU,EAa1G,SAAyBpL,EAAY6I,GAEjC,IAAK,IADDU,EAAQvJ,EAAWuJ,MAAO8B,KACrBlN,EAAK,EAAGmN,EAAazC,EAAU1K,EAAKmN,EAAWzU,OAAQsH,IAAM,CAClE,IAAI8D,EAASqJ,EAAWnN,GACnBoL,EAAMtH,EAAO7C,OACdiM,EAAQ3P,KAAKuG,GACb4F,GAAK7H,EAAYiC,IAGzB,OAAOoJ,EAtB6GE,CAAgBvL,EAAY6I,GFsBpJ,SAAwB7I,EAAYwL,GAChC,IAAK,IAAIrN,EAAK,EAAGsN,EAAaD,EAAUrN,EAAKsN,EAAW5U,OAAQsH,IAE5D0J,GAAK7H,EADOyL,EAAWtN,IAG3B,OAAOqN,EE1BHE,CAAQ1L,EAAY6I,MACpB8C,EAAiBzC,EAAOrS,QAAUsS,EAAMtS,OAAQqU,EAAU9C,GAAapI,EAAYiB,IAAY0K,GAAmBxC,EAAMtS,QAAUoK,EAAQiK,OAC9I,GAAIS,GAAkBN,EAAQxU,QAAUqU,EAAQ,CAC5C,GAAI5I,GAAYtC,EAAYiB,GACxB,OAAO,IAAIqJ,GAAsBtK,EAAYkC,EAAQiH,EAAOkC,EAASnC,EAAQgC,GAE7ElL,EAAW0H,mBACXqB,GAAoB/I,GAE5BkC,GAAUM,GAAOxC,GCTrB,SAAgB4L,GAAW5L,EAAY6L,EAAU5K,GAC7C,IAAIoK,EAeR,SAA0BrL,EAAY6L,EAAU7D,GAE5C,IAAK,IADDqD,EAAUlT,MAAM0T,EAAShV,QAAS0S,EAAQvJ,EAAWuJ,MAChD3S,EAAI,EAAGuT,EAAI,EAAGvT,EAAIiV,EAAShV,OAAQD,IAAK,CAC7C,IAAIqQ,EAAQjH,EAAWnF,IAAIgR,EAASjV,IAChCqQ,IACAoE,EAAQlB,KAAOlD,EACf0B,GAAYY,EAAOtC,GACnBY,GAAK7H,EAAYiH,EAAOe,IAIhC,OADAqD,EAAQxU,OAASsT,EACVkB,EA1BOS,CAAiB9L,EAAY6L,EAAU5K,EAAQ+G,OAC7D,GAAIqD,EAAQxU,OAAQ,CAChB,IAAIqL,EAASC,GAAMnC,GAEnB,GAwBR,SAAqBA,EAAYqL,GAE7B,IAAK,IADDnO,EAAO8C,EAAWuI,OAAQA,EAASvI,EAAWuI,OAASpQ,MAAM+E,EAAKrG,OAASwU,GAAU9B,EAAQvJ,EAAWuJ,MACnG3S,EAAI,EAAGuT,EAAI,EAAGvT,EAAIsG,EAAKrG,OAAQD,IAAK,CACzC,IAAIqQ,EAAQ/J,EAAKtG,GACb2S,EAAMtC,EAAM7H,OACZmJ,EAAO4B,KAAOlD,GAGtBsB,EAAO1R,OAASsT,EAjCZgB,CAAYnL,EAAYqL,EAAQxU,QAC5ByL,GAAYtC,EAAYiB,GAAU,CAChB,IAAIqJ,GAAsBtK,EAAYkC,KAAYmJ,MAAa,GACrE7I,cAGZN,GAAUM,GAAOxC,GAGzB,OAAOqL,EC4XX,SACSU,GAAW/L,EAAYgM,EAAU/K,GACtC,IAAIgL,EAAShL,EAAQuI,MAAQxJ,EAAWwJ,MAAMwC,EAAU/K,GAAW+K,EACnE,OAAO7T,MAAM+T,QAAQD,GAAUA,GAAUA,GAI7C,SAASE,GAAYzT,EAAKsE,GACtB,YAAmB,IAAZA,EAAqB,SAAUoP,EAAGC,GAAK,OAAO3T,EAAIjC,KAAKuG,EAASoP,EAAGC,IAAQ3T,EAEtF,SAAS4T,GAAoBC,EAAUvP,GACnC,MAAwB,iBAAbuP,EACA,SAAUtT,GACb,IAAK,IAAIhC,KAAOsV,EACZ,GAAIA,EAAStV,KAASgC,EAAEhC,GACpB,OAAO,EAEf,OAAO,GAGRkV,GAAYI,EAAUvP,GClb1B,SAASwP,GAAeC,GAC3B,cAAeA,GACX,IAAK,WACD,OAAO,SAAUnN,GAAQ,OAAOmN,EAAchW,KAAK6I,IACvD,IAAK,SACD,OAAO,WAAc,OAAOmN,GAChC,IAAK,SAED,OADc,IAAInG,GAAkBmG,GAAehM,SCkH/D,SAASiM,GAAYC,EAAQX,GAEzB,IAAK,IADDY,KACKzO,EAAK,EAAG0O,EAAab,EAAU7N,EAAK0O,EAAWhW,OAAQsH,IAAM,CAClE,IAAI2O,EAAKD,EAAW1O,GAChB8D,EAAS0K,EAAO9R,IAAIiS,GACpB7K,GACA2K,EAAQlR,KAAKuG,GAErB,OAAO2K,EAEX,SAASG,GAAS/M,EAAYgM,EAAU/K,GACpC,GAAI+L,EAAehN,EAAWiN,KAAMjB,GAAW,CAC3C,IAAI9J,EAASgL,GAAe/K,MAAMnC,GAClCA,EAAWiN,KAAOjB,EAASvQ,QAC3ByR,GAAe5K,YAAYtC,EAAYiB,GACvCiB,GAAUgL,GAAe1K,OAAOxC,IAGxC,SAASmN,GAAQnB,GACb,OAAOA,EAAY7T,MAAM+T,QAAQF,GAAYA,GAAYA,MClI7D,SAGgBzJ,GAAWQ,GAYvB,OAXqB,SAAUqK,GAE3B,SAASC,IACL,OAAkB,OAAXD,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAM/D,OARAyX,EAAkBD,EAAeD,GAIjCC,EAAc9K,WAAaQ,EAC3BsK,EAAgBE,GACZ5S,GACD0S,IAELG,IAGN,SACgBxV,GAAMiB,GAClB,OAAO,IAAImL,IAAyBpM,MAAOiB,IAE/C,SAAgB2Q,GAAY6D,GACxB,OAAO,WAGH,IAAK,IAFDC,EAAQ7X,KACRiM,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAEzB,IAAItF,EAIJ,OAHAhD,KAAK+T,YAAY,WACb/Q,EAAS4U,EAAO/T,MAAMgU,EAAO5L,KAE1BjJ,GC3Bf,SAAgB8U,GAAK1M,GACjBpL,KAAKuJ,IAAMwO,WAAW,QACtB3M,IAAYA,MACZ4M,SAAShY,KAAMiY,OAAO7M,EAAS8M,KAC/BlY,KAAKmY,iBACLnY,KAAKwK,WAAW3G,MAAM7D,KAAMuB,WAC5BvB,KAAKoY,iBAsET,SAAgBC,GAAOjN,GACnBA,IAAYA,MACRA,EAAQkN,SACRtY,KAAKsY,OAASlN,EAAQkN,QAC1BtY,KAAKuY,cACLvY,KAAKwK,WAAW3G,MAAM7D,KAAMuB,WA+DhC,SAAgBiX,KACZxY,KAAKyY,YACLzY,KAAK0Y,SAAWC,OAAO3Y,KAAK0Y,SAAU1Y,MAChB,oBAAX4Y,SACP5Y,KAAK6Y,SAAWD,OAAOC,SACvB7Y,KAAK8Y,QAAUF,OAAOE,SCqD9B,SACSC,GAAMnB,EAAQC,EAAOzM,GAC1ByM,EAAMmB,MAAQnB,EAAMmB,KAAKvO,OAASoN,EAAMmB,KAAKvO,QAC7C,IAAIwO,EAAMpB,EAAMmB,KAAOnB,EAAMqB,KAAKtB,EAAQC,EAAOzM,GAEjD,OADA6N,GAAOA,EAAIE,QAAUF,EAAIE,OAAO,WAActB,EAAMmB,UAAO,IACpDC,EAEX,SAASG,GAAUhI,EAAOhG,GACtB,IAAIW,EAAQX,EAAQW,MACpBX,EAAQW,MAAQ,SAAUL,GAClBK,GACAA,EAAMnL,KAAKwK,EAAQjE,QAASiK,EAAO1F,EAAMN,GAC7CO,GAAiByF,EAAO,QAASA,EAAO1F,EAAMN,IAGtD,SAASO,GAAiByF,GAEtB,IAAK,IADDnF,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,EAAK,GAAK/G,UAAU+G,GAE7B8I,EAAMlF,QAAQrI,MAAMuN,EAAOnF,GAC3B,IAAI9B,EAAaiH,EAAMjH,WACvBA,GAAcA,EAAW+B,QAAQrI,MAAMsG,EAAY8B,GCrLvD,SAASoN,GAAqBC,EAAOC,EAAWC,GAC5CC,OAAOD,EAAS,SAAUxY,EAAQ4W,GAC1B8B,EAAE9B,KACF0B,EAAM1B,GAGlB,SAAmB5W,EAAQ4W,EAAQ2B,GAC/B,OAAQvY,GACJ,KAAK,EAAG,OAAO,WACX,OAAO0Y,EAAE9B,GAAQ5X,KAAKuZ,KAE1B,KAAK,EAAG,OAAO,SAAUpX,GACrB,OAAOuX,EAAE9B,GAAQ5X,KAAKuZ,GAAYpX,IAEtC,KAAK,EAAG,OAAO,SAAUuU,EAAUvP,GAC/B,IAAIhF,EAAQnC,KAAKuZ,GAAYrS,EAAWyS,GAAGjD,EAAU1W,MACrD,OAAOuB,UAAUP,OAAS,EACtB0Y,EAAE9B,GAAQzV,EAAO+E,EAAUC,GACzBuS,EAAE9B,GAAQzV,EAAO+E,IAE3B,KAAK,EAAG,OAAO,SAAUwP,EAAUkD,EAAYzS,GAC3C,IAAIhF,EAAQnC,KAAKuZ,GAAYrS,EAAWyS,GAAGjD,EAAU1W,MACrD,OAAOuB,UAAUP,OAAS,EACtB0Y,EAAE9B,GAAQzV,EAAO+E,EAAU0S,EAAYzS,GACrCuS,EAAE9B,GAAQzV,EAAO+E,IAE3B,QAAS,OAAO,WAEZ,IAAK,IADD+E,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAGzB,OADA2D,EAAK3F,QAAQtG,KAAKuZ,IACXG,EAAE9B,GAAQ/T,MAAM6V,EAAGzN,KA7BV4N,CAAU7Y,EAAQ4W,EAAQ2B,MAiCtD,SAASI,GAAGjD,EAAUoD,GAClB,cAAepD,GACX,IAAK,WAAY,OAAOA,EACxB,IAAK,SAAU,OAAO,SAAUtF,GAAS,OAAOA,EAAMpM,IAAI0R,IAC1D,IAAK,SACD,KAAMA,aAAoBoD,EAAS1I,OAC/B,OAAO2I,UAAUrD,GAE7B,OAAOA,ECnFX,SAEgB7U,GAASuB,GACrB,OAAO4W,GAAOrC,MAAM9V,SAASuB,GAOjC,SAAS6W,GAAaC,EAAWlY,GAC7B,OACIgD,IAAK,WAAc,OAAOkV,EAAUlY,IACpCmY,IAAK,SAAUhY,GAAS+X,EAAUlY,GAAQG,IAGlD,SAASiY,GAAQzX,GACb,OAAO0X,KAAoB1X,EAAK,SAAUS,GAAK,OAAUjB,MAAOiB,K1BrBpE,IAAIlD,GAAgBE,OAAOka,iBACpBC,wBAA2BjY,OAAS,SAAUzC,EAAGC,GAAKD,EAAE0a,UAAYza,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIY,KAAKZ,EAAOA,EAAEa,eAAeD,KAAIb,EAAEa,GAAKZ,EAAEY,KAQ9D8Z,GAAWpa,OAAOoD,QAAU,SAAkB/C,GACrD,IAAK,IAAIF,EAAGQ,EAAI,EAAG0Z,EAAIlZ,UAAUP,OAAQD,EAAI0Z,EAAG1Z,IAAK,CACjDR,EAAIgB,UAAUR,GACd,IAAK,IAAIL,KAAKH,EAAOH,OAAOD,UAAUQ,eAAeC,KAAKL,EAAGG,KAAID,EAAEC,GAAKH,EAAEG,IAE9E,OAAOD,GCjBPia,IACAC,KAAM,EAAG5O,MAAO,EAAG6O,KAAM,EAAGC,KAAM,EAAGC,IAAK,EAAGC,MAAO,GAE7CD,GAAM,SAAUE,EAASC,EAAOC,GACvC,IAA4CC,EAAKC,EAAOC,EAApDC,EAAgBZ,GAAcM,GAUlC,QATsB,IAAlBM,GAA6BJ,GAO7BC,EAAMF,EAAOI,EAAQL,EAASI,EAAQF,IANtCI,EAAgB,EAChBH,EAAMH,EACNI,EAAQH,EACRI,EAAQ,OAKRC,GAAiBR,GAAIO,MAAO,CAC5B,GAAIC,GAAiBR,GAAIS,QAAUT,GAAIU,OAAQ,CAC3C,IAAIzP,EAAQ,IAAIb,MAAMiQ,GAEtB,MADApP,EAAMqP,MAAQA,EACRrP,EAGN+O,GAAIU,OAAOH,EAAOF,EAAKC,GACFN,GAAIW,OAMrCX,GAAIO,MAA2B,oBAAZK,SAA2BA,QAAQC,KAAgC,eAAzBD,QAAQC,IAAIC,SAA4B,EAAI,EACzGd,GAAIS,MAAQ,EACZT,GAAIW,KAAO,EACX,IAAII,GAA6B,oBAAXjD,OAClB,SAAkBkD,GACd,GAAIA,GAAkC,iBAAdA,EAAwB,CAC5C,IAAI3Z,EAAQ2Z,EAAUC,iBAAmBD,EAAiEzF,GAApCpH,QAAQ6M,EAAUC,iBAA4BzZ,MAAM+T,QAAQlU,IAC9H6Z,EAAS5b,OAAOiE,KAAKlC,GAAOoL,KAAK,MAAO0O,EAAO5F,EAAU,cAAgBlU,EAAMnB,OAAS,KAAO,KAAOgb,EAAS,KACnH,OAAOF,EAAU7b,YAAY+B,KAAO,IAAMia,EAE9C,OAAOH,GACP,SAAkB1Y,GAAK,OAAOA,GACf,oBAAZ0I,UACPgP,GAAIU,OAAS,SAAkBH,EAAOtP,EAAOqP,GACzC,IAAInP,GAAQF,GACZ,IAAK,IAAImQ,KAAUd,EACfnP,EAAKpG,KAAK,OAASqW,EAAS,IAAKL,GAAST,EAAMc,KAEpDpQ,QAAQuP,GAAOxX,MAAMiI,QAASG,KA+ItC,IAAInJ,GAAaR,MAAMnC,UAAW8D,GAAYuL,KAAKrP,UAAWgE,GAAc/D,OAAOD,UAuC/EsE,GAAYrE,OAAOC,OAAO,MAC9BoE,GAAU9D,eAAiBwD,GAAYxD,uGAhKvC,SAAmC8B,EAAO0Z,GAEtC,IAAK,IADDC,KACK9T,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC8T,EAAM9T,EAAK,GAAK/G,UAAU+G,GAE9B,IAAK,IAAIrC,EAAK,EAAGsC,EAAU6T,EAAOnW,EAAKsC,EAAQvH,OAAQiF,IAAM,CACzD,IAAIoW,EAAS9T,EAAQtC,GACjB9D,EAAQga,EAAWE,QACb,IAAVla,IAAqBM,EAAMtC,UAAUkc,GAAUla,oDA0CvD,SAAsCQ,EAAKuO,GAEvC,IAAK,IADD7P,EACKe,EAAQO,GAAMtB,GAAQe,EAAOA,EAAQhC,OAAOiC,eAAeD,GAChEf,EAAOjB,OAAOqB,yBAAyBW,EAAO8O,GAElD,OAAO7P,iCAuBX,SAA2BS,EAAMC,GAC7B,IAAK,IAAIC,KAAQD,EACbD,EAAKE,GAAQD,EAAOC,GAExB,OAAOF,gBAEX,SAA6BA,EAAMC,GAC/B,IAAK,IAAIC,KAAQD,OACM,IAAfD,EAAKE,KACLF,EAAKE,GAAQD,EAAOC,IAG5B,OAAOF,iBAgBX,SAAqBwa,GACjB,OAAOA,EAAIlc,OAAOiE,KAAKiY,qCC3LvBrX,GAAW,WACX,SAASA,KAiCT,OA/BAA,EAAQH,OAAS,SAAUyX,EAAYC,QAChB,IAAfD,IAAyBA,MAC7B,IAAI3X,EAAYpC,EAAaxC,MAC7Bwc,GAAehZ,EAAOxD,KAAMwc,GAC5B,IAAIhX,EAAS+W,EAAW/W,OAAQiX,EAAcC,EAAeH,GAAa,WAM1E,OALA/W,GAAUxF,KAAKwF,OAAOkM,MAAMlM,GAC5BxF,KAAKwF,OAAOQ,YAAYhG,KAAKG,UAAWsc,GAAa,GACrDzc,KAAKwF,OAAOQ,YAAYhG,KAAKG,UAAWH,KAAKwF,OAAOmX,qBAAqB/X,IAAY,GACrF5E,KAAK4c,UAAY5c,KAAK4c,SAAS5c,KAAKwF,OAAOF,YAAaV,GACxD5E,KAAKwF,OAAOqX,sBAAsBjY,GAC3B5E,MAEXiF,EAAQ6X,OAAS,SAAUxO,EAAMyO,GAC7B,IAAIC,EAgBJ,OAfI1O,GAAQA,EAAK3N,eAAe,eAE5Bf,EADAod,EAAc1O,EAAKrO,YACID,MAGvBgd,EAAe,SAAUzF,GAErB,SAAS0F,IACL,OAAkB,OAAX1F,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAE/D,OAJAyX,EAAkBwF,EAAU1F,GAIrB0F,GACTjd,MAEN0E,EAAUsY,GACV1O,GAAQ0O,EAAYlY,OAAOwJ,EAAMyO,GAC1BC,GAEJ/X,KA+CPF,GAAe,WACf,SAASA,EAAYtC,GACjBzC,KAAKyC,MAAQA,EACbzC,KAAKsF,eACL,IAAIE,EAAShD,EAAaC,GAAO+C,OACjCxF,KAAKkd,WAAc1X,GAAUA,EAAO0X,YAAe3Y,IACnDvE,KAAKyF,gBAAmBD,GAAUA,EAAOC,iBAAoBlB,IAC7DvE,KAAKmd,cAAiB3X,GAAUA,EAAO2X,kBA4E3C,OA1EApY,EAAYC,IAAM,SAAUvC,GACxB,IAAI+C,EAAS/C,EAAM+C,OACnB,OAAOA,GAAU/C,IAAU+C,EAAO/C,MAAQ+C,EACtC/C,EAAM+C,OAAS,IAAIT,EAAYtC,IAEvCsC,EAAY5E,UAAUwc,qBAAuB,SAAU/X,GACnD,IAAIU,EAAcf,IAAW9B,EAAQzC,KAAKyC,MAC1C,OAAOc,EAAU+B,EAAatF,KAAKyF,gBAAiB,SAAUY,EAAMrE,GAChE,GAAI4C,EAAU5C,KAAUS,EAAMT,GAC1B,OAAOS,EAAMT,MAIzB+C,EAAY5E,UAAUuR,MAAQ,SAAUlM,GAGpC,IAAK,IAFDpD,EAAQpC,KAAKyC,MAAMtC,UACnBgd,EAAgBnd,KAAKmd,cAAgBnd,KAAKmd,cAAcvX,QACnD0C,EAAK,EAAG8U,EAAW5X,EAAQ8C,EAAK8U,EAASpc,OAAQsH,IAAM,CAC5D,IAAI+U,EAAQD,EAAS9U,GACrB,GAAIhG,MAAM+T,QAAQgH,GACdrd,KAAK0R,MAAM2L,QAEV,GAAIF,EAActc,QAAQwc,GAAS,EAEpC,GADAF,EAActX,KAAKwX,GACE,mBAAVA,EAAsB,CAC7Brd,KAAKgG,YAAYhG,KAAKyC,MAAO4a,GAC7B,IAAIC,EAAeD,EAAM7X,OACrB8X,IACAtd,KAAKkd,WAAarb,EAAS0C,IAAWvE,KAAKkd,WAAYI,EAAaJ,YACpEld,KAAKyF,gBAAkB5D,EAAS0C,IAAWvE,KAAKyF,gBAAiB6X,EAAa7X,iBAC9EzF,KAAKmd,cAAgBnd,KAAKmd,cAAcI,OAAOD,EAAaH,gBAEhEnd,KAAKgG,YAAY5D,EAAOib,EAAMld,gBAG9BH,KAAKgG,YAAY5D,EAAOib,KAKxCtY,EAAY5E,UAAU+E,SAAW,WAE7B,IAAK,IADDsY,KACKlV,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpCkV,EAAMlV,GAAM/G,UAAU+G,GAE1B,IAAK,IAAIrC,EAAK,EAAGwX,EAAUD,EAAOvX,EAAKwX,EAAQzc,OAAQiF,IAAM,CACzD,IAAIZ,EAAOoY,EAAQxX,GACnBlB,EAAYC,IAAIK,GAAMqM,OAAO1R,KAAKyC,UAG1CsC,EAAY5E,UAAU6F,YAAc,SAAUlE,EAAMC,EAAQuE,GACxD,IAAIuR,EAAQ7X,MAwCpB,SAAwB0d,EAAQ7a,GAE5B,IAAK,IADD8a,EAASC,UAAeF,GACnBpV,EAAK,EAAGrC,EAAK7F,OAAOiE,KAAKqZ,GAASpV,EAAKrC,EAAGjF,OAAQsH,IAAM,CAC7D,IAAI+T,EAASpW,EAAGqC,GAChBqV,EAAOtB,IAAWxZ,EAAIwZ,IA3CtBwB,CAAe9b,EAAQ,SAAUC,GAC7B,IACIqE,EADAD,EAAahG,OAAOqB,yBAAyBM,EAAQC,IAErDqE,EAAOwR,EAAMpS,gBAAgBzD,KAC7BmE,EAAe0R,EAAMvS,YAAatD,EAAMoE,EAAYC,EAAMC,GAEzDD,GAAQA,IAASyX,GAAWC,YAC7B5X,EAAerE,EAAME,EAAMoE,EAAYyR,EAAMqF,WAAWlb,GAAOsE,MAI3EvB,EAAY5E,UAAU0c,sBAAwB,SAAUjY,GACpD,IAAesY,EAANld,KAAsBkd,WAAYza,EAAlCzC,KAA6CyC,MACtD,GAAIya,EAAY,CACZ,IAAI9a,EAAQK,EAAMtC,UAAW6d,EAAYpZ,EAAUzE,UACnD,IAAK,IAAI+b,KAAUgB,EAAY,CAC3B,IAAI7W,EAAO6W,EAAWhB,GAClB9Z,EAAMzB,eAAeub,IAAWA,KAAU8B,IAC1C5b,EAAM8Z,GAAUzV,EAAYrE,EAAM8Z,GAAS8B,EAAU9B,GAAS7V,OAKvEtB,KAGP6Y,IACAK,SAAU1Z,GACNvD,QAAQ,EACRb,WAAW,EACX+d,QAAQ,EACR3c,WAAW,EACXS,MAAM,EACN6C,WAAW,IAEf6Y,OAAQnZ,GACJtE,aAAa,KAUVuF,GAAS,WAEhB,IAAK,IADD2Y,KACK7V,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC6V,EAAK7V,GAAM/G,UAAU+G,GAEzB,gBAAkB7F,GAAS,OAAOsC,GAAYC,IAAIvC,GAAOiP,MAAMyM,KAExDL,YAAwBvY,GAAS,gBAAkB9C,GAC1D,IAAI+C,EAAST,GAAYC,IAAIvC,GAC7B+C,EAAO0X,WAAarb,EAAS0D,EAAOC,EAAO0X,cAE/CY,GAAW3b,MAAQ,SAAU4B,EAAGjE,GAAK,OAAOiE,GAC5C+Z,GAAWC,WAAa,SAAUha,EAAGjE,GAAK,OAAOiE,GACjD+Z,GAAWpM,MAAQ,SAAU3N,EAAGjE,GAAK,OAAO+B,KAAakC,EAAGjE,IAC5Dge,GAAWM,KAAO,SAAUra,EAAGjE,GAAK,gBAAkBsD,GAClD,OAAOW,EAAEnD,KAAKZ,KAAMF,EAAEc,KAAKZ,KAAMoD,MAErC0a,GAAWjc,SAAW,SAAUkC,EAAGjE,GAAK,kBACpC,OAAO+B,EAASkC,EAAEF,MAAM7D,KAAMuB,WAAYzB,EAAE+D,MAAM7D,KAAMuB,cAE5Duc,GAAWO,WAAa,SAAUta,EAAGjE,GAAK,kBACtCiE,EAAEF,MAAM7D,KAAMuB,WACdzB,EAAE+D,MAAM7D,KAAMuB,aAElBuc,GAAWQ,UAAY,SAAUva,EAAGjE,GAAK,kBACrCA,EAAE+D,MAAM7D,KAAMuB,WACdwC,EAAEF,MAAM7D,KAAMuB,aAElBuc,GAAWvb,MAAQ,SAAUwB,EAAGjE,GAAK,kBACjC,OAAOiE,EAAEF,MAAM7D,KAAMuB,YAAczB,EAAE+D,MAAM7D,KAAMuB,aAErDuc,GAAWlb,KAAO,SAAUmB,EAAGjE,GAAK,kBAChC,OAAOiE,EAAEF,MAAM7D,KAAMuB,YAAczB,EAAE+D,MAAM7D,KAAMuB,aC7NrD,IAAIgd,GAAY,WACZ,SAASA,EAASlR,GACdrN,KAAKyY,YACDpL,IACIA,aAAekR,EACfve,KAAKyY,SAAWpL,EAAIoL,SAAS7S,QAG7ByH,GAAOrN,KAAKwe,aAAanR,IAqCrC,OAjCAkR,EAASpe,UAAUuR,MAAQ,SAAUrE,GACjCrN,KAAKyY,SAAWzY,KAAKyY,SAAS8E,OAAOlQ,EAAIoL,WAE7C8F,EAASpe,UAAUqe,aAAe,SAAUnR,GACxC,IAAK,IAAI+O,KAAS/O,EACdrN,KAAKuQ,SAAS6L,EAAO/O,EAAI+O,KAGjCmC,EAASpe,UAAUse,aAAe,SAAUrC,GACxC,IAAK,IAAI9T,EAAK,EAAGrC,EAAKmW,EAAM5T,MAAMJ,IAAgBE,EAAKrC,EAAGjF,OAAQsH,IAAM,CACpE,IAAI4T,EAASjW,EAAGqC,GAChBtI,KAAKuQ,SAAS2L,EAAQxV,EAAmBwV,MAGjDqC,EAASpe,UAAUoQ,SAAW,SAAU6L,EAAOlV,GAE3C,IAAK,IADDuR,EAAWzY,KAAKyY,SACXnQ,EAAK,EAAGrC,EAAKmW,EAAM5T,MAAMJ,IAAgBE,EAAKrC,EAAGjF,OAAQsH,IAAM,CACpE,IAAI+T,EAASpW,EAAGqC,GAChBmQ,EAAS5S,KAAK,IAAI6Y,GAAgBrC,EAAQnV,MAGlDqX,EAASpe,UAAU4R,UAAY,SAAU5Q,EAAQY,GAC7C,IAAK,IAAIuG,EAAK,EAAGrC,EAAKjG,KAAKyY,SAAUnQ,EAAKrC,EAAGjF,OAAQsH,IAAM,CACvD,IAAIqW,EAAU1Y,EAAGqC,GACjBX,EAAG5F,EAAQ4c,EAAQ3c,KAAM2c,EAAQzX,SAAU/F,KAGnDod,EAASpe,UAAUmS,YAAc,SAAUnR,EAAQY,GAC/C,IAAK,IAAIuG,EAAK,EAAGrC,EAAKjG,KAAKyY,SAAUnQ,EAAKrC,EAAGjF,OAAQsH,IAAM,CACvD,IAAIsW,EAAU3Y,EAAGqC,GACjBP,EAAIhG,EAAQ6c,EAAQ5c,KAAM4c,EAAQ1X,SAAU/F,KAG7Cod,KAGPG,GAAmB,WAiBnB,OAhBA,SAAyB1c,EAAMkF,GAC3BlH,KAAKgC,KAAOA,EAERhC,KAAKkH,UADQ,IAAbA,EACgBR,EAAmB1E,GAEV,iBAAbkF,EAER,WACI,IAAI2X,EAAU7e,KAAKkH,GACnB2X,GAAWA,EAAQhb,MAAM7D,KAAMuB,YAIvB2F,MAMxBN,MAWAgB,GAAgB,WAOhB,OANA,SAAsBV,EAAUC,EAASK,QACxB,IAATA,IAAmBA,EAAO,MAC9BxH,KAAKkH,SAAWA,EAChBlH,KAAKmH,QAAUA,EACfnH,KAAKwH,KAAOA,MA+EhBY,GAAgB,sIC/JwBH,GAAU6W,EAAoBnX,GAAKoX,EAAehX,GAAMiX,EAAgBvb,GAAOwb,EAAiBpY,GAAWqY,EAAqBnY,GAAWoY,EAAqBrY,GAAWsY,EAEnNlW,GAAW,EAKXmW,GAAa,WACb,SAASA,IACLrf,KAAKiH,aAAU,EACfjH,KAAKsJ,kBAAe,EACpBtJ,KAAKuJ,IAAMN,IACXjJ,KAAKwK,WAAW3G,MAAM7D,KAAMuB,WAmGhC,OAjGA8d,EAAUzC,SAAW,SAAU3W,EAAIrB,GAC/B,IAAI0a,EAAcrZ,EAAGqZ,YAAalP,EAAenK,EAAGmK,aAAcmP,EAAatZ,EAAGsZ,WAClF,GAAID,GAAelP,EAAc,CAC7B,IAAIoP,EAAY,IAAIjB,GAASve,KAAKG,UAAUiQ,cAC5CkP,GAAeE,EAAUhB,aAAac,GACtClP,GAAgBoP,EAAU9N,MAAMtB,GAChCpQ,KAAKG,UAAUiQ,aAAeoP,EAE9BD,GACAnf,OAAOqf,iBAAiBzf,KAAKG,UAAWoD,KAAcgc,EAAYpW,KAG1EkW,EAAUlf,UAAUqK,WAAa,aACjC6U,EAAUlf,UAAUwH,GAAK,SAAUQ,EAAQjB,EAAUC,GACjD,GAAsB,iBAAXgB,EACPF,GAAQN,GAAI3H,KAAMmI,EAAQjB,EAAUC,QAEpC,IAAK,IAAI+U,KAAU/T,EACfF,GAAQN,GAAI3H,KAAMkc,EAAQ/T,EAAO+T,GAAS/U,GAAWD,GAC7D,OAAOlH,MAEXqf,EAAUlf,UAAUsD,KAAO,SAAU0E,EAAQjB,EAAUC,GACnD,GAAsB,iBAAXgB,EACPF,GAAQxE,GAAMzD,KAAMmI,EAAQjB,EAAUC,QAEtC,IAAK,IAAIkV,KAAUlU,EACfF,GAAQxE,GAAMzD,KAAMqc,EAAQlU,EAAOkU,GAASlV,GAAWD,GAC/D,OAAOlH,MAEXqf,EAAUlf,UAAU4H,IAAM,SAAUI,EAAQjB,EAAUC,GAClD,GAAKgB,EAEA,GAAsB,iBAAXA,EACZF,GAAQF,GAAK/H,KAAMmI,EAAQjB,EAAUC,QAErC,IAAK,IAAIa,KAAUG,EACfF,GAAQF,GAAK/H,KAAMgI,EAAQG,EAAOH,GAASb,GAAWD,QAL1Da,GAAI/H,UAAM,EAAQkH,EAAUC,GAMhC,OAAOnH,MAEXqf,EAAUlf,UAAU+L,QAAU,SAAUlK,EAAM+B,EAAGjE,EAAGwB,EAAGzB,EAAGW,GAOtD,YANU,IAANX,QAAsB,IAANW,EAChBqG,GAAS7G,KAAMgC,EAAM+B,EAAGjE,EAAGwB,EAAGzB,EAAGW,QACtB,IAANc,EACLwF,GAAS9G,KAAMgC,EAAM+B,EAAGjE,EAAGwB,GAE3ByF,GAAS/G,KAAMgC,EAAM+B,EAAGjE,GACrBE,MAEXqf,EAAUlf,UAAUuf,SAAW,SAAU3d,EAAQgC,EAAGjE,GAKhD,OAJIiC,IACAqH,EAAapJ,KAAM+B,GACnBA,EAAO4F,GAAG5D,EAAIjE,GAAkB,iBAANiE,EAAwBjE,EAAPE,KAAUA,OAElDA,MAEXqf,EAAUlf,UAAUwf,aAAe,SAAU5d,EAAQgC,EAAGjE,GAKpD,OAJIiC,IACAqH,EAAapJ,KAAM+B,GACnBA,EAAO0B,KAAKM,EAAIjE,GAAkB,iBAANiE,EAAwBjE,EAAPE,KAAUA,OAEpDA,MAEXqf,EAAUlf,UAAUyf,cAAgB,SAAUC,EAAU9b,EAAGjE,GACvD,IAAIwJ,EAAetJ,KAAKsJ,aACxB,GAAIA,EAAc,CACd,IAAIwW,IAAc/b,GAAKjE,GAAIigB,EAAUjgB,GAAkB,iBAANiE,EAAwBjE,EAAPE,KAClE,GAAI6f,EAAU,CACV,IAAI9d,EAASuH,EAAauW,EAAStW,KAC/BxH,IACI+d,UACOxW,EAAauW,EAAStW,KACjCxH,EAAOgG,IAAIhE,EAAGgc,EAAQ/f,YAGzB,GAAgB,MAAZ6f,EAAkB,CACvB,IAAK,IAAItW,KAAOD,EACZA,EAAaC,GAAKxB,IAAIhE,EAAGgc,EAAQ/f,MACjC8f,IACC9f,KAAKsJ,kBAAe,IAGjC,OAAOtJ,MAEXqf,EAAUlf,UAAUkS,QAAU,WACtBrS,KAAKggB,YAEThgB,KAAK4f,gBACL5f,KAAK+H,MACL/H,KAAKggB,WAAY,IAErBX,EAAY3H,GACR5S,EACAQ,GACIia,WAAYzB,GAAWpM,MACvB4N,YAAaxB,GAAWpM,SAE7B2N,MAIIY,GAAS5c,EAAKgc,GAAUlf,UAAW,cAAe,cuBhH7DC,OAAO0c,OAAS,SAAUP,EAAYC,GAAe,OAAOvX,GAAQ6X,OAAOP,EAAYC,IACvFpc,OAAOoD,SAAWpD,OAAOoD,OAAS0c,GAClC9f,OAAO0a,IAAMqF,GCTb,IAAIC,GAAmB,WACnB,SAASA,EAAgBzd,GACrB3C,KAAKgB,OAAS2B,EAAI0d,gBAAgBrgB,KAAKqT,YACnCrT,KAAK+L,MAAQpJ,EAAI2d,SAAS3d,KAC1B3C,KAAKgB,SAqBb,OAlBAof,EAAgBjgB,UAAUogB,KAAO,SAAU7J,GACvC,IAAe3K,EAAN/L,KAAiB+L,MAAOsH,EAAxBrT,KAAoCqT,OACzCtH,GACA2K,EAAS3K,EAAO,MACpB,IAAK,IAAI3K,KAAOiS,EACZqD,EAASrD,EAAOjS,GAAMA,IAG9Bgf,EAAgBjgB,UAAUqgB,UAAY,SAAU9J,EAAUgH,GACtD1d,KAAKugB,KAAK,SAAUpe,EAAOf,GACnBe,aAAiBie,EACjBje,EAAMqe,UAAU9J,EAAUgH,EAAO1Y,IAAI5D,IAGrCsV,EAASvU,EAAOf,EAAKsc,MAI1B0C,KvBzBPtW,GAAgB,6BAChB2G,GAAqB,WAkBrB,OAjBA,SAA2B/G,EAAW+W,QAChB,IAAdA,IAAwBA,GAAY,GACxC,IAAI7W,EAAOF,EACNG,MAAMC,IACNuD,IAAI,SAAUjM,GACf,MAAY,MAARA,GAAuB,UAARA,EACR,aACI,MAAXA,EAAI,GACG,mBAAsBA,EAAIsf,OAAO,GAAK,KACnB,IAA1Btf,EAAIP,QAAQ,UACL,mBAAsBO,EAAIsf,OAAO,GAAK,KAC1Ctf,IAEXpB,KAAK2Q,KAAO8P,GAAa7W,EAAK+W,MAC9B3gB,KAAK0Q,OAAS9G,EAAK5I,OACnBhB,KAAK4K,QAAU,IAAIwC,SAAS,OAAQ,8BAAgCxD,EAAKgX,QAAU,+CAAiDhX,EAAKyD,IAAI,SAAUjK,GAAK,MAAO,gCAAkCA,EAAI,oBAAsBmK,KAAK,IAAM,2CEZxLzG,GAAW+Z,EAAoBlZ,GAAKmZ,EAAc/Y,GAAMgZ,GAElH,SAAWzP,GACPA,EAAcA,EAAqB,MAAI,GAAK,QAC5CA,EAAcA,EAAsB,OAAI,GAAK,SAC7CA,EAAcA,EAA0B,WAAI,GAAK,aAHrD,CAIGA,kBAAkBA,qBACrB,IAAInC,GAAiB,WACjB,SAASA,EAAc5F,GACnBvJ,KAAKiH,aAAU,EACfjH,KAAKghB,gBACLhhB,KAAKihB,cAAe,EACpBjhB,KAAKkhB,SAAW,KAChBlhB,KAAKoK,YAAS,EACdpK,KAAKsK,eAAY,EACjBtK,KAAKmhB,sBAAmB,EACxBnhB,KAAKuJ,IAAMvJ,KAAKohB,UAAY7X,EA0IhC,OAxIA8X,EAAkBlS,EAClBA,EAAcyN,SAAW,SAAUtX,EAAaV,GACxCU,EAAYgc,WACZthB,KAAKG,UAAUohB,UAAYjc,EAAYgc,UAC3CjC,GAAUzC,SAAShc,KAAKZ,KAAMsF,EAAaV,IAG/CuK,EAAchK,SAAW,SAAUP,GAC3BA,EAAUvE,SAAWL,KAAKK,SAC1BL,KAAKK,OAASghB,EAAgBhhB,SAGtC8O,EAAc9O,OAAS,SAAU0D,EAAGjE,GAChC,OAAO,IAAIE,KAAK+D,EAAGjE,IAEvBqP,EAAchP,UAAUkS,QAAU,WAC1BrS,KAAKggB,YAET1U,EAAQtL,MACRA,KAAKoK,YAAS,EACdpK,KAAKsK,eAAY,EACjBtK,KAAK+H,MACL/H,KAAK4f,gBACL5f,KAAKggB,WAAY,IAErB7Q,EAAchP,UAAUqK,WAAa,aACrC2E,EAAchP,UAAUqhB,UAAY,SAAU3C,EAAS1d,GACnDwG,GAAG3H,KAAMA,KAAKwR,iBAAkBqN,EAAS1d,IAE7CgO,EAAchP,UAAUshB,WAAa,SAAU5C,EAAS1d,GACpD4G,GAAI/H,KAAMA,KAAKwR,iBAAkBqN,EAAS1d,IAE9CgO,EAAchP,UAAUuhB,gBAAkB,SAAUvgB,EAAQ0d,GACxD7e,KAAK0f,SAASve,EAAQA,EAAOqQ,iBAAkBqN,IAEnD1P,EAAchP,UAAU4T,YAAc,SAAUlR,EAAKuI,QACjC,IAAZA,IAAsBA,MAC1B,IAAIiB,EAASgL,GAAe/K,MAAMtM,MAC9B2hB,EAAS9e,EAAIjC,KAAKZ,KAAMA,MAC5B2hB,GAAU3hB,KAAKma,IAAIwH,GACnBtV,GAAUgL,GAAe1K,OAAO3M,OAEpCmP,EAAchP,UAAUyhB,WAAa,SAAUlL,EAAUtL,GACrD,IAAIiB,EAASgL,GAAe/K,MAAMtM,MAClCA,KAAKugB,KAAK7J,GACVrK,GAAUgL,GAAe1K,OAAO3M,OAEpCmP,EAAchP,UAAUga,IAAM,SAAUzM,EAAQtC,GAC5C,GAAIsC,EAAQ,CACR,IAAIqG,EAAc/T,KAAKgU,mBAAmBtG,EAAQtC,GAClD2I,GAAeA,EAAYpH,SAE/B,OAAO3M,MAEXmP,EAAchP,UAAU0hB,WAAa,SAAU9f,GAC3C,IAAI8V,EAAQ7X,KAQZ,OAPAA,KAAK+T,YAAY,WACb8D,EAAMsC,IAAIpY,EAAOga,iBAAmBha,GAAU2P,OAAO,IACrD,IAAIsP,EAAejf,EAAOif,aACtBA,IACAnJ,EAAMmJ,aAAeA,KAGtBhhB,MAEXmP,EAAchP,UAAUwT,MAAQ,SAAUmO,EAAM1W,GAAW,OAAO0W,GAClE3S,EAAchP,UAAU4hB,QAAU,SAAUrY,GACxC,OAAOF,EAAiBxJ,KAAM0J,EAAW,SAAUgU,EAAQtc,GAAO,OAAOsc,EAAO1Y,IAAM0Y,EAAO1Y,IAAI5D,GAAOsc,EAAOtc,MAEnH+N,EAAchP,UAAU8J,SAAW,WAC/B,OAAOjK,KAAKoK,QAEhB+E,EAAchP,UAAU6J,SAAW,WAC/B,IAAII,EAASpK,KAAKoK,OAClB,OAAOA,EAASA,EAAOJ,WAAahK,KAAKgiB,eAE7C7S,EAAchP,UAAUkN,IAAM,SAAUqJ,EAAUvP,GAC9C,IAAIpE,KAAUF,OAAkB,IAAZsE,EAAqB,SAAUoP,EAAGC,GAAK,OAAOE,EAAS9V,KAAKuG,EAASoP,EAAGC,IAAQE,EAMpG,OALA1W,KAAKugB,KAAK,SAAU0B,EAAK7gB,GACrB,IAAI4B,EAASH,EAAIof,EAAK7gB,QACP,IAAX4B,GACAD,EAAI8C,KAAK7C,KAEVD,GAEXoM,EAAchP,UAAU+hB,aAAe,WAAc,OAAOliB,KAAKwL,YACjE2D,EAAchP,UAAUgiB,MAAQ,SAAU/W,GAAW,MAAM,IAAIF,MAAM,oBACrEiE,EAAchP,UAAUiiB,YAAc,WAClC,OAAOlY,EAAiBlK,OAASA,KAAKuhB,WAE1CpS,EAAchP,UAAUkiB,UAAY,SAAU3L,EAAUvP,GACpD,IAAIxE,KAMJ,OALA3C,KAAKugB,KAAK,SAAU0B,EAAK7gB,GACrB,IAAI4B,EAAS0T,EAASuL,EAAK7gB,QACZ,IAAX4B,IACAL,EAAIvB,GAAO4B,KAEZL,GAEXvC,OAAOwB,eAAeuN,EAAchP,UAAW,mBAC3C6E,IAAK,WACD,IAAI+G,EAAQ/L,KAAKmhB,mBAAqBnhB,KAAKmhB,iBAAmB,IAAIf,GAAgBpgB,OAClF,OAAO+L,EAAM/K,OAAS+K,EAAQ,MAElCuW,YAAY,EACZ9b,cAAc,IAElB2I,EAAchP,UAAUmgB,SAAW,SAAU3d,KAC7CwM,EAAchP,UAAUoiB,mBAAqB,SAAUnhB,GACnD,IAAI2K,EAAQ/L,KAAKwiB,gBACjB,OAAQphB,EAAM2K,GAASA,EAAMsH,OAAOjS,GAAO2K,IAAU,MAEzDoD,EAAchP,UAAUsiB,oBAAsB,SAAU/Y,GACpD,OAAOF,EAAiBxJ,KAAM0J,EAAW,SAAUgU,EAAQtc,GAAO,OAAOsc,EAAO6E,mBAAmBnhB,MAEvG+N,EAAchP,UAAUuiB,oBAAsB,SAAUhM,GACpD,IAAI8L,EAAkBxiB,KAAKwiB,gBAC3BA,GAAmBA,EAAgBhC,UAAU9J,EAAU1W,OAE3DmP,EAAchP,UAAUwiB,QAAU,SAAUvhB,GACxC,OAAQpB,KAAKuiB,mBAAmBnhB,IAEpC+N,EAAchP,UAAUyiB,QAAU,WAAc,OAAO5iB,KAAKuJ,KAC5D4F,EAAchP,UAAU0b,SAAW,WAAc,OAAO7b,KAAKuJ,KAC7D4F,EAAchP,UAAU0iB,aAAe,WACnC,IAAI7gB,EAAOhC,KAAKC,YAAY+B,KAC5B,GAAa,aAATA,EACA,OAAOA,GAEfmN,EAAgBkS,EAAkB3J,GAC9B5S,EACAQ,GACIgc,SAAUxD,GAAW3b,QAEzBqD,GAAO6Z,KACRlQ,GAEH,IAAIkS,KAGGhK,IACP/K,MAAO,SAAUoR,GACb,OAAOA,EAAOuD,eAAwBvD,EAAOuD,cAAe,IAEhExU,YAAa,SAAUiR,EAAQtS,GAC3B,IAAI0X,GAAS1X,EAAQuJ,OAKrB,OAJImO,IACApF,EAAOwD,SAAW9V,GACtBsS,EAAOsD,gBACPtD,EAAOyD,sBAAmB,EACnB2B,GAEXnW,OAAQ,SAAU+Q,EAAQqF,GACtB,IAAIC,EAAkBtF,EAAOwD,SAC7B,GAAI8B,EAAiB,CACjB,KAAOtF,EAAOwD,UAAU,CACpB,IAAI9V,EAAUsS,EAAOwD,SACrBxD,EAAOwD,SAAW,KAClBpa,GAAS4W,EAAQA,EAAOlM,iBAAkBkM,EAAQtS,EAAS2X,GAE/DrF,EAAOuD,cAAe,EACtB,IAAI7W,EAASsT,EAAOtT,OAChBA,GAAUA,IAAW2Y,GACrB3Y,EAAOqH,kBAAkBiM,EAAQsF,QAIrCtF,EAAOwD,SAAW,KAClBxD,EAAOuD,cAAe,GAG9BgC,OAAQ,SAAUhR,EAAOC,EAAO9Q,GAC5B,OAAK8Q,EAAM9H,OAKJ8H,EAAM9H,SAAW6H,GAJpBC,EAAM9H,OAAS6H,EACfC,EAAM5H,UAAYlJ,GACX,IAIf4Q,KAAM,SAAUC,EAAOC,GACfD,IAAUC,EAAM9H,SAChB8H,EAAM9H,YAAS,EACf8H,EAAM5H,eAAY,KC5M1BsC,GAASyK,GAAe/K,MAAOU,GAAeqK,GAAe5K,YAAaE,GAAS0K,GAAe1K,OAElG7F,GAAW+Z,EAuBJqC,IACPnP,YAAa,SAAUlR,EAAKuI,QACR,IAAZA,IAAsBA,MAC1B,IAAIiB,EAASC,EAAMtM,MACnB6C,EAAIjC,KAAKZ,KAAMA,MACfqM,GAAUM,GAAO3M,OAErByR,kBAAmB,SAAUS,EAAO9G,GAChC,IAAId,EAAY4H,EAAM5H,UAAWiP,EAAYvZ,KAAKuM,YAAYjC,GACzDiP,IAAaA,EAAU4J,kBACxBnjB,KAAKojB,qBAAqB9Y,EAAWc,IAE7CgY,qBAAsB,SAAUhiB,EAAKgK,QACjB,IAAZA,IAAsBA,MAC1B,IAAIiB,EAASC,EAAMtM,MACfyM,EAAYzM,KAAMoL,IAClBtE,GAAS9G,KAAM,UAAYoB,EAAKpB,KAAMA,KAAK0M,WAAWtL,GAAMgK,GAEhEiB,GAAUM,GAAO3M,OAErBgU,mBAAoB,SAAUqP,EAAUjY,QACpB,IAAZA,IAAsBA,MAC1B,IACIkY,EADAjX,EAASC,EAAMtM,MAAOujB,KAAclQ,KAAa9G,EAAcvM,KAAKuM,YAAamB,EAAStC,EAAQuI,MAAQ3T,KAAK2T,MAAM0P,EAAUjY,GAAWiY,EAE9I,GAAI5V,EAAiBzN,KAAM0N,GACvB,IAAK,IAAIwO,KAAUxO,EAAQ,CACvB,IAAIY,EAAO/B,EAAY2P,GACnB5N,EACIA,EAAK9B,SAASkB,EAAOwO,GAASlc,KAAMoL,EAASiI,IAC7CkQ,EAAQ1d,KAAKqW,IAIjBoH,IAAYA,MACZA,EAAQzd,KAAK,IAAMqW,EAAS,MAMxC,GAAIqH,EAAQviB,QAAUyL,EAAYzM,KAAMoL,GACpC,OAAO,IAAIoY,GAAkBxjB,KAAMqM,EAAQgH,EAAQkQ,GAEvD,IAAK,IAAIjb,EAAK,EAAGmb,EAAWpQ,EAAQ/K,EAAKmb,EAASziB,OAAQsH,IAAM,CACnCmb,EAASnb,GACfqE,OAAO3M,MAE9BqM,GAAUM,GAAO3M,QAiBrBwjB,GAAqB,WACrB,SAASA,EAAkB9F,EAAQrR,EAAQgH,EAAQkQ,GAC/CvjB,KAAK0d,OAASA,EACd1d,KAAKqM,OAASA,EACdrM,KAAKqT,OAASA,EACdrT,KAAKujB,QAAUA,EAenB,OAbAC,EAAkBrjB,UAAUwM,OAAS,SAAUoW,GAE3C,IAAK,IADU1P,EAANrT,KAAkBqT,OAAQqK,EAA1B1d,KAAsC0d,OAAQ6F,EAA9CvjB,KAA2DujB,QAC3Djb,EAAK,EAAGob,EAAWrQ,EAAQ/K,EAAKob,EAAS1iB,OAAQsH,IAAM,CAC1Cob,EAASpb,GACfqE,OAAO+Q,GAGvB,IAAK,IADDhR,EAAagR,EAAOhR,WAAYwU,EAAWxD,EAAOwD,SAC7Chb,EAAK,EAAGyd,EAAYJ,EAASrd,EAAKyd,EAAU3iB,OAAQkF,IAAM,CAC/D,IAAI9E,EAAMuiB,EAAUzd,GACpBY,GAAS4W,EAAQ,UAAYtc,EAAKsc,EAAQhR,EAAWtL,GAAM8f,GAE/DlhB,KAAKqM,QAAUM,GAAO+Q,EAAQqF,IAE3BS,KC5GP1f,GAAWqT,EAAgB3T,GAAS0c,EACpC0D,MACA7T,GAAW,WACX,SAASA,EAAQ/N,EAAMwR,GACnBxT,KAAKgC,KAAOA,EACZhC,KAAK6jB,QAAU,KACf7jB,KAAKoL,QAAUoI,EACf,IAAIpI,EAAU5H,IAASsgB,YAAcC,cAAgBC,mBAAsBxQ,GAC3EpI,EAAQ0Y,SAAW1Y,EAAQ0Y,SAASle,QACpCwF,EAAQ2Y,WAAa3Y,EAAQ2Y,WAAWne,QACxCwF,EAAQ4Y,eAAiB5Y,EAAQ4Y,eAAepe,QAChD,IAAIzD,EAAQiJ,EAAQjJ,MAAOkM,EAAOjD,EAAQiD,KAAMsF,EAAQvI,EAAQuI,MAAOsQ,EAAS7Y,EAAQ6Y,OAAQC,EAAe9Y,EAAQ8Y,aAAc5D,EAAWlV,EAAQkV,SAAUwD,EAAW1Y,EAAQ0Y,SAAUC,EAAa3Y,EAAQ2Y,WAAYC,EAAiB5Y,EAAQ4Y,eAuBzP,GAtBAhkB,KAAKmC,MAAQA,EACbnC,KAAKqO,KAAOA,GACPjD,EAAQsD,kBAAoBL,EAC7BrO,KAAKyO,aAAezO,KAAKK,OAEpB8jB,EAAkBhiB,GACvBnC,KAAKyO,aAAe,IAAIrB,SAAS,UAAYgX,KAAKC,UAAUliB,GAAS,KAGrEnC,KAAKyO,aAAezO,KAAKyO,aAE7BzO,KAAKmjB,kBAAoC,IAAjBe,EACxBlkB,KAAKikB,YAAoB,IAAXA,EAAoBjkB,KAAKikB,OAASA,EAChDjkB,KAAKsgB,SAAWA,GAAYtgB,KAAKsgB,SAC7BlV,EAAQkZ,aACRtkB,KAAKsgB,SAoGjB,SAAwBA,GACpB,OAAO,SAAUlU,EAAQjK,EAAOf,GAC5B,OAAOe,EAAQme,EAAS1f,KAAKZ,KAAMoM,EAAQjK,EAAOf,GAAO,YAtGrCmjB,CAAevkB,KAAKsgB,WAExCyD,EAAWzd,QAAQtG,KAAKwkB,SACxBxkB,KAAK2T,MAAQA,GAAS3T,KAAK2T,MACvB3T,KAAKgF,KACL8e,EAASxd,QAAQtG,KAAKgF,KAC1BhF,KAAKwK,WAAW5J,KAAKZ,KAAMoL,GACvB0Y,EAAS9iB,OAAQ,CACjB,IAAIyjB,EAAYzkB,KAAK6jB,QAAUC,EAASY,OAAO9W,GAC3C+W,EAAa3kB,KAAKsgB,SACtBtgB,KAAKsgB,SAAW,SAAUlU,EAAQjK,EAAOf,GACrC,OAAOujB,EAAW/jB,KAAKZ,KAAMoM,EAAQqY,EAAU7jB,KAAKwL,EAAQjK,EAAOf,GAAMA,IAGjFpB,KAAKuD,UAAYwgB,EAAW/iB,OAAS+iB,EAAWW,OAAO3W,GAAmB/N,KAAKuD,UAC/EvD,KAAK4kB,aAAeZ,EAAehjB,OAASgjB,EAAeU,OAAOxW,GAAuBlO,KAAK4kB,aAkElG,OAhEA7U,EAAQ1P,OAAS,SAAU+K,EAASpJ,GAChC,IAAIqM,EAAOjD,EAAQiD,KACnB,OAAO,IADkCjD,EAAQoD,aAAeH,EAAOA,EAAKG,WAAauB,IAChE/N,EAAMoJ,IAEnC2E,EAAQ5P,UAAU0kB,aAAe,SAAUxd,EAAMG,EAAM4D,KACvD2E,EAAQ5P,UAAUoD,UAAY,SAAUiE,EAAMH,EAAM+J,EAAOhG,GAAW,OAAO5D,GAC7EuI,EAAQ5P,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+J,EAAOhG,GAAW,OAAO5D,GAC3EuI,EAAQ5P,UAAU2kB,UAAY,SAAU/gB,EAAGjE,GACvC,OAAOgE,GAASC,EAAGjE,IAEvBiQ,EAAQ5P,UAAUykB,aAAe,SAAUpd,EAAMH,EAAM+J,EAAOhG,KAC9D2E,EAAQ5P,UAAUE,OAAS,aAC3B0P,EAAQ5P,UAAUwR,MAAQ,SAAUxP,EAAOiK,GACvC,OAAOjK,GAEX4N,EAAQ5P,UAAUkS,QAAU,SAAUjG,EAAQjK,GAC1CnC,KAAK4kB,kBAAa,EAAQziB,EAAOiK,EAAQwX,KAE7C7T,EAAQ5P,UAAUmgB,SAAW,SAAUlU,EAAQjK,EAAOf,KACtD2O,EAAQ5P,UAAU8jB,OAAS,SAAU9hB,EAAOf,GACxC,OAAOe,GAASA,EAAM8hB,OAAS9hB,EAAM8hB,SAAW9hB,GAEpD4N,EAAQ5P,UAAU4kB,yBAA2B,WACzC,IAAe/iB,EAANhC,KAAgBgC,KAAM6hB,EAAtB7jB,KAAmC6jB,QAC5C,GAAa,OAAT7hB,EACA,OACImY,IAAK,SAAUhY,GACXgK,EAAanM,KAAMgC,EAAMG,IAE7B6C,IAAM6e,EACF,WACI,OAAOA,EAAQjjB,KAAKZ,KAAMA,KAAK0M,WAAW1K,GAAOA,IAErD,WAAc,OAAOhC,KAAK0M,WAAW1K,MAIrD+N,EAAQ5P,UAAUqK,WAAa,SAAUxI,EAAMoJ,KAC/C2E,EAAQ5P,UAAU6kB,OAAS,SAAU7iB,EAAOiK,EAAQhB,GAChD,IAAImL,OAAc,IAAVpU,EAAmBnC,KAAKyO,eAAiBtM,EAAOiB,EAAIpD,KAAKuD,UAAUgT,OAAG,EAAQnK,EAAQhB,GAE9F,OADApL,KAAK4kB,aAAaxhB,OAAG,EAAQgJ,EAAQhB,GAC9BhI,GAEX2M,EAAQ5P,UAAUqM,SAAW,SAAUrK,EAAOiK,EAAQhB,EAASiI,GAC3D,IAAIrR,EAAOhC,KAAKgC,KAAM0K,EAAaN,EAAOM,WAAYrF,EAAOqF,EAAW1K,GACpEwF,EAAOxH,KAAKuD,UAAUpB,EAAOkF,EAAM+E,EAAQhB,GAE/C,OADAsB,EAAW1K,GAAQwF,IACfxH,KAAK8kB,UAAUtd,EAAMH,KACrBrH,KAAK4kB,aAAapd,EAAMH,EAAM+E,EAAQhB,IAC/B,IAIf2E,EAAQ5P,UAAUwN,KAAO,SAAU0N,EAAO4J,EAAM9iB,EAAOiK,GACnD+T,GAAU9E,EAAO,4BAA8BjP,EAAOyW,eAAiB,IAAM7iB,KAAKgC,KAAO,KAAOijB,GAC5FC,OAAU9Y,EACV+Y,uBAAwBnlB,KACxBolB,cAAehZ,EAAOM,WAAW1M,KAAKgC,MACtCqjB,YAAaljB,KAGrB4N,EAAQ5P,UAAUsO,aAAe,WAC7B,OAAOzO,KAAKmC,OAET4N,KoB3GPiC,GAAOqF,GAAerF,KAAMiR,GAAS5L,GAAe4L,OACpDqC,GAAkB,SAAU/N,GAE5B,SAAS+N,IACL,OAAkB,OAAX/N,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAqF/D,OAvFAyX,EAAkB6N,EAAgB/N,GAIlC+N,EAAenlB,UAAUwR,MAAQ,SAAUxP,GACvC,OAAOA,EAAQA,EAAMwP,QAAUxP,GAEnCmjB,EAAenlB,UAAU8jB,OAAS,SAAU7gB,GAAK,OAAOA,GAAKA,EAAE6gB,UAC/DqB,EAAenlB,UAAU6kB,OAAS,SAAU7iB,EAAOiK,EAAQhB,GACvD,IAAImL,EAAInL,EAAQuG,MAAQ3R,KAAK2R,MAAMxP,QAAoB,IAAVA,EAAmBnC,KAAKyO,eAAiBtM,EAClFiB,EAAIpD,KAAKuD,UAAUgT,OAAG,EAAQnK,EAAQhB,GAE1C,OADApL,KAAK4kB,aAAaxhB,OAAG,EAAQgJ,EAAQhB,GAC9BhI,GAEXkiB,EAAenlB,UAAUqM,SAAW,SAAUrK,EAAOiK,EAAQhB,EAASiI,GAClE,IAEIsO,EAFAvgB,EAAMpB,KAAKgC,KAAM0K,EAAaN,EAAOM,WACrCrF,EAAOqF,EAAWtL,GAEtB,GAAIugB,EAAS3hB,KAAK6kB,aAAaxd,EAAMlF,EAAOiJ,GAAU,CAClD,IAAIma,EAAoBle,EAAK2M,mBAAmB2N,EAAQvW,GACxD,SAAIma,IACIlS,EACAA,EAAOxN,KAAK0f,GAGZA,EAAkB5Y,OAAOP,IAEzBpM,KAAKmjB,mBAKjB,IAAI3b,EAAOxH,KAAKuD,UAAUpB,EAAOkF,EAAM+E,EAAQhB,GAE/C,OADAsB,EAAWtL,GAAOoG,IACdxH,KAAK8kB,UAAUtd,EAAMH,KACrBrH,KAAK4kB,aAAapd,EAAMH,EAAM+E,EAAQhB,IAC/B,IAIfka,EAAenlB,UAAU0kB,aAAe,SAAUxd,EAAMG,EAAM4D,GAC1D,GAAI/D,GAAgB,MAARG,EAAc,CACtB,KAAIA,aAAgBxH,KAAKqO,MAKrB,OAAO7G,EAJP,GAAI4D,EAAQsG,MACR,OAAOlK,EAAKuU,kBAO5BuJ,EAAenlB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,EAAQhB,GAC7D,OAAY,MAAR5D,EACOA,EACPA,aAAgBxH,KAAKqO,OACjB7G,EAAK6J,SAAa7J,EAAK6J,QAAUC,gBAAckU,YAC/CxlB,KAAK2N,KAAK,QAAS,qEAAsEnG,EAAM4E,GAE5FhB,EAAQsG,MAAQlK,EAAKmK,QAAUnK,GAEnCxH,KAAKqO,KAAKhO,OAAOmH,EAAM4D,IAElCka,EAAenlB,UAAUkS,QAAU,SAAUjG,EAAQjK,GAC7CA,GACAnC,KAAK4kB,kBAAa,EAAQziB,EAAOiK,OAGzCkZ,EAAenlB,UAAUmgB,SAAW,SAAUlU,EAAQjK,GAClD,IAAI4J,EAAQ5J,GAASA,EAAMqgB,gBAC3B,GAAIzW,EACA,OAAOA,GAEfuZ,EAAenlB,UAAUE,OAAS,WAC9B,OAAOL,KAAKqO,KAAKhO,UAErBilB,EAAenlB,UAAUqK,WAAa,SAAUY,GAC5CA,EAAQ4Y,eAAe1d,QAAQtG,KAAKylB,gBAExCH,EAAenlB,UAAUslB,cAAgB,SAAUje,EAAMH,EAAM+E,EAAQhB,GAC/D/D,IACA2K,GAAK5F,EAAQ/E,GACb+D,EAAQ+G,OAAS9K,EAAKgL,WAEtB7K,IAASyb,GAAO7W,EAAQ5E,EAAMxH,KAAKgC,OACnChC,KAAK2N,KAAK,QAAS,oEAAqEnG,EAAM4E,IAG/FkZ,GACTvV,InB3FEvM,GAAS0c,EACT3R,GAA0B,WAC1B,SAASA,EAAuBnD,GAC5BpL,KAAKoL,SAAY0Y,YAAcC,cAAgBC,mBAC3C5Y,GACA5H,GAAOxD,KAAKoL,QAASA,GA8F7B,OA5FAmD,EAAuBpO,UAAUulB,MAAQ,SAAUA,EAAO3Z,GACtD,SAASuU,EAASlP,EAAOjP,EAAOH,GAC5B,IAAK0jB,EAAM9kB,KAAKwQ,EAAOjP,EAAOH,GAAO,CACjC,IAAImZ,EAAMpP,GAAS2Z,EAAM3Z,OAAS/J,EAAO,gBACzC,MAAsB,mBAARmZ,EAAqBA,EAAIva,KAAKwQ,EAAOpP,GAAQmZ,GAGnE,IAAI9T,EAAOrH,KAAKoL,QAAQkV,SACxB,OAAOtgB,KAAK2lB,UACRrF,SAAUjZ,WAAkB+J,EAAOjP,EAAOH,GACtC,OAAOqF,EAAK+J,EAAOjP,EAAOH,IAASse,EAASlP,EAAOjP,EAAOH,IACzDse,KAGblgB,OAAOwB,eAAe2M,EAAuBpO,UAAW,UACpD6E,IAAK,WACD,OAAOc,EAAoB,aAAc9F,OAE7CsiB,YAAY,EACZ9b,cAAc,IAElBpG,OAAOwB,eAAe2M,EAAuBpO,UAAW,MACpD6E,IAAK,WAAc,OAAOhF,KAAKgR,QAC/BsR,YAAY,EACZ9b,cAAc,IAElBpG,OAAOwB,eAAe2M,EAAuBpO,UAAW,cACpD6E,IAAK,WACD,OAAOhF,KAAK2lB,UAAWrB,YAAY,KAEvChC,YAAY,EACZ9b,cAAc,IAElB+H,EAAuBpO,UAAUmhB,SAAW,SAAUA,GAClD,OAAOthB,KAAK2lB,UAAWrE,SAAUA,KAErC/S,EAAuBpO,UAAU0Q,QAAU,SAAUL,GACjD,OAAOxQ,KAAK2lB,UAAWtV,UAAWG,KAEtCjC,EAAuBpO,UAAUwT,MAAQ,SAAU9Q,GAC/C,OAAO7C,KAAK2lB,UAAWhS,MAAO9Q,KAElC0L,EAAuBpO,UAAU8jB,OAAS,SAAUphB,GAChD,OAAO7C,KAAK2lB,UACR1B,OAAuB,mBAARphB,EAAqBA,EAAOA,EAAM,SAAUO,GAAK,OAAOA,GAAKA,EAAE6gB,UAkD1F,gBA/CI1V,EAAuBpO,UAAU6E,IAAM,SAAUnC,GAC7C,OAAO7C,KAAK2lB,UACR7B,SAAU9jB,KAAKoL,QAAQ0Y,SAASvG,OAAO1a,MAG/C0L,EAAuBpO,UAAUga,IAAM,SAAUtX,GAQ7C,OAAO7C,KAAK2lB,UACR5B,WAAY/jB,KAAKoL,QAAQ2Y,WAAWxG,OARxC,SAAuB/V,EAAMH,EAAM+E,EAAQhB,GACvC,GAAIpL,KAAK8kB,UAAUtd,EAAMH,GAAO,CAC5B,IAAIue,EAAU/iB,EAAIjC,KAAKwL,EAAQ5E,EAAMxH,KAAKgC,MAC1C,YAAmB,IAAZ4jB,EAAqBve,EAAOrH,KAAKwkB,QAAQoB,EAASve,EAAM+E,EAAQhB,GAE3E,OAAO/D,OAMfkH,EAAuBpO,UAAU+jB,aAAe,SAAU/b,GACtD,OAAOnI,KAAK2lB,UAAWzB,aAAc/b,KAEzCoG,EAAuBpO,UAAUgI,OAAS,SAAUkF,GAChD,IAAIwY,EAAW,IAAItH,GAASlR,GAK5B,OAAOrN,KAAK2lB,UACR3B,eAAgBhkB,KAAKoL,QAAQ4Y,eAAezG,OALhD,SAAkC/V,EAAMH,EAAM+E,GAC1C/E,GAAQA,EAAK6E,SAAW2Z,EAASvT,YAAYlG,EAAQ/E,GACrDG,GAAQA,EAAK0E,SAAW2Z,EAAS9T,UAAU3F,EAAQ5E,QAM3DpH,OAAOwB,eAAe2M,EAAuBpO,UAAW,OACpD6E,IAAK,WACD,OAAOhF,MAEXsiB,YAAY,EACZ9b,cAAc,IAElB+H,EAAuBpO,UAAUwlB,SAAW,SAAUva,GAClD,IAAI0a,EAAS,IAAIvX,EAAuBvO,KAAKoL,SAE7C,OADA5H,GAAOsiB,EAAO1a,QAASA,GAChB0a,GAEXvX,EAAuBpO,UAAUgC,MAAQ,SAAUiB,GAC/C,OAAOpD,KAAK2lB,UAAWxjB,MAAOiB,EAAGsL,kBAAkB,KAEhDH,KAYXnB,SAASjN,UAAUgC,MAAQ,SAAUiB,GACjC,OAAO,IAAImL,IAAyBF,KAAMrO,KAAMmC,MAAOiB,EAAGsL,kBAAkB,KAEhFtO,OAAOwB,eAAewL,SAASjN,UAAW,cACtC6E,IAAK,WAAc,OAAOhF,KAAK+lB,aAAe/lB,KAAK6O,IAAIyV,YACvDnK,IAAK,SAAU/W,GAAKpD,KAAK+lB,YAAc3iB,KAE3ChD,OAAOwB,eAAewL,SAASjN,UAAW,UACtC6E,IAAK,WAAc,OAAOhF,KAAK6O,IAAImC,UAEvC5Q,OAAOwB,eAAewL,SAASjN,UAAW,OACtC6E,IAAK,WACD,OAAOhF,KAAKgmB,MAAQ3X,GAAKrO,OAE7Bma,IAAK,SAAUhY,GAASnC,KAAKgmB,KAAO7jB,KC3HxC,IAAI8jB,GAAY,SAAU1O,GAEtB,SAAS0O,IACL,OAAkB,OAAX1O,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAgC/D,OAlCAyX,EAAkBwO,EAAU1O,GAI5B0O,EAAS9lB,UAAUE,OAAS,WACxB,OAAO,IAAImP,MAEfyW,EAAS9lB,UAAUqkB,QAAU,SAAUhd,EAAMzD,EAAGqI,GAC5C,GAAY,MAAR5E,GAAgBA,aAAgBgI,KAChC,OAAOhI,EACX,IAAI8H,EAAO,IAAIE,KAAKhI,GAAO0e,EAAY5W,EAAKG,UAI5C,OAHIyW,GAAcA,GACdlmB,KAAK2N,KAAK,OAAQ,6BAA8BnG,EAAM4E,GAEnDkD,GAEX2W,EAAS9lB,UAAUmgB,SAAW,SAAUlP,EAAOjP,EAAOH,GAClD,GAAa,MAATG,EAAe,CACf,IAAI+jB,EAAY/jB,EAAMsN,UACtB,GAAIyW,GAAcA,EACd,OAAOlkB,EAAO,qBAG1BikB,EAAS9lB,UAAU8jB,OAAS,SAAU9hB,GAAS,OAAOA,GAASA,EAAMgkB,eACrEF,EAAS9lB,UAAU2kB,UAAY,SAAU/gB,EAAGjE,GAAK,OAAQiE,GAAKA,EAAE0L,cAAgB3P,GAAKA,EAAE2P,YACvFwW,EAAS9lB,UAAU6kB,OAAS,SAAU7iB,EAAOiK,EAAQhB,GACjD,OAAOpL,KAAKuD,eAAoB,IAAVpB,EAAmBnC,KAAKyO,eAAiBtM,OAAO,EAAQiK,EAAQhB,IAE1F6a,EAAS9lB,UAAUqM,SAAW,SAAUrK,EAAOiK,EAAQhB,EAASiI,GAC5D,IAAIrR,EAAOhC,KAAKgC,KAAM0K,EAAaN,EAAOM,WAAYrF,EAAOqF,EAAW1K,GACxE,OAAOhC,KAAK8kB,UAAUzd,EAAMqF,EAAW1K,GAAQhC,KAAKuD,UAAUpB,EAAOkF,EAAM+E,EAAQhB,KAEvF6a,EAAS9lB,UAAUwR,MAAQ,SAAUxP,GAAS,OAAOA,GAAS,IAAIqN,KAAKrN,EAAMsN,YAC7EwW,EAAS9lB,UAAUkS,QAAU,aACtB4T,GACTlW,IACFP,KACKhB,WAAayX,GAClB,IAAIG,GAAgB,uBAChBC,GAAc,SAAU9O,GAExB,SAAS8O,IACL,OAAkB,OAAX9O,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAY/D,OAdAyX,EAAkB4O,EAAY9O,GAI9B8O,EAAWlmB,UAAUqkB,QAAU,SAAUhd,GACrC,GAAoB,iBAATA,EAAmB,CAC1B,IAAI8e,EAASF,GAAcG,KAAK/e,GAChC,GAAI8e,EACA,OAAO,IAAI9W,KAAKT,OAAOuX,EAAO,KAGtC,OAAOL,GAAS9lB,UAAUqkB,QAAQ3gB,MAAM7D,KAAMuB,YAElD8kB,EAAWlmB,UAAU8jB,OAAS,SAAU9hB,GAAS,OAAOA,GAAS,SAAWA,EAAMsN,UAAY,MACvF4W,GACTJ,IAEEO,GAAiB,SAAUjP,GAE3B,SAASiP,IACL,OAAkB,OAAXjP,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAG/D,OALAyX,EAAkB+O,EAAejP,GAIjCiP,EAAcrmB,UAAU8jB,OAAS,SAAU9hB,GAAS,OAAOA,GAASA,EAAMsN,WACnE+W,GACTP,IACF7lB,OACOqf,iBAAiBjQ,MACpBiX,WACIzhB,IAAK,WACD,OAAO,IAAIuJ,IACPF,KAAMmB,KACNhB,WAAY6X,OAIxBH,WACIlhB,IAAK,WACD,OAAO,IAAIuJ,IACPF,KAAMmB,KACNhB,WAAYgY,SAQvBnX,GAAa,0BACbA,GAAa,2BACbA,GAAa,4BACbA,GAAa,6BACbA,GAAa,mCACd4W,GAAS9lB,UAAUqkB,QAAU,SAAUriB,GACnC,OAAgB,MAATA,GAAiBA,aAAiBqN,KAAOrN,EAAQ,IAAIqN,KAIpE,SAAuBF,GACnB,IAAI4W,EAAWQ,EAAQC,EAAgB,EACvC,GAAKD,EAASE,GAAeL,KAAKjX,GAAQ,CACtC,IAAK,IAAWkH,EAAPzV,EAAI,EAAOyV,EAAIqQ,GAAY9lB,KAAOA,EACvC2lB,EAAOlQ,IAAMkQ,EAAOlQ,IAAM,EAE9BkQ,EAAO,KAAOA,EAAO,IAAM,GAAK,EAChCA,EAAO,IAAMA,EAAO,IAAM,EACR,MAAdA,EAAO,SAA4BI,IAAdJ,EAAO,KAC5BC,EAA6B,GAAbD,EAAO,IAAWA,EAAO,IACvB,MAAdA,EAAO,KACPC,EAAgB,EAAIA,IAG5BT,EACI1W,KAAKuX,IAAIL,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAKC,EAAeD,EAAO,GAAIA,EAAO,SAGtGR,EAAY1W,KAAKmE,MAAMrE,GAE3B,OAAO4W,EAxB8Dc,CAAc7kB,MAGvF,IAAI0kB,IAAe,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,IAAKD,GAAiB,qICnGxDK,GAAsB,SAAU1P,GAEhC,SAAS0P,IACL,OAAkB,OAAX1P,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAiB/D,OAnBAyX,EAAkBwP,EAAoB1P,GAItC0P,EAAmB9mB,UAAUE,OAAS,WAClC,OAAO,IAAIL,KAAKqO,MAEpB4Y,EAAmB9mB,UAAUqkB,QAAU,SAAUhd,GAC7C,OAAe,MAARA,GAAgBA,aAAgBxH,KAAKqO,KAAO7G,EAAO,IAAIxH,KAAKqO,KAAK7G,IAE5Eyf,EAAmB9mB,UAAU8jB,OAAS,SAAU9hB,GAC5C,OAAOA,GAASA,EAAM8hB,OAAS9hB,EAAM8hB,SAAW9hB,GAEpD8kB,EAAmB9mB,UAAUwR,MAAQ,SAAUxP,GAC3C,OAAO,IAAInC,KAAKqO,KAAKrO,KAAKikB,OAAO9hB,KAErC8kB,EAAmB9mB,UAAU2kB,UAAY,SAAU/gB,EAAGjE,GAClD,OAAOiE,IAAMjE,GAEVmnB,GACTlX,IACF3C,SAASjN,UAAUqO,WAAayY,GAChC,IAAIC,GAAiB,SAAU3P,GAE3B,SAAS2P,IACL,OAAkB,OAAX3P,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAoB/D,OAtBAyX,EAAkByP,EAAe3P,GAIjC2P,EAAc/mB,UAAUkS,QAAU,aAClC6U,EAAc/mB,UAAUE,OAAS,WAAc,OAAOL,KAAKqO,QAC3D6Y,EAAc/mB,UAAU8jB,OAAS,SAAU9hB,GAAS,OAAOA,GAC3D+kB,EAAc/mB,UAAUqkB,QAAU,SAAUhd,GAAQ,OAAe,MAARA,EAAeA,EAAOxH,KAAKqO,KAAK7G,IAC3F0f,EAAc/mB,UAAU2kB,UAAY,SAAU/gB,EAAGjE,GAAK,OAAOiE,IAAMjE,GACnEonB,EAAc/mB,UAAUwR,MAAQ,SAAUxP,GAAS,OAAOA,GAC1D+kB,EAAc/mB,UAAU6kB,OAAS,SAAU7iB,EAAOiK,EAAQhB,GACtD,OAAOpL,KAAKuD,eAAoB,IAAVpB,EAAmBnC,KAAKmC,MAAQA,OAAO,EAAQiK,EAAQhB,IAEjF8b,EAAc/mB,UAAUqM,SAAW,SAAUrK,EAAOiK,EAAQhB,EAASiI,GACjE,IAAIrR,EAAOhC,KAAKgC,KAAM0K,EAAaN,EAAOM,WAAYrF,EAAOqF,EAAW1K,GACxE,OAAOqF,KAAUqF,EAAW1K,GAAQhC,KAAKuD,UAAUpB,EAAOkF,EAAM+E,EAAQhB,KAE5E8b,EAAc/mB,UAAUqK,WAAa,WAC5BxK,KAAKoL,QAAQsD,mBACd1O,KAAKmC,MAAQnC,KAAKqO,SAGnB6Y,GACTnX,IACFd,QACQT,WAAaQ,OAAOR,WAAa0Y,GACzC,IAAIC,GAAe,SAAU5P,GAEzB,SAAS4P,IACL,OAAkB,OAAX5P,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAiB/D,OAnBAyX,EAAkB0P,EAAa5P,GAI/B4P,EAAYhnB,UAAUE,OAAS,WAC3B,OAAO,GAEX8mB,EAAYhnB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,GAClD,IAAIgb,EAAc,MAAR5f,EAAeA,EAAOxH,KAAKqO,KAAK7G,GAI1C,OAHI4f,GAAQA,GACRpnB,KAAK2N,KAAK,OAAQ,+BAAgCnG,EAAM4E,GAErDgb,GAEXD,EAAYhnB,UAAUmgB,SAAW,SAAUlP,EAAOjP,EAAOH,GACrD,GAAa,MAATG,IAAkBklB,SAASllB,GAC3B,OAAOH,EAAO,wBAGfmlB,GACTD,IACFnY,OACOP,WAAa2Y,GAIpBzX,GAAQlB,WAAa2Y,GACrBpY,OAAOuY,QAAU5X,GACK,oBAAXkJ,SACPA,OAAOlJ,QAAUX,OAAOuY,SAE5B,IAAIC,GAAa,SAAUhQ,GAEvB,SAASgQ,IACL,OAAkB,OAAXhQ,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAc/D,OAhBAyX,EAAkB8P,EAAWhQ,GAI7BgQ,EAAUpnB,UAAU8jB,OAAS,SAAU9hB,GAAS,OAAOA,GACvDolB,EAAUpnB,UAAUkS,QAAU,aAC9BkV,EAAUpnB,UAAUE,OAAS,WAAc,UAC3CknB,EAAUpnB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,GAChD,OAAY,MAAR5E,GAAgBlF,MAAM+T,QAAQ7O,GACvBA,GACXxH,KAAK2N,KAAK,OAAQ,wDAAyDnG,EAAM4E,QAGrFmb,EAAUpnB,UAAUwR,MAAQ,SAAUxP,GAClC,OAAOA,GAASA,EAAMyD,SAEnB2hB,GACTxX,IACFzN,MACMkM,WAAa+Y,GACnB,IAAIC,GAAc,SAAUjQ,GAExB,SAASiQ,IACL,OAAkB,OAAXjQ,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAS/D,OAXAyX,EAAkB+P,EAAYjQ,GAI9BiQ,EAAWrnB,UAAUE,OAAS,WAAc,UAC5CmnB,EAAWrnB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,GACjD,OAAY,MAAR5E,GAAgC,iBAATA,EAChBA,GACXxH,KAAK2N,KAAK,OAAQ,0DAA2DnG,EAAM4E,QAGhFob,GACTzX,IACF3P,OACOoO,WAAagZ,GAEpB,IAAIC,GAAgB,SAAUlQ,GAE1B,SAASkQ,IACL,OAAkB,OAAXlQ,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAY/D,OAdAyX,EAAkBgQ,EAAclQ,GAIhCkQ,EAAatnB,UAAU8jB,OAAS,SAAU9hB,KAC1CslB,EAAatnB,UAAUE,OAAS,WAAc,OAAOwP,IACrD4X,EAAatnB,UAAUkS,QAAU,aACjCoV,EAAatnB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,GACnD,OAAY,MAAR5E,GAAgC,mBAATA,EAChBA,GACXxH,KAAK2N,KAAK,OAAQ,6BAA8BnG,EAAM4E,GAC/CyD,KAEX4X,EAAatnB,UAAUwR,MAAQ,SAAUxP,GAAS,OAAOA,GAClDslB,GACT1X,IACF3C,SACSoB,WAAaiZ,GkBxItB,IAAI9f,GAAKmZ,EAAc/Y,GAAMgZ,EAAe/O,GAAOqF,GAAerF,KAAMiR,GAAS5L,GAAe4L,OAC5FyE,GAAiBpW,gBAAcC,OAASD,gBAAcqW,MACtDC,GAAc,SAAUrQ,GAExB,SAASqQ,IACL,OAAkB,OAAXrQ,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAsF/D,OAxFAyX,EAAkBmQ,EAAYrQ,GAI9BqQ,EAAWznB,UAAU6kB,OAAS,SAAU7iB,EAAOiK,EAAQhB,GACnD,IAAImL,EAAInL,EAAQuG,MAAQ3R,KAAK2R,MAAMxP,EAAOiK,QAAqB,IAAVjK,EAAmBnC,KAAKyO,eAAiBtM,EAC1FiB,EAAIpD,KAAKuD,UAAUgT,OAAG,EAAQnK,EAAQhB,GAE1C,OADApL,KAAK4kB,aAAaxhB,OAAG,EAAQgJ,EAAQhB,GAC9BhI,GAEXwkB,EAAWznB,UAAUqM,SAAW,SAAUrK,EAAOiK,EAAQhB,EAASiI,GAC9D,IAEIsO,EAFAvgB,EAAMpB,KAAKgC,KAAM0K,EAAaN,EAAOM,WACrCrF,EAAOqF,EAAWtL,GAEtB,GAAIugB,EAAS3hB,KAAK6kB,aAAaxd,EAAMlF,EAAOiJ,GAAU,CAClD,IAAIma,EAAoBle,EAAK2M,mBAAmB2N,EAAQvW,GACxD,SAAIma,IACIlS,EACAA,EAAOxN,KAAK0f,GAGZA,EAAkB5Y,OAAOP,IAEzBpM,KAAKmjB,mBAKjB,IAAI3b,EAAOxH,KAAKuD,UAAUpB,EAAOkF,EAAM+E,EAAQhB,GAE/C,OADAsB,EAAWtL,GAAOoG,IACdxH,KAAK8kB,UAAUtd,EAAMH,KACrBrH,KAAK4kB,aAAapd,EAAMH,EAAM+E,EAAQhB,IAC/B,IAIfwc,EAAWznB,UAAUwR,MAAQ,SAAUxP,EAAOiK,GAC1C,IAAKjK,GAASA,EAAMiI,SAAWgC,EAC3B,OAAOjK,EACX,IAAIwP,EAAQxP,EAAMwP,QAElB,OADAsR,GAAO7W,EAAQuF,EAAO3R,KAAKgC,MACpB2P,GAEXiW,EAAWznB,UAAU8jB,OAAS,aAC9B2D,EAAWznB,UAAU0kB,aAAe,SAAUxd,EAAMG,EAAM4D,GACtD,GAAI/D,GAAgB,MAARG,KAAkBA,aAAgBxH,KAAKqO,MAC/C,OAAO7G,GAGfogB,EAAWznB,UAAUqkB,QAAU,SAAUhd,EAAMH,EAAM+E,EAAQhB,GACzD,GAAY,MAAR5D,GAAgBA,aAAgBxH,KAAKqO,KACrC,OAAO7G,EACX,IAAIqgB,EAAiB,IAAI7nB,KAAKqO,KAAK7G,EAAM4D,EAASsc,IAElD,OADAzE,GAAO7W,EAAQyb,EAAgB7nB,KAAKgC,MAC7B6lB,GAEXD,EAAWznB,UAAUmgB,SAAW,SAAUlP,EAAOjP,EAAOH,KACxD4lB,EAAWznB,UAAUE,OAAS,WAC1B,OAAO,MAEXunB,EAAWznB,UAAUslB,cAAgB,SAAUje,EAAMH,EAAM+E,EAAQhB,GAC3D/D,IACIA,EAAK+C,SAAWgC,GAChB4F,GAAK5F,EAAQ/E,GACb+D,EAAQ+G,OAAS9K,EAAKgL,WAGtBtK,GAAIV,EAAMA,EAAKmK,iBAAkBxR,KAAKqQ,UAAWjE,IAGrD5E,GACIA,EAAK4C,SAAWgC,GAChBzE,GAAGH,EAAMA,EAAKgK,iBAAkBxR,KAAKqQ,UAAWjE,IAI5Dwb,EAAWznB,UAAUkS,QAAU,SAAUjG,EAAQjK,GACzCA,GACAnC,KAAK4kB,kBAAa,EAAQziB,EAAOiK,OAGzCwb,EAAWznB,UAAUqK,WAAa,SAAUY,GACxC,IAAImO,EAAYvZ,KAChBA,KAAKqQ,UAAYrQ,KAAKmjB,iBAAmB,SAAUjR,EAAO9G,EAAS2X,GAC/D/iB,OAAS+iB,GAAa/iB,KAAKojB,qBAAqB7J,EAAUvX,KAAMoJ,IAM5E,aAJQA,EAAQ4Y,eAAe1d,QAAQtG,KAAKylB,gBAEjCmC,GACT7X,IC9FS+X,IACPC,KAAM,SAAU3c,GACZ,IAAIyM,EAAQ7X,UACI,IAAZoL,IAAsBA,MAC1B,IAAIkW,EAAWthB,KAAKoiB,cAAe4F,EAAOhoB,KAAKikB,SAC/C,OAAO9Y,EAAQnL,KAAMA,KAAKioB,QACtB3G,EAASjhB,OAAO2nB,EAAM5c,EAASpL,MAC/BshB,EAASK,OAAO3hB,KAAK6S,GAAImV,EAAM5c,EAASpL,MAAOoL,EAAS,SAAUuW,GAClE9J,EAAMsC,IAAIwH,EAAQuG,IAAmBvU,OAAO,GAAQvI,OAG5D+W,MAAO,SAAU/W,GACb,IAAIyM,EAAQ7X,KAEZ,YADgB,IAAZoL,IAAsBA,MACnBD,EAAQnL,KAAMA,KAAKoiB,cAAc+F,KAAKnoB,KAAK6S,GAAIzH,EAASpL,MAAOoL,EAAS,SAAU4c,GAAQ,OAAOnQ,EAAMsC,IAAI6N,EAAME,IAAmBvU,OAAO,GAAQvI,OAE9Jgd,QAAS,SAAUhd,GACf,IAAIyM,EAAQ7X,KAEZ,YADgB,IAAZoL,IAAsBA,MACnBD,EAAQnL,KAAMA,KAAKoiB,cAAcgG,QAAQpoB,KAAK6S,GAAIzH,EAASpL,MAAOoL,EAAS,WAC9E,IAAIjB,EAAa0N,EAAM1N,WACnBA,EACAA,EAAWke,OAAOxQ,EAAOzM,GAGzByM,EAAMxF,cCtBlB7O,GAAS0c,EAAcxd,GAAU4lB,EAAexN,GAAMqF,GACtDoI,GAAc,EACdrD,GAAU,SAAU3N,GAEpB,SAAS2N,EAAO7B,EAAU7P,GACtB,IAAIqE,EAAQN,EAAO3W,KAAKZ,KAAMuoB,OAAkBvoB,KAChD6X,EAAMnL,cACN,IAAItB,EAAUoI,MAAiB9F,GAAUtC,EAAQuI,MAAQkE,EAAMlE,MAAM0P,EAAUjY,GAAWiY,OAO1F,OANIvI,GAAIO,MAAQ,GAwRxB,SACmBjP,EAAQsB,GACvB,GAAID,EAAiBrB,EAAQsB,GAAS,CAClC,IAAInB,EAAcH,EAAOG,YACrB+W,OAAU,EACd,IAAK,IAAIjH,KAAU3O,EACVnB,EAAY8P,KACbiH,IAAYA,MACZA,EAAQzd,KAAK,IAAMwW,EAAS,MAGhCiH,GACAlX,EAAOuB,KAAK,OAAQ,wBAA0B2V,EAAQ/V,KAAK,MAAQ,iBAAmBG,OAAQA,KAnS9F8a,CAAU3Q,EAAOnK,GACrBmK,EAAMhL,oBAAsBgL,EAAMnL,WAAa,IAAImL,EAAMrK,WAAWqK,EAAOnK,EAAQtC,GACnFyM,EAAMrN,WAAW6Y,EAAU7P,GACvBqE,EAAMzH,cACNyH,EAAMzH,aAAa2B,UAAU8F,EAAOA,GACjCA,EA0PX,OArQAJ,EAAkByN,EAAQ3N,GAaf2N,EACXA,EAAOtI,SAAW,SAAUT,EAAYvX,KACxCsgB,EAAOrjB,SAAW,SAAUsL,GACxB,OAAOnN,KAAK8c,QAASpQ,WAAYS,KAErC+X,EAAO/kB,UAAU4nB,KAAO,SAAU3c,GAAW,MAAM,IAAIF,MAAM,yBAC7Dga,EAAO/kB,UAAUioB,QAAU,SAAUhd,GAAW,MAAM,IAAIF,MAAM,yBAChEga,EAAO/kB,UAAUsoB,mBAAqB,WAAc,OAAO,IAAIzoB,KAAK8M,eAAe9M,KAAK6M,sBACxFzM,OAAOwB,eAAesjB,EAAO/kB,UAAW,mBACpC6E,IAAK,WAAc,OAAOhF,KAAK0M,YAC/B4V,YAAY,EACZ9b,cAAc,IAElBpG,OAAOwB,eAAesjB,EAAO/kB,UAAW,WACpC6E,IAAK,WACD,IAAI4gB,EAAU5lB,KAAK+M,mBACnB,IAAK6Y,EAAS,CACV,IAAIve,EAAOrH,KAAK6M,oBAChB+Y,KACS5lB,KAAuBuM,YAChC,IAAK,IADwCG,EAApC1M,KAAoD0M,WACpDpE,EAAK,EAAGpC,EAAKlG,KAAK0oB,iBAAkBpgB,EAAKpC,EAAGlF,OAAQsH,IAAM,CAC/D,IAAIgF,EAAOpH,EAAGoC,GACVlH,EAAMkM,EAAKtL,KAAMG,EAAQuK,EAAWtL,GACpCkM,EAAKwX,UAAU3iB,EAAOkF,EAAKjG,MAC3BwkB,EAAQxkB,GAAOe,GAGvBnC,KAAK+M,mBAAqB6Y,EAE9B,OAAOA,GAEXtD,YAAY,EACZ9b,cAAc,IAElB0e,EAAO/kB,UAAUwoB,kBAAoB,SAAUC,GAC3C,IAAKA,EACD,QAAO5oB,KAAKiU,cAAezQ,MAAWxD,KAAK4lB,SAC/C,IAAI3D,EAAK2D,GAAU,EAAOiD,EAAM7oB,KAAKihB,aAAejhB,KAAK6M,oBAAsB7M,KAAK0M,WAAYyD,EAAYnQ,KAAKuM,YACjH,IAAK,IAAIe,KAAQsb,EACRzY,EAAU7C,GAAMwX,UAAU+D,EAAIvb,GAAQ2U,EAAM2G,EAAKtb,OAErDsY,IAAYA,OAAetY,GAAQ2U,GAExC,OAAO2D,GAEXV,EAAO/kB,UAAU8T,WAAa,SAAU7S,GACpC,IAAIyL,EAAsB7M,KAAK6M,oBAC/B,QAAKA,IAEEzL,EACHpB,KAAKuM,YAAYnL,GAAK0jB,UAAU9kB,KAAK0M,WAAWtL,GAAMyL,EAAoBzL,KACzEsB,GAAQ1C,KAAK4lB,WAEtBV,EAAO/kB,UAAU6S,SAAW,SAAU5R,GAClC,GAAIA,EAAK,CACL,IAAIyL,EAAsB7M,KAAK6M,oBAC/B,GAAIA,EACA,OAAOA,EAAoBzL,GAEnC,OAAO,MAEX8jB,EAAO/kB,UAAU8nB,MAAQ,WACrB,OAAkB,MAAXjoB,KAAK6S,IAEhBqS,EAAO/kB,UAAU0O,IAAM,SAAUzN,GAC7B,YAAoB,GAAbpB,KAAKoB,IAEhB8jB,EAAO/kB,UAAUgS,MAAQ,SAAU/Q,EAAKgK,GACpC,IAAIjJ,EAAQnC,KAAKoB,GAEjB,OADApB,KAAKma,KAAKlU,KAASA,EAAG7E,QAAO,EAAQ6E,GAAKiiB,IAAmB/V,OAAO,GAAQ/G,IACrEjJ,EACP,IAAI8D,GAERif,EAAO/kB,UAAU2oB,MAAQ,SAAU1d,GAC/B,IAAIyM,EAAQ7X,KACR+oB,EAAU3d,GAAWA,EAAQ2d,QAIjC,OAHA/oB,KAAK+T,YAAY,WACb8D,EAAMmR,YAAYnR,EAAMnL,WAAY,SAAUvK,EAAOf,GAAO,OAAOyW,EAAMzW,GAAO2nB,EAAU,UAAO,KAClG3d,GACIpL,MAEXklB,EAAO/kB,UAAU8J,SAAW,WACxB,IAAIgI,EAAQjS,KAAKoK,OACjB,OAAOpK,KAAKsK,UAAY2H,EAAQA,GAASA,EAAM7H,QAEnDhK,OAAOwB,eAAesjB,EAAO/kB,UAAW,MACpC6E,IAAK,WAAc,OAAOhF,KAAK0M,WAAW1M,KAAKiT,cAC/CkH,IAAK,SAAU/W,GAAK+I,EAAanM,KAAMA,KAAKiT,YAAa7P,IACzDkf,YAAY,EACZ9b,cAAc,IAElB0e,EAAO/kB,UAAU6oB,YAAc,SAAU7b,EAAOuJ,GAC5C,IACI4M,EADA/W,EAAcvM,KAAKuM,YAEvB,IAAK,IAAI2P,KAAU/O,EAAO,CACtB,IAAImB,EAAO/B,EAAY2P,GACnB5N,EACAoI,EAASvJ,EAAM+O,GAASA,EAAQ5N,IAGhCgV,IAAYA,MACZA,EAAQzd,KAAK,IAAMqW,EAAS,MAGhCoH,GACAtjB,KAAK2N,KAAK,OAAQ,cAAgB2V,EAAQ/V,KAAK,MAAQ,oBACnDb,WAAYS,KAIxB+X,EAAO/kB,UAAUogB,KAAO,SAAU7J,EAAUvP,GACxC,IAAItE,OAAkB,IAAZsE,EAAqB,SAAUoP,EAAGC,GAAK,OAAOE,EAAS9V,KAAKuG,EAASoP,EAAGC,IAAQE,EAAUhK,EAAa1M,KAAK0M,WACtH,IAAK,IAAItL,KAAOpB,KAAK0M,WAAY,CAC7B,IAAIvK,EAAQuK,EAAWtL,QACT,IAAVe,GACAU,EAAIV,EAAOf,KAGvB8jB,EAAO/kB,UAAUkE,KAAO,WACpB,IAAIA,KAEJ,OADArE,KAAKugB,KAAK,SAAUpe,EAAOf,GAAO,YAAiB,IAAVe,GAAoBkC,EAAKwB,KAAKzE,KAChEiD,GAEX6gB,EAAO/kB,UAAUuN,OAAS,WACtB,OAAO1N,KAAKqN,IAAI,SAAUlL,GAAS,OAAOA,KAE9C+iB,EAAO/kB,UAAU8oB,QAAU,WAAc,UACzC/D,EAAO/kB,UAAU+oB,OAAS,SAAUpH,GAAQ,OAAOA,GACnDoD,EAAO/kB,UAAU0B,SAAW,SAAU6L,QACnB,IAAXA,IAAqBA,MAEzB,IAAK,IADD7L,KACKyG,EAAK,EAAG6gB,EADqBnpB,KAAK0oB,iBACapgB,EAAK6gB,EAAmBnoB,OAAQsH,IAAM,CAC1F,IAAIgF,EAAO6b,EAAmB7gB,GAC1BlH,EAAMkM,EAAKtL,KAAMG,EAAQuL,EAAOtM,GACpCS,EAAST,QAAiB,IAAVe,EAAmBmL,EAAKmB,eAAiBtM,EAE7D,OAAON,GAEXqjB,EAAO/kB,UAAUqK,WAAa,SAAUkD,EAAQtC,KAChD8Z,EAAO/kB,UAAUwR,MAAQ,SAAUvG,QACf,IAAZA,IAAsBA,MAC1B,IAAIge,EAAO,IAAIppB,KAAKC,YAAYD,KAAK0M,YAAciF,OAAO,IAG1D,OAFIvG,EAAQie,WACRD,EAAKpH,cAAgBhiB,KAAKgK,YACvBof,GAEXlE,EAAO/kB,UAAUmpB,UAAY,WAAc,OAAOtpB,KAAK2R,SAEvDuT,EAAO/kB,UAAUkgB,gBAAkB,SAAUkJ,GACzC,IAAI1R,EAAQ7X,KACRgB,EAAS,EAQb,OAPAhB,KAAKgpB,YAAYhpB,KAAK0M,WAAY,SAAUvK,EAAOH,EAAMuX,GACrD,IAAIxN,EAAQwN,EAAU+G,SAASzI,EAAO1V,EAAOH,GACzC+J,IACAwd,EAAOvnB,GAAQ+J,EACf/K,OAGDA,GAEXkkB,EAAO/kB,UAAU6E,IAAM,SAAU5D,GAC7B,OAAOpB,KAAKoB,IAEhB8jB,EAAO/kB,UAAU8jB,OAAS,WACtB,IAAIpM,EAAQ7X,KACRgoB,KASJ,OARAhoB,KAAKgpB,YAAYhpB,KAAK0M,WAAY,SAAUvK,EAAOf,EAAK6E,GACpD,IAAIge,EAAShe,EAAGge,OAChB,QAAc,IAAV9hB,EAAkB,CAClB,IAAIqnB,EAASvF,EAAOrjB,KAAKiX,EAAO1V,EAAOf,QACxB,IAAXooB,IACAxB,EAAK5mB,GAAOooB,MAGjBxB,GAEX9C,EAAO/kB,UAAUwT,MAAQ,SAAUmO,EAAM1W,GACrC,OAAOpL,KAAKkpB,OAAOpH,IAEvBoD,EAAO/kB,UAAUspB,QAAU,SAAUznB,EAAMG,EAAOiJ,GAC9C,IAAIyM,EAAQ7X,KA6BZ,OA5BAA,KAAK+T,YAAY,WAGb,IAAK,IAFDnK,EAAO5H,EAAKwG,MAAM,KAAMkhB,EAAI9f,EAAK5I,OAAS,EAAGsM,EAAO1D,EAAK8f,GACzDtY,EAAQyG,EACH9W,EAAI,EAAGA,EAAI2oB,EAAG3oB,IAAK,CACxB,IAAIK,EAAMwI,EAAK7I,GACXyG,EAAO4J,EAAMpM,IAAMoM,EAAMpM,IAAI5D,GAAOgQ,EAAMhQ,GAC9C,IAAKoG,EAAM,CACP,IAAI2I,EAAYiB,EAAM7E,YACtB,IAAI4D,EAQA,OAPA,IAAIwZ,EAAWxZ,EAAU/O,GAAKf,SAC1B+K,GAAWA,EAAQ2d,SAAWY,EAASpd,aACvCod,EAASb,MAAM1d,GAEnBgG,EAAMhQ,GAAOoG,EAAOmiB,EAK5BvY,EAAQ5J,EAER4J,EAAM+I,IACN/I,EAAM+I,KAAKlU,KAASA,EAAGqH,GAAQnL,EAAO8D,GAAKmF,GAG3CgG,EAAM9D,GAAQnL,EAElB,IAAI8D,IAEDjG,MAEXI,OAAOwB,eAAesjB,EAAO/kB,UAAW,cACpC6E,IAAK,WACD,OAAOhF,KAAKsK,UAAY,KAAOtK,KAAKoK,QAExCkY,YAAY,EACZ9b,cAAc,IAElB0e,EAAO/kB,UAAUkS,QAAU,WACvB,IAAIwF,EAAQ7X,KACRA,KAAKggB,YAEThgB,KAAKgpB,YAAYhpB,KAAK0M,WAAY,SAAUvK,EAAOf,EAAKmY,GACpDA,EAAUlH,QAAQwF,EAAO1V,KAE7BoV,EAAOpX,UAAUkS,QAAQzR,KAAKZ,QAElCklB,EAAO/kB,UAAUwN,KAAO,SAAU0N,EAAO4J,EAAM7J,GAC3C+E,GAAU9E,EAAO,YAAc4J,EAAMiD,IAAmBhD,OAAUllB,KAAM4pB,yBAA0B5pB,KAAKuM,aAAe6O,KAE1H8J,EAAO/kB,UAAU0iB,aAAe,WAC5B,OAAOtL,EAAOpX,UAAU0iB,aAAajiB,KAAKZ,OAAS,UAEvDklB,EAAO/kB,UAAU6T,mBAAqB,SAAUtG,EAAQtC,KACxD8Z,EAAoBxN,GAChB5S,GACIsc,UAAW,IACX5P,iBAAkB,SAClByB,YAAa,OAEjB3N,GACIzD,SAAUic,GAAWpM,MACrBhF,WAAYoR,GAAWpM,MACvBvH,WAAY2T,GAAWpM,MACvBmY,WAAY/L,GAAW3b,MACvB8Q,YAAa6K,GAAWC,cAE7BmH,IAGL/V,IAGF3L,GAAO0hB,GAAO/kB,UAAW+iB,GAAmB4E,IAC5C,IAAIgC,GAAwB,WAIxB,OAHA,SAA8B1d,EAAQhJ,EAAGgI,GACrCpL,KAAK6S,GAAKzP,EAAEyP,OAIpBqS,GAAO/kB,UAAUqN,WAAasc,GAC9B,IAAIC,GAA4B,WAI5B,OAHA,SAAkC3mB,GAC9BpD,KAAK6S,GAAKzP,EAAEyP,OAIpBqS,GAAO/kB,UAAU2M,eAAiBid,GAClC,IAAIC,GAAcja,GAAQ1P,QAAS8B,WAAO,GAAU,MACpD+iB,GAAO/kB,UAAUoM,aAAgBsG,GAAImX,IACrC9E,GAAO/kB,UAAUuoB,kBAAoBsB,IACrC9E,GAAO1W,WAAa8W,GlB5RpB,IAAI9hB,GAAS0c,EAAcre,GAAWooB,EACtC/E,GAAO/f,SAAW,SAAUP,GACxBuK,GAAchK,SAASvE,KAAKZ,KAAM4E,GAClC,IAAInC,EAAQzC,KACRkqB,EAAqB,SAAU3S,GAE/B,SAAS2S,IACL,OAAkB,OAAX3S,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAM/D,OARAyX,EAAkByS,EAAmB3S,GAIrC2S,EAAkB9Y,MAAQ3O,EAC1BynB,EAAoBxS,GAChBhT,GACDwlB,IAELtlB,EAAUilB,YACZ7pB,KAAKkqB,kBAAoBA,EACrBznB,EAAMonB,aAAejlB,EAAUilB,aAC/B7pB,KAAK6pB,WAAaK,GAEtBla,GAAqBhQ,KAAM4nB,KAE/B1C,GAAOtI,SAAW,SAAUT,EAAYvX,GACpC,IAAIoZ,EAAYpZ,EAAUzE,UACtB8F,EDlBO,SAAUkkB,EAAsBC,GAC3C,IAAIC,EAAeC,KAAgBH,EAAsBra,IAAkBya,EAAgBC,KAAeH,EAAcD,GACpHK,EAAoBxd,EAAkBsd,GAC1C,OAAOrC,MAAqBuC,GAAqBle,YAAa,IAAIke,EAAkB3d,eAAeyd,GAAgB7B,iBAAkBtoB,OAAOiE,KAAKkmB,GAAeld,IAAI,SAAUjM,GAAO,OAAOmpB,EAAcnpB,KAAUme,WAAY+K,KAAgBD,EAAc,SAAUjnB,GAAK,OAAOA,EAAE2hB,6BAAgCkE,QAW1T,SAAsBvc,GAClB,OAAO,IAAIU,SAAS,4GAA8GhN,OAAOiE,KAAKqI,GAAYW,IAAI,SAAUjM,GACpK,GAAIsL,EAAWtL,GAAK6iB,OAChB,MAAO,QAAU7iB,EAAM,QAAUA,EAAM,yBAA2BA,EAAM,MAAQA,EAAM,SAE3FmM,KAAK,MAAQ,kCAhB+Smd,CAAaH,IAKhV,SAAoB7d,GAChB,IAAIie,EAAiBvqB,OAAOiE,KAAKqI,GAAYke,OAAO,SAAU5oB,GAAQ,OAAO0K,EAAW1K,GAAM2R,QAC9F,OAAOgX,EAAe3pB,QAClBkoB,OAAQ,IAAI9b,SAAS,OAAQ,+DAAiEud,EAAetd,IAAI,SAAUrL,GAAQ,MAAO,0CAA4CA,EAAO,yBAA2BA,EAAO,aAAeA,EAAO,2BAA6BA,EAAO,MAASA,EAAO,yBAA4BuL,KAAK,IAAM,8CARUsd,CAAWN,GAAgBra,GAAiBma,IAAiBhgB,WAAYigB,KAAgBC,EAAe,SAAUO,GAAW,OAAOA,EAAQ1f,QAAQkW,aCezeyJ,CAAQ/qB,KAAK0M,WAa1B,SAAuBzG,GACnB,IAAIpE,EAAWoE,EAAGpE,SAAU6K,EAAazG,EAAGyG,WAAYuG,EAAchN,EAAGgN,YACrEkJ,EAAazP,GAAc7K,MAI/B,OAHIoR,GAAiBA,KAAekJ,IAChCA,EAAWlJ,QAAe,GAEvBkJ,EAnB4B6O,CAAc7O,GAAa6B,EAAUzR,aAAcgT,EAAatZ,EAAGsZ,WAAYnP,EAAenK,EAAGmK,aAAc6a,EAAevO,EAAezW,GAAK,aAAc,iBACnMzC,GAAOxD,KAAKG,UAAW8qB,GACvB9O,EAAWoD,WAAa1d,GAASsa,EAAWoD,eAAkBA,GAC9DpD,EAAW/L,aAAeA,EAC1BjB,GAAcyN,SAAShc,KAAKZ,KAAMmc,EAAYvX,GAC9C5E,KAAKkqB,kBAAkBplB,OAAOqX,EAAWhS,gBACzCnK,KAAK6pB,WAAa1N,EAAW0N,WAC7B7pB,KAAK6pB,WAAW1pB,UAAUiR,MAAQpR,KAC9Bmc,EAAWmF,WACXthB,KAAK6pB,WAAW1pB,UAAUohB,UAAYpF,EAAWmF,WAEzD4D,GAAO1W,WAAa8W,GACpBtV,GAAqBkV,GAAQ0C,ICzC7B,IAAmC7gB,GAAWmkB,EAAoBpkB,GAAW+Z,EAAoBlZ,GAAKmZ,EAAc/Y,GAAMgZ,EAAepU,GAAS0K,GAAe1K,OAAkDiF,GAAUyF,GAAe4L,OAAQ7Q,GAAQiF,GAAerF,KA2EvQyC,GAAyB,WACzB,SAASA,EAAsBiJ,EAAQrR,EAAQiH,EAAOkC,EAASnC,EAAQgC,GACnErV,KAAK0d,OAASA,EACd1d,KAAKqM,OAASA,EACdrM,KAAKsT,MAAQA,EACbtT,KAAKwV,QAAUA,EACfxV,KAAKqT,OAASA,EACdrT,KAAKqV,OAASA,EAkClB,OAhCAZ,EAAsBtU,UAAUwM,OAAS,SAAUoW,GAE/C,IAAK,IADU1P,EAANrT,KAAkBqT,OAAQqK,EAA1B1d,KAAsC0d,OAAQwD,EAAWxD,EAAOwD,SAChE5Y,EAAK,EAAGmb,EAAWpQ,EAAQ/K,EAAKmb,EAASziB,OAAQsH,IAAM,EACxDyL,EAAc0P,EAASnb,IACfqE,OAAO+Q,GAEnBA,EAAO7L,mBACPqB,GAAoBwK,GAExB,IAAK,IAAIxX,EAAK,EAAGwd,EAAWrQ,EAAQnN,EAAKwd,EAAS1iB,OAAQkF,IAAM,CAC5D,IAAI6N,EAAc2P,EAASxd,GAC3Ba,GAAS2W,EAAQ,SAAU3J,EAAY2J,OAAQwD,GAGnD,IAAK,IADU5N,EAANtT,KAAiBsT,MAAOkC,EAAxBxV,KAAqCwV,QACrC2V,EAAK,EAAGC,EAAU9X,EAAO6X,EAAKC,EAAQpqB,OAAQmqB,IAAM,CACrD/e,EAASgf,EAAQD,GACrBrkB,GAASsF,EAAQ,MAAOA,EAAQsR,EAAQwD,GACxCpa,GAAS4W,EAAQ,MAAOtR,EAAQsR,EAAQwD,GAE5C,IAAK,IAAImK,EAAK,EAAGC,EAAY9V,EAAS6V,EAAKC,EAAUtqB,OAAQqqB,IAAM,CAC/D,IAAIjf,EAASkf,EAAUD,GACvBvkB,GAASsF,EAAQ,SAAUA,EAAQsR,EAAQwD,GAC3Cpa,GAAS4W,EAAQ,SAAUtR,EAAQsR,EAAQwD,GAE3ClhB,KAAKqV,QACLtO,GAAS2W,EAAQ,OAAQA,EAAQwD,IAEjC5N,EAAMtS,QAAUwU,EAAQxU,SACxB+F,GAAS2W,EAAQ,SAAUA,EAAQwD,GAEvClhB,KAAKqM,QAAUM,GAAO+Q,EAAQqF,IAE3BtO,KCpHPnI,GAAQ+K,GAAe/K,MAAOK,GAAS0K,GAAe1K,OAAQF,GAAc4K,GAAe5K,YCA3FH,GAAQ+K,GAAe/K,MAAOK,GAAS0K,GAAe1K,OAAQF,GAAc4K,GAAe5K,YAC3FsI,IAAkBJ,QAAQ,GCA1B5N,GAAWmkB,EAAoBpkB,GAAW+Z,EAAoBpU,GAAc4K,GAAe5K,YAAaH,GAAQ+K,GAAe/K,MAAOK,GAAS0K,GAAe1K,OCM9J5F,GAAWmkB,EAA4D5e,GAAQ+K,GAAe/K,MAAOK,GAAS0K,GAAe1K,OAAQF,GAAc4K,GAAe5K,YAAiDjJ,GAAS0c,EAAcre,GAAWooB,EACrPsB,GAAS,EACT3lB,GAAQtD,MAAMnC,UAAUyF,MACxB4lB,GAAsB,SAAUjU,GAEhC,SAASiU,IACL,OAAkB,OAAXjU,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAG/D,OALAyX,EAAkB+T,EAAoBjU,GAItCiU,EAAmB/c,gBACZ+c,GACT5D,IACEiC,GAAc,SAAUtS,GAExB,SAASsS,EAAW9S,EAAS3L,EAASgE,QAClB,IAAZhE,IAAsBA,MAC1B,IAAIyM,EAAQN,EAAO3W,KAAKZ,KAAMurB,OAAavrB,KAe3C,GAdA6X,EAAMnF,UACNmF,EAAMnE,SACNmE,EAAM4T,WAAa5T,EAAM4T,gBACE,IAAvBrgB,EAAQqgB,aACR5T,EAAM4T,WAAargB,EAAQqgB,WAC3BrgB,EAAQqgB,gBAAa,GAEzB5T,EAAMzG,MAAQyG,EAAMzG,MAChBhG,EAAQgG,QACRyG,EAAMzG,MAAQhG,EAAQgG,MACtBhG,EAAQgG,WAAQ,GAEpByG,EAAM5E,YAAc4E,EAAMzG,MAAMjR,UAAU8S,YAC1C4E,EAAMxG,QAAUjC,GAAU,EACtB2H,EAAS,CAETrC,GAAoBmD,EADL3B,GAAW2B,EAAOd,EAAS3L,GACLA,GAAS,GAKlD,OAHAyM,EAAMrN,WAAW3G,MAAMgU,EAAOtW,WAC1BsW,EAAMzH,cACNyH,EAAMzH,aAAa2B,UAAU8F,EAAOA,GACjCA,EA8WX,OAvYAJ,EAAkBoS,EAAYtS,GA2BfsS,EACfA,EAAW1pB,UAAUurB,aAAe,SAAUhZ,EAAQtH,GAClD,IAA6DugB,EAAS,IAAIC,EAA3D5rB,KAAKC,YAAY4rB,SAAS7rB,MAAMoL,QAAQiD,MAA4BqE,EAAQtH,GAE3F,OADAugB,EAAO/gB,QAAQ5K,MACR2rB,GAEX9B,EAAW1kB,SAAW,SAAUP,GAG5B,SAASknB,EAAe/nB,EAAGjE,EAAGyR,GAC1BlM,EAAKzE,KAAKZ,KAAM+D,EAAGjE,EAAGwR,gBAAcqW,OAASpW,EAASD,gBAAcC,OAAS,IAHjF,IAAIlM,EAAOrF,KACXA,KAAK+rB,UAAY,KAIjB9mB,GAAQO,OAAON,SAAS4mB,GACxBA,EAAe3rB,UAAYH,KAAKG,UAChC2rB,EAAetd,WAAagd,GAC5BxrB,KAAKgsB,KAAOhsB,KAAKisB,OAASH,EAC1B3c,GAAchK,SAASvE,KAAKZ,KAAM4E,GAClCoL,GAAqBhQ,KAAM4nB,KAE/BiC,EAAWjN,SAAW,SAAUT,EAAYvX,GACxC,GAAIuX,EAAW+P,WAAY,CACvB,IAAI1M,EAAY,IAAIjB,GAAS3Z,EAAUzE,UAAU2R,aACjD0N,EAAUhB,aAAarC,EAAW+P,YAClClsB,KAAKG,UAAU2R,YAAc0N,OAEH,IAA1BrD,EAAWsP,aACXzrB,KAAKG,UAAUsrB,WAAatP,EAAWsP,YAC3Ctc,GAAcyN,SAAShc,KAAKZ,KAAMmc,IAEtC/b,OAAOwB,eAAeioB,EAAW1pB,UAAW,mBACxC6E,IAAK,WAAc,OAAOhF,KAAK0S,QAC/B4P,YAAY,EACZ9b,cAAc,IAElBpG,OAAOwB,eAAeioB,EAAW1pB,UAAW,cACxC6E,IAAK,WAAc,OAAOhF,KAAKwS,aAC/B2H,IAAK,SAAU/W,GACX,IAAIyU,EAAQ7X,KACZ,cACeoD,GACX,IAAK,SACDpD,KAAKwS,YAAc,SAAUzO,EAAGjE,GAC5B,IAAIqsB,EAAKpoB,EAAEX,GAAIgpB,EAAKtsB,EAAEsD,GACtB,OAAI+oB,IAAOC,EACA,EACJD,EAAKC,GAAM,EAAI,GAE1B,MACJ,IAAK,WACgB,IAAbhpB,EAAEpC,OACFhB,KAAKwS,YAAc,SAAUzO,EAAGjE,GAC5B,IAAIqsB,EAAK/oB,EAAExC,KAAKiX,EAAO9T,GAAIqoB,EAAKhpB,EAAExC,KAAKiX,EAAO/X,GAC9C,OAAIqsB,IAAOC,EACA,EACJD,EAAKC,GAAM,EAAI,GAI1BpsB,KAAKwS,YAAc,SAAUzO,EAAGjE,GAAK,OAAOsD,EAAExC,KAAKiX,EAAO9T,EAAGjE,IAEjE,MACJ,QACIE,KAAKwS,YAAc,OAG/B8P,YAAY,EACZ9b,cAAc,IAElBqjB,EAAW1pB,UAAU6J,SAAW,WAC5B,OAAOhK,KAAKqsB,SAAWrsB,KAAKqsB,OAASrsB,KAAKoK,OAASpK,KAAKoK,OAAOJ,WAAahK,KAAKgiB,gBAErF6H,EAAW1pB,UAAUsR,kBAAoB,SAAUrF,EAAQhB,EAAS2X,GAEhE,QADgB,IAAZ3X,IAAsBA,MACtB2X,IAAc/iB,KAAlB,CAEA,IAAIiT,EAAcjT,KAAKiT,YACnB7G,EAAO6H,WAAWhB,IAClBF,GAAY/S,KAAK0T,MAAOtH,GAE5B,IAAIC,EAASC,GAAMtM,MACfyM,GAAYzM,KAAMoL,IAClBrE,GAAS/G,KAAM,SAAUoM,EAAQhB,GAErCiB,GAAUM,GAAO3M,QAErB6pB,EAAW1pB,UAAU6E,IAAM,SAAUsnB,GACjC,GAAe,MAAXA,EAAJ,CAEA,GAAuB,iBAAZA,EAAsB,CAC7B,IAAIzZ,EAAKyZ,EAAQtsB,KAAKiT,aACtB,YAAe,IAAPJ,GAAiB7S,KAAK0T,MAAMb,IAAQ7S,KAAK0T,MAAM4Y,EAAQ/iB,KAG/D,OAAOvJ,KAAK0T,MAAM4Y,KAG1BzC,EAAW1pB,UAAUogB,KAAO,SAAU7J,EAAUvP,GAE5C,IAAK,IADDtE,EAAMyT,GAAYI,EAAUvP,GAAUuL,EAAS1S,KAAK0S,OAC/C3R,EAAI,EAAGA,EAAI2R,EAAO1R,OAAQD,IAC/B8B,EAAI6P,EAAO3R,GAAIA,IAGvB8oB,EAAW1pB,UAAUosB,QAAU,SAAU7V,EAAUvP,GAC/C,OAAOnH,KAAKugB,KAAK7J,EAAUvP,IAE/B0iB,EAAW1pB,UAAUoC,MAAQ,SAAUmU,EAAUvP,GAE7C,IAAK,IADDtE,EAAM4T,GAAoBC,EAAUvP,GAAUuL,EAAS1S,KAAK0S,OACvD3R,EAAI,EAAGA,EAAI2R,EAAO1R,OAAQD,IAC/B,IAAK8B,EAAI6P,EAAO3R,GAAIA,GAChB,OAAO,EAEf,OAAO,GAEX8oB,EAAW1pB,UAAUyqB,OAAS,SAAUlU,EAAUvP,GAC9C,IAAItE,EAAM4T,GAAoBC,EAAUvP,GACxC,OAAOnH,KAAKqN,IAAI,SAAUjK,EAAGrC,GAAK,OAAO8B,EAAIO,EAAGrC,GAAKqC,OAAI,KAE7DymB,EAAW1pB,UAAUqsB,KAAO,SAAU9V,EAAUvP,GAE5C,IAAK,IADDtE,EAAM4T,GAAoBC,EAAUvP,GAAUuL,EAAS1S,KAAK0S,OACvD3R,EAAI,EAAGA,EAAI2R,EAAO1R,OAAQD,IAC/B,GAAI8B,EAAI6P,EAAO3R,GAAIA,GACf,OAAO2R,EAAO3R,GAEtB,OAAO,MAEX8oB,EAAW1pB,UAAUyC,KAAO,SAAU8T,EAAUvP,GAC5C,OAAO8H,QAAQjP,KAAKwsB,KAAK9V,EAAUvP,KAEvC0iB,EAAW1pB,UAAUkN,IAAM,SAAUqJ,EAAUvP,GAG3C,IAAK,IAFDtE,EAAMyT,GAAYI,EAAUvP,GAAUuL,EAAS1S,KAAK0S,OAAQ+Z,EAASnqB,MAAMoQ,EAAO1R,QAClFsT,EAAI,EACCvT,EAAI,EAAGA,EAAI2R,EAAO1R,OAAQD,IAAK,CACpC,IAAIqC,EAAIP,EAAI6P,EAAO3R,GAAIA,QACjB,IAANqC,IAAiBqpB,EAAOnY,KAAOlR,GAGnC,OADAqpB,EAAOzrB,OAASsT,EACTmY,GAEX5C,EAAW1pB,UAAUkgB,gBAAkB,SAAUkJ,GAC7C,GAAIvpB,KAAKqR,QACL,OAAO,EACX,IAAIqb,EAAQ,EAQZ,OAPA1sB,KAAKugB,KAAK,SAAUnU,GAChB,IAAIL,EAAQK,EAAOoW,gBACfzW,IACAwd,EAAOnd,EAAO7C,KAAOwC,EACrB2gB,OAGDA,GAEX7C,EAAW1pB,UAAUqK,WAAa,aAClCpK,OAAOwB,eAAeioB,EAAW1pB,UAAW,UACxC6E,IAAK,WAAc,OAAOhF,KAAK0S,OAAO1R,QACtCshB,YAAY,EACZ9b,cAAc,IAElBqjB,EAAW1pB,UAAUyD,MAAQ,WAAc,OAAO5D,KAAK0S,OAAO,IAC9DmX,EAAW1pB,UAAUwsB,KAAO,WAAc,OAAO3sB,KAAK0S,OAAO1S,KAAK0S,OAAO1R,OAAS,IAClF6oB,EAAW1pB,UAAUiU,GAAK,SAAUwY,GAChC,IAAIha,EAAQga,EAAU,EAAIA,EAAU5sB,KAAK0S,OAAO1R,OAAS4rB,EACzD,OAAO5sB,KAAK0S,OAAOE,IAEvBiX,EAAW1pB,UAAUwR,MAAQ,SAAUvG,QACnB,IAAZA,IAAsBA,MAC1B,IAAIsH,EAAS1S,KAAKqR,QAAUC,gBAAcqW,MAAQ3nB,KAAK0S,OAAS1S,KAAKqN,IAAI,SAAU+D,GAAS,OAAOA,EAAMO,UAAayX,EAAO,IAAIppB,KAAKC,YAAYyS,GAAUtB,MAAOpR,KAAKoR,MAAOqa,WAAYzrB,KAAKyrB,YAAczrB,KAAKqR,SAGnN,OAFIjG,EAAQie,WACRD,EAAKpH,cAAgBhiB,KAAKgK,YACvBof,GAEXS,EAAW1pB,UAAU8jB,OAAS,WAC1B,OAAOjkB,KAAK0S,OAAOrF,IAAI,SAAU+D,GAAS,OAAOA,EAAM6S,YAE3D4F,EAAW1pB,UAAUga,IAAM,SAAUhE,EAAU/K,GAM3C,QALiB,IAAb+K,IAAuBA,WACX,IAAZ/K,IAAsBA,WACN,IAAhBA,EAAQyhB,KACR7sB,KAAK2N,KAAK,OAAQ,oFAAqFvC,GAEvGA,EAAQ0hB,MACR9sB,KAAK8sB,MAAM3W,EAAU/K,OAEpB,CACD,IAAI2I,EAAc/T,KAAKgU,mBAAmBmC,EAAU/K,GACpD2I,GAAeA,EAAYpH,SAE/B,OAAO3M,MAEX6pB,EAAW1pB,UAAU4sB,YAAc,SAAUC,GACzC,IAAInV,EAAQ7X,KACZ,GAAIgtB,EAAS,CACThtB,KAAK+sB,aAAY,GACjB,IAAIE,EAA8B,mBAAZD,EAAyBA,EAAU,WAAc,OAAO,GAO9E,OANAhtB,KAAKktB,cACDC,QAAS,SAAUnF,GACfiF,EAASjF,IAASnQ,EAAMgV,IAAI7E,GAAQrU,OAAO,EAAMjC,OAAO,KAE5D8D,QAAS,SAAU3C,GAAM,OAAOgF,EAAMwQ,OAAOxV,KAE1C7S,KAAKoiB,cAAcrQ,UAAU/R,KAAKktB,aAAcltB,MAGnDA,KAAKktB,eACLltB,KAAKoiB,cAAc9P,YAAYtS,KAAKktB,aAAcltB,MAClDA,KAAKktB,aAAe,OAIhCrD,EAAW1pB,UAAUgiB,MAAQ,SAAU3O,GACnC,IAAIqE,EAAQ7X,UACM,IAAdwT,IAAwBA,MAC5B,IAAIpI,EAAU8c,IAAmBvU,OAAO,GAAQH,GAChD,OAAOrI,EAAQnL,KADwDA,KAAKoiB,cAC9CjE,KAAK/S,EAASpL,MAAOoL,EAAS,SAAU4c,GAClE,IAAIhlB,EAAS6U,EAAMsC,IAAI6N,EAAME,IAAmBvU,OAAO,GAAQvI,IAI/D,OAHIA,EAAQ2hB,cACR/pB,EAAS6U,EAAMkV,YAAY3hB,EAAQ2hB,cAEhC/pB,KAGf6mB,EAAW1pB,UAAUkS,QAAU,WAC3B,IAAIrS,KAAKggB,UAAT,CAGA,IAAK,IADDoN,GAAcptB,KAAKqR,QACd/I,EAAK,EAAGrC,EAAKjG,KAAK0S,OAAQpK,EAAKrC,EAAGjF,OAAQsH,IAAM,CACrD,IAAI8D,EAASnG,EAAGqC,GAChB0J,GAAKhS,KAAMoM,GACPghB,GACAhhB,EAAOiG,UAEfrS,KAAK+sB,aAAY,GACjBxV,EAAOpX,UAAUkS,QAAQzR,KAAKZ,QAElC6pB,EAAW1pB,UAAU2sB,MAAQ,SAAUO,EAAYjiB,QAC/B,IAAZA,IAAsBA,MAC1B,IAAIiB,EAASC,GAAMtM,MAAOstB,EAAiBttB,KAAK0S,OAC5C2a,EACA3Y,GAAoB1U,KAAMkW,GAAWlW,KAAMqtB,EAAYjiB,GAAUA,GAAS,IAG1EpL,KAAK0T,SACL1T,KAAK0S,WAETjG,GAAYzM,KAAMoL,GAClBA,EAAQuJ,QAAU5N,GAAS/G,KAAM,QAASA,KAAM6B,IAAWyrB,eAAgBA,GAAkBliB,IAE7F,IAAK,IADDsI,EAAQ1T,KAAK0T,MACRpL,EAAK,EAAGilB,EAAmBD,EAAgBhlB,EAAKilB,EAAiBvsB,OAAQsH,IAAM,CACpF,IAAIklB,EAAYD,EAAiBjlB,GACjCoL,EAAM8Z,EAAUjkB,MAAQyI,GAAKhS,KAAMwtB,GAGvC,OADAnhB,GAAUM,GAAO3M,MACVA,KAAK0S,QAEhBmX,EAAW1pB,UAAU0sB,IAAM,SAAUQ,EAAYjiB,QAC7B,IAAZA,IAAsBA,MAC1B,IAAI+K,EAAWD,GAAWlW,KAAMqtB,EAAYjiB,GAAU2I,EAAc/T,KAAK0S,OAAO1R,OAC5EmS,GAAenT,KAAMmW,EAAU/K,GAC/BsJ,GAAoB1U,KAAMmW,EAAU/K,GACxC,GAAI2I,EAEA,OADAA,EAAYpH,SACLoH,EAAYT,OAG3BuW,EAAW1pB,UAAUkoB,OAAS,SAAUoF,EAAcriB,GAElD,YADgB,IAAZA,IAAsBA,MACtBqiB,EACOnrB,MAAM+T,QAAQoX,GACjB1X,GAAW/V,KAAMytB,EAAcriB,GDvT/C,SAA0BjB,EAAY8M,EAAI7L,GACtC,IAAIgG,EAAQjH,EAAWnF,IAAIiS,GAC3B,GAAI7F,EAAO,CACP,IAAI/E,EAASC,GAAMnC,GAAauI,EAASvI,EAAWuI,OACpDA,EAAOgb,OAAOhb,EAAO7R,QAAQuQ,GAAQ,GACrC0B,GAAY3I,EAAWuJ,MAAOtC,GAC9B,IAAIuc,EAASlhB,GAAYtC,EAAYiB,GAQrC,OAPIuiB,IACA7mB,GAASsK,EAAO,SAAUA,EAAOjH,EAAYiB,GAC7CtE,GAASqD,EAAY,SAAUiH,EAAOjH,EAAYiB,IAEtD4G,GAAK7H,EAAYiH,EAAOhG,EAAQ+G,OAChCwb,GAAU5mB,GAASoD,EAAY,SAAUA,EAAYiB,GACrDiB,GAAUM,GAAOxC,GACViH,GC0SCwc,CAAU5tB,KAAMytB,EAAcriB,OAI1Cye,EAAW1pB,UAAU6T,mBAAqB,SAAUqZ,EAAYjiB,QAC5C,IAAZA,IAAsBA,MAC1B,IAAI+K,EAAWD,GAAWlW,KAAMqtB,EAAYjiB,GAC5C,OAAIpL,KAAK0S,OAAO1R,QACc,IAAnBoK,EAAQid,OACXlV,GAAenT,KAAMmW,EAAU/K,GAAS,GACxC4J,GAAehV,KAAMmW,EAAU/K,GAG5BsJ,GAAoB1U,KAAMmW,EAAU/K,IAGnDye,EAAW1pB,UAAU0tB,MAAQ,SAAUzsB,GACnC,OAAOpB,KAAK0S,OAAOrF,IAAI,SAAU+D,GAAS,OAAOA,EAAMhQ,MAE3DyoB,EAAW1pB,UAAUsS,KAAO,SAAUrH,GAElC,QADgB,IAAZA,IAAsBA,MACtBmH,GAAavS,KAAMoL,GAAU,CAC7B,IAAIiB,EAASC,GAAMtM,MACfyM,GAAYzM,KAAMoL,IAClBrE,GAAS/G,KAAM,OAAQA,KAAMoL,GAEjCiB,GAAUM,GAAO3M,MAErB,OAAOA,MAEX6pB,EAAW1pB,UAAU0F,KAAO,SAAUuL,EAAOhG,GACzC,OAAOpL,KAAK6sB,IAAIzb,EAAO5N,IAAS4Q,GAAIpU,KAAKgB,QAAUoK,KAEvDye,EAAW1pB,UAAUwgB,IAAM,SAAUvV,GACjC,IAAIgG,EAAQpR,KAAKoU,GAAGpU,KAAKgB,OAAS,GAElC,OADAhB,KAAKqoB,OAAOjX,EAAO8W,IAAmB/V,OAAO,GAAQ/G,IAC9CgG,GAEXyY,EAAW1pB,UAAUgS,MAAQ,SAAU2b,EAAW1iB,GAC9C,IAAIjJ,EAAQnC,KAAKgF,IAAI8oB,GAErB,OADA9tB,KAAKqoB,OAAOyF,EAAW5F,IAAmB/V,OAAO,GAAQ/G,IAClDjJ,GAEX0nB,EAAW1pB,UAAUmG,QAAU,SAAU8K,EAAOhG,GAC5C,OAAOpL,KAAK6sB,IAAIzb,EAAO5N,IAAS4Q,GAAI,GAAKhJ,KAE7Cye,EAAW1pB,UAAUygB,MAAQ,SAAUxV,GACnC,IAAIgG,EAAQpR,KAAKoU,GAAG,GAEpB,OADApU,KAAKqoB,OAAOjX,EAAO8W,IAAmB/V,OAAO,GAAQ/G,IAC9CgG,GAEXyY,EAAW1pB,UAAUyF,MAAQ,WACzB,OAAOA,GAAM/B,MAAM7D,KAAK0S,OAAQnR,YAEpCsoB,EAAW1pB,UAAUU,QAAU,SAAUitB,GACrC,IAAI1hB,EAASpM,KAAKgF,IAAI8oB,GACtB,OAAO9tB,KAAK0S,OAAO7R,QAAQuL,IAE/Byd,EAAW1pB,UAAU4tB,QAAU,SAAU5gB,GACrC,OAAOA,EAAMnN,KAAKoR,MAAMjR,UAAU8S,cAEtC4W,EAAW1pB,UAAU6tB,OAAS,SAAU5c,EAAO6c,GAC3C,IAAI5mB,EAAO4H,QAAQjP,KAAKgF,IAAIoM,IAAS5J,OAAkB,IAAXymB,GAAqB5mB,EAAO4H,QAAQgf,GAShF,OARI5mB,IAASG,IACLH,EACArH,KAAKqoB,OAAOjX,GAGZpR,KAAK6sB,IAAIzb,IAGV5J,GAEXqiB,EAAW1pB,UAAUwN,KAAO,SAAU0N,EAAO4J,EAAM9iB,GAC/Cge,GAAU9E,EAAO,uBAAyBrb,KAAKoR,MAAMjR,UAAU0iB,eAAiB,IAAM7iB,KAAK6iB,eAAiB,KAAOoC,GAC/GiJ,SAAU/rB,EACVgsB,kBAAmBnuB,KAAKoR,MAAMjR,UAAUoM,eAGhDsd,EAAW1pB,UAAU0iB,aAAe,WAChC,OAAOtL,EAAOpX,UAAU0iB,aAAajiB,KAAKZ,OAAS,cAEvD6pB,EAAWrb,WAAa8W,GACxBuE,EAA4BnS,GACxB5S,GACIsc,UAAW,IACXhQ,MAAO8T,GACP1T,iBAAkB,UAClBK,kBAAmB,OAEvBvM,GACImmB,WAAY3N,GAAW3b,MACvBiP,MAAO0M,GAAWC,WAClBmO,WAAYpO,GAAWpM,SAE5BmY,IAGL1a,IAMFa,GAAqB6Z,GAAYjC,IACjC1C,GAAO2E,WAAaA,GchapB,IAAIuE,GAAiB,SAAU7W,GAE3B,SAAS6W,IACL,OAAkB,OAAX7W,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAa/D,OAfAyX,EAAkB2W,EAAe7W,GAIjC6W,EAAcjuB,UAAU8jB,OAAS,SAAU9hB,GACvC,OAAOA,GAA0B,iBAAVA,EAAqBA,EAAM0Q,GAAK1Q,GAE3DisB,EAAcjuB,UAAUwR,MAAQ,SAAUxP,GACtC,OAAOA,GAA0B,iBAAVA,EAAqBA,EAAM0Q,GAAK1Q,GAE3DisB,EAAcjuB,UAAU2kB,UAAY,SAAU/gB,EAAGjE,GAE7C,OADUiE,IAAc,MAARA,EAAE8O,GAAa9O,EAAIA,EAAE8O,QAAW/S,IAAc,MAARA,EAAE+S,GAAa/S,EAAIA,EAAE+S,MAG/Eub,EAAcjuB,UAAUmgB,SAAW,SAAUlP,EAAOjP,EAAOH,KACpDosB,GACTre,IACFmV,GAAOmJ,KAAO,SAAcC,GACxB,IAAIC,EAAsB5X,GAAe2X,GAKzC,OAJe,IAAI/f,IACfpM,MAAO,KACPqM,WAAY4f,KAGXppB,IAAI,SAAUsnB,EAAStqB,GACxB,GAAuB,iBAAZsqB,EACP,OAAOA,EACX,IAAIniB,EAAaokB,EAAoBvuB,MACjCoM,EAAS,KAMb,OALIjC,GAAcA,EAAWnJ,SACzBoL,EAASjC,EAAWnF,IAAIsnB,IAAY,KACpCtsB,KAAK0M,WAAW1K,GAAQoK,EACxBA,GAAUpM,KAAKuM,YAAYvK,GAAM4iB,aAAaxY,EAAQ,KAAMpM,UAEzDoM,KZjCfyd,GAAWgC,SAAW,SAAkByC,GACpC,IAAI1C,EAAW5rB,KAAK+rB,YAAc/rB,KAAK+rB,UAS3C,SAAgCyC,GAC5B,IAAIC,EAAsB,SAAUlX,GAEhC,SAASkX,EAAmBhB,EAAcriB,GACtC,IAAIyM,EAAQN,EAAO3W,KAAKZ,QAAUoL,EAASsjB,KAAqB1uB,KAGhE,OAFA6X,EAAM8W,aAAe,KACrB9W,EAAMT,KAAOE,GAAQmW,GACd5V,EA6FX,OAlGAJ,EAAkBgX,EAAoBlX,GAOtCnX,OAAOwB,eAAe6sB,EAAmBtuB,UAAW,mBAChD6E,IAAK,WAAc,OAAOhF,KAAKoX,MAAQpX,KAAK0S,QAC5C4P,YAAY,EACZ9b,cAAc,IAElBioB,EAAmBtuB,UAAU0sB,IAAM,SAAUQ,EAAYjiB,QACrC,IAAZA,IAAsBA,MAC1B,IAAIujB,EAAe3uB,KAAK2uB,aAAcxZ,EAAQmC,GAAQ+V,GACtD,GAAIsB,EACA,OAAOpX,EAAOpX,UAAU0sB,IAAIjsB,KAAKZ,KAAM6W,GAAY8X,EAAcxZ,GAAQ/J,GAGzE,GAAI+J,EAAMnU,OAAQ,CACd,IAAIqL,EAASgL,GAAe/K,MAAMtM,MAClCA,KAAKoX,KAAOpX,KAAKoX,KAAOpX,KAAKoX,KAAKmG,OAAOpI,GAASA,EAAMvP,QACxDyR,GAAe5K,YAAYzM,KAAMoL,GACjCiB,GAAUgL,GAAe1K,OAAO3M,QAI5CyuB,EAAmBtuB,UAAU2sB,MAAQ,SAAUO,EAAYjiB,QACvC,IAAZA,IAAsBA,MAC1B,IAAIujB,EAAe3uB,KAAK2uB,aAAcxY,EAAWmB,GAAQ+V,GACzD,OAAOsB,EACHpX,EAAOpX,UAAU2sB,MAAMlsB,KAAKZ,KAAM6W,GAAY8X,EAAcxY,GAAW/K,GACvE8L,GAASlX,KAAMmW,EAAU/K,QAEjCqjB,EAAmBtuB,UAAU6T,mBAAqB,SAAUqZ,EAAYjiB,GACpE,IAAIujB,EAAe3uB,KAAK2uB,aAAcxY,EAAWmB,GAAQ+V,GACzD,OAAOsB,EACHpX,EAAOpX,UAAU6T,mBAAmBpT,KAAKZ,KAAM6W,GAAY8X,EAAcxY,GAAW/K,GACpF8L,GAASlX,KAAMmW,EAAU/K,IAEjCqjB,EAAmBtuB,UAAU8jB,OAAS,WAClC,OAAOjkB,KAAKoX,KACRpX,KAAKoX,KAAK/J,IAAI,SAAUif,GAAW,OAAOA,EAAQzZ,IAAMyZ,IACxDtsB,KAAK0S,OAAOrF,IAAI,SAAU+D,GAAS,OAAOA,EAAMyB,MAExD4b,EAAmBtuB,UAAUkgB,gBAAkB,WAAc,OAAO,GACpEjgB,OAAOwB,eAAe6sB,EAAmBtuB,UAAW,UAChD6E,IAAK,WACD,OAAOhF,KAAK0S,OAAO1R,SAAWhB,KAAKoX,KAAOpX,KAAKoX,KAAKpW,OAAS,IAEjEshB,YAAY,EACZ9b,cAAc,IAElBioB,EAAmBtuB,UAAUwR,MAAQ,SAAUM,GAC3C,IAA6BmX,EAAO,IAAI/jB,EAA7BrF,KAAKC,iBACZmR,MAAOpR,KAAKoR,MACZqa,WAAYzrB,KAAKyrB,aAUrB,OARIzrB,KAAK2uB,cACLvF,EAAKuF,aAAe3uB,KAAK2uB,aACzBvF,EAAKhS,KAAO,KACZgS,EAAK0D,MAAM9sB,KAAK0S,QAAUiC,QAAQ,KAGlCyU,EAAKhS,KAAOpX,KAAKoX,KAAKxR,QAEnBwjB,GAEXqF,EAAmBtuB,UAAUwT,MAAQ,SAAUib,GAC3C,OAAOA,GAEXH,EAAmBtuB,UAAUyK,QAAU,SAAUT,GAQ7C,OAPIA,GAAcA,EAAWnJ,SACzBhB,KAAK2uB,aAAexkB,EAChBnK,KAAKoX,OACLpX,KAAK8sB,MAAM9sB,KAAKoX,MAAQzC,QAAQ,IAChC3U,KAAKoX,KAAO,OAGbpX,MAEXyuB,EAAmBtuB,UAAU0uB,YAAc,WAAc,OAAO7uB,KAAKikB,UACrEwK,EAAmBtuB,UAAU6tB,OAAS,SAAUF,EAAW7L,GACvD,OAAO1K,EAAOpX,UAAU6tB,OAAOptB,KAAKZ,KAAMA,KAAK2uB,aAAa3pB,IAAI8oB,GAAY7L,IAEhFwM,EAAmBtuB,UAAU2uB,OAAS,WAClC,GAAI9uB,KAAK2uB,aAEL,OADA3uB,KAAKma,IAAIna,KAAK2uB,aAAajc,QACpB1S,KAAK0S,OAEhB,MAAM,IAAIxH,MAAM,0EAEpBujB,EAAmBtuB,UAAU4uB,UAAY,WACrC,OAAO/uB,KAAKgB,OAAShB,KAAK8sB,QAAU9sB,KAAK8uB,UAE7CL,EAAqB/W,GACjB5S,GACD2pB,IAELD,GAEF,OADAC,EAAmBtuB,UAAU2R,iBAAc,EACpC2c,EAhH4CO,CAAuBhvB,OAAQuuB,EAAsB5X,GAAe2X,GAGvH,OAHqJ,IAAI/f,IACrJF,KAAMud,IAEM5mB,IAAI,SAAUoS,GAE1B,OADCA,GAAQA,EAAKuX,cAAgBvX,EAAKxM,QAAQ2jB,EAAoBvuB,OACxDoX,KAGf,IAAIsX,GAAmBpd,gBAAcqW,MAAQrW,gBAAckU,WabvD6G,GAAS,KACT4C,GAAS,SAAU1X,GAEnB,SAAS0X,IACL,OAAkB,OAAX1X,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAoB/D,OAtBAyX,EAAkBwX,EAAO1X,GAIzB0X,EAAM9uB,UAAU6J,SAAW,WAAc,OAAOhK,MAChDivB,EAAM9uB,UAAU6E,IAAM,SAAUhD,GAC5B,IAAI0O,EAAQ1Q,KAAKgC,GACjB,OAAI0O,GAAS1Q,OAASA,KAAKgiB,cAChBtR,EACJ1Q,KAAKoK,OAASpK,KAAKoK,OAAOpF,IAAIhD,GAAQhC,KAAKgiB,cAAchd,IAAIhD,IAExE5B,OAAOwB,eAAeqtB,EAAO,UACzBjqB,IAAK,WAAc,OAAOqnB,IAC1BlS,IAAK,SAAU+U,GACP7C,IACAA,GAAOha,UAEXlD,GAAchP,UAAU6hB,cAAgBqK,GAAS6C,GAErD5M,YAAY,EACZ9b,cAAc,IAEXyoB,GACT/J,IACF+J,GACME,OAAS,IAAIF,GZ5BnB7uB,OAAOka,iBAAmBla,OAAOka,eAAiB2P,GAClD,IA2CIhkB,GApCO0B,IAAM1B,GAAKga,IAAWtY,GAAKI,GAAM9B,GAAG8B,IAAKmE,GAAUjG,GAAGiG,QAASzI,GAAOwC,GAAGxC,KAAMic,GAAWzZ,GAAGyZ,SAAUE,GAAgB3Z,GAAG2Z,cAAeD,GAAe1Z,GAAG0Z,+5BCRlKyP,GAAmBxW,OAAOyW,SAE1BC,IACAC,EAAGC,EACH1W,QAAS,KACT2W,QAAS,QACT3X,KAAMA,GAAMU,QAASA,GAASH,OAAQA,GAAQqX,WAElD,WAGI,OADA9W,OAAOyW,SAAWD,GACXpvB,OAYP2vB,GAAwB,iBACxBzX,IAAe,QAAS,aAAc,KAAM,KAAM,aAAc,YAAa,UAAW,UAC5FF,SAASF,GAAK3X,WACVyvB,QAAS,MACTL,EAAG,SAAUM,GACT,OAAO7vB,KAAK8vB,IAAItD,KAAKqD,IAEzBrlB,WAAY,aACZulB,OAAQ,WACJ,OAAO/vB,MAEXqoB,OAAQ,WAGJ,OAFAroB,KAAK8vB,IAAIzH,SACTroB,KAAK4f,gBACE5f,MAEXgwB,WAAY,SAAUC,EAASC,GAO3B,OANIlwB,KAAK8vB,KACL9vB,KAAKmwB,mBACTnwB,KAAK8vB,IAAMG,aAAmBX,GAASC,EAAIU,EAAUX,GAASC,EAAEU,GAChEjwB,KAAKiX,GAAKjX,KAAK8vB,IAAI,IACF,IAAbI,GACAlwB,KAAKoY,iBACFpY,MAEXoY,eAAgB,SAAUjQ,GACtB,IAAMA,KAAWA,EAASioB,SAASpwB,KAAM,WACrC,OAAOA,KACXA,KAAKmwB,mBACL,IAAK,IAAI/uB,KAAO+G,EAAQ,CACpB,IAAIyP,EAASzP,EAAO/G,GAGpB,GAFKivB,aAAazY,KACdA,EAAS5X,KAAKmI,EAAO/G,KACpBwW,EAAL,CAEA,IAAI/N,EAAQzI,EAAIyI,MAAM8lB,IAClBW,EAAYzmB,EAAM,GAAIgmB,EAAWhmB,EAAM,GAC3C+N,EAASe,OAAOf,EAAQ5X,MACxBswB,GAAa,kBAAoBtwB,KAAKuJ,IACrB,KAAbsmB,EACA7vB,KAAK8vB,IAAInoB,GAAG2oB,EAAW1Y,GAGvB5X,KAAK8vB,IAAInoB,GAAG2oB,EAAWT,EAAUjY,IAGzC,OAAO5X,MAEXmwB,iBAAkB,WAEd,OADAnwB,KAAK8vB,IAAI/nB,IAAI,kBAAoB/H,KAAKuJ,KAC/BvJ,MAEXmY,eAAgB,WACZ,GAAKnY,KAAKiX,GAUNjX,KAAKgwB,WAAWI,SAASpwB,KAAM,OAAO,OAV5B,CACV,IAAImN,EAAQ6K,YAAaoY,SAASpwB,KAAM,eACpCA,KAAK6S,KACL1F,EAAM0F,GAAKud,SAASpwB,KAAM,OAC1BA,KAAKuwB,YACLpjB,EAAa,MAAIijB,SAASpwB,KAAM,cACpC,IAAI8vB,EAAMR,GAASC,EAAE,IAAMa,SAASpwB,KAAM,WAAa,KAAKsN,KAAKH,GACjEnN,KAAKgwB,WAAWF,GAAK,OAcjC,IAAIU,GAAgB,aAChBC,GAAa,eACbC,GAAa,SACbC,GAAe,2BACnB3Y,SAASK,GAAOlY,WACZqK,WAAY,aACZomB,MAAO,SAAUA,EAAO5uB,EAAMkF,GACrB2pB,WAAWD,KACZA,EAAQ5wB,KAAK8wB,eAAeF,IAC5BP,aAAaruB,KACbkF,EAAWlF,EACXA,EAAO,IAENkF,IACDA,EAAWlH,KAAKgC,IACpB,IAAI+uB,EAAS/wB,KASb,OARAsvB,GAASxW,QAAQ8X,MAAMA,EAAO,SAAUI,GACpC,IAAI/kB,EAAO8kB,EAAOE,mBAAmBL,EAAOI,IACC,IAAzCD,EAAOG,QAAQhqB,EAAU+E,EAAMjK,KAC/B+uB,EAAO7kB,QAAQrI,MAAMktB,GAAS,SAAW/uB,GAAMub,OAAOtR,IACtD8kB,EAAO7kB,QAAQ,QAASlK,EAAMiK,GAC9BqjB,GAASxW,QAAQ5M,QAAQ,QAAS6kB,EAAQ/uB,EAAMiK,MAGjDjM,MAEXkxB,QAAS,SAAUhqB,EAAU+E,EAAMjK,GAC3BkF,GACAA,EAASrD,MAAM7D,KAAMiM,IAE7BklB,SAAU,SAAUH,EAAU5lB,GAE1B,OADAkkB,GAASxW,QAAQqY,SAASH,EAAU5lB,GAC7BpL,MAEXuY,YAAa,WACT,GAAKvY,KAAKsY,OAAV,CAEAtY,KAAKsY,OAAS8X,SAASpwB,KAAM,UAE7B,IADA,IAAI4wB,EAAOtY,EAAS8Y,OAAOpxB,KAAKsY,QACC,OAAzBsY,EAAQtY,EAAOqI,QACnB3gB,KAAK4wB,MAAMA,EAAO5wB,KAAKsY,OAAOsY,MAGtCE,eAAgB,SAAUF,GAOtB,OANAA,EAAQA,EAAMS,QAAQV,GAAc,QAC/BU,QAAQb,GAAe,WACvBa,QAAQZ,GAAY,SAAU5mB,EAAOynB,GACtC,OAAOA,EAAWznB,EAAQ,aAEzBwnB,QAAQX,GAAY,YAClB,IAAIa,OAAO,IAAMX,EAAQ,yBAEpCK,mBAAoB,SAAUL,EAAOI,GACjC,IAAIQ,EAASZ,EAAMrK,KAAKyK,GAAUprB,MAAM,GACxC,OAAO6rB,MAAMD,EAAQ,SAAUE,EAAO3wB,GAClC,OAAIA,IAAMywB,EAAOxwB,OAAS,EACf0wB,GAAS,KACbA,EAAQC,mBAAmBD,GAAS,UAavD,IAAIE,GAAgB,eAChBC,GAAe,aACfC,GAAe,OACnBtZ,GAAQuZ,SAAU,EAClB/Z,SAASQ,GAAQrY,WACb6xB,SAAU,GACVC,OAAQ,WAEJ,OADWjyB,KAAK6Y,SAASqZ,SAASb,QAAQ,SAAU,SACpCrxB,KAAKyJ,OAASzJ,KAAKmyB,aAEvCC,UAAW,WAGP,OAFWpyB,KAAKqyB,eAAeryB,KAAK6Y,SAASqZ,UAC7BtsB,MAAM,EAAG5F,KAAKyJ,KAAKzI,OAAS,GAAK,MACjChB,KAAKyJ,MAEzB4oB,eAAgB,SAAUrB,GACtB,OAAOsB,UAAUtB,EAASK,QAAQ,OAAQ,WAE9Cc,UAAW,WACP,IAAItoB,EAAQ7J,KAAK6Y,SAAS0Z,KAAKlB,QAAQ,MAAO,IAAIxnB,MAAM,QACxD,OAAOA,EAAQA,EAAM,GAAK,IAE9B2oB,QAAS,SAAU5Z,GACf,IAAI/O,GAAS+O,GAAU5Y,MAAM6Y,SAAS0Z,KAAK1oB,MAAM,UACjD,OAAOA,EAAQA,EAAM,GAAK,IAE9B4oB,QAAS,WACL,IAAI7oB,EAAO5J,KAAKqyB,eAAeryB,KAAK6Y,SAASqZ,SAAWlyB,KAAKmyB,aAAavsB,MAAM5F,KAAKyJ,KAAKzI,OAAS,GACnG,MAA0B,MAAnB4I,EAAK8oB,OAAO,GAAa9oB,EAAKhE,MAAM,GAAKgE,GAEpD+oB,YAAa,SAAU3B,GASnB,OARgB,MAAZA,IAEIA,EADAhxB,KAAK4yB,gBAAkB5yB,KAAK6yB,iBACjB7yB,KAAKyyB,UAGLzyB,KAAKwyB,WAGjBxB,EAASK,QAAQO,GAAe,KAE3CkB,MAAO,SAAU1nB,GACb,GAAIoN,GAAQuZ,QACR,MAAM,IAAI7mB,MAAM,6CAYpB,GAXAsN,GAAQuZ,SAAU,EAClB/xB,KAAKoL,QAAU4M,UAAWvO,KAAM,KAAOzJ,KAAKoL,QAASA,GACrDpL,KAAKyJ,KAAOzJ,KAAKoL,QAAQ3B,KACzBzJ,KAAK6yB,kBAA+C,IAA5B7yB,KAAKoL,QAAQ2nB,WACrC/yB,KAAKgzB,eAAiB,iBAAkBpa,cAAqC,IAA1Bqa,SAASC,cAA2BD,SAASC,aAAe,GAC/GlzB,KAAKmzB,eAAiBnzB,KAAK6yB,kBAAoB7yB,KAAKgzB,eACpDhzB,KAAKozB,kBAAoBpzB,KAAKoL,QAAQioB,UACtCrzB,KAAKszB,iBAAmBtzB,KAAK8Y,UAAW9Y,KAAK8Y,QAAQua,WACrDrzB,KAAK4yB,cAAgB5yB,KAAKozB,iBAAmBpzB,KAAKszB,cAClDtzB,KAAKgxB,SAAWhxB,KAAK2yB,cACrB3yB,KAAKyJ,MAAQ,IAAMzJ,KAAKyJ,KAAO,KAAK4nB,QAAQQ,GAAc,KACtD7xB,KAAK6yB,kBAAoB7yB,KAAKozB,gBAAiB,CAC/C,IAAKpzB,KAAKszB,gBAAkBtzB,KAAKiyB,SAAU,CACvC,IAAIxoB,EAAOzJ,KAAKyJ,KAAK7D,MAAM,GAAI,IAAM,IAErC,OADA5F,KAAK6Y,SAASwY,QAAQ5nB,EAAO,IAAMzJ,KAAKyyB,YACjC,EAEFzyB,KAAKszB,eAAiBtzB,KAAKiyB,UAChCjyB,KAAKmxB,SAASnxB,KAAKwyB,WAAanB,SAAS,IAGjD,IAAKrxB,KAAKgzB,gBAAkBhzB,KAAK6yB,mBAAqB7yB,KAAK4yB,cAAe,CACtE5yB,KAAKuzB,OAASN,SAASO,cAAc,UACrCxzB,KAAKuzB,OAAO1e,IAAM,eAClB7U,KAAKuzB,OAAOE,MAAMC,QAAU,OAC5B1zB,KAAKuzB,OAAOI,UAAY,EACxB,IAAI1X,EAAOgX,SAAShX,KAChB2X,EAAU3X,EAAK4X,aAAa7zB,KAAKuzB,OAAQtX,EAAK6X,YAAYC,cAC9DH,EAAQX,SAASe,OACjBJ,EAAQX,SAASgB,QACjBL,EAAQ/a,SAASrU,KAAO,IAAMxE,KAAKgxB,SAEvC,IAAIkD,EAAmBtb,OAAOsb,kBAAoB,SAAU5D,EAAWjnB,GACnE,OAAO8qB,YAAY,KAAO7D,EAAWjnB,IAWzC,GATIrJ,KAAK4yB,cACLsB,EAAiB,WAAYl0B,KAAK0Y,UAAU,GAEvC1Y,KAAKmzB,iBAAmBnzB,KAAKuzB,OAClCW,EAAiB,aAAcl0B,KAAK0Y,UAAU,GAEzC1Y,KAAK6yB,mBACV7yB,KAAKo0B,kBAAoBC,YAAYr0B,KAAK0Y,SAAU1Y,KAAKgyB,YAExDhyB,KAAKoL,QAAQuJ,OACd,OAAO3U,KAAKs0B,WAEpB7Y,KAAM,WACF,IAAI8Y,EAAsB3b,OAAO2b,qBAAuB,SAAUjE,EAAWjnB,GACzE,OAAOmrB,YAAY,KAAOlE,EAAWjnB,IAErCrJ,KAAK4yB,cACL2B,EAAoB,WAAYv0B,KAAK0Y,UAAU,GAE1C1Y,KAAKmzB,iBAAmBnzB,KAAKuzB,QAClCgB,EAAoB,aAAcv0B,KAAK0Y,UAAU,GAEjD1Y,KAAKuzB,SACLN,SAAShX,KAAKwY,YAAYz0B,KAAKuzB,QAC/BvzB,KAAKuzB,OAAS,MAEdvzB,KAAKo0B,mBACLM,cAAc10B,KAAKo0B,mBACvB5b,GAAQuZ,SAAU,GAEtBnB,MAAO,SAAUA,EAAO1pB,GACpBlH,KAAKyY,SAASnS,SAAUsqB,MAAOA,EAAO1pB,SAAUA,KAEpDwR,SAAU,SAAUlY,GAChB,IAAIm0B,EAAU30B,KAAK2yB,cAInB,GAHIgC,IAAY30B,KAAKgxB,UAAYhxB,KAAKuzB,SAClCoB,EAAU30B,KAAKwyB,QAAQxyB,KAAKuzB,OAAOQ,gBAEnCY,IAAY30B,KAAKgxB,SACjB,OAAO,EACPhxB,KAAKuzB,QACLvzB,KAAKmxB,SAASwD,GAClB30B,KAAKs0B,WAETA,QAAS,SAAUtD,GACf,QAAKhxB,KAAKoyB,cAEVpB,EAAWhxB,KAAKgxB,SAAWhxB,KAAK2yB,YAAY3B,GACrC4D,OAAO50B,KAAKyY,SAAU,SAAUoG,GACnC,GAAIA,EAAQ+R,MAAMvoB,KAAK2oB,GAEnB,OADAnS,EAAQ3X,SAAS8pB,IACV,MAInBG,SAAU,SAAUH,EAAU5lB,GAC1B,IAAKoN,GAAQuZ,QACT,OAAO,EACN3mB,IAAuB,IAAZA,IACZA,GAAYc,UAAWd,IAC3B4lB,EAAWhxB,KAAK2yB,YAAY3B,GAAY,IACxC,IAAIvnB,EAAOzJ,KAAKyJ,KACC,KAAbunB,GAA0C,MAAvBA,EAAS0B,OAAO,KACnCjpB,EAAOA,EAAK7D,MAAM,GAAI,IAAM,KAEhC,IAAIivB,EAAMprB,EAAOunB,EAEjB,GADAA,EAAWhxB,KAAKqyB,eAAerB,EAASK,QAAQS,GAAc,KAC1D9xB,KAAKgxB,WAAaA,EAAtB,CAGA,GADAhxB,KAAKgxB,SAAWA,EACZhxB,KAAK4yB,cACL5yB,KAAK8Y,QAAQ1N,EAAQimB,QAAU,eAAiB,gBAAiB4B,SAAS6B,MAAOD,OAEhF,CAAA,IAAI70B,KAAK6yB,iBAYV,OAAO7yB,KAAK6Y,SAASrV,OAAOqxB,GAV5B,GADA70B,KAAK+0B,YAAY/0B,KAAK6Y,SAAUmY,EAAU5lB,EAAQimB,SAC9CrxB,KAAKuzB,QAAWvC,IAAahxB,KAAKwyB,QAAQxyB,KAAKuzB,OAAOQ,eAAiB,CACvE,IAAIH,EAAU5zB,KAAKuzB,OAAOQ,cACrB3oB,EAAQimB,UACTuC,EAAQX,SAASe,OACjBJ,EAAQX,SAASgB,SAErBj0B,KAAK+0B,YAAYnB,EAAQ/a,SAAUmY,EAAU5lB,EAAQimB,UAM7D,OAAIjmB,EAAQc,QACDlM,KAAKs0B,QAAQtD,QADxB,IAGJ+D,YAAa,SAAUlc,EAAUmY,EAAUK,GACvC,GAAIA,EAAS,CACT,IAAIkB,EAAO1Z,EAAS0Z,KAAKlB,QAAQ,qBAAsB,IACvDxY,EAASwY,QAAQkB,EAAO,IAAMvB,QAG9BnY,EAASrU,KAAO,IAAMwsB,KAIlC1B,GAASxW,QAAU,IAAIN,GYxVvB,IAAIwc,IACA30B,OAAU,OACVshB,OAAU,MACVsT,MAAS,QACTC,OAAU,SACV/M,KAAQ,OAERmH,IACAC,EAAGF,GAASE,EACZ4F,aAAc,SAAUppB,GACpB,IAAI3I,EAAImsB,EAAE6F,WAEV,OADAhyB,EAAEyH,OAAOkB,GACF3I,GAEXiyB,KAAM,SAAUjqB,GACZ,OAAOmkB,EAAE8F,KAAKxxB,MAAM0rB,EAAGhuB,YAE3B2X,KAKJ,SACctB,EAAQxG,EAAOhG,QACT,IAAZA,IAAsBA,MAC1B,IACIomB,GAAWnjB,KADJ2mB,GAAUpd,GACM0d,SAAU,QAChClqB,EAAQypB,MACTrD,EAAOqD,IAAMzE,SAAShf,EAAO,QAAUke,GAASiG,YAEhC,MAAhBnqB,EAAQ0W,OAAgB1Q,GAAqB,WAAXwG,GAAkC,WAAXA,GAAkC,UAAXA,IAChF4Z,EAAOgE,YAAc,mBACrBhE,EAAO1P,KAAOsC,KAAKC,UAAUjZ,EAAQ+B,OAASiE,EAAM6S,OAAO7Y,KAE3C,QAAhBomB,EAAOnjB,OACPmjB,EAAOiE,aAAc,GAEzB,IAAI1pB,EAAQX,EAAQW,MACpBX,EAAQW,MAAQ,SAAUkN,EAAKyc,EAAYC,GACvCvqB,EAAQsqB,WAAaA,EACrBtqB,EAAQuqB,YAAcA,EAClB5pB,GACAA,EAAMnL,KAAKwK,EAAQjE,QAAS8R,EAAKyc,EAAYC,IAErD,IAAI1c,EAAM7N,EAAQ6N,IAAMqW,GAAS+F,KAAKrd,SAASwZ,EAAQpmB,IAGvD,OAFAgG,EAAMlF,QAAQ,UAAWkF,EAAO6H,EAAK7N,GACrCgG,EAAMjH,YAAciH,EAAMjH,WAAW+B,QAAQ,UAAWkF,EAAO6H,EAAK7N,GAC7D6N,GA7BPsc,SAAU,WACN,MAAM,IAAIrqB,MAAM,oDXnBpBrJ,GAAWooB,EACX2L,GAAqBC,EAAmBle,IAAOxX,UAC/C21B,GAAkB,SAAUve,GAE5B,SAASue,IACL,OAAkB,OAAXve,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KA4D/D,OA9DAyX,EAAkBqe,EAAgBve,GAIlCue,EAAe31B,UAAUkS,QAAU,WAC3BrS,KAAKgZ,MAAQhZ,KAAKgZ,KAAKvO,OACvBzK,KAAKgZ,KAAKvO,QACd8M,EAAOpX,UAAUkS,QAAQzR,KAAKZ,OAElC81B,EAAe31B,UAAU00B,IAAM,WAAc,OAAO70B,KAAKoR,MAAMjR,UAAU41B,SAAW,IACpFD,EAAe31B,UAAU61B,YAAc,SAAU5qB,GAC7C,IAAIW,EACJ,GAAIX,EAAQkV,WAAavU,EAAQ/L,KAAKwiB,iBAElC,OADAxiB,KAAKkM,QAAQ,UAAWlM,KAAM+L,EAAOiM,UAAWwK,gBAAiBzW,GAASX,KACnE,GAGf0qB,EAAe31B,UAAUgiB,MAAQ,SAAU/W,GAEvC,IAAI6qB,GADJ7qB,EAAU4M,UAAWrE,OAAO,GAAQvI,IACd6qB,QAClB9rB,EAAanK,KAWjB,OAVAoL,EAAQ6qB,QAAU,SAAUvqB,GACxB,IAAIkM,EAASxM,EAAQ0hB,MAAQ,QAAU,MAEvC,GADA3iB,EAAWyN,GAAQlM,EAAMN,GACrBjB,EAAW6rB,YAAY5qB,GACvB,OAAO,EACP6qB,GACAA,EAAQr1B,KAAKwK,EAAQjE,QAASgD,EAAYuB,EAAMN,GACpDjB,EAAW+B,QAAQ,OAAQ/B,EAAYuB,EAAMN,IAEjDgO,GAAUpZ,KAAMoL,GACT2N,GAAM,OAAQ/Y,KAAMoL,IAE/B0qB,EAAe31B,UAAUE,OAAS,SAAU61B,EAAS9qB,GACjD,IAAIyM,EAAQ7X,UACI,IAAZoL,IAAsBA,MAC1B,IAAIgG,EAAQ8kB,aAAmBC,GAC3BD,EACAl2B,KAAKoR,MAAM/Q,OAAO61B,EAAS9qB,GAC/BgG,EAAMhH,SAAWgH,EAAMhH,OAASpK,MAChCoL,EAAQgrB,MAAQp2B,KAAK6sB,KAAKzb,GAAQhG,GAClC,IACI6qB,EAAU7qB,EAAQ6qB,QAQtB,OAPA7qB,EAAQ6qB,QAAU,SAAU7kB,EAAO1F,EAAM2qB,GACjCjrB,EAAQgrB,MACRve,EAAMgV,KAAKzb,GAAQvP,IAAW8R,OAAO,GAAS0iB,IAC9CJ,GACAA,EAAQr1B,KAAKy1B,EAAalvB,QAASiK,EAAO1F,EAAM2qB,IAExDjlB,EAAM2W,KAAK,KAAM3c,GACVgG,GAEX0kB,EAAe31B,UAAU+Y,KAAO,WAC5B,OAAOod,GAAKpd,KAAKrV,MAAM7D,KAAMuB,YAEjCu0B,EAAiBpe,GACb5S,GACIonB,YACI9D,QAAS,SAAUhX,GAASpR,KAAKqoB,OAAOjX,QAGjD0kB,IAELjM,IAGEsM,GAAa,SAAU5e,GAEvB,SAAS4e,IACL,OAAkB,OAAX5e,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KA4I/D,OA9IAyX,EAAkB0e,EAAW5e,GAI7B4e,EAAUh2B,UAAU61B,YAAc,SAAU5qB,GACxC,IAAIW,EACJ,GAAIX,EAAQkV,WAAavU,EAAQ/L,KAAKwiB,iBAElC,OADA7W,GAAiB3L,KAAM,UAAWA,KAAM+L,EAAOiM,UAAWwK,gBAAiBzW,GAASX,KAC7E,GAGf+qB,EAAUh2B,UAAUkS,QAAU,WACtBrS,KAAKgZ,MAAQhZ,KAAKgZ,KAAKvO,OACvBzK,KAAKgZ,KAAKvO,QACd8M,EAAOpX,UAAUkS,QAAQzR,KAAKZ,OAElCm2B,EAAUh2B,UAAUgiB,MAAQ,SAAU/W,GAElC,IAAIgG,EAAQpR,KACRi2B,GAFJ7qB,EAAU4M,UAAWrE,OAAO,GAAQvI,IAEd6qB,QAUtB,OATA7qB,EAAQ6qB,QAAU,SAAUM,GAExB,GADAnlB,EAAM+I,IAAIoc,EAAanrB,GACnBgG,EAAM4kB,YAAY5qB,GAClB,OAAO,EACP6qB,GACAA,EAAQr1B,KAAKwK,EAAQjE,QAASiK,EAAOmlB,EAAanrB,GACtDO,GAAiByF,EAAO,OAAQA,EAAOmlB,EAAanrB,IAExDgO,GAAUpZ,KAAMoL,GACT2N,GAAM,OAAQ/Y,KAAMoL,IAE/B+qB,EAAUh2B,UAAU+Y,KAAO,WACvB,OAAOod,GAAKpd,KAAKrV,MAAM7D,KAAMuB,YAEjC40B,EAAUh2B,UAAU4nB,KAAO,SAAU3mB,EAAK6gB,EAAKzO,GAC3C,IACIrG,EAAO6V,EADPnL,EAAQ7X,KAED,MAAPoB,GAA8B,iBAARA,GACtB+L,EAAQ/L,EACR4hB,EAAkBf,SAGjB9U,MAAY/L,GAAO6gB,EACpBe,EAAkBxP,OAEtB,IAAIpI,EAAU4M,UAAWsI,UAAU,EAAM3M,OAAO,GAAQqP,GAAkBoT,EAAOhrB,EAAQgrB,KAIzF,GAHIjpB,IAAUipB,GACVp2B,KAAKma,IAAIhN,EAAO6V,GAEhBhjB,KAAKg2B,YAAY5qB,GAGjB,OAFI+B,GAASipB,GACTp2B,KAAKma,IAAIhN,EAAO6V,GACbsT,GAAKnB,aAAan1B,KAAKwiB,iBAElC,IAAIpR,EAAQpR,KACRi2B,EAAU7qB,EAAQ6qB,QAClBvpB,EAAa1M,KAAK0M,WACtBtB,EAAQ6qB,QAAU,SAAUM,GAIxB,GAHAnlB,EAAM1E,WAAaA,EACf0pB,IACAG,EAAcve,YAAa7K,EAAOopB,IAClCA,IACAX,GAAmBzb,IAAIvZ,KAAKiX,EAAO0e,EAAanrB,GAC5CgG,EAAM4kB,YAAY5qB,IAClB,OAAO,EAEX6qB,GACAA,EAAQr1B,KAAKwK,EAAQjE,QAASiK,EAAOmlB,EAAanrB,GACtDO,GAAiByF,EAAO,OAAQA,EAAOmlB,EAAanrB,IAExDgO,GAAUpZ,KAAMoL,GACZ+B,GAASipB,IACTp2B,KAAK0M,WAAasL,YAAatL,EAAYS,IAC/C,IAAIyK,EAAS5X,KAAKioB,QAAU,SAAY7c,EAAQ6pB,MAAQ,QAAU,SACnD,UAAXrd,GAAuBxM,EAAQ+B,QAC/B/B,EAAQ+B,MAAQA,GACpB,IAAI8L,EAAMF,GAAMnB,EAAQ5X,KAAMoL,GAE9B,OADApL,KAAK0M,WAAaA,EACXuM,GAEXkd,EAAUh2B,UAAUioB,QAAU,SAAUhd,GAEpC,IAAIgG,EAAQpR,KACRi2B,GAFJ7qB,EAAUA,EAAUorB,QAAQprB,OAEN6qB,QAClBG,EAAOhrB,EAAQgrB,KACfhO,EAAU,WACVhX,EAAMwO,gBACNxO,EAAMlF,QAAQ,UAAWkF,EAAOA,EAAMjH,WAAYiB,IAEtDA,EAAQ6qB,QAAU,SAAUvqB,GACpB0qB,GACAhO,IACA6N,GACAA,EAAQr1B,KAAKwK,EAAQjE,QAASiK,EAAO1F,EAAMN,GAC1CgG,EAAM6W,SACPtc,GAAiByF,EAAO,OAAQA,EAAO1F,EAAMN,IAErD,IAAI6N,EAUJ,OATIjZ,KAAKioB,QACLwO,QAAQrrB,EAAQ6qB,UAGhB7c,GAAUpZ,KAAMoL,GAChB6N,EAAMF,GAAM,SAAU/Y,KAAMoL,IAE3BgrB,GACDhO,IACGnP,IAAO,GAElBkd,EAAUh2B,UAAU00B,IAAM,WACtB,IAAI6B,EAAOtG,SAASpwB,KAAM,YACtBowB,SAASpwB,KAAKmK,WAAY,QAC1BmsB,GAAKf,WACT,GAAIv1B,KAAKioB,QACL,OAAOyO,EACX,IAAI7jB,EAAK7S,KAAKgF,IAAIhF,KAAKiT,aACvB,OAAOyjB,EAAKrF,QAAQ,SAAU,OAASsF,mBAAmB9jB,IAE9DsjB,EAAUh2B,UAAUga,IAAM,SAAUpW,EAAGjE,EAAGwB,GACtC,MAAiB,iBAANyC,EACHzC,EACOiW,EAAOpX,UAAUga,IAAIvZ,KAAKZ,MAAOiG,KAASA,EAAGlC,GAAKjE,EAAGmG,GAAK3E,IAGjEtB,KAAK+D,GAAKjE,EACHE,MAIJuX,EAAOpX,UAAUga,IAAIvZ,KAAKZ,KAAM+D,EAAGjE,GAE9C,IAAImG,GAERkwB,EAAUtM,WAAaiM,GACvBK,EAAYze,GACR5S,GACIixB,QAAS,KAEbzwB,GACIywB,QAASjY,GAAWC,cAEzBoY,IAELxe,ICxNSif,IACPC,KAAM,WAEF,IAAK,IADD5qB,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAEzB,OAAO2P,OAAOjY,KAAMiM,IAExB6qB,OAAQ,SAAUxpB,GACd,OAAOypB,SAAS/2B,KAAKsN,KAEzB0pB,QAAS,SAAU7pB,GACf,QAAS8pB,WAAW9pB,EAAOnN,KAAlBi3B,CAAwBj3B,OAErCqD,KAAM,WAEF,IAAK,IADDgB,KACKiE,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpCjE,EAAKiE,GAAM/G,UAAU+G,GAEzB,OAAOtI,KAAKqiB,UAAU,SAAUlgB,EAAOf,GACnC,GAAIiD,EAAKxD,QAAQO,GAAO,EACpB,OAAOe,KAInB+0B,OAAQ,WACJ,IAAIC,KAEJ,OADAn3B,KAAKugB,KAAK,SAAUpe,EAAOf,GAAO,OAAO+1B,EAASh1B,GAASf,IACpD+1B,GAEXC,MAAO,WACH,OAAOp3B,KAAKqN,IAAI,SAAUlL,EAAOf,GAAO,OAAQA,EAAKe,MAEzDO,QAAS,WACL,OAAQ1C,KAAK0N,SAAS1M,QAE1Bq2B,MAAO,WACH,OAAOC,QAAQt3B,KAAKqiB,UAAU,SAAUjf,GAAK,OAAOA,OAGjDm0B,IACPC,MAAO,SAAUrqB,EAAOvJ,GACpB,OAAO5D,KAAK4D,EAAQ,OAAS,UAAUuJ,IAE3CsqB,UAAW,SAAUtqB,GACjB,OAAOnN,KAAKw3B,MAAMrqB,GAAO,KAGjCkM,GAAqBke,GAAiB,UAClChL,QAAS,EAAGhM,KAAM,EAAGlT,IAAK,EAAGqqB,QAAS,EAAGhT,OAAQ,EACjDiT,MAAO,EAAGC,OAAQ,EAAGC,YAAa,EAAGC,MAAO,EAAGtL,KAAM,EAAGuL,UAAW,EAAGC,cAAe,EAAGC,OAAQ,EAAGrN,OAAQ,EAC3GsN,OAAQ,EAAGrtB,OAAQ,EAAGtI,MAAO,EAAGoG,IAAK,EAAG/F,KAAM,EAAGu1B,IAAK,EAAGC,QAAS,EAAGC,SAAU,EAC/EC,SAAU,EAAGC,OAAQ,EAAGC,IAAK,EAAGC,IAAK,EAAGnhB,QAAS,EAAGohB,KAAM,EAAG90B,MAAO,EACpE0D,KAAM,EAAGqxB,KAAM,EAAGC,QAAS,EAAGC,KAAM,EAAGloB,KAAM,EAAGmoB,KAAM,EAAGnM,KAAM,EAC/DoM,QAAS,EAAGC,WAAY,EAAGn4B,QAAS,EAAGo4B,QAAS,EAAGC,YAAa,EAChEx2B,QAAS,EAAG20B,MAAO,EAAG8B,OAAQ,EAAGC,UAAW,EAAGC,QAAS,EAAGC,QAAS,EACpEC,OAAQ,EAAGC,QAAS,IWpDxB,IAAIC,GAAa,SAAUliB,GAEvB,SAASkiB,IACL,OAAkB,OAAXliB,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAQ/D,OAVAyX,EAAkBgiB,EAAWliB,GAI7BkiB,EAAY/hB,GACR5S,GACIkF,SAAUilB,GAAM9uB,UAAU6J,SAC1BhF,IAAKiqB,GAAM9uB,UAAU6E,OAE1By0B,IAELtD,IAEEuD,GAAa,SAAUniB,GAEvB,SAASmiB,IACL,IAAI7hB,EAAmB,OAAXN,GAAmBA,EAAO1T,MAAM7D,KAAMuB,YAAcvB,KAEhE,OADA6X,EAAM8hB,aACC9hB,EAyFX,OA7FAJ,EAAkBiiB,EAAWniB,GAM7BmiB,EAAUv5B,UAAUqK,WAAa,WAC7B,IAAIqN,EAAQ7X,KACZA,KAAKugB,KAAK,SAAU0P,EAASjuB,GACzB,GAAKiuB,EAAL,CAEAA,EAAQf,MAAQrX,EAChB,IAAIsK,EAAQ8N,EAAQ9N,MACpB,GAAIA,EAAO,CACP,IAAIyX,EAAS/hB,EACboY,EAAQ9N,MAAQ,WACZ,OAAOyX,EAAOD,UAAU33B,GAAQmgB,EAAMte,MAAM7D,KAAMuB,YAGtD0uB,aAAmB6F,IAAkB7F,EAAQjvB,SAC7C6W,EAAM8hB,UAAU33B,IAAQ,OAIpC03B,EAAUv5B,UAAUgiB,MAAQ,WAExB,IAAK,IADDlW,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAGzB,IAAK,IADD2Q,KACKhT,EAAK,EAAG4zB,EADW5tB,EAAKjL,OAASiL,EAAOjM,KAAKqE,OACR4B,EAAK4zB,EAAc74B,OAAQiF,IAAM,CAC3E,IAAIiW,EAAS2d,EAAc5zB,GACvBqH,EAAOtN,KAAK0M,WAAWwP,GAC3B5O,GAAQA,EAAK6U,OAASlJ,EAAIpT,KAAKyH,EAAK6U,SAExC,IAAIoN,EAAIF,GAASE,EACjB,OAAOA,GAAKA,EAAEuK,MAAQvK,EAAEuK,KAAKj2B,MAAM0rB,EAAGtW,IAE1CygB,EAAUv5B,UAAU45B,UAAY,WAE5B,IAAK,IADD9tB,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAGzB,IAAK,IADD2Q,KACKhT,EAAK,EAAG+zB,EADwB/tB,EAAKjL,OAASiL,EAAOjM,KAAKqE,OACrB4B,EAAK+zB,EAAch5B,OAAQiF,IAAM,CAC3E,IAAIoW,EAAS2d,EAAc/zB,GACvBqH,EAHatN,KAGD0M,WAAW2P,GAC3BpD,EAAIpT,KAJa7F,KAIH25B,UAAUtd,IAAW/O,GAAQA,EAAK6U,OAAS7U,EAAK6U,SAElE,IAAIoN,EAAIF,GAASE,EACjB,OAAOA,GAAKA,EAAEuK,MAAQvK,EAAEuK,KAAKj2B,MAAM0rB,EAAGtW,IAE1CygB,EAAUv5B,UAAU2oB,MAAQ,WAExB,IAAK,IADD7c,KACK3D,EAAK,EAAGA,EAAK/G,UAAUP,OAAQsH,IACpC2D,EAAK3D,GAAM/G,UAAU+G,GAGzB,IAAK,IAAIrC,EAAK,EAAGg0B,EADChuB,EAAKjL,OAASiL,EAAOjM,KAAKqE,OACE4B,EAAKg0B,EAAcj5B,OAAQiF,IAAM,CAC3E,IAAI+B,EAASiyB,EAAch0B,GACvBgqB,EAAUjwB,KAAK0M,WAAW1E,GAC1BioB,aAAmB6F,GACnB7F,EAAQnD,QAEHmD,aAAmBhB,GACxBgB,EAAQnH,QAEHmH,aAAmBkG,IACxBlG,EAAQ9V,IAAI8V,EAAQpuB,YAExB7B,KAAK25B,UAAU3xB,IAAU,EAE7B,OAAOhI,MAEX05B,EAAU9c,SAAW,SAAUtX,EAAaV,GACxC,IAAI8H,EAAapH,EAAYzD,UAAYyD,EAAYoH,WACrD+M,OAAO/M,EAAY,SAAUwtB,EAAMl4B,GAC3Bk4B,EAAKrrB,MACLnC,EAAW1K,GAAQk4B,EAAKrrB,IACnBsL,IAAI,SAAUhY,GACf,IAAKA,IAAUA,EAAMnB,OAAQ,EACVhB,KAAK25B,YAAc35B,KAAK25B,eAC9B33B,IAAQ,EAErB,OAAOG,OAInBg0B,GAAUvZ,SAAShc,KAAKZ,KAAMsF,EAAaV,IAE/C80B,EAAYhiB,GACR5S,GACD40B,IAELD,IV1GSh3B,GAAQ03B,GACfngB,GAAS5Z,OAAOC,OAAO+5B,GAAOnQ,GAC9B/Q,KAAQe,GAAaqc,GAAM,QAC3BnB,aAAgBlb,GAAaqc,GAAM,gBACnCjB,KAAQpb,GAAaqc,GAAM,QAC3Bxd,QAAWmB,GAAaoV,GAAU,WAClCH,MAASjV,GAAaogB,GAAW,UACjC9K,GACIvqB,IAAK,WAAc,OAAOqqB,GAASE,GACnCpV,IAAK,SAAUhY,GAASktB,GAASE,EAAI+G,GAAK/G,EAAIptB,KAEnDiY,IAAUiV,SAAUA,GAAU5sB,MAAOA,GAAOkV,MAAOwe,GAAWtM,WAAYiM,GAAgB4D,UAAWA,GAAWzK,MAAOwK,GAAW53B,SAAUA,KAAauY,GAAQiV,MAMpKtqB,GACYC,IAAIgV,GAAO/U,SAASyM,OAAOsI,GAAOiG,SAC9CjG,GAAOqF,UAAU7Z,OAAON,SAASmqB,GAASvX,KAAMuX,GAAShX,OAAQgX,GAAS7W,SAC1EwB,GAAOkL,OAAO1f,OAAOkM,OAAOklB,KAC5B5c,GAAOkL,OAAO2E,WAAWrkB,OAAOkM,OAAO6lB"}