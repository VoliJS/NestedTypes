{"version":3,"file":"index.js","sources":["../src/backbone.ts","../node_modules/tslib/tslib.es6.js","../src/sync.ts","../src/rest.ts","../node_modules/type-r/ext-types/src/dates.ts","../node_modules/type-r/ext-types/src/integer.ts","../node_modules/type-r/ext-types/src/url.ts","../node_modules/type-r/ext-types/src/ip.ts","../node_modules/type-r/ext-types/src/email.ts","../node_modules/type-r/globals/src/index.ts","../src/rest-store.ts","../src/underscore-mixin.ts","../src/index.ts"],"sourcesContent":["/*******\n * Backbone Backward compatibility shim for View, Router, and History.\n * Based on 1.2.3, converted to browser-only ES6 modules thing. \n */\n\n//     Backbone.js 1.2.3\n//     (c) 2010-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Backbone may be freely distributed under the MIT license.\nimport * as jQuery from 'jquery';\nimport * as _ from 'underscore';\n\n// Initial Setup\n// -------------\ndeclare global {\n    interface Window {\n      Backbone : any\n    }\n\n    function attachEvent( a, b );\n    function detachEvent( a, b );\n}\n\n// Save the previous value of the `Backbone` variable, so that it can be\n// restored later on, if `noConflict` is used.\nconst previousBackbone = window.Backbone;\n\n// Create a local reference to a common array method we'll want to use later.\nconst slice = Array.prototype.slice;\n\n// For Backbone's purposes, jQuery, Zepto, Ender, or My Library (kidding) owns\n// the `$` variable.\nconst exported = {\n  $ : jQuery,\n  history : null,\n  VERSION : '1.2.3',\n  View, History, Router, noConflict\n}\n\nexport default exported;\n\n// Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable\n// to its previous owner. Returns a reference to this Backbone object.\nfunction noConflict() {\n  window.Backbone = previousBackbone;\n  return this;\n};\n\n// Backbone.View\n// -------------\n\n// Backbone Views are almost more convention than they are actual code. A View\n// is simply a JavaScript object that represents a logical chunk of UI in the\n// DOM. This might be a single item, an entire list, a sidebar or panel, or\n// even the surrounding frame which wraps your whole app. Defining a chunk of\n// UI as a **View** allows you to define your DOM events declaratively, without\n// having to worry about render order ... and makes it easy for the view to\n// react to specific changes in the state of your models.\n\n// Creating a Backbone.View creates its initial element outside of the DOM,\n// if an existing element is not provided...\nexport function View(options) {\n  this.cid = _.uniqueId('view');\n  options || (options = {});\n  _.extend(this, _.pick(options, viewOptions));\n  this._ensureElement();\n  this.initialize.apply(this, arguments);\n  this.delegateEvents();\n};\n\n// Cached regex to split keys for `delegate`.\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\n// List of view options to be merged as properties.\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n\n// Set up all inheritable **Backbone.View** properties and methods.\n_.extend(View.prototype, {\n\n  // The default `tagName` of a View's element is `\"div\"`.\n  tagName: 'div',\n\n  // jQuery delegate for element lookup, scoped to DOM elements within the\n  // current view. This should be preferred to global lookups where possible.\n  $: function (selector) {\n    return this.$el.find(selector);\n  },\n\n  // Initialize is an empty function by default. Override it with your own\n  // initialization logic.\n  initialize: function () { },\n\n  // **render** is the core function that your view should override, in order\n  // to populate its element (`this.el`), with the appropriate HTML. The\n  // convention is for **render** to always return `this`.\n  render: function () {\n    return this;\n  },\n\n  // Remove this view by taking the element out of the DOM, and removing any\n  // applicable Backbone.Events listeners.\n  remove: function () {\n    this.$el.remove();\n    this.stopListening();\n    return this;\n  },\n\n  // Change the view's element (`this.el` property), including event\n  // re-delegation.\n  setElement: function (element, delegate) {\n    if (this.$el) this.undelegateEvents();\n    this.$el = element instanceof exported.$ ? element : exported.$(element);\n    this.el = this.$el[0];\n    if (delegate !== false) this.delegateEvents();\n    return this;\n  },\n\n  // Set callbacks, where `this.events` is a hash of\n  //\n  // *{\"event selector\": \"callback\"}*\n  //\n  //     {\n  //       'mousedown .title':  'edit',\n  //       'click .button':     'save',\n  //       'click .open':       function(e) { ... }\n  //     }\n  //\n  // pairs. Callbacks will be bound to the view, with `this` set properly.\n  // Uses event delegation for efficiency.\n  // Omitting the selector binds the event to `this.el`.\n  // This only works for delegate-able events: not `focus`, `blur`, and\n  // not `change`, `submit`, and `reset` in Internet Explorer.\n  delegateEvents: function (events) {\n    if (!(events || (events = _.result(this, 'events')))) return this;\n    this.undelegateEvents();\n    for (var key in events) {\n      var method = events[key];\n      if (!_.isFunction(method)) method = this[events[key]];\n      if (!method) continue;\n\n      var match = key.match(delegateEventSplitter);\n      var eventName = match[1], selector = match[2];\n      method = _.bind(method, this);\n      eventName += '.delegateEvents' + this.cid;\n      if (selector === '') {\n        this.$el.on(eventName, method);\n      } else {\n        this.$el.on(eventName, selector, method);\n      }\n    }\n    return this;\n  },\n\n  // Clears all callbacks previously bound to the view with `delegateEvents`.\n  // You usually don't need to use this, but may wish to if you have multiple\n  // Backbone views attached to the same DOM element.\n  undelegateEvents: function () {\n    this.$el.off('.delegateEvents' + this.cid);\n    return this;\n  },\n\n  // Ensure that the View has a DOM element to render into.\n  // If `this.el` is a string, pass it through `$()`, take the first\n  // matching element, and re-assign it to `el`. Otherwise, create\n  // an element from the `id`, `className` and `tagName` properties.\n  _ensureElement: function () {\n    if (!this.el) {\n      var attrs = _.extend({}, _.result(this, 'attributes'));\n      if (this.id) attrs.id = _.result(this, 'id');\n      if (this.className) attrs['class'] = _.result(this, 'className');\n      var $el = exported.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n      this.setElement($el, false);\n    } else {\n      this.setElement(_.result(this, 'el'), false);\n    }\n  }\n\n});\n\n// Backbone.Router\n// ---------------\n\n// Routers map faux-URLs to actions, and fire events when routes are\n// matched. Creating a new one sets its `routes` hash, if not set statically.\nexport function Router(options) {\n  options || (options = {});\n  if (options.routes) this.routes = options.routes;\n  this._bindRoutes();\n  this.initialize.apply(this, arguments);\n}\n\n// Cached regular expressions for matching named param parts and splatted\n// parts of route strings.\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam = /(\\(\\?)?:\\w+/g;\nvar splatParam = /\\*\\w+/g;\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n// Set up all inheritable **Backbone.Router** properties and methods.\n_.extend(Router.prototype, {\n\n  // Initialize is an empty function by default. Override it with your own\n  // initialization logic.\n  initialize: function () { },\n\n  // Manually bind a single named route to a callback. For example:\n  //\n  //     this.route('search/:query/p:num', 'search', function(query, num) {\n  //       ...\n  //     });\n  //\n  route: function (route, name, callback) {\n    if (!_.isRegExp(route)) route = this._routeToRegExp(route);\n    if (_.isFunction(name)) {\n      callback = name;\n      name = '';\n    }\n    if (!callback) callback = this[name];\n    var router = this;\n    exported.history.route(route, function (fragment) {\n      var args = router._extractParameters(route, fragment);\n      if (router.execute(callback, args, name) !== false) {\n        router.trigger.apply(router, ['route:' + name].concat(args));\n        router.trigger('route', name, args);\n        exported.history.trigger('route', router, name, args);\n      }\n    });\n    return this;\n  },\n\n  // Execute a route handler with the provided parameters.  This is an\n  // excellent place to do pre-route setup or post-route cleanup.\n  execute: function (callback, args, name) {\n    if (callback) callback.apply(this, args);\n  },\n\n  // Simple proxy to `Backbone.history` to save a fragment into the history.\n  navigate: function (fragment, options) {\n    exported.history.navigate(fragment, options);\n    return this;\n  },\n\n  // Bind all defined routes to `Backbone.history`. We have to reverse the\n  // order of the routes here to support behavior where the most general\n  // routes can be defined at the bottom of the route map.\n  _bindRoutes: function () {\n    if (!this.routes) return;\n    this.routes = _.result(this, 'routes');\n    var route, routes = _.keys(this.routes);\n    while ((route = routes.pop()) != null) {\n      this.route(route, this.routes[route]);\n    }\n  },\n\n  // Convert a route string into a regular expression, suitable for matching\n  // against the current location hash.\n  _routeToRegExp: function (route) {\n    route = route.replace(escapeRegExp, '\\\\$&')\n      .replace(optionalParam, '(?:$1)?')\n      .replace(namedParam, function (match, optional) {\n        return optional ? match : '([^/?]+)';\n      })\n      .replace(splatParam, '([^?]*?)');\n    return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n  },\n\n  // Given a route, and a URL fragment that it matches, return the array of\n  // extracted decoded parameters. Empty or unmatched parameters will be\n  // treated as `null` to normalize cross-browser behavior.\n  _extractParameters: function (route, fragment) {\n    var params = route.exec(fragment).slice(1);\n    return _.map(params, function (param, i) {\n      // Don't decode the search params.\n      if (i === params.length - 1) return param || null;\n      return param ? decodeURIComponent(param) : null;\n    });\n  }\n\n});\n\n// Backbone.History\n// ----------------\n\n// Handles cross-browser history management, based on either\n// [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n// [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n// and URL fragments. If the browser supports neither (old IE, natch),\n// falls back to polling.\nexport function History() {\n  this.handlers = [];\n  this.checkUrl = _.bind(this.checkUrl, this);\n\n  // Ensure that `History` can be used outside of the browser.\n  if (typeof window !== 'undefined') {\n    this.location = window.location;\n    this.history = window.history;\n  }\n};\n\n// Cached regex for stripping a leading hash/slash and trailing space.\nvar routeStripper = /^[#\\/]|\\s+$/g;\n\n// Cached regex for stripping leading and trailing slashes.\nvar rootStripper = /^\\/+|\\/+$/g;\n\n// Cached regex for stripping urls of hash.\nvar pathStripper = /#.*$/;\n\n// Has the history handling already been started?\n(History as any).started = false;\n\n// Set up all inheritable **Backbone.History** properties and methods.\n_.extend(History.prototype, {\n\n  // The default interval to poll for hash changes, if necessary, is\n  // twenty times a second.\n  interval: 50,\n\n  // Are we at the app root?\n  atRoot: function () {\n    var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n    return path === this.root && !this.getSearch();\n  },\n\n  // Does the pathname match the root?\n  matchRoot: function () {\n    var path = this.decodeFragment(this.location.pathname);\n    var root = path.slice(0, this.root.length - 1) + '/';\n    return root === this.root;\n  },\n  // Unicode characters in `location.pathname` are percent encoded so they're\n  // decoded for comparison. `%25` should not be decoded since it may be part\n  // of an encoded parameter.\n  decodeFragment: function (fragment) {\n    return decodeURI(fragment.replace(/%25/g, '%2525'));\n  },\n  // In IE6, the hash fragment and search params are incorrect if the\n  // fragment contains `?`.\n  getSearch: function () {\n    var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n    return match ? match[0] : '';\n  },\n  // Gets the true hash value. Cannot use location.hash directly due to bug\n  // in Firefox where location.hash will always be decoded.\n  getHash: function (window) {\n    var match = (window || this).location.href.match(/#(.*)$/);\n    return match ? match[1] : '';\n  },\n\n  // Get the pathname and search params, without the root.\n  getPath: function () {\n    var path = this.decodeFragment(\n      this.location.pathname + this.getSearch()\n    ).slice(this.root.length - 1);\n    return path.charAt(0) === '/' ? path.slice(1) : path;\n  },\n\n  // Get the cross-browser normalized URL fragment from the path or hash.\n  getFragment: function (fragment) {\n    if (fragment == null) {\n      if (this._usePushState || !this._wantsHashChange) {\n        fragment = this.getPath();\n      } else {\n        fragment = this.getHash();\n      }\n    }\n    return fragment.replace(routeStripper, '');\n  },\n\n  // Start the hash change handling, returning `true` if the current URL matches\n  // an existing route, and `false` otherwise.\n  start: function (options) {\n    if ((History as any).started) throw new Error('Backbone.history has already been started');\n    (History as any).started = true;\n\n    // Figure out the initial configuration. Do we need an iframe?\n    // Is pushState desired ... is it available?\n    this.options = _.extend({ root: '/' }, this.options, options);\n    this.root = this.options.root;\n    this._wantsHashChange = this.options.hashChange !== false;\n    this._hasHashChange = 'onhashchange' in window && ((document as any).documentMode === void 0 || (document as any).documentMode > 7);\n    this._useHashChange = this._wantsHashChange && this._hasHashChange;\n    this._wantsPushState = !!this.options.pushState;\n    this._hasPushState = !!(this.history && this.history.pushState);\n    this._usePushState = this._wantsPushState && this._hasPushState;\n    this.fragment = this.getFragment();\n\n    // Normalize root to always include a leading and trailing slash.\n    this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n\n\n\n    // Transition from hashChange to pushState or vice versa if both are\n    // requested.\n    if (this._wantsHashChange && this._wantsPushState) {\n\n      // If we've started off with a route from a `pushState`-enabled\n      // browser, but we're currently in a browser that doesn't support it...\n      if (!this._hasPushState && !this.atRoot()) {\n        var root = this.root.slice(0, -1) || '/';\n        this.location.replace(root + '#' + this.getPath());\n        // Return immediately as browser will do redirect to new url\n        return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n      } else if (this._hasPushState && this.atRoot()) {\n        this.navigate(this.getHash(), { replace: true });\n      }\n\n    }\n\n    // Proxy an iframe to handle location events if the browser doesn't\n    // support the `hashchange` event, HTML5 history, or the user wants\n    // `hashChange` but not `pushState`.\n    if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n      this.iframe = document.createElement('iframe');\n      this.iframe.src = 'javascript:0';\n      this.iframe.style.display = 'none';\n      this.iframe.tabIndex = -1;\n      var body = document.body;\n      // Using `appendChild` will throw on IE < 9 if the document is not ready.\n      var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n      iWindow.document.open();\n      iWindow.document.close();\n      iWindow.location.hash = '#' + this.fragment;\n    }\n\n    // Add a cross-platform `addEventListener` shim for older browsers.\n    var addEventListener = window.addEventListener || function (eventName, listener) {\n      return attachEvent('on' + eventName, listener);\n    };\n    // Depending on whether we're using pushState or hashes, and whether\n    // 'onhashchange' is supported, determine how we check the URL state.\n    if (this._usePushState) {\n      addEventListener('popstate', this.checkUrl, false);\n    } else if (this._useHashChange && !this.iframe) {\n      addEventListener('hashchange', this.checkUrl, false);\n    } else if (this._wantsHashChange) {\n      this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n    }\n    if (!this.options.silent) return this.loadUrl();\n  },\n\n  // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n  // but possibly useful for unit testing Routers.\n  stop: function () {\n    // Add a cross-platform `removeEventListener` shim for older browsers.\n    var removeEventListener = window.removeEventListener || function (eventName, listener) {\n      return detachEvent('on' + eventName, listener);\n    };\n    // Remove window listeners.\n    if (this._usePushState) {\n      removeEventListener('popstate', this.checkUrl, false);\n    } else if (this._useHashChange && !this.iframe) {\n      removeEventListener('hashchange', this.checkUrl, false);\n    }\n    // Clean up the iframe if necessary.\n    if (this.iframe) {\n      document.body.removeChild(this.iframe);\n      this.iframe = null;\n    }\n    // Some environments will throw when clearing an undefined interval.\n    if (this._checkUrlInterval) clearInterval(this._checkUrlInterval);\n    (History as any).started = false;\n  },\n\n  // Add a route to be tested when the fragment changes. Routes added later\n  // may override previous routes.\n  route: function (route, callback) {\n    this.handlers.unshift({ route: route, callback: callback });\n  },\n\n  // Checks the current URL to see if it has changed, and if it has,\n  // calls `loadUrl`, normalizing across the hidden iframe.\n  checkUrl: function (e) {\n    var current = this.getFragment();\n    // If the user pressed the back button, the iframe's hash will have\n    // changed and we should use that for comparison.\n    if (current === this.fragment && this.iframe) {\n      current = this.getHash(this.iframe.contentWindow);\n    }\n    if (current === this.fragment) return false;\n    if (this.iframe) this.navigate(current);\n    this.loadUrl();\n  },\n\n  // Attempt to load the current URL fragment. If a route succeeds with a\n  // match, returns `true`. If no defined routes matches the fragment,\n  // returns `false`.\n  loadUrl: function (fragment) {\n    // If the root doesn't match, no routes can match either.\n    if (!this.matchRoot()) return false;\n    fragment = this.fragment = this.getFragment(fragment);\n    return _.some(this.handlers, function (handler) {\n      if (handler.route.test(fragment)) {\n        handler.callback(fragment);\n        return true;\n      }\n    });\n  },\n\n  // Save a fragment into the hash history, or replace the URL state if the\n  // 'replace' option is passed. You are responsible for properly URL-encoding\n  // the fragment in advance.\n  //\n  // The options object can contain `trigger: true` if you wish to have the\n  // route callback be fired (not usually desirable), or `replace: true`, if\n  // you wish to modify the current URL without adding an entry to the history.\n  navigate: function (fragment, options) {\n    if (!(History as any).started) return false;\n    if (!options || options === true) options = { trigger: !!options };\n\n    // Normalize the fragment.\n    fragment = this.getFragment(fragment || '');\n\n    // Don't include a trailing slash on the root.\n    var root = this.root;\n    if (fragment === '' || fragment.charAt(0) === '?') {\n      root = root.slice(0, -1) || '/';\n    }\n    var url = root + fragment;\n    // Strip the hash and decode for matching.\n    fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n\n    if (this.fragment === fragment) return;\n    this.fragment = fragment;\n\n\n    // If pushState is available, we use it to set the fragment as a real URL.\n    if (this._usePushState) {\n      this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n    } else if (this._wantsHashChange) {\n      this._updateHash(this.location, fragment, options.replace);\n      if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n        var iWindow = this.iframe.contentWindow;\n        // Opening and closing the iframe tricks IE7 and earlier to push a\n        // history entry on hash-tag change.  When replace is true, we don't\n        // want this.\n        if (!options.replace) {\n          iWindow.document.open();\n          iWindow.document.close();\n        }\n\n        this._updateHash(iWindow.location, fragment, options.replace);\n      }\n\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n    } else {\n      return this.location.assign(url);\n    }\n    if (options.trigger) return this.loadUrl(fragment);\n  },\n\n  // Update the hash location, either replacing the current entry, or adding\n  // a new one to the browser history.\n  _updateHash: function (location, fragment, replace) {\n    if (replace) {\n      var href = location.href.replace(/(javascript:|#).*$/, '');\n      location.replace(href + '#' + fragment);\n    } else {\n      // Some browsers require that `hash` contains a leading #.\n      location.hash = '#' + fragment;\n    }\n  }\n\n});\n\n// Create the default Backbone.history.\nexported.history = new History;\n\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/**\n * Backbone.js 1.2.3 REST implementation\n * (c) 2010-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n * Backbone may be freely distributed under the MIT license.\n *\n * With validation patches - NestedTypes validation semantic is applied. (c) Vlad Balin, 2015.\n */\nimport * as _ from 'underscore';\nimport Backbone from './backbone';\n\nexport type LazyValue< T > = () => T | T;\n\n// Map from CRUD to HTTP for our default `Backbone.sync` implementation.\nexport type Method = 'create' | 'update' | 'patch' | 'delete' | 'read'    \n\nexport interface Restful {\n    trigger( event : string, model, xhr, options )\n    collection? : { trigger( event : string, model, xhr, options ) }\n    toJSON( options : any ) : {}\n    _xhr : JQueryXHR\n    sync( method : string, object : Restful, options : SyncOptions )\n}\n\nexport interface SyncOptions {\n    url? : LazyValue< string >\n    data? : any\n    attrs? : {}\n    beforeSend? : ( xhr ) => any\n\n    success? : ( resp : any ) => void\n    error? : ( xhr?, textStatus?, errorThrown? ) => void\n\n    textStatus? : string\n    errorThrown? : any\n    xhr? : any\n    context? : {}\n}\n\nconst methodMap = {\n    'create' : 'POST',\n    'update' : 'PUT',\n    'patch'  : 'PATCH',\n    'delete' : 'DELETE',\n    'read'   : 'GET'\n};\n\nconst exported = {\n    $ : Backbone.$,\n    \n    errorPromise : error => {\n        var x = $.Deferred();\n        x.reject( error );\n        return x;\n    },\n\n    // Set the default implementation of `Backbone.ajax` to proxy through to `$`.\n    // Override this if you'd like to use a different library.\n    ajax : function( options : {} ){\n        return $.ajax.apply( $, arguments );\n    },\n\n    sync,\n\n    // Throw an error when a URL is needed, and none is supplied.\n    urlError : function(){\n        throw new Error( 'A \"url\" property or function must be specified' );\n    }\n};\n\nexport default exported;\n\n    // Backbone.sync\n    // -------------\n\n    // Override this function to change the manner in which Backbone persists\n    // models to the server. You will be passed the type of request, and the\n    // model in question. By default, makes a RESTful Ajax request\n    // to the model's `url()`. Some possible customizations could be:\n    //\n    // * Use `setTimeout` to batch rapid-fire updates into a single request.\n    // * Send up the models as XML instead of JSON.\n    // * Persist models via WebSockets instead of Ajax.\n\nfunction sync( method : Method, model : Restful, options : SyncOptions = {} ) : JQueryXHR{\n    var type = methodMap[ method ];\n\n    // Default JSON-request options.\n    var params : any = { type : type, dataType : 'json' };\n\n    // Ensure that we have a URL.\n    if( !options.url ){\n        params.url = _.result( model, 'url' ) || exported.urlError();\n    }\n\n    // Ensure that we have the appropriate request data.\n    if( options.data == null && model && (method === 'create' || method === 'update' || method === 'patch') ){\n        params.contentType = 'application/json';\n        params.data        = JSON.stringify( options.attrs || model.toJSON( options ) );\n    }\n\n    // Don't process data on a non-GET request.\n    if( params.type !== 'GET' ){\n        params.processData = false;\n    }\n\n    // Pass along `textStatus` and `errorThrown` from jQuery.\n    var error     = options.error;\n    options.error = function( xhr, textStatus, errorThrown ){\n        options.textStatus  = textStatus;\n        options.errorThrown = errorThrown;\n        if( error ) error.call( options.context, xhr, textStatus, errorThrown );\n    };\n\n    // Make the request, allowing the user to override any Ajax options.\n    var xhr = options.xhr = exported.ajax( _.extend( params, options ) );\n    model.trigger( 'request', model, xhr, options );\n    model.collection && model.collection.trigger( 'request', model, xhr, options );\n    return xhr;\n}","import { Collection, define, definitions, mixinRules, Model, tools } from 'type-r';\nimport * as _ from 'underscore';\nimport Sync, { Restful, SyncOptions } from './sync';\n\nconst { defaults } = tools;\n\nexport interface RestOptions extends SyncOptions {\n    wait? : boolean\n    patch? : boolean\n    reset? : boolean\n    validate? : boolean\n}\n\n@define({\n    itemEvents : {\n        destroy( model ){ this.remove( model ); }\n    } \n})\nexport class RestCollection extends Collection<RestModel> implements Restful {\n    _xhr : JQueryXHR\n\n    dispose(){\n        if( this._xhr && this._xhr.abort ) this._xhr.abort();\n        super.dispose();\n    }\n\n    model : typeof RestModel\n    url() : string { return this.model.prototype.urlRoot || ''; }\n\n    _invalidate( options : { validate? : boolean } ) : boolean {\n        var error;\n        if( options.validate && ( error = this.validationError ) ){\n            this.trigger( 'invalid', this, error, _.extend( { validationError : error }, options ) );\n            return true;\n        }\n    }\n\n    // Fetch the default set of models for this collection, resetting the\n    // collection when they arrive. If `reset: true` is passed, the response\n    // data will be passed through the `reset` method instead of `set`.\n    fetch( options : RestOptions ) : any {\n        options         = _.extend( { parse : true }, options );\n        var success     = options.success;\n        var collection  = this;\n        options.success = function( resp ){\n            var method = options.reset ? 'reset' : 'set';\n            collection[ method ]( resp, options );\n            if( collection._invalidate( options ) ) return false;\n\n            if( success ) success.call( options.context, collection, resp, options );\n            collection.trigger( 'sync', collection, resp, options );\n        };\n\n        wrapError( this, options );\n        return _sync( 'read', this, options );\n    }\n\n    create( a_model, options : any = {} ) : RestModel {\n        const model : RestModel = a_model instanceof RestModel ?\n                                        a_model :\n                                        <any> this.model.create( a_model, options );\n\n        // Hack! For the situation when model instance is given, aquire it. \n        model._owner || ( model._owner = this );\n\n        options.wait || this.add([ model ], options );\n\n        var collection  = this;\n        var success     = options.success;\n        options.success = ( model, resp, callbackOpts ) =>{\n            if( options.wait ) this.add( [ model ], defaults({ parse : false }, callbackOpts ) );\n            if( success ) success.call( callbackOpts.context, model, resp, callbackOpts );\n        };\n\n        model.save( null, options );\n        return model;\n    }\n\n    // Proxy `Backbone.sync` by default -- but override this if you need\n    // custom syncing semantics for *this* particular model.\n    sync(){\n        return Sync.sync.apply( this, arguments );\n    }\n};\n\nconst modelProto = Model.prototype;\n\n@define({\n    urlRoot : ''\n})\n@definitions({\n    urlRoot : mixinRules.protoValue\n})\nexport class RestModel extends Model implements Restful {\n    static Collection : typeof Collection = RestCollection as any;\n    \n    _xhr : JQueryXHR\n\n    urlRoot : string\n\n    /** @private */\n    _invalidate( options : { validate? : boolean } ) : boolean {\n        var error;\n        if( options.validate && ( error = this.validationError ) ){\n            triggerAndBubble( this, 'invalid', this, error, _.extend( { validationError : error }, options ) );\n            return true;\n        }\n    }\n\n    dispose(){\n        if( this._xhr && this._xhr.abort ) this._xhr.abort();\n        super.dispose();\n    }\n\n    // Fetch the model from the server, merging the response with the model's\n    // local attributes. Any changed attributes will trigger a \"change\" event.\n    fetch( options? : RestOptions ) : any {\n        options         = _.extend( { parse : true }, options );\n        var model       = this;\n        var success     = options.success;\n        options.success = function( serverAttrs ){\n            model.set( serverAttrs, options );\n            if( model._invalidate( options ) ) return false;\n\n            if( success ) success.call( options.context, model, serverAttrs, options );\n            triggerAndBubble( model, 'sync', model, serverAttrs, options );\n        };\n\n        wrapError( this, options );\n        return _sync( 'read', this, options );\n    }\n\n    // Proxy `Backbone.sync` by default -- but override this if you need\n    // custom syncing semantics for *this* particular model.\n    sync( method : string, self : this, options : SyncOptions ) : any\n    sync() : JQueryXHR {\n        return Sync.sync.apply( this, arguments );\n    }\n\n    // Set a hash of model attributes, and sync the model to the server.\n    // If the server returns an attributes hash that differs, the model's\n    // state will be `set` again.\n    save( attrs? : {}, options? : RestOptions ) : any\n    save( key : string, value : any, options? : RestOptions ) : any\n    save( key, val, a_options? : RestOptions ) : any {\n        // Handle both `\"key\", value` and `{key: value}` -style arguments.\n        let attrs, originalOptions;\n\n        if( key == null || typeof key === 'object' ){\n            attrs   = key;\n            originalOptions = val || {};\n        }\n        else{\n            (attrs = {})[ key ] = val;\n            originalOptions = a_options || {};\n        }\n\n        const options = _.extend( { validate : true, parse : true }, originalOptions ),\n              wait = options.wait;\n\n        // If we're not waiting and attributes exist, save acts as\n        // `set(attr).save(null, opts)` with validation. Otherwise, check if\n        // the model will be valid when the attributes, if any, are set.\n        if( attrs && !wait ){\n            this.set( attrs, originalOptions );\n        }\n\n        if( this._invalidate( options ) ){\n            if( attrs && wait ) this.set( attrs, originalOptions );\n            return Sync.errorPromise( this.validationError );\n        }\n\n        // After a successful server-side save, the client is (optionally)\n        // updated with the server-side state.\n        var model       = this;\n        var success     = options.success;\n        var attributes  = this.attributes;\n        options.success = serverAttrs => {\n            // Ensure attributes are restored during synchronous saves.\n            model.attributes = attributes;\n            if( wait ) serverAttrs = _.extend( {}, attrs, serverAttrs );\n\n            if( serverAttrs ){\n                // When server sends string, polimorphyc Model set screws up.\n                modelProto.set.call( this, serverAttrs, options );\n                if( model._invalidate( options ) ) return false;\n            }\n\n            if( success ) success.call( options.context, model, serverAttrs, options );\n            triggerAndBubble( model, 'sync', model, serverAttrs, options );\n        };\n\n        wrapError( this, options );\n\n        // Set temporary attributes if `{wait: true}` to properly find new ids.\n        if( attrs && wait ) this.attributes = _.extend( {}, attributes, attrs );\n\n        var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n        if( method === 'patch' && !options.attrs ) options.attrs = attrs;\n        var xhr = _sync( method, this, options );\n\n        // Restore attributes.\n        this.attributes = attributes;\n\n        return xhr;\n    }\n\n    // Destroy this model on the server if it was already persisted.\n    // Optimistically removes the model from its collection, if it has one.\n    // If `wait: true` is passed, waits for the server to respond before removal.\n    destroy( options : RestOptions ) : any {\n        options     = options ? _.clone( options ) : {};\n        var model   = this;\n        var success = options.success;\n        var wait    = options.wait;\n\n        var destroy = function(){\n            model.stopListening(); // TBD: figure out whenever we need to dispose the model.\n            model.trigger( 'destroy', model, model.collection, options );\n        };\n\n        options.success = function( resp ){\n            if( wait ) destroy();\n            if( success ) success.call( options.context, model, resp, options );\n            if( !model.isNew() ) triggerAndBubble( model, 'sync', model, resp, options );\n        };\n\n        var xhr : JQueryXHR;\n\n        if( this.isNew() ){\n            _.defer( options.success );\n        }\n        else{\n            wrapError( this, options );\n            xhr = _sync( 'delete', this, options );\n        }\n\n        if( !wait ) destroy();\n        \n        return xhr || false;\n    }\n\n    // Default URL for the model's representation on the server -- if you're\n    // using Backbone's restful methods, override this to change the endpoint\n    // that will be called.\n    url() : string {\n        var base =\n                _.result( this, 'urlRoot' ) ||\n                _.result( this.collection, 'url' ) ||\n                Sync.urlError();\n\n        if( this.isNew() ) return base;\n\n        var id = this.get( this.idAttribute );\n\n        return base.replace( /[^\\/]$/, '$&/' ) + encodeURIComponent( id );\n    }\n\n    set( key : string, value : any, options? : object ) : this\n    set( attrs : {}, options? : object ) : this\n    set( a, b?, c? ) : this {\n        if( typeof a === 'string' ){\n            if( c ){\n                return <this> super.set({ [ a ] : b }, c );\n            }\n            else{\n                this[ a ] = b;\n                return this;\n            } \n        }\n        else{\n            return <this> super.set( a, b );\n        }\n    }\n}\n\nfunction _sync( method : string, _this : Restful, options ) : JQueryXHR {\n    // Abort and pending IO request. Just one is allowed at the time.\n    _this._xhr && _this._xhr.abort && _this._xhr.abort();\n    const xhr = _this._xhr = _this.sync( method, _this, options );\n    xhr && xhr.always && xhr.always( function(){ _this._xhr = void 0; });\n    return xhr;\n}\n\n// Wrap an optional error callback with a fallback error event.\nfunction wrapError( model : any, options : RestOptions ){\n    var error     = options.error;\n    options.error = function( resp ){\n        if( error ) error.call( options.context, model, resp, options );\n        triggerAndBubble( model, 'error', model, resp, options );\n    };\n}\n\nfunction triggerAndBubble( model : any, ...args : any[] ){\n    model.trigger.apply( model, args );\n    const { collection } = model;\n    collection && collection.trigger.apply( collection, args ); \n}","import {DateType, ChainableAttributeSpec, type} from \"type-r\";\n\nconst msDatePattern  = /\\/Date\\(([0-9]+)\\)\\//;\n\nexport class MicrosoftDateType extends DateType {\n    convert( next ) {\n        if( typeof next === 'string' ){\n            const msDate = msDatePattern.exec( next );\n            if( msDate ){\n                return new Date( Number( msDate[ 1 ] ) );\n            }\n        }\n\n        return DateType.prototype.convert.apply( this, arguments );\n    }\n\n    toJSON( value ) { return value && `/Date(${ value.getTime() })/`; }\n}\n\nexport const MicrosoftDate = new ChainableAttributeSpec({\n    type      : Date,\n    _metatype: MicrosoftDateType\n})\n\nexport const Timestamp = type( Date ).toJSON( x => x && x.getTime() );","import {NumericType} from \"type-r\";\n\nexport function Integer( x ) {\n    return x ? Math.round( x ) : 0;\n}\n\n(Integer as any)._metatype = NumericType;\n","import { AttributeCheck, ChainableAttributeSpec, type } from 'type-r';\n\nconst urlPattern = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\nexport function isUrl( x : string ) {\n    return !x || urlPattern.test( x );\n}\n\n(isUrl as AttributeCheck).error = 'Not valid URL'\n\nexport const Url : ChainableAttributeSpec = type( String ).check( isUrl );","import {type, ChainableAttributeSpec, AttributeCheck} from 'type-r'\n\nconst ipPattern = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n\nexport function isIPAddress( x : string ) {\n    return !x || ipPattern.test( x );\n}\n\n(isIPAddress as AttributeCheck).error = 'Not valid IP address'\n\nexport const IPAddress : ChainableAttributeSpec = type( String ).check( isIPAddress );","import { AttributeCheck, type } from 'type-r';\n\nconst emailPattern = /^[-a-z0-9~!$%^&*_=+}{\\'?]+(\\.[-a-z0-9~!$%^&*_=+}{\\'?]+)*@([a-z0-9_][-a-z0-9_]*(\\.[-a-z0-9_]+)*\\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}))(:[0-9]{1,5})?$/i;\n\nexport function isEmail( x : string ) {\n    return !x || !!x.match( emailPattern );\n}\n\n(isEmail as AttributeCheck).error = 'Not valid email';\n\nexport const Email = type( String ).check( isEmail );","import { Integer, MicrosoftDate, Timestamp } from \"type-r/ext-types\";\nimport { type, ChainableAttributeSpec } from \"type-r\";\n\n/*\n * dates\n */\ndeclare global {\n    // Legacy has-notation\n    interface Function{\n        value : ( x : any ) => ChainableAttributeSpec;\n        isRequired : ChainableAttributeSpec;\n        asProp : PropertyDecorator\n        has : ChainableAttributeSpec;\n    }\n\n    // Date type extensions\n    interface DateConstructor {\n        microsoft : ChainableAttributeSpec\n        timestamp : ChainableAttributeSpec\n    }\n\n    // Integer type\n    interface Window {\n        Integer : Function;\n    }\n\n    interface NumberConstructor {\n        integer : typeof Integer\n    }\n}\n\nFunction.prototype.value = function( x ) {\n    return new ChainableAttributeSpec( { type : this, value : x, hasCustomDefault : true } );\n};\n\nObject.defineProperty( Function.prototype, 'isRequired', {\n    get() { return this._isRequired || this.has.isRequired; },\n    set( x ){ this._isRequired = x; }\n});\n\nObject.defineProperty( Function.prototype, 'asProp', {\n    get() { return this.has.asProp; },\n});\n\nObject.defineProperty( Function.prototype, 'has', {\n    get() {\n        // workaround for sinon.js and other libraries overriding 'has'\n        return this._has || type( this );\n    },\n\n    set( value ) { this._has = value; }\n} );\n\n\nObject.defineProperties( Date, {\n    microsoft: {\n        value: MicrosoftDate\n    },\n\n    timestamp: {\n        value: Timestamp\n    }\n} );\n\n\n/*\n * integer\n */\n\nNumber.integer = Integer;\n\nif( typeof window !== 'undefined' ) {\n    window.Integer = Integer;\n}","import { define, Store } from 'type-r';\nimport \"type-r/globals\";\nimport * as _ from 'underscore';\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\n\n@define({\n    getStore : Store.prototype.getStore,\n    get : Store.prototype.get,\n})\nexport class RestStore extends RestModel {}\n\n@define\nexport class LazyStore extends RestStore {\n    _resolved  : {} = {}\n\n    initialize(){\n        this.forEach( ( element, name ) => {\n            if( !element ) return;\n\n            element.store = this;\n\n            var fetch = element.fetch;\n\n            if( fetch ){\n                const self = this;\n                element.fetch = function() {\n                    return self._resolved[ name ] = fetch.apply( this, arguments );\n                }\n            }\n\n            if( element instanceof RestCollection && element.length ){\n                this._resolved[name] = true;\n            }\n        });\n    }\n\n    // fetch specified items, or all items if called without arguments.\n    // returns jquery promise\n    fetch( ...args : any[] /* hack, inheritance here violates LSP */) : any {\n        var xhr         = [],\n            objsToFetch = args.length ? args : this.keys();\n\n        for( let name of objsToFetch ){\n            var attr = this.attributes[name];\n            attr && attr.fetch && xhr.push( attr.fetch() );\n        }\n\n        const { $ } = Backbone;\n        return $ && $.when && $.when.apply( $, xhr );\n    }\n\n    // fetch specified items, or all items if called without arguments.\n    // returns first jquery promise.\n    fetchOnce( ...args : string[] ) : JQueryXHR {\n        var xhr         = [],\n            self        = this,\n            objsToFetch = args.length ? args : this.keys();\n\n        for( let name of objsToFetch ){\n            var attr = self.attributes[ name ];\n            xhr.push( self._resolved[ name ] || attr && attr.fetch && attr.fetch());\n        }\n\n        const { $ } = Backbone;\n        return $ && $.when && $.when.apply( $, xhr );\n    }\n\n    clear( ...args : string[] ) : this {\n        var objsToClear = args.length ? args : this.keys();\n\n        for( let name of objsToClear ){\n            var element = this.attributes[ name ];\n\n            if( element instanceof RestCollection ){\n                element.reset();\n            }\n            else if( element instanceof Store ){\n                element.clear();\n            }\n            else if( element instanceof RestModel ){\n                element.set( element.defaults() )\n            }\n\n            this._resolved[ name ] = false;\n        }\n\n        return this;\n    }\n\n    static onDefine( definitions, BaseClass ){\n        var attributes = definitions.defaults || definitions.attributes;\n\n        // add automatic fetching on first element's access\n        _.each( attributes, ( Type : Function, name ) => {\n            if( Type.has ){\n                attributes[name] = Type.has\n                    .set( function( value ){\n                        if( !value || !value.length ){\n                            const resolved = this._resolved || ( this._resolved = {} ); \n                            resolved[name] = false;\n                        }\n                        \n                        return value;\n                    })\n            }  \n        });\n\n        RestModel.onDefine.call( this, definitions, BaseClass );\n    }\n} \n    ","import * as _ from 'underscore'\nimport { Model, tools } from 'type-r'\n\nexport const ModelMixin = {\n    pick( ...args : any[] ){\n        return _.pick( this, args );\n    },\n\n    values( this : Model ){\n        return this.keys().map( name => this[ name ] );\n    },\n\n    each: Model.prototype.forEach,\n\n    escape( attr ){\n        return _.escape( this[ attr ] );\n    },\n\n    matches( attrs ){\n        return !!_.iteratee( attrs, this )( this );\n    },\n\n    omit( ...keys : string[] ) : {} {\n        return this.mapObject( ( value, key ) => {\n            if( keys.indexOf( key ) < 0 ){\n                return value;\n            }\n        });\n    },\n\n    invert(){\n        const inverted = {};\n        this.each( ( value, key ) => inverted[ value ] = key );\n        return inverted;\n    },\n\n    pairs(){\n        return this.map( ( value, key ) => [ key, value ] );\n    },\n\n    isEmpty(){\n        return !this.values().length;\n    },\n\n    chain(){\n        return _.chain( this.mapObject( x => x ) );\n    }\n};\n\nexport const CollectionMixin = {\n    where(attrs, first) {\n        return this[first ? 'find' : 'filter'](attrs);\n    },\n\n    findWhere(attrs) {\n        return this.where(attrs, true);\n    }\n};\n\naddUnderscoreMethods( CollectionMixin, 'models', {\n    forEach  : 3, each : 3, map : 3, collect : 3, reduce : 4,\n    foldl    : 4, inject : 4, reduceRight : 4, foldr : 4, find : 3, findIndex : 3, findLastIndex : 3, detect : 3, filter : 3,\n    select   : 3, reject : 3, every : 3, all : 3, some : 3, any : 3, include : 3, includes : 3,\n    contains : 3, invoke : 0, max : 3, min : 3, toArray : 1, size : 1, first : 3,\n    head     : 3, take : 3, initial : 3, rest : 3, tail : 3, drop : 3, last : 3,\n    without  : 0, difference : 0, indexOf : 3, shuffle : 1, lastIndexOf : 3,\n    isEmpty  : 1, chain : 1, sample : 3, partition : 3, groupBy : 3, countBy : 3,\n    sortBy   : 3, indexBy : 3\n});\n\nfunction addUnderscoreMethods(Mixin, attribute, methods ) {\n    _.each(methods, function(length, method) {\n        if (_[method]) Mixin[method] = addMethod(length, method, attribute);\n    });\n}\n\n// Proxy Backbone class methods to Underscore functions, wrapping the model's\n// `attributes` object or collection's `models` array behind the scenes.\n//\n// collection.filter(function(model) { return model.get('age') > 10 });\n// collection.each(this.addView);\n//\n// `Function#apply` can be slow so we use the method's arg count, if we know it.\nfunction addMethod(length, method, attribute) {\n    switch (length) {\n        case 1: return function() {\n            return _[method](this[attribute]);\n        };\n        case 2: return function(value) {\n            return _[method](this[attribute], value);\n        };\n        case 3: return function(iteratee, context) {\n            var value = this[ attribute ],\n                callback = cb(iteratee, this);\n\n            return arguments.length > 1 ?\n                _[method]( value, callback, context)\n                : _[method]( value, callback );\n        };\n        case 4: return function(iteratee, defaultVal, context) {\n            var value = this[ attribute ],\n                callback = cb(iteratee, this);\n\n            return arguments.length > 1 ?\n                _[method]( value, callback, defaultVal, context )\n                : _[method](value, callback );\n        };\n        default: return function( ...args : any[] ) {\n            args.unshift(this[attribute]);\n            return _[method].apply(_, args);\n        };\n    }\n}\n\n// Support `collection.sortBy('attr')` and `collection.findWhere({id: 1})`.\nfunction cb(iteratee, instance) {\n    switch( typeof iteratee ){\n        case 'function' : return iteratee;\n        case 'string' : return model => model.get( iteratee );\n        case 'object' :\n            if( !(iteratee instanceof instance.model )) return _.matches( iteratee ); \n    }\n\n    return iteratee;\n}","/**\n * Extend Type-R namespace\n */\nimport * as TypeR from 'type-r';\nimport { MixinsState, Store as BaseStore, tools } from 'type-r';\n/**\n * Prepare backbone View, Router, History, and Events.\n */\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\nimport { LazyStore, RestStore } from './rest-store';\nimport Sync from './sync';\nimport { CollectionMixin, ModelMixin } from './underscore-mixin';\nexport * from 'type-r';\nexport * from './backbone';\nexport { Backbone, RestStore, LazyStore, RestCollection as Collection, RestModel as Model };\n\n/**\n * Prepare  \n */\n\nexport const Class : typeof TypeR.Messenger = TypeR.Messenger;\n\nconst Nested : typeof TypeR & typeof Backbone = Object.create( TypeR, tools.defaults({\n        'sync'         : linkProperty( Sync, 'sync' ),\n        'errorPromise' : linkProperty( Sync, 'errorPromise' ),\n        'ajax'         : linkProperty( Sync, 'ajax' ),\n        'history'      : linkProperty( Backbone, 'history' ),\n        'store'        : linkProperty( BaseStore, 'global' ),\n        '$' : {\n            get(){ return Backbone.$; },\n            set( value ){ (<any>Backbone).$ = (<any>Sync).$ = value; }\n        }\n    },\n    toProps( { Backbone, Class, Model : RestModel, Collection : RestCollection, LazyStore, Store : RestStore, defaults } ),\n    toProps( Backbone )\n));\n\nexport default Nested;\n\n\nexport function defaults( x ) : typeof Nested.Record {\n    return Nested.Model.defaults( x );\n}\n\n\nMixinsState.get( Nested.Mixable ).merge([ Nested.Events ]);\nNested.Messenger.mixins.populate( Backbone.View, Backbone.Router, Backbone.History );\nNested.Record.mixins.merge([ ModelMixin ]);\nNested.Record.Collection.mixins.merge([ CollectionMixin ]);\n\n/**\n * Local utilities\n */\nfunction linkProperty( Namespace, name ){\n    return {\n        get(){ return Namespace[ name ]; },\n        set( value ){ Namespace[ name ] = value; }\n    };\n}\n\nfunction toProps( obj ){\n    return tools.transform({}, obj, x => ({ value : x }) );\n} "],"names":["previousBackbone","window","Backbone","exported","$","jQuery","history","VERSION","View","History","Router","noConflict","this","options","cid","_.uniqueId","_.extend","_.pick","viewOptions","_ensureElement","initialize","apply","arguments","delegateEvents","delegateEventSplitter","routes","_bindRoutes","prototype","tagName","selector","$el","find","render","remove","stopListening","setElement","element","delegate","undelegateEvents","el","events","_.result","key","method","_.isFunction","match","eventName","_.bind","on","off","attrs","id","className","attr","optionalParam","namedParam","splatParam","escapeRegExp","handlers","checkUrl","location","route","name","callback","_.isRegExp","_routeToRegExp","router","fragment","args","_extractParameters","execute","trigger","concat","navigate","_.keys","pop","replace","optional","RegExp","params","exec","slice","_.map","param","i","length","decodeURIComponent","routeStripper","rootStripper","pathStripper","started","interval","atRoot","pathname","root","getSearch","matchRoot","decodeFragment","decodeURI","href","getHash","getPath","path","charAt","getFragment","_usePushState","_wantsHashChange","start","Error","hashChange","_hasHashChange","document","documentMode","_useHashChange","_wantsPushState","pushState","_hasPushState","iframe","createElement","src","style","display","tabIndex","body","iWindow","insertBefore","firstChild","contentWindow","open","close","hash","addEventListener","listener","attachEvent","_checkUrlInterval","setInterval","silent","loadUrl","stop","removeEventListener","detachEvent","removeChild","clearInterval","unshift","e","current","_.some","handler","test","url","title","assign","_updateHash","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","__decorate","decorators","target","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","methodMap","update","patch","delete","read","errorPromise","error","x","Deferred","reject","ajax","sync","model","type","dataType","urlError","data","contentType","JSON","stringify","toJSON","processData","xhr","textStatus","errorThrown","call","context","collection","defaults","tslib_1.__extends","RestCollection","_xhr","abort","_super","dispose","urlRoot","validate","validationError","success","parse","resp","reset","_invalidate","wrapError","_sync","a_model","RestModel","_owner","wait","add","callbackOpts","_this_1","save","Sync","define","itemEvents","destroy","Collection","modelProto","Model","triggerAndBubble","serverAttrs","set","val","a_options","originalOptions","attributes","isNew","_.clone","_.defer","base","get","idAttribute","encodeURIComponent","a","definitions","mixinRules","protoValue","_this","always","_i","msDatePattern","MicrosoftDateType","next","msDate","Date","Number","DateType","convert","value","getTime","MicrosoftDate","ChainableAttributeSpec","_metatype","Timestamp","Integer","Math","round","NumericType","urlPattern","isUrl","String","check","ipPattern","isIPAddress","emailPattern","isEmail","Function","hasCustomDefault","_isRequired","has","isRequired","asProp","_has","defineProperties","microsoft","timestamp","integer","Mixin","attribute","methods","RestStore","getStore","Store","LazyStore","forEach","store","fetch","self_1","_resolved","objsToFetch_1","keys","_a","name_1","push","when","objsToFetch_2","name_2","objsToClear_1","name_3","clear","BaseClass","_.each","Type","onDefine","ModelMixin","pick","values","map","each","escape","_.escape","matches","_.iteratee","omit","mapObject","indexOf","invert","inverted","pairs","isEmpty","chain","_.chain","CollectionMixin","where","first","findWhere","cb","iteratee","instance","_.matches","collect","reduce","foldl","inject","reduceRight","foldr","findIndex","findLastIndex","detect","filter","select","every","all","some","any","include","includes","contains","invoke","max","min","toArray","size","head","take","initial","rest","tail","drop","last","without","difference","shuffle","lastIndexOf","sample","partition","groupBy","countBy","sortBy","indexBy","_","defaultVal","addMethod","Class","TypeR.Messenger","Nested","TypeR","tools","linkProperty","BaseStore","toProps","Namespace","obj","transform","MixinsState","Mixable","merge","Events","Messenger","mixins","populate","Record"],"mappings":"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"}