{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../lib/type-r/object-plus/tools.js","../lib/type-r/object-plus/mixins.js","../lib/type-r/object-plus/eventsource.js","../lib/type-r/object-plus/events.js","../lib/type-r/traversable.js","../lib/type-r/io-tools.js","../lib/type-r/transactions.js","../lib/type-r/record/attributes/updates.js","../lib/type-r/record/attributes/any.js","../lib/type-r/record/attributes/attrDef.js","../lib/type-r/record/attributes/date.js","../lib/type-r/record/attributes/basic.js","../lib/type-r/record/attributes/index.js","../lib/type-r/record/index.js","../lib/type-r/collection/commons.js","../lib/type-r/collection/add.js","../lib/type-r/collection/set.js","../lib/type-r/collection/remove.js","../lib/type-r/collection/index.js","../lib/type-r/relations/commons.js","../lib/type-r/relations/subsetOf.js","../lib/type-r/index.js","../lib/backbone.js","../lib/rest.js","../lib/underscore-mixin.js","../lib/index.js","../lib/type-r/object-plus/index.js","../lib/type-r/validation.js","../lib/type-r/record/attributes/owned.js","../lib/type-r/record/attributes/shared.js","../lib/type-r/record/io-mixin.js","../lib/type-r/record/record.js","../lib/type-r/relations/from.js","../lib/type-r/relations/store.js","../lib/sync.js","../lib/rest-store.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nvar levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nvar toString = typeof window === 'undefined' ?\n    function toString(something) {\n        if (something && typeof something === 'object') {\n            var value = something.__inner_state__ || something, isTransactional = Boolean(something.__inner_state__), isArray = Array.isArray(value);\n            var keys_1 = Object.keys(value).join(', '), body = isArray ? \"[ length = \" + value.length + \" ]\" : \"{ \" + keys_1 + \" }\";\n            return something.constructor.name + ' ' + body;\n        }\n        return something;\n    } : function toString(x) { return x; };\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", toString(props[name_1]));\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\nvar HashProto = Object.create(null);\nHashProto.hasOwnProperty = ObjectProto.hasOwnProperty;\nexport function hashMap(obj) {\n    var hash = Object.create(HashProto);\n    return obj ? assign(hash, obj) : hash;\n}\n//# sourceMappingURL=tools.js.map","import * as tslib_1 from \"tslib\";\nimport { assign, hashMap, getBaseClass, defaults, transform } from './tools';\nimport { __extends } from 'tslib';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = tslib_1.__rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                tslib_1.__extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(hashMap(), rules, mixins.definitionRules);\n    };\n}\nexport function propertyListDecorator(listName) {\n    return function propList(proto, name) {\n        var list = proto.hasOwnProperty(listName) ?\n            proto[listName] : (proto[listName] = (proto[listName] || []).slice());\n        list.push(name);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || hashMap();\n        this.definitionRules = (mixins && mixins.definitionRules) || hashMap();\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = hashMap(), Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults(hashMap(), this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults(hashMap(), this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: hashMap({\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    }),\n    object: hashMap({\n        constructor: true\n    })\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.keys(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        ignore[name_2] || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","import * as tslib_1 from \"tslib\";\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = tslib_1.__decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|(store\\.[^.]+)|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^' || key === 'owner')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            if (key.indexOf('store.') === 0)\n                return \"getStore().get(\\\"\" + key.substr(6) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        this.resolve = new Function('self', \"\\n            var v = self.\" + path.shift() + \";\\n                           \\n            \" + path.map(function (x) { return \"\\n                v = v && v.\" + x + \";\\n            \"; }).join('') + \"\\n\\n            return v;\\n        \");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","export function getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\nexport function createIOPromise(initialize) {\n    var resolve, reject, onAbort;\n    function abort(fn) {\n        onAbort = fn;\n    }\n    var promise = new Promise(function (a_resolve, a_reject) {\n        reject = a_reject;\n        resolve = a_resolve;\n        initialize(resolve, reject, abort);\n    });\n    promise.abort = function () {\n        onAbort ? onAbort(resolve, reject) : reject(new Error(\"I/O Aborted\"));\n    };\n    return promise;\n}\nexport function startIO(self, promise, options, thenDo) {\n    abortIO(self);\n    options.ioUpdate = true;\n    self._ioPromise = promise\n        .then(function (resp) {\n        self._ioPromise = null;\n        var result = thenDo ? thenDo(resp) : resp;\n        triggerAndBubble(self, 'sync', self, resp, options);\n        return result;\n    })\n        .catch(function (err) {\n        self._ioPromise = null;\n        console.error(err);\n        triggerAndBubble(self, 'error', self, err, options);\n        throw err;\n    });\n    self._ioPromise.abort = promise.abort;\n    return self._ioPromise;\n}\nexport function abortIO(self) {\n    if (self._ioPromise && self._ioPromise.abort) {\n        self._ioPromise.abort();\n        self._ioPromise = null;\n    }\n}\nexport function triggerAndBubble(eventSource) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    eventSource.trigger.apply(eventSource, args);\n    var collection = eventSource.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=io-tools.js.map","import * as tslib_1 from \"tslib\";\nimport { Messenger, tools, mixins, mixinRules, definitions, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nimport { abortIO } from './io-tools';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onDefine = function (definitions, BaseClass) {\n        if (definitions.endpoint)\n            this.prototype._endpoint = definitions.endpoint;\n        Messenger.onDefine.call(this, definitions, BaseClass);\n    };\n    ;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        abortIO(this);\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        var _this = this;\n        this.transaction(function () {\n            _this.set(source.__inner_state__ || source, { merge: true });\n            var _changeToken = source._changeToken;\n            if (_changeToken) {\n                _this._changeToken = _changeToken;\n            }\n        });\n        return this;\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.hasPendingIO = function () { return this._ioPromise; };\n    Transactional.prototype.fetch = function (options) { throw new Error(\"Not implemented\"); };\n    Transactional.prototype.getEndpoint = function () {\n        return getOwnerEndpoint(this) || this._endpoint;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = tslib_1.__decorate([\n        define,\n        definitions({\n            endpoint: mixinRules.value\n        }),\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\nfunction getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\n//# sourceMappingURL=transactions.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n        var _a = this, doInit = _a.doInit, doUpdate = _a.doUpdate;\n        this.doInit = parse ? function (value, record, options) {\n            return doInit.call(this, options.parse && value != null ? parse.call(record, value, this.name) : value, record, options);\n        } : doInit;\n        this.doUpdate = parse ? function (value, record, options, nested) {\n            return doUpdate.call(this, options.parse && value != null ? parse.call(record, value, this.name) : value, record, options, nested);\n        } : doUpdate;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"as\", {\n        get: function () { return this.asProp; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.endpoint = function (endpoint) {\n        return this.metadata({ endpoint: endpoint });\n    };\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    ChainableAttributeSpec.from = function (spec) {\n        var attrSpec;\n        if (typeof spec === 'function') {\n            attrSpec = spec.has;\n        }\n        else if (spec && spec instanceof ChainableAttributeSpec) {\n            attrSpec = spec;\n        }\n        else {\n            var type_1 = inferType(spec);\n            if (type_1 && type_1.prototype instanceof Transactional) {\n                attrSpec = type_1.shared.value(spec);\n            }\n            else {\n                attrSpec = new ChainableAttributeSpec({ type: type_1, value: spec, hasCustomDefault: true });\n            }\n        }\n        return attrSpec;\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nexport function type(spec) {\n    return spec instanceof ChainableAttributeSpec ? spec : new ChainableAttributeSpec({\n        type: spec,\n        value: spec._attribute.defaultValue,\n        hasCustomDefault: spec._attribute.defaultValue !== void 0\n    });\n    ;\n}\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || type(this);\n    },\n    set: function (value) { this._has = value; }\n});\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    tslib_1.__extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    tslib_1.__extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    tslib_1.__extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    tslib_1.__extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    tslib_1.__extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    tslib_1.__extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    tslib_1.__extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    tslib_1.__extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    tslib_1.__extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.dispose = function () { };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","import * as tslib_1 from \"tslib\";\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return tslib_1.__assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }) }, localEventsMixin(myAttributes), { _endpoints: _.transform({}, allAttributes, function (attrDef) { return attrDef.options.endpoint; }) });\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(ChainableAttributeSpec.from(spec).options, name);\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile, { ChainableAttributeSpec } from './attributes';\nimport { Transactional } from '../transactions';\nimport { createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        tslib_1.__extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = tslib_1.__decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = tslib_1.__rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n    if (definition.endpoint)\n        this.Collection.prototype._endpoint = definition.endpoint;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return ChainableAttributeSpec.from(proto).asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id || id === 0) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id || id === 0) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove, options.unset);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove, unset) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model, unset);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","import * as tslib_1 from \"tslib\";\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nimport { startIO } from '../io-tools';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    tslib_1.__extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator !== void 0)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.forEach = function (iteratee, context) {\n        return this.each(iteratee, context);\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.liveUpdates = function (enabled) {\n        var _this = this;\n        if (enabled) {\n            this.liveUpdates(false);\n            var filter_1 = typeof enabled === 'function' ? enabled : function () { return true; };\n            this._liveUpdates = {\n                updated: function (json) {\n                    filter_1(json) && _this.add(json, { parse: true, merge: true });\n                },\n                removed: function (id) { return _this.remove(id); }\n            };\n            return this.getEndpoint().subscribe(this._liveUpdates, this).then(function () { return _this; });\n        }\n        else {\n            if (this._liveUpdates) {\n                this.getEndpoint().unsubscribe(this._liveUpdates, this);\n                this._liveUpdates = null;\n            }\n        }\n    };\n    Collection.prototype.fetch = function (a_options) {\n        var _this = this;\n        if (a_options === void 0) { a_options = {}; }\n        var options = tslib_1.__assign({ parse: true }, a_options), endpoint = this.getEndpoint();\n        return startIO(this, endpoint.list(options, this), options, function (json) {\n            var result = _this.set(json, tslib_1.__assign({ parse: true }, options));\n            if (options.liveUpdates) {\n                result = _this.liveUpdates(options.liveUpdates);\n            }\n            return result;\n        });\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        this.liveUpdates(false);\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = this.models;\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        else {\n            this._byId = {};\n            this.models = [];\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        var _byId = this._byId;\n        for (var _i = 0, previousModels_1 = previousModels; _i < previousModels_1.length; _i++) {\n            var toDispose = previousModels_1[_i];\n            _byId[toDispose.cid] || free(this, toDispose);\n        }\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, tslib_1.__assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        tslib_1.__extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            if (options === void 0) { options = {}; }\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd.slice();\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            if (options === void 0) { options = {}; }\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        Object.defineProperty(SubsetOfCollection.prototype, \"length\", {\n            get: function () {\n                return this.models.length || (this.refs ? this.refs.length : 0);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.refs = null;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs.slice();\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = tslib_1.__decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    SubsetOfCollection.prototype._itemEvents = void 0;\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements.slice();\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return elements ? (Array.isArray(elements) ? elements : [elements]) : [];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tslib_1 from \"tslib\";\nimport { tools } from './object-plus';\nObject.setPrototypeOf || (Object.setPrototypeOf = tools.defaults);\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nexport * from './transactions';\nexport * from './io-tools';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        tslib_1.__extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = tslib_1.__decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map","import * as _ from 'underscore';\nimport * as jQuery from 'jquery';\nvar previousBackbone = window.Backbone;\nvar slice = Array.prototype.slice;\nvar exported = {\n    $: jQuery,\n    history: null,\n    VERSION: '1.2.3',\n    View: View, History: History, Router: Router, noConflict: noConflict\n};\nexport default exported;\nfunction noConflict() {\n    window.Backbone = previousBackbone;\n    return this;\n}\n;\nexport function View(options) {\n    this.cid = _.uniqueId('view');\n    options || (options = {});\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n    this.delegateEvents();\n}\n;\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n_.extend(View.prototype, {\n    tagName: 'div',\n    $: function (selector) {\n        return this.$el.find(selector);\n    },\n    initialize: function () { },\n    render: function () {\n        return this;\n    },\n    remove: function () {\n        this.$el.remove();\n        this.stopListening();\n        return this;\n    },\n    setElement: function (element, delegate) {\n        if (this.$el)\n            this.undelegateEvents();\n        this.$el = element instanceof exported.$ ? element : exported.$(element);\n        this.el = this.$el[0];\n        if (delegate !== false)\n            this.delegateEvents();\n        return this;\n    },\n    delegateEvents: function (events) {\n        if (!(events || (events = _.result(this, 'events'))))\n            return this;\n        this.undelegateEvents();\n        for (var key in events) {\n            var method = events[key];\n            if (!_.isFunction(method))\n                method = this[events[key]];\n            if (!method)\n                continue;\n            var match = key.match(delegateEventSplitter);\n            var eventName = match[1], selector = match[2];\n            method = _.bind(method, this);\n            eventName += '.delegateEvents' + this.cid;\n            if (selector === '') {\n                this.$el.on(eventName, method);\n            }\n            else {\n                this.$el.on(eventName, selector, method);\n            }\n        }\n        return this;\n    },\n    undelegateEvents: function () {\n        this.$el.off('.delegateEvents' + this.cid);\n        return this;\n    },\n    _ensureElement: function () {\n        if (!this.el) {\n            var attrs = _.extend({}, _.result(this, 'attributes'));\n            if (this.id)\n                attrs.id = _.result(this, 'id');\n            if (this.className)\n                attrs['class'] = _.result(this, 'className');\n            var $el = exported.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n            this.setElement($el, false);\n        }\n        else {\n            this.setElement(_.result(this, 'el'), false);\n        }\n    }\n});\nexport function Router(options) {\n    options || (options = {});\n    if (options.routes)\n        this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n}\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam = /(\\(\\?)?:\\w+/g;\nvar splatParam = /\\*\\w+/g;\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n_.extend(Router.prototype, {\n    initialize: function () { },\n    route: function (route, name, callback) {\n        if (!_.isRegExp(route))\n            route = this._routeToRegExp(route);\n        if (_.isFunction(name)) {\n            callback = name;\n            name = '';\n        }\n        if (!callback)\n            callback = this[name];\n        var router = this;\n        exported.history.route(route, function (fragment) {\n            var args = router._extractParameters(route, fragment);\n            if (router.execute(callback, args, name) !== false) {\n                router.trigger.apply(router, ['route:' + name].concat(args));\n                router.trigger('route', name, args);\n                exported.history.trigger('route', router, name, args);\n            }\n        });\n        return this;\n    },\n    execute: function (callback, args, name) {\n        if (callback)\n            callback.apply(this, args);\n    },\n    navigate: function (fragment, options) {\n        exported.history.navigate(fragment, options);\n        return this;\n    },\n    _bindRoutes: function () {\n        if (!this.routes)\n            return;\n        this.routes = _.result(this, 'routes');\n        var route, routes = _.keys(this.routes);\n        while ((route = routes.pop()) != null) {\n            this.route(route, this.routes[route]);\n        }\n    },\n    _routeToRegExp: function (route) {\n        route = route.replace(escapeRegExp, '\\\\$&')\n            .replace(optionalParam, '(?:$1)?')\n            .replace(namedParam, function (match, optional) {\n            return optional ? match : '([^/?]+)';\n        })\n            .replace(splatParam, '([^?]*?)');\n        return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n    _extractParameters: function (route, fragment) {\n        var params = route.exec(fragment).slice(1);\n        return _.map(params, function (param, i) {\n            if (i === params.length - 1)\n                return param || null;\n            return param ? decodeURIComponent(param) : null;\n        });\n    }\n});\nexport function History() {\n    this.handlers = [];\n    this.checkUrl = _.bind(this.checkUrl, this);\n    if (typeof window !== 'undefined') {\n        this.location = window.location;\n        this.history = window.history;\n    }\n}\n;\nvar routeStripper = /^[#\\/]|\\s+$/g;\nvar rootStripper = /^\\/+|\\/+$/g;\nvar pathStripper = /#.*$/;\nHistory.started = false;\n_.extend(History.prototype, {\n    interval: 50,\n    atRoot: function () {\n        var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n        return path === this.root && !this.getSearch();\n    },\n    matchRoot: function () {\n        var path = this.decodeFragment(this.location.pathname);\n        var root = path.slice(0, this.root.length - 1) + '/';\n        return root === this.root;\n    },\n    decodeFragment: function (fragment) {\n        return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n    getSearch: function () {\n        var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n        return match ? match[0] : '';\n    },\n    getHash: function (window) {\n        var match = (window || this).location.href.match(/#(.*)$/);\n        return match ? match[1] : '';\n    },\n    getPath: function () {\n        var path = this.decodeFragment(this.location.pathname + this.getSearch()).slice(this.root.length - 1);\n        return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n    getFragment: function (fragment) {\n        if (fragment == null) {\n            if (this._usePushState || !this._wantsHashChange) {\n                fragment = this.getPath();\n            }\n            else {\n                fragment = this.getHash();\n            }\n        }\n        return fragment.replace(routeStripper, '');\n    },\n    start: function (options) {\n        if (History.started)\n            throw new Error('Backbone.history has already been started');\n        History.started = true;\n        this.options = _.extend({ root: '/' }, this.options, options);\n        this.root = this.options.root;\n        this._wantsHashChange = this.options.hashChange !== false;\n        this._hasHashChange = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n        this._useHashChange = this._wantsHashChange && this._hasHashChange;\n        this._wantsPushState = !!this.options.pushState;\n        this._hasPushState = !!(this.history && this.history.pushState);\n        this._usePushState = this._wantsPushState && this._hasPushState;\n        this.fragment = this.getFragment();\n        this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n        if (this._wantsHashChange && this._wantsPushState) {\n            if (!this._hasPushState && !this.atRoot()) {\n                var root = this.root.slice(0, -1) || '/';\n                this.location.replace(root + '#' + this.getPath());\n                return true;\n            }\n            else if (this._hasPushState && this.atRoot()) {\n                this.navigate(this.getHash(), { replace: true });\n            }\n        }\n        if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n            this.iframe = document.createElement('iframe');\n            this.iframe.src = 'javascript:0';\n            this.iframe.style.display = 'none';\n            this.iframe.tabIndex = -1;\n            var body = document.body;\n            var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n            iWindow.document.open();\n            iWindow.document.close();\n            iWindow.location.hash = '#' + this.fragment;\n        }\n        var addEventListener = window.addEventListener || function (eventName, listener) {\n            return attachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            addEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            addEventListener('hashchange', this.checkUrl, false);\n        }\n        else if (this._wantsHashChange) {\n            this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n        }\n        if (!this.options.silent)\n            return this.loadUrl();\n    },\n    stop: function () {\n        var removeEventListener = window.removeEventListener || function (eventName, listener) {\n            return detachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            removeEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            removeEventListener('hashchange', this.checkUrl, false);\n        }\n        if (this.iframe) {\n            document.body.removeChild(this.iframe);\n            this.iframe = null;\n        }\n        if (this._checkUrlInterval)\n            clearInterval(this._checkUrlInterval);\n        History.started = false;\n    },\n    route: function (route, callback) {\n        this.handlers.unshift({ route: route, callback: callback });\n    },\n    checkUrl: function (e) {\n        var current = this.getFragment();\n        if (current === this.fragment && this.iframe) {\n            current = this.getHash(this.iframe.contentWindow);\n        }\n        if (current === this.fragment)\n            return false;\n        if (this.iframe)\n            this.navigate(current);\n        this.loadUrl();\n    },\n    loadUrl: function (fragment) {\n        if (!this.matchRoot())\n            return false;\n        fragment = this.fragment = this.getFragment(fragment);\n        return _.some(this.handlers, function (handler) {\n            if (handler.route.test(fragment)) {\n                handler.callback(fragment);\n                return true;\n            }\n        });\n    },\n    navigate: function (fragment, options) {\n        if (!History.started)\n            return false;\n        if (!options || options === true)\n            options = { trigger: !!options };\n        fragment = this.getFragment(fragment || '');\n        var root = this.root;\n        if (fragment === '' || fragment.charAt(0) === '?') {\n            root = root.slice(0, -1) || '/';\n        }\n        var url = root + fragment;\n        fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n        if (this.fragment === fragment)\n            return;\n        this.fragment = fragment;\n        if (this._usePushState) {\n            this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        }\n        else if (this._wantsHashChange) {\n            this._updateHash(this.location, fragment, options.replace);\n            if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n                var iWindow = this.iframe.contentWindow;\n                if (!options.replace) {\n                    iWindow.document.open();\n                    iWindow.document.close();\n                }\n                this._updateHash(iWindow.location, fragment, options.replace);\n            }\n        }\n        else {\n            return this.location.assign(url);\n        }\n        if (options.trigger)\n            return this.loadUrl(fragment);\n    },\n    _updateHash: function (location, fragment, replace) {\n        if (replace) {\n            var href = location.href.replace(/(javascript:|#).*$/, '');\n            location.replace(href + '#' + fragment);\n        }\n        else {\n            location.hash = '#' + fragment;\n        }\n    }\n});\nexported.history = new History;\n//# sourceMappingURL=backbone.js.map","import * as tslib_1 from \"tslib\";\nimport Sync from './sync';\nimport * as _ from 'underscore';\nimport { define, Model, Collection, tools, definitions, mixinRules } from './type-r';\nvar defaults = tools.defaults;\nvar transactionalProto = tools.getBaseClass(Model).prototype;\nvar RestCollection = (function (_super) {\n    tslib_1.__extends(RestCollection, _super);\n    function RestCollection() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestCollection.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestCollection.prototype.url = function () { return this.model.prototype.urlRoot || ''; };\n    RestCollection.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            this.trigger('invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestCollection.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var success = options.success;\n        var collection = this;\n        options.success = function (resp) {\n            var method = options.reset ? 'reset' : 'set';\n            collection[method](resp, options);\n            if (collection._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, collection, resp, options);\n            collection.trigger('sync', collection, resp, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestCollection.prototype.create = function (a_model, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var model = a_model instanceof RestModel ?\n            a_model :\n            this.model.create(a_model, options);\n        model._owner || (model._owner = this);\n        options.wait || this.add([model], options);\n        var collection = this;\n        var success = options.success;\n        options.success = function (model, resp, callbackOpts) {\n            if (options.wait)\n                _this.add([model], defaults({ parse: false }, callbackOpts));\n            if (success)\n                success.call(callbackOpts.context, model, resp, callbackOpts);\n        };\n        model.save(null, options);\n        return model;\n    };\n    RestCollection.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestCollection = tslib_1.__decorate([\n        define({\n            itemEvents: {\n                destroy: function (model) { this.remove(model); }\n            }\n        })\n    ], RestCollection);\n    return RestCollection;\n}(Collection));\nexport { RestCollection };\n;\nvar RestModel = (function (_super) {\n    tslib_1.__extends(RestModel, _super);\n    function RestModel() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestModel.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            triggerAndBubble(this, 'invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestModel.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestModel.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var model = this;\n        var success = options.success;\n        options.success = function (serverAttrs) {\n            model.set(serverAttrs, options);\n            if (model._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestModel.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestModel.prototype.save = function (key, val, a_options) {\n        var _this = this;\n        var attrs, originalOptions;\n        if (key == null || typeof key === 'object') {\n            attrs = key;\n            originalOptions = val || {};\n        }\n        else {\n            (attrs = {})[key] = val;\n            originalOptions = a_options || {};\n        }\n        var options = _.extend({ validate: true, parse: true }, originalOptions), wait = options.wait;\n        if (attrs && !wait) {\n            this.set(attrs, originalOptions);\n        }\n        if (this._invalidate(options)) {\n            if (attrs && wait)\n                this.set(attrs, originalOptions);\n            return Sync.errorPromise(this.validationError);\n        }\n        var model = this;\n        var success = options.success;\n        var attributes = this.attributes;\n        options.success = function (serverAttrs) {\n            model.attributes = attributes;\n            if (wait)\n                serverAttrs = _.extend({}, attrs, serverAttrs);\n            if (serverAttrs) {\n                transactionalProto.set.call(_this, serverAttrs, options);\n                if (model._invalidate(options))\n                    return false;\n            }\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        if (attrs && wait)\n            this.attributes = _.extend({}, attributes, attrs);\n        var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n        if (method === 'patch' && !options.attrs)\n            options.attrs = attrs;\n        var xhr = _sync(method, this, options);\n        this.attributes = attributes;\n        return xhr;\n    };\n    RestModel.prototype.destroy = function (options) {\n        options = options ? _.clone(options) : {};\n        var model = this;\n        var success = options.success;\n        var wait = options.wait;\n        var destroy = function () {\n            model.stopListening();\n            model.trigger('destroy', model, model.collection, options);\n        };\n        options.success = function (resp) {\n            if (wait)\n                destroy();\n            if (success)\n                success.call(options.context, model, resp, options);\n            if (!model.isNew())\n                triggerAndBubble(model, 'sync', model, resp, options);\n        };\n        var xhr;\n        if (this.isNew()) {\n            _.defer(options.success);\n        }\n        else {\n            wrapError(this, options);\n            xhr = _sync('delete', this, options);\n        }\n        if (!wait)\n            destroy();\n        return xhr || false;\n    };\n    RestModel.prototype.url = function () {\n        var base = _.result(this, 'urlRoot') ||\n            _.result(this.collection, 'url') ||\n            Sync.urlError();\n        if (this.isNew())\n            return base;\n        var id = this.get(this.idAttribute);\n        return base.replace(/[^\\/]$/, '$&/') + encodeURIComponent(id);\n    };\n    RestModel.prototype.set = function (a, b, c) {\n        if (typeof a === 'string') {\n            if (c) {\n                return _super.prototype.set.call(this, (_a = {}, _a[a] = b, _a), c);\n            }\n            else {\n                this[a] = b;\n                return this;\n            }\n        }\n        else {\n            return _super.prototype.set.call(this, a, b);\n        }\n        var _a;\n    };\n    RestModel.Collection = RestCollection;\n    RestModel = tslib_1.__decorate([\n        define({\n            urlRoot: ''\n        }),\n        definitions({\n            urlRoot: mixinRules.protoValue\n        })\n    ], RestModel);\n    return RestModel;\n}(Model));\nexport { RestModel };\nfunction _sync(method, _this, options) {\n    _this._xhr && _this._xhr.abort && _this._xhr.abort();\n    var xhr = _this._xhr = _this.sync(method, _this, options);\n    xhr && xhr.always && xhr.always(function () { _this._xhr = void 0; });\n    return xhr;\n}\nfunction wrapError(model, options) {\n    var error = options.error;\n    options.error = function (resp) {\n        if (error)\n            error.call(options.context, model, resp, options);\n        triggerAndBubble(model, 'error', model, resp, options);\n    };\n}\nfunction triggerAndBubble(model) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    model.trigger.apply(model, args);\n    var collection = model.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=rest.js.map","import * as _ from 'underscore';\nexport var ModelMixin = {\n    pick: function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return _.pick(this, args);\n    },\n    escape: function (attr) {\n        return _.escape(this[attr]);\n    },\n    matches: function (attrs) {\n        return !!_.iteratee(attrs, this)(this);\n    },\n    omit: function () {\n        var keys = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            keys[_i] = arguments[_i];\n        }\n        return this.mapObject(function (value, key) {\n            if (keys.indexOf(key) < 0) {\n                return value;\n            }\n        });\n    },\n    invert: function () {\n        var inverted = {};\n        this.each(function (value, key) { return inverted[value] = key; });\n        return inverted;\n    },\n    pairs: function () {\n        return this.map(function (value, key) { return [key, value]; });\n    },\n    isEmpty: function () {\n        return !this.values().length;\n    },\n    chain: function () {\n        return _.chain(this.mapObject(function (x) { return x; }));\n    }\n};\nexport var CollectionMixin = {\n    where: function (attrs, first) {\n        return this[first ? 'find' : 'filter'](attrs);\n    },\n    findWhere: function (attrs) {\n        return this.where(attrs, true);\n    }\n};\naddUnderscoreMethods(CollectionMixin, 'models', {\n    forEach: 3, each: 3, map: 3, collect: 3, reduce: 4,\n    foldl: 4, inject: 4, reduceRight: 4, foldr: 4, find: 3, findIndex: 3, findLastIndex: 3, detect: 3, filter: 3,\n    select: 3, reject: 3, every: 3, all: 3, some: 3, any: 3, include: 3, includes: 3,\n    contains: 3, invoke: 0, max: 3, min: 3, toArray: 1, size: 1, first: 3,\n    head: 3, take: 3, initial: 3, rest: 3, tail: 3, drop: 3, last: 3,\n    without: 0, difference: 0, indexOf: 3, shuffle: 1, lastIndexOf: 3,\n    isEmpty: 1, chain: 1, sample: 3, partition: 3, groupBy: 3, countBy: 3,\n    sortBy: 3, indexBy: 3\n});\nfunction addUnderscoreMethods(Mixin, attribute, methods) {\n    _.each(methods, function (length, method) {\n        if (_[method])\n            Mixin[method] = addMethod(length, method, attribute);\n    });\n}\nfunction addMethod(length, method, attribute) {\n    switch (length) {\n        case 1: return function () {\n            return _[method](this[attribute]);\n        };\n        case 2: return function (value) {\n            return _[method](this[attribute], value);\n        };\n        case 3: return function (iteratee, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, context)\n                : _[method](value, callback);\n        };\n        case 4: return function (iteratee, defaultVal, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, defaultVal, context)\n                : _[method](value, callback);\n        };\n        default: return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            args.unshift(this[attribute]);\n            return _[method].apply(_, args);\n        };\n    }\n}\nfunction cb(iteratee, instance) {\n    switch (typeof iteratee) {\n        case 'function': return iteratee;\n        case 'string': return function (model) { return model.get(iteratee); };\n        case 'object':\n            if (!(iteratee instanceof instance.model))\n                return _.matches(iteratee);\n    }\n    return iteratee;\n}\n//# sourceMappingURL=underscore-mixin.js.map","import * as TypeR from './type-r';\nexport * from './type-r';\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\nimport { Store as BaseStore, tools, MixinsState } from './type-r';\nimport Sync from './sync';\nimport { ModelMixin, CollectionMixin } from './underscore-mixin';\nimport { RestStore, LazyStore } from './rest-store';\nexport var Class = TypeR.Messenger;\nvar Nested = Object.create(TypeR, tools.defaults({\n    'sync': linkProperty(Sync, 'sync'),\n    'errorPromise': linkProperty(Sync, 'errorPromise'),\n    'ajax': linkProperty(Sync, 'ajax'),\n    'history': linkProperty(Backbone, 'history'),\n    'store': linkProperty(BaseStore, 'global'),\n    '$': {\n        get: function () { return Backbone.$; },\n        set: function (value) { Backbone.$ = Sync.$ = value; }\n    }\n}, toProps({ Backbone: Backbone, Class: Class, Model: RestModel, Collection: RestCollection, LazyStore: LazyStore, Store: RestStore, defaults: defaults }), toProps(Backbone)));\nexport default Nested;\nexport { Backbone, RestStore, LazyStore, RestCollection as Collection, RestModel as Model };\nexport function defaults(x) {\n    return Nested.Model.defaults(x);\n}\nexport * from './backbone';\nMixinsState.get(Nested.Mixable).merge([Nested.Events]);\nNested.Messenger.mixins.populate(Backbone.View, Backbone.Router, Backbone.History);\nNested.Record.mixins.merge([ModelMixin]);\nNested.Record.Collection.mixins.merge([CollectionMixin]);\nfunction linkProperty(Namespace, name) {\n    return {\n        get: function () { return Namespace[name]; },\n        set: function (value) { Namespace[name] = value; }\n    };\n}\nfunction toProps(obj) {\n    return tools.transform({}, obj, function (x) { return ({ value: x }); });\n}\n//# sourceMappingURL=index.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    tslib_1.__extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            free(record, prev);\n            options.unset || prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    tslib_1.__extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                options.unset || prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","import * as tslib_1 from \"tslib\";\nimport { startIO } from '../io-tools';\nexport var IORecordMixin = {\n    save: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var endpoint = this.getEndpoint(), json = this.toJSON();\n        return startIO(this, this.isNew() ?\n            endpoint.create(json, options, this) :\n            endpoint.update(this.id, json, options, this), options, function (update) {\n            _this.set(update, tslib_1.__assign({ parse: true }, options));\n        });\n    },\n    fetch: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().read(this.id, options, this), options, function (json) { return _this.set(json, tslib_1.__assign({ parse: true }, options)); });\n    },\n    destroy: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().destroy(this.id, options, this), options, function () {\n            var collection = _this.collection;\n            if (collection) {\n                collection.remove(_this, options);\n            }\n            else {\n                _this.dispose();\n            }\n            return _this;\n        });\n    }\n};\n//# sourceMappingURL=io-mixin.js.map","import * as tslib_1 from \"tslib\";\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nimport { IORecordMixin } from './io-mixin';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    tslib_1.__extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this._previousAttributes = _this.attributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.save = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.destroy = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), tslib_1.__assign({ unset: true }, options));\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype.defaults = function (values) {\n        if (values === void 0) { values = {}; }\n        var defaults = {}, _attributesArray = this._attributesArray;\n        for (var _i = 0, _attributesArray_1 = _attributesArray; _i < _attributesArray_1.length; _i++) {\n            var attr = _attributesArray_1[_i];\n            var key = attr.name, value = values[key];\n            defaults[key] = value === void 0 ? attr.defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return data;\n    };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, tslib_1.__assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin, IORecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    tslib_1.__extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    tslib_1.__extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","import * as _ from 'underscore';\nimport Backbone from './backbone';\nimport { tools } from './type-r';\nvar defaults = tools.defaults;\nvar methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch': 'PATCH',\n    'delete': 'DELETE',\n    'read': 'GET'\n};\nvar exported = {\n    $: Backbone.$,\n    errorPromise: function (error) {\n        var x = $.Deferred();\n        x.reject(error);\n        return x;\n    },\n    ajax: function (options) {\n        return $.ajax.apply($, arguments);\n    },\n    sync: sync,\n    urlError: function () {\n        throw new Error('A \"url\" property or function must be specified');\n    }\n};\nexport default exported;\nfunction sync(method, model, options) {\n    if (options === void 0) { options = {}; }\n    var type = methodMap[method];\n    var params = { type: type, dataType: 'json' };\n    if (!options.url) {\n        params.url = _.result(model, 'url') || exported.urlError();\n    }\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n        params.contentType = 'application/json';\n        params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n    if (params.type !== 'GET') {\n        params.processData = false;\n    }\n    var error = options.error;\n    options.error = function (xhr, textStatus, errorThrown) {\n        options.textStatus = textStatus;\n        options.errorThrown = errorThrown;\n        if (error)\n            error.call(options.context, xhr, textStatus, errorThrown);\n    };\n    var xhr = options.xhr = exported.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    model.collection && model.collection.trigger('request', model, xhr, options);\n    return xhr;\n}\n//# sourceMappingURL=sync.js.map","import * as tslib_1 from \"tslib\";\nimport Backbone from './backbone';\nimport * as _ from 'underscore';\nimport { define, Store } from './type-r';\nimport { RestModel, RestCollection } from './rest';\nvar RestStore = (function (_super) {\n    tslib_1.__extends(RestStore, _super);\n    function RestStore() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestStore = tslib_1.__decorate([\n        define({\n            getStore: Store.prototype.getStore,\n            get: Store.prototype.get,\n        })\n    ], RestStore);\n    return RestStore;\n}(RestModel));\nexport { RestStore };\nvar LazyStore = (function (_super) {\n    tslib_1.__extends(LazyStore, _super);\n    function LazyStore() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._resolved = {};\n        return _this;\n    }\n    LazyStore.prototype.initialize = function () {\n        var _this = this;\n        this.each(function (element, name) {\n            if (!element)\n                return;\n            element.store = _this;\n            var fetch = element.fetch;\n            if (fetch) {\n                var self_1 = _this;\n                element.fetch = function () {\n                    return self_1._resolved[name] = fetch.apply(this, arguments);\n                };\n            }\n            if (element instanceof RestCollection && element.length) {\n                _this._resolved[name] = true;\n            }\n        });\n    };\n    LazyStore.prototype.fetch = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_1 = objsToFetch; _a < objsToFetch_1.length; _a++) {\n            var name_1 = objsToFetch_1[_a];\n            var attr = this.attributes[name_1];\n            attr && attr.fetch && xhr.push(attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.fetchOnce = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], self = this, objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_2 = objsToFetch; _a < objsToFetch_2.length; _a++) {\n            var name_2 = objsToFetch_2[_a];\n            var attr = self.attributes[name_2];\n            xhr.push(self._resolved[name_2] || attr && attr.fetch && attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.clear = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var objsToClear = args.length ? args : this.keys();\n        for (var _a = 0, objsToClear_1 = objsToClear; _a < objsToClear_1.length; _a++) {\n            var name_3 = objsToClear_1[_a];\n            var element = this.attributes[name_3];\n            if (element instanceof RestCollection) {\n                element.reset();\n            }\n            else if (element instanceof Store) {\n                element.clear();\n            }\n            else if (element instanceof RestModel) {\n                element.set(element.defaults());\n            }\n            this._resolved[name_3] = false;\n        }\n        return this;\n    };\n    LazyStore.onDefine = function (definitions, BaseClass) {\n        var attributes = definitions.defaults || definitions.attributes;\n        _.each(attributes, function (Type, name) {\n            if (Type.has) {\n                attributes[name] = Type.has\n                    .set(function (value) {\n                    if (!value || !value.length) {\n                        var resolved = this._resolved || (this._resolved = {});\n                        resolved[name] = false;\n                    }\n                    return value;\n                });\n            }\n        });\n        RestModel.onDefine.call(this, definitions, BaseClass);\n    };\n    LazyStore = tslib_1.__decorate([\n        define\n    ], LazyStore);\n    return LazyStore;\n}(RestStore));\nexport { LazyStore };\n//# sourceMappingURL=rest-store.js.map"],"names":["__extends","d","b","__","this","constructor","extendStatics","prototype","Object","create","__rest","s","e","t","p","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","defaults","dest","source","name","other","isValidJSON","value","proto","getPrototypeOf","Array","every","getBaseClass","Class","isEmpty","obj","some","fun","ArrayProto","arr","result","someArray","someObject","predicate","x","omit","discard","transform","assign","once","func","memo","first","apply","notEqual","a","protoA","DateProto","arraysNotEqual","ObjectProto","keysA","keys","objectsNotEqual","hashMap","hash","HashProto","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","propertyListDecorator","listName","slice","push","definitionDecorator","definitionKey","mergeObject","_a","_b","assignProperty","sourceProp","rule","unshift","destProp","configurable","resolveRule","getBubblingHandler","event","_bubblingHandlers","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend3","on","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","_i","names_1","split","self","queue","all","listSend2","listSend4","listSend5","f","listSend6","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","getOwnerEndpoint","collection","_owner","_endpoints","_ownerKey","createIOPromise","initialize","abort","fn","onAbort","resolve","reject","promise","Promise","a_resolve","a_reject","Error","startIO","options","thenDo","abortIO","ioUpdate","_ioPromise","then","resp","triggerAndBubble","catch","err","console","error","eventSource","args","trigger","setAttribute","record","isRoot","begin","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","type","spec","ChainableAttributeSpec","_attribute","defaultValue","hasCustomDefault","supportsDate","date","isNaN","Date","getTime","Integer","Math","round","doNothing","createAttribute","AnyType","from","createSharedTypeSpec","Attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","ref","CompiledReference","local","tail","createWatcherFromRef","watcher","wrapWatcher","attrName","asProp","getMetadata","prop","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","dispose","unsubscribe","sortElements","_comparator","sort","models","addIndex","index","id","removeIndex","updateIndex","previous","idAttribute","logAggregationError","addTransaction","items","nested","added","a_items","a_options","forceMerge","_byId","parse","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","appendElements","needSort","at","length_1","Number","j","moveElements","sortOrMoveElements","CollectionTransaction","emptySetTransaction","silent","len","src","_reallocateEmpty","silentOptions","setTransaction","_prevById","prevModels","toAdd","orderKept","sorted","_reallocate","reusedCount","removed","previous_1","_garbageCollect","children","children_1","freeAll","addedOrChanged","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","k","toPredicateFunction","iteratee","parseReference","collectionRef","resolveRefs","master","records","elements_1","el","delaySet","tools.notEqual","refs","transactionApi","toArray","_super","DefaultRecord","tslib_1.__extends","tslib_1.__decorate","Model","method","_this","View","_.uniqueId","_.extend","_.pick","viewOptions","_ensureElement","delegateEvents","Router","routes","_bindRoutes","History","handlers","checkUrl","_.bind","window","location","history","_sync","_xhr","xhr","sync","always","wrapError","addUnderscoreMethods","Mixin","attribute","methods","_.each","_","cb","defaultVal","addMethod","instance","_.matches","Nested","linkProperty","Namespace","set","toProps","tools.transform","setPrototypeOf","__proto__","__assign","n","levelToNumber","none","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","toString","something","__inner_state__","Boolean","keys_1","body","name_1","definition","names","name_2","o","protoProps","staticProps","defineMixin","tslib_1.__rest","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","concat","ctors","ctors_1","object","ignore","dontMix","forEachOwnProp","mixinRules","protoValue","baseProto","function","caller","list","pipe","classFirst","classLast","EventMap","addEventsMap","bubbleEvents","EventDescriptor","event_1","event_2","handler","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","localEvents","properties","eventsMap","defineProperties","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","_validateNested","validate","each","eachError","splitTail","substr","pop","shift","eventsApi.trigger3","eventsApi.on","eventsApi.off","Transactional","_changeToken","_transaction","_isDirty","_validationError","cidPrefix","Transactional_1","endpoint","_endpoint","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","data","deepGet","_defaultStore","val","hasPendingIO","fetch","getEndpoint","mapObject","enumerable","getValidationError","validationError","deepValidationError","eachValidationError","isValid","valueOf","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","propagateChanges","forceAttributeChange","a_values","unknown","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","toJSON","changeEvents","tools.isValidJSON","JSON","stringify","isRequired","wrapIsRequired","convert","getHook_1","reduce","validate_1","handleChange","doInit","canBeUpdated","isChanged","createPropertyDescriptor","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","attrSpec","has","type_1","String","inferType","shared","_isRequired","_has","DateType","timestamp","toISOString","msDatePattern","MSDateType","msDate","exec","TimestampType","microsoft","struct","minutesOffset","isoDatePattern","numericKeys","undefined","UTC","safeParseDate","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","IORecordMixin","save","json","isNew","tslib_1.__assign","read","destroy","remove","tools.isEmpty","_cidCounter","typeCheck","previousAttributes","_attributesArray","changedAttributes","diff","old","clear","nullify","forEachAttr","_attributesArray_1","copy","pinStore","deepClone","errors","asJson","_parse","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","attrDef","compile","getAttributes","dynamicMixin","eventsApi.trigger2","_d","added_1","_e","removed_1","_count","CollectionRefsType","comparator","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","objOrId","forEach","filter","find","mapped","count","last","a_index","add","reset","liveUpdates","enabled","filter_1","_liveUpdates","updated","aggregated","a_elements","previousModels","previousModels_1","toDispose","recordsOrIds","splice","notify","removeOne","pluck","modelOrId","modelId","toggle","a_next","Argument","Attributes spec","RecordRefType","masterCollection","getMasterCollection","CollectionConstructor","SubsetOfCollection","subsetOfBehavior","resolvedWith","raw","getModelIds","addAll","toggleAll","defineSubsetCollection","Store","store","global","previousBackbone","Backbone","exported","$","jQuery","VERSION","noConflict","delegateEventSplitter","tagName","selector","$el","render","setElement","element","delegate","undelegateEvents","_.result","_.isFunction","eventName","className","optionalParam","namedParam","splatParam","escapeRegExp","route","_.isRegExp","_routeToRegExp","router","fragment","_extractParameters","execute","navigate","_.keys","replace","optional","RegExp","params","_.map","param","decodeURIComponent","routeStripper","rootStripper","pathStripper","started","interval","atRoot","pathname","getSearch","matchRoot","decodeFragment","decodeURI","href","getHash","getPath","charAt","getFragment","_usePushState","_wantsHashChange","start","hashChange","_hasHashChange","document","documentMode","_useHashChange","_wantsPushState","pushState","_hasPushState","iframe","createElement","style","display","tabIndex","iWindow","insertBefore","firstChild","contentWindow","open","close","addEventListener","attachEvent","_checkUrlInterval","setInterval","loadUrl","removeEventListener","detachEvent","removeChild","clearInterval","current","_.some","url","title","_updateHash","methodMap","patch","delete","errorPromise","Deferred","ajax","dataType","urlError","contentType","processData","textStatus","errorThrown","transactionalProto","tools.getBaseClass","RestCollection","urlRoot","_invalidate","success","a_model","RestModel","wait","callbackOpts","Sync","serverAttrs","_.clone","_.defer","base","encodeURIComponent","ModelMixin","pick","escape","_.escape","matches","_.iteratee","invert","inverted","pairs","chain","_.chain","CollectionMixin","where","findWhere","collect","foldl","inject","reduceRight","foldr","findIndex","findLastIndex","detect","select","any","include","includes","contains","invoke","max","min","size","take","initial","rest","drop","without","difference","shuffle","lastIndexOf","sample","partition","groupBy","countBy","sortBy","indexBy","RestStore","LazyStore","_resolved","self_1","objsToFetch_1","when","fetchOnce","objsToFetch_2","objsToClear_1","Type","TypeR.Messenger","TypeR","BaseStore"],"mappings":"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"}