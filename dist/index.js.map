{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../lib/type-r/object-plus/tools.js","../lib/type-r/object-plus/mixins.js","../lib/type-r/object-plus/eventsource.js","../lib/type-r/object-plus/events.js","../lib/type-r/traversable.js","../lib/type-r/io-tools.js","../lib/type-r/transactions.js","../lib/type-r/record/attributes/updates.js","../lib/type-r/record/attributes/any.js","../lib/type-r/record/attributes/attrDef.js","../lib/type-r/record/attributes/date.js","../lib/type-r/record/attributes/basic.js","../lib/type-r/record/attributes/index.js","../lib/type-r/record/index.js","../lib/type-r/collection/commons.js","../lib/type-r/collection/add.js","../lib/type-r/collection/set.js","../lib/type-r/collection/remove.js","../lib/type-r/collection/index.js","../lib/type-r/relations/commons.js","../lib/type-r/relations/subsetOf.js","../lib/type-r/index.js","../lib/backbone.js","../lib/rest.js","../lib/underscore-mixin.js","../lib/index.js","../lib/type-r/object-plus/index.js","../lib/type-r/validation.js","../lib/type-r/record/attributes/owned.js","../lib/type-r/record/attributes/shared.js","../lib/type-r/record/io-mixin.js","../lib/type-r/record/record.js","../lib/type-r/relations/from.js","../lib/type-r/relations/store.js","../lib/sync.js","../lib/rest-store.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n","var levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", props[name_1]);\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nObject.setPrototypeOf || (Object.setPrototypeOf = defaults);\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\nvar HashProto = Object.create(null);\nHashProto.hasOwnProperty = ObjectProto.hasOwnProperty;\nexport function hashMap(obj) {\n    var hash = Object.create(HashProto);\n    return obj ? assign(hash, obj) : hash;\n}\n//# sourceMappingURL=tools.js.map","import * as tslib_1 from \"tslib\";\nimport { assign, hashMap, getBaseClass, defaults, transform } from './tools';\nimport { __extends } from 'tslib';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = tslib_1.__rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                tslib_1.__extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(hashMap(), rules, mixins.definitionRules);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || hashMap();\n        this.definitionRules = (mixins && mixins.definitionRules) || hashMap();\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = hashMap(), Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    if (getBaseClass(mixin) !== Object) {\n                        console.log('Mixin error');\n                    }\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults(hashMap(), this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults(hashMap(), this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: hashMap({\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    }),\n    object: hashMap({\n        constructor: true\n    })\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.getOwnPropertyNames(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        ignore[name_2] || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","import * as tslib_1 from \"tslib\";\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = tslib_1.__decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        path.unshift('self');\n        this.resolve = new Function('self', \"return \" + path.join('.') + \";\");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","export function getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\nexport function createIOPromise(initialize) {\n    var resolve, reject, onAbort;\n    function abort(fn) {\n        onAbort = fn;\n    }\n    var promise = new Promise(function (a_resolve, a_reject) {\n        reject = a_reject;\n        resolve = a_resolve;\n        initialize(resolve, reject, abort);\n    });\n    promise.abort = function () {\n        onAbort ? onAbort(resolve, reject) : reject(new Error(\"I/O Aborted\"));\n    };\n    return promise;\n}\nexport function startIO(self, promise, options, thenDo) {\n    abortIO(self);\n    options.ioUpdate = true;\n    self._ioPromise = promise\n        .then(function (resp) {\n        self._ioPromise = null;\n        var result = thenDo ? thenDo(resp) : resp;\n        triggerAndBubble(self, 'sync', self, resp, options);\n        return result;\n    })\n        .catch(function (err) {\n        self._ioPromise = null;\n        console.error(err);\n        triggerAndBubble(self, 'error', self, err, options);\n        throw err;\n    });\n    self._ioPromise.abort = promise.abort;\n    return self._ioPromise;\n}\nexport function abortIO(self) {\n    if (self._ioPromise && self._ioPromise.abort) {\n        self._ioPromise.abort();\n        self._ioPromise = null;\n    }\n}\nexport function triggerAndBubble(eventSource) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    eventSource.trigger.apply(eventSource, args);\n    var collection = eventSource.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=io-tools.js.map","import * as tslib_1 from \"tslib\";\nimport { Messenger, tools, mixins, mixinRules, definitions, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nimport { abortIO } from './io-tools';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onDefine = function (definitions, BaseClass) {\n        if (definitions.endpoint)\n            this.prototype._endpoint = definitions.endpoint;\n        Messenger.onDefine.call(this, definitions, BaseClass);\n    };\n    ;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        abortIO(this);\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        return this.set(source.__inner_state__ || source, { merge: true });\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.hasPendingIO = function () { return this._ioPromise; };\n    Transactional.prototype.fetch = function (options) { throw new Error(\"Not implemented\"); };\n    Transactional.prototype.getEndpoint = function () {\n        return getOwnerEndpoint(this) || this._endpoint;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = tslib_1.__decorate([\n        define,\n        definitions({\n            endpoint: mixinRules.value\n        }),\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\nfunction getOwnerEndpoint(self) {\n    var collection = self.collection;\n    if (collection) {\n        return getOwnerEndpoint(collection);\n    }\n    if (self._owner) {\n        var _endpoints = self._owner._endpoints;\n        return _endpoints && _endpoints[self._ownerKey];\n    }\n}\n//# sourceMappingURL=transactions.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.endpoint = function (endpoint) {\n        return this.metadata({ endpoint: endpoint });\n    };\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || new ChainableAttributeSpec({\n            type: this,\n            value: this._attribute.defaultValue,\n            hasCustomDefault: this._attribute.defaultValue !== void 0\n        });\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type = inferType(spec);\n        if (type && type.prototype instanceof Transactional) {\n            attrSpec = type.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    tslib_1.__extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    tslib_1.__extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    tslib_1.__extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    tslib_1.__extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    tslib_1.__extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    tslib_1.__extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    tslib_1.__extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    tslib_1.__extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    tslib_1.__extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.dispose = function () { };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","import * as tslib_1 from \"tslib\";\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return tslib_1.__assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes), { _endpoints: _.transform({}, allAttributes, function (attrDef) { return attrDef.options.endpoint; }) });\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        tslib_1.__extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = tslib_1.__decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = tslib_1.__rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n    if (definition.endpoint)\n        this.Collection.prototype._endpoint = definition.endpoint;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id != null) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id != null) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove, options.unset);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove, unset) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model, unset);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","import * as tslib_1 from \"tslib\";\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nimport { startIO } from '../io-tools';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    tslib_1.__extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.liveUpdates = function (enabled) {\n        var _this = this;\n        if (enabled) {\n            this.liveUpdates(false);\n            var filter_1 = typeof enabled === 'function' ? enabled : function () { return true; };\n            this._liveUpdates = {\n                updated: function (json) {\n                    filter_1(json) && _this.add(json, { parse: true, merge: true });\n                },\n                removed: function (id) { return _this.remove(id); }\n            };\n            return this.getEndpoint().subscribe(this._liveUpdates, this);\n        }\n        else {\n            if (this._liveUpdates) {\n                this.getEndpoint().unsubscribe(this._liveUpdates, this);\n                this._liveUpdates = null;\n            }\n        }\n    };\n    Collection.prototype.fetch = function (a_options) {\n        var _this = this;\n        if (a_options === void 0) { a_options = {}; }\n        var options = tslib_1.__assign({ parse: true }, a_options), endpoint = this.getEndpoint();\n        return startIO(this, endpoint.list(options, this), options, function (json) {\n            var result = _this.set(json, tslib_1.__assign({ parse: true }, options));\n            if (options.liveUpdates) {\n                result = _this.liveUpdates(options.liveUpdates);\n            }\n            return result;\n        });\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        this.liveUpdates(false);\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = this.models;\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        else {\n            this._byId = {};\n            this.models = [];\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        var _byId = this._byId;\n        for (var _i = 0, previousModels_1 = previousModels; _i < previousModels_1.length; _i++) {\n            var toDispose = previousModels_1[_i];\n            _byId[toDispose.cid] || free(this, toDispose);\n        }\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, tslib_1.__assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        tslib_1.__extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd.slice();\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.refs = null;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs.slice();\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = tslib_1.__decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    SubsetOfCollection.prototype._itemEvents = void 0;\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements.slice();\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return elements ? (Array.isArray(elements) ? elements : [elements]) : [];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tslib_1 from \"tslib\";\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nexport * from './transactions';\nexport { createIOPromise } from './io-tools';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        tslib_1.__extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = tslib_1.__decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map","import * as _ from 'underscore';\nimport * as jQuery from 'jquery';\nvar previousBackbone = window.Backbone;\nvar slice = Array.prototype.slice;\nvar exported = {\n    $: jQuery,\n    history: null,\n    VERSION: '1.2.3',\n    View: View, History: History, Router: Router, noConflict: noConflict\n};\nexport default exported;\nfunction noConflict() {\n    window.Backbone = previousBackbone;\n    return this;\n}\n;\nexport function View(options) {\n    this.cid = _.uniqueId('view');\n    options || (options = {});\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n    this.delegateEvents();\n}\n;\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n_.extend(View.prototype, {\n    tagName: 'div',\n    $: function (selector) {\n        return this.$el.find(selector);\n    },\n    initialize: function () { },\n    render: function () {\n        return this;\n    },\n    remove: function () {\n        this.$el.remove();\n        this.stopListening();\n        return this;\n    },\n    setElement: function (element, delegate) {\n        if (this.$el)\n            this.undelegateEvents();\n        this.$el = element instanceof exported.$ ? element : exported.$(element);\n        this.el = this.$el[0];\n        if (delegate !== false)\n            this.delegateEvents();\n        return this;\n    },\n    delegateEvents: function (events) {\n        if (!(events || (events = _.result(this, 'events'))))\n            return this;\n        this.undelegateEvents();\n        for (var key in events) {\n            var method = events[key];\n            if (!_.isFunction(method))\n                method = this[events[key]];\n            if (!method)\n                continue;\n            var match = key.match(delegateEventSplitter);\n            var eventName = match[1], selector = match[2];\n            method = _.bind(method, this);\n            eventName += '.delegateEvents' + this.cid;\n            if (selector === '') {\n                this.$el.on(eventName, method);\n            }\n            else {\n                this.$el.on(eventName, selector, method);\n            }\n        }\n        return this;\n    },\n    undelegateEvents: function () {\n        this.$el.off('.delegateEvents' + this.cid);\n        return this;\n    },\n    _ensureElement: function () {\n        if (!this.el) {\n            var attrs = _.extend({}, _.result(this, 'attributes'));\n            if (this.id)\n                attrs.id = _.result(this, 'id');\n            if (this.className)\n                attrs['class'] = _.result(this, 'className');\n            var $el = exported.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n            this.setElement($el, false);\n        }\n        else {\n            this.setElement(_.result(this, 'el'), false);\n        }\n    }\n});\nexport function Router(options) {\n    options || (options = {});\n    if (options.routes)\n        this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n}\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam = /(\\(\\?)?:\\w+/g;\nvar splatParam = /\\*\\w+/g;\nvar escapeRegExp = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n_.extend(Router.prototype, {\n    initialize: function () { },\n    route: function (route, name, callback) {\n        if (!_.isRegExp(route))\n            route = this._routeToRegExp(route);\n        if (_.isFunction(name)) {\n            callback = name;\n            name = '';\n        }\n        if (!callback)\n            callback = this[name];\n        var router = this;\n        exported.history.route(route, function (fragment) {\n            var args = router._extractParameters(route, fragment);\n            if (router.execute(callback, args, name) !== false) {\n                router.trigger.apply(router, ['route:' + name].concat(args));\n                router.trigger('route', name, args);\n                exported.history.trigger('route', router, name, args);\n            }\n        });\n        return this;\n    },\n    execute: function (callback, args, name) {\n        if (callback)\n            callback.apply(this, args);\n    },\n    navigate: function (fragment, options) {\n        exported.history.navigate(fragment, options);\n        return this;\n    },\n    _bindRoutes: function () {\n        if (!this.routes)\n            return;\n        this.routes = _.result(this, 'routes');\n        var route, routes = _.keys(this.routes);\n        while ((route = routes.pop()) != null) {\n            this.route(route, this.routes[route]);\n        }\n    },\n    _routeToRegExp: function (route) {\n        route = route.replace(escapeRegExp, '\\\\$&')\n            .replace(optionalParam, '(?:$1)?')\n            .replace(namedParam, function (match, optional) {\n            return optional ? match : '([^/?]+)';\n        })\n            .replace(splatParam, '([^?]*?)');\n        return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n    _extractParameters: function (route, fragment) {\n        var params = route.exec(fragment).slice(1);\n        return _.map(params, function (param, i) {\n            if (i === params.length - 1)\n                return param || null;\n            return param ? decodeURIComponent(param) : null;\n        });\n    }\n});\nexport function History() {\n    this.handlers = [];\n    this.checkUrl = _.bind(this.checkUrl, this);\n    if (typeof window !== 'undefined') {\n        this.location = window.location;\n        this.history = window.history;\n    }\n}\n;\nvar routeStripper = /^[#\\/]|\\s+$/g;\nvar rootStripper = /^\\/+|\\/+$/g;\nvar pathStripper = /#.*$/;\nHistory.started = false;\n_.extend(History.prototype, {\n    interval: 50,\n    atRoot: function () {\n        var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n        return path === this.root && !this.getSearch();\n    },\n    matchRoot: function () {\n        var path = this.decodeFragment(this.location.pathname);\n        var root = path.slice(0, this.root.length - 1) + '/';\n        return root === this.root;\n    },\n    decodeFragment: function (fragment) {\n        return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n    getSearch: function () {\n        var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n        return match ? match[0] : '';\n    },\n    getHash: function (window) {\n        var match = (window || this).location.href.match(/#(.*)$/);\n        return match ? match[1] : '';\n    },\n    getPath: function () {\n        var path = this.decodeFragment(this.location.pathname + this.getSearch()).slice(this.root.length - 1);\n        return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n    getFragment: function (fragment) {\n        if (fragment == null) {\n            if (this._usePushState || !this._wantsHashChange) {\n                fragment = this.getPath();\n            }\n            else {\n                fragment = this.getHash();\n            }\n        }\n        return fragment.replace(routeStripper, '');\n    },\n    start: function (options) {\n        if (History.started)\n            throw new Error('Backbone.history has already been started');\n        History.started = true;\n        this.options = _.extend({ root: '/' }, this.options, options);\n        this.root = this.options.root;\n        this._wantsHashChange = this.options.hashChange !== false;\n        this._hasHashChange = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n        this._useHashChange = this._wantsHashChange && this._hasHashChange;\n        this._wantsPushState = !!this.options.pushState;\n        this._hasPushState = !!(this.history && this.history.pushState);\n        this._usePushState = this._wantsPushState && this._hasPushState;\n        this.fragment = this.getFragment();\n        this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n        if (this._wantsHashChange && this._wantsPushState) {\n            if (!this._hasPushState && !this.atRoot()) {\n                var root = this.root.slice(0, -1) || '/';\n                this.location.replace(root + '#' + this.getPath());\n                return true;\n            }\n            else if (this._hasPushState && this.atRoot()) {\n                this.navigate(this.getHash(), { replace: true });\n            }\n        }\n        if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n            this.iframe = document.createElement('iframe');\n            this.iframe.src = 'javascript:0';\n            this.iframe.style.display = 'none';\n            this.iframe.tabIndex = -1;\n            var body = document.body;\n            var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n            iWindow.document.open();\n            iWindow.document.close();\n            iWindow.location.hash = '#' + this.fragment;\n        }\n        var addEventListener = window.addEventListener || function (eventName, listener) {\n            return attachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            addEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            addEventListener('hashchange', this.checkUrl, false);\n        }\n        else if (this._wantsHashChange) {\n            this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n        }\n        if (!this.options.silent)\n            return this.loadUrl();\n    },\n    stop: function () {\n        var removeEventListener = window.removeEventListener || function (eventName, listener) {\n            return detachEvent('on' + eventName, listener);\n        };\n        if (this._usePushState) {\n            removeEventListener('popstate', this.checkUrl, false);\n        }\n        else if (this._useHashChange && !this.iframe) {\n            removeEventListener('hashchange', this.checkUrl, false);\n        }\n        if (this.iframe) {\n            document.body.removeChild(this.iframe);\n            this.iframe = null;\n        }\n        if (this._checkUrlInterval)\n            clearInterval(this._checkUrlInterval);\n        History.started = false;\n    },\n    route: function (route, callback) {\n        this.handlers.unshift({ route: route, callback: callback });\n    },\n    checkUrl: function (e) {\n        var current = this.getFragment();\n        if (current === this.fragment && this.iframe) {\n            current = this.getHash(this.iframe.contentWindow);\n        }\n        if (current === this.fragment)\n            return false;\n        if (this.iframe)\n            this.navigate(current);\n        this.loadUrl();\n    },\n    loadUrl: function (fragment) {\n        if (!this.matchRoot())\n            return false;\n        fragment = this.fragment = this.getFragment(fragment);\n        return _.some(this.handlers, function (handler) {\n            if (handler.route.test(fragment)) {\n                handler.callback(fragment);\n                return true;\n            }\n        });\n    },\n    navigate: function (fragment, options) {\n        if (!History.started)\n            return false;\n        if (!options || options === true)\n            options = { trigger: !!options };\n        fragment = this.getFragment(fragment || '');\n        var root = this.root;\n        if (fragment === '' || fragment.charAt(0) === '?') {\n            root = root.slice(0, -1) || '/';\n        }\n        var url = root + fragment;\n        fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n        if (this.fragment === fragment)\n            return;\n        this.fragment = fragment;\n        if (this._usePushState) {\n            this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n        }\n        else if (this._wantsHashChange) {\n            this._updateHash(this.location, fragment, options.replace);\n            if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n                var iWindow = this.iframe.contentWindow;\n                if (!options.replace) {\n                    iWindow.document.open();\n                    iWindow.document.close();\n                }\n                this._updateHash(iWindow.location, fragment, options.replace);\n            }\n        }\n        else {\n            return this.location.assign(url);\n        }\n        if (options.trigger)\n            return this.loadUrl(fragment);\n    },\n    _updateHash: function (location, fragment, replace) {\n        if (replace) {\n            var href = location.href.replace(/(javascript:|#).*$/, '');\n            location.replace(href + '#' + fragment);\n        }\n        else {\n            location.hash = '#' + fragment;\n        }\n    }\n});\nexported.history = new History;\n//# sourceMappingURL=backbone.js.map","import * as tslib_1 from \"tslib\";\nimport Sync from './sync';\nimport * as _ from 'underscore';\nimport { define, Model, Collection, tools, definitions, mixinRules } from './type-r';\nvar defaults = tools.defaults;\nvar transactionalProto = tools.getBaseClass(Model).prototype;\nvar RestCollection = (function (_super) {\n    tslib_1.__extends(RestCollection, _super);\n    function RestCollection() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestCollection.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestCollection.prototype.url = function () { return this.model.prototype.urlRoot || ''; };\n    RestCollection.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            this.trigger('invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestCollection.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var success = options.success;\n        var collection = this;\n        options.success = function (resp) {\n            var method = options.reset ? 'reset' : 'set';\n            collection[method](resp, options);\n            if (collection._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, collection, resp, options);\n            collection.trigger('sync', collection, resp, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestCollection.prototype.create = function (a_model, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var model = a_model instanceof RestModel ?\n            a_model :\n            this.model.create(a_model, options);\n        model._owner || (model._owner = this);\n        options.wait || this.add([model], options);\n        var collection = this;\n        var success = options.success;\n        options.success = function (model, resp, callbackOpts) {\n            if (options.wait)\n                _this.add([model], defaults({ parse: false }, callbackOpts));\n            if (success)\n                success.call(callbackOpts.context, model, resp, callbackOpts);\n        };\n        model.save(null, options);\n        return model;\n    };\n    RestCollection.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestCollection = tslib_1.__decorate([\n        define({\n            itemEvents: {\n                destroy: function (model) { this.remove(model); }\n            }\n        })\n    ], RestCollection);\n    return RestCollection;\n}(Collection));\nexport { RestCollection };\n;\nvar RestModel = (function (_super) {\n    tslib_1.__extends(RestModel, _super);\n    function RestModel() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestModel.prototype._invalidate = function (options) {\n        var error;\n        if (options.validate && (error = this.validationError)) {\n            triggerAndBubble(this, 'invalid', this, error, _.extend({ validationError: error }, options));\n            return true;\n        }\n    };\n    RestModel.prototype.dispose = function () {\n        if (this._xhr && this._xhr.abort)\n            this._xhr.abort();\n        _super.prototype.dispose.call(this);\n    };\n    RestModel.prototype.fetch = function (options) {\n        options = _.extend({ parse: true }, options);\n        var model = this;\n        var success = options.success;\n        options.success = function (serverAttrs) {\n            model.set(serverAttrs, options);\n            if (model._invalidate(options))\n                return false;\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        return _sync('read', this, options);\n    };\n    RestModel.prototype.sync = function () {\n        return Sync.sync.apply(this, arguments);\n    };\n    RestModel.prototype.save = function (key, val, a_options) {\n        var _this = this;\n        var attrs, originalOptions;\n        if (key == null || typeof key === 'object') {\n            attrs = key;\n            originalOptions = val || {};\n        }\n        else {\n            (attrs = {})[key] = val;\n            originalOptions = a_options || {};\n        }\n        var options = _.extend({ validate: true, parse: true }, originalOptions), wait = options.wait;\n        if (attrs && !wait) {\n            this.set(attrs, originalOptions);\n        }\n        if (this._invalidate(options)) {\n            if (attrs && wait)\n                this.set(attrs, originalOptions);\n            return Sync.errorPromise(this.validationError);\n        }\n        var model = this;\n        var success = options.success;\n        var attributes = this.attributes;\n        options.success = function (serverAttrs) {\n            model.attributes = attributes;\n            if (wait)\n                serverAttrs = _.extend({}, attrs, serverAttrs);\n            if (serverAttrs) {\n                transactionalProto.set.call(_this, serverAttrs, options);\n                if (model._invalidate(options))\n                    return false;\n            }\n            if (success)\n                success.call(options.context, model, serverAttrs, options);\n            triggerAndBubble(model, 'sync', model, serverAttrs, options);\n        };\n        wrapError(this, options);\n        if (attrs && wait)\n            this.attributes = _.extend({}, attributes, attrs);\n        var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n        if (method === 'patch' && !options.attrs)\n            options.attrs = attrs;\n        var xhr = _sync(method, this, options);\n        this.attributes = attributes;\n        return xhr;\n    };\n    RestModel.prototype.destroy = function (options) {\n        options = options ? _.clone(options) : {};\n        var model = this;\n        var success = options.success;\n        var wait = options.wait;\n        var destroy = function () {\n            model.stopListening();\n            model.trigger('destroy', model, model.collection, options);\n        };\n        options.success = function (resp) {\n            if (wait)\n                destroy();\n            if (success)\n                success.call(options.context, model, resp, options);\n            if (!model.isNew())\n                triggerAndBubble(model, 'sync', model, resp, options);\n        };\n        var xhr;\n        if (this.isNew()) {\n            _.defer(options.success);\n        }\n        else {\n            wrapError(this, options);\n            xhr = _sync('delete', this, options);\n        }\n        if (!wait)\n            destroy();\n        return xhr || false;\n    };\n    RestModel.prototype.url = function () {\n        var base = _.result(this, 'urlRoot') ||\n            _.result(this.collection, 'url') ||\n            Sync.urlError();\n        if (this.isNew())\n            return base;\n        var id = this.get(this.idAttribute);\n        return base.replace(/[^\\/]$/, '$&/') + encodeURIComponent(id);\n    };\n    RestModel.prototype.set = function (a, b, c) {\n        if (typeof a === 'string') {\n            if (c) {\n                return _super.prototype.set.call(this, (_a = {}, _a[a] = b, _a), c);\n            }\n            else {\n                this[a] = b;\n                return this;\n            }\n        }\n        else {\n            return _super.prototype.set.call(this, a, b);\n        }\n        var _a;\n    };\n    RestModel.Collection = RestCollection;\n    RestModel = tslib_1.__decorate([\n        define({\n            urlRoot: ''\n        }),\n        definitions({\n            urlRoot: mixinRules.protoValue\n        })\n    ], RestModel);\n    return RestModel;\n}(Model));\nexport { RestModel };\nfunction _sync(method, _this, options) {\n    _this._xhr && _this._xhr.abort && _this._xhr.abort();\n    var xhr = _this._xhr = _this.sync(method, _this, options);\n    xhr && xhr.always && xhr.always(function () { _this._xhr = void 0; });\n    return xhr;\n}\nfunction wrapError(model, options) {\n    var error = options.error;\n    options.error = function (resp) {\n        if (error)\n            error.call(options.context, model, resp, options);\n        triggerAndBubble(model, 'error', model, resp, options);\n    };\n}\nfunction triggerAndBubble(model) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    model.trigger.apply(model, args);\n    var collection = model.collection;\n    collection && collection.trigger.apply(collection, args);\n}\n//# sourceMappingURL=rest.js.map","import * as _ from 'underscore';\nexport var ModelMixin = {\n    pick: function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return _.pick(this, args);\n    },\n    escape: function (attr) {\n        return _.escape(this[attr]);\n    },\n    matches: function (attrs) {\n        return !!_.iteratee(attrs, this)(this);\n    },\n    omit: function () {\n        var keys = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            keys[_i] = arguments[_i];\n        }\n        return this.mapObject(function (value, key) {\n            if (keys.indexOf(key) < 0) {\n                return value;\n            }\n        });\n    },\n    invert: function () {\n        var inverted = {};\n        this.each(function (value, key) { return inverted[value] = key; });\n        return inverted;\n    },\n    pairs: function () {\n        return this.map(function (value, key) { return [key, value]; });\n    },\n    isEmpty: function () {\n        return !this.values().length;\n    },\n    chain: function () {\n        return _.chain(this.mapObject(function (x) { return x; }));\n    }\n};\nexport var CollectionMixin = {\n    where: function (attrs, first) {\n        return this[first ? 'find' : 'filter'](attrs);\n    },\n    findWhere: function (attrs) {\n        return this.where(attrs, true);\n    }\n};\naddUnderscoreMethods(CollectionMixin, 'models', {\n    forEach: 3, each: 3, map: 3, collect: 3, reduce: 4,\n    foldl: 4, inject: 4, reduceRight: 4, foldr: 4, find: 3, findIndex: 3, findLastIndex: 3, detect: 3, filter: 3,\n    select: 3, reject: 3, every: 3, all: 3, some: 3, any: 3, include: 3, includes: 3,\n    contains: 3, invoke: 0, max: 3, min: 3, toArray: 1, size: 1, first: 3,\n    head: 3, take: 3, initial: 3, rest: 3, tail: 3, drop: 3, last: 3,\n    without: 0, difference: 0, indexOf: 3, shuffle: 1, lastIndexOf: 3,\n    isEmpty: 1, chain: 1, sample: 3, partition: 3, groupBy: 3, countBy: 3,\n    sortBy: 3, indexBy: 3\n});\nfunction addUnderscoreMethods(Mixin, attribute, methods) {\n    _.each(methods, function (length, method) {\n        if (_[method])\n            Mixin[method] = addMethod(length, method, attribute);\n    });\n}\nfunction addMethod(length, method, attribute) {\n    switch (length) {\n        case 1: return function () {\n            return _[method](this[attribute]);\n        };\n        case 2: return function (value) {\n            return _[method](this[attribute], value);\n        };\n        case 3: return function (iteratee, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, context)\n                : _[method](value, callback);\n        };\n        case 4: return function (iteratee, defaultVal, context) {\n            var value = this[attribute], callback = cb(iteratee, this);\n            return arguments.length > 1 ?\n                _[method](value, callback, defaultVal, context)\n                : _[method](value, callback);\n        };\n        default: return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            args.unshift(this[attribute]);\n            return _[method].apply(_, args);\n        };\n    }\n}\nfunction cb(iteratee, instance) {\n    switch (typeof iteratee) {\n        case 'function': return iteratee;\n        case 'string': return function (model) { return model.get(iteratee); };\n        case 'object':\n            if (!(iteratee instanceof instance.model))\n                return _.matches(iteratee);\n    }\n    return iteratee;\n}\n//# sourceMappingURL=underscore-mixin.js.map","import * as TypeR from './type-r';\nexport * from './type-r';\nimport Backbone from './backbone';\nimport { RestCollection, RestModel } from './rest';\nimport { Store as BaseStore, tools, MixinsState } from './type-r';\nimport Sync from './sync';\nimport { ModelMixin, CollectionMixin } from './underscore-mixin';\nimport { RestStore, LazyStore } from './rest-store';\nexport var Class = TypeR.Messenger;\nvar Nested = Object.create(TypeR, tools.defaults({\n    'sync': linkProperty(Sync, 'sync'),\n    'errorPromise': linkProperty(Sync, 'errorPromise'),\n    'ajax': linkProperty(Sync, 'ajax'),\n    'history': linkProperty(Backbone, 'history'),\n    'store': linkProperty(BaseStore, 'global'),\n    '$': {\n        get: function () { return Backbone.$; },\n        set: function (value) { Backbone.$ = Sync.$ = value; }\n    }\n}, toProps({ Backbone: Backbone, Class: Class, Model: RestModel, Collection: RestCollection, LazyStore: LazyStore, Store: RestStore, defaults: defaults }), toProps(Backbone)));\nexport default Nested;\nexport { Backbone, RestStore, LazyStore, RestCollection as Collection, RestModel as Model };\nexport function defaults(x) {\n    return Nested.Model.defaults(x);\n}\nexport * from './backbone';\nMixinsState.get(Nested.Mixable).merge([Nested.Events]);\nNested.Messenger.mixins.populate(Backbone.View, Backbone.Router, Backbone.History);\nNested.Record.mixins.merge([ModelMixin]);\nNested.Record.Collection.mixins.merge([CollectionMixin]);\nfunction linkProperty(Namespace, name) {\n    return {\n        get: function () { return Namespace[name]; },\n        set: function (value) { Namespace[name] = value; }\n    };\n}\nfunction toProps(obj) {\n    return tools.transform({}, obj, function (x) { return ({ value: x }); });\n}\n//# sourceMappingURL=index.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    tslib_1.__extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            free(record, prev);\n            options.unset || prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    tslib_1.__extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                options.unset || prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","import * as tslib_1 from \"tslib\";\nimport { startIO } from '../io-tools';\nexport var IORecordMixin = {\n    save: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var endpoint = this.getEndpoint(), json = this.toJSON();\n        return startIO(this, this.isNew() ?\n            endpoint.create(json, options, this) :\n            endpoint.update(this.id, json, options, this), options, function (update) {\n            _this.set(update, tslib_1.__assign({ parse: true }, options));\n        });\n    },\n    fetch: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().read(this.id, options, this), options, function (json) { return _this.set(json, tslib_1.__assign({ parse: true }, options)); });\n    },\n    destroy: function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return startIO(this, this.getEndpoint().destroy(this.id, options, this), options, function () {\n            var collection = _this.collection;\n            if (collection) {\n                collection.remove(_this, options);\n            }\n            else {\n                _this.dispose();\n            }\n        });\n    }\n};\n//# sourceMappingURL=io-mixin.js.map","import * as tslib_1 from \"tslib\";\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nimport { IORecordMixin } from './io-mixin';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    tslib_1.__extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this._previousAttributes = _this.attributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.save = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.destroy = function (options) { throw new Error('Implemented by mixin'); };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), tslib_1.__assign({ unset: true }, options));\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        if (values === void 0) { values = {}; }\n        var defaults = {}, _attributesArray = this._attributesArray;\n        for (var _i = 0, _attributesArray_1 = _attributesArray; _i < _attributesArray_1.length; _i++) {\n            var attr = _attributesArray_1[_i];\n            var key = attr.name, value = values[key];\n            defaults[key] = value === void 0 ? attr.defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, tslib_1.__assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin, IORecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    tslib_1.__extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    tslib_1.__extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","import * as _ from 'underscore';\nimport Backbone from './backbone';\nimport { tools } from './type-r';\nvar defaults = tools.defaults;\nvar methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch': 'PATCH',\n    'delete': 'DELETE',\n    'read': 'GET'\n};\nvar exported = {\n    $: Backbone.$,\n    errorPromise: function (error) {\n        var x = $.Deferred();\n        x.reject(error);\n        return x;\n    },\n    ajax: function (options) {\n        return $.ajax.apply($, arguments);\n    },\n    sync: sync,\n    urlError: function () {\n        throw new Error('A \"url\" property or function must be specified');\n    }\n};\nexport default exported;\nfunction sync(method, model, options) {\n    if (options === void 0) { options = {}; }\n    var type = methodMap[method];\n    var params = { type: type, dataType: 'json' };\n    if (!options.url) {\n        params.url = _.result(model, 'url') || exported.urlError();\n    }\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n        params.contentType = 'application/json';\n        params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n    if (params.type !== 'GET') {\n        params.processData = false;\n    }\n    var error = options.error;\n    options.error = function (xhr, textStatus, errorThrown) {\n        options.textStatus = textStatus;\n        options.errorThrown = errorThrown;\n        if (error)\n            error.call(options.context, xhr, textStatus, errorThrown);\n    };\n    var xhr = options.xhr = exported.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    model.collection && model.collection.trigger('request', model, xhr, options);\n    return xhr;\n}\n//# sourceMappingURL=sync.js.map","import * as tslib_1 from \"tslib\";\nimport Backbone from './backbone';\nimport * as _ from 'underscore';\nimport { define, Store } from './type-r';\nimport { RestModel, RestCollection } from './rest';\nvar RestStore = (function (_super) {\n    tslib_1.__extends(RestStore, _super);\n    function RestStore() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RestStore = tslib_1.__decorate([\n        define({\n            getStore: Store.prototype.getStore,\n            get: Store.prototype.get,\n        })\n    ], RestStore);\n    return RestStore;\n}(RestModel));\nexport { RestStore };\nvar LazyStore = (function (_super) {\n    tslib_1.__extends(LazyStore, _super);\n    function LazyStore() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._resolved = {};\n        return _this;\n    }\n    LazyStore.prototype.initialize = function () {\n        var _this = this;\n        this.each(function (element, name) {\n            if (!element)\n                return;\n            element.store = _this;\n            var fetch = element.fetch;\n            if (fetch) {\n                var self_1 = _this;\n                element.fetch = function () {\n                    return self_1._resolved[name] = fetch.apply(this, arguments);\n                };\n            }\n            if (element instanceof RestCollection && element.length) {\n                _this._resolved[name] = true;\n            }\n        });\n    };\n    LazyStore.prototype.fetch = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_1 = objsToFetch; _a < objsToFetch_1.length; _a++) {\n            var name_1 = objsToFetch_1[_a];\n            var attr = this.attributes[name_1];\n            attr && attr.fetch && xhr.push(attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.fetchOnce = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var xhr = [], self = this, objsToFetch = args.length ? args : this.keys();\n        for (var _a = 0, objsToFetch_2 = objsToFetch; _a < objsToFetch_2.length; _a++) {\n            var name_2 = objsToFetch_2[_a];\n            var attr = self.attributes[name_2];\n            xhr.push(self._resolved[name_2] || attr && attr.fetch && attr.fetch());\n        }\n        var $ = Backbone.$;\n        return $ && $.when && $.when.apply($, xhr);\n    };\n    LazyStore.prototype.clear = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var objsToClear = args.length ? args : this.keys();\n        for (var _a = 0, objsToClear_1 = objsToClear; _a < objsToClear_1.length; _a++) {\n            var name_3 = objsToClear_1[_a];\n            var element = this.attributes[name_3];\n            if (element instanceof RestCollection) {\n                element.reset();\n            }\n            else if (element instanceof Store) {\n                element.clear();\n            }\n            else if (element instanceof RestModel) {\n                element.set(element.defaults());\n            }\n            this._resolved[name_3] = false;\n        }\n        return this;\n    };\n    LazyStore.onDefine = function (definitions, BaseClass) {\n        var attributes = definitions.defaults || definitions.attributes;\n        _.each(attributes, function (Type, name) {\n            if (Type.has) {\n                attributes[name] = Type.has\n                    .set(function (value) {\n                    if (!value || !value.length) {\n                        var resolved = this._resolved || (this._resolved = {});\n                        resolved[name] = false;\n                    }\n                    return value;\n                });\n            }\n        });\n        RestModel.onDefine.call(this, definitions, BaseClass);\n    };\n    LazyStore = tslib_1.__decorate([\n        define\n    ], LazyStore);\n    return LazyStore;\n}(RestStore));\nexport { LazyStore };\n//# sourceMappingURL=rest-store.js.map"],"names":["__extends","d","b","__","this","constructor","extendStatics","prototype","Object","create","__rest","s","e","t","p","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","isValidJSON","value","proto","getPrototypeOf","Array","every","getBaseClass","Class","isEmpty","obj","some","fun","ArrayProto","arr","result","someArray","someObject","predicate","x","omit","source","dest","discard","name","transform","assign","other","defaults","once","func","memo","first","apply","notEqual","a","protoA","DateProto","arraysNotEqual","ObjectProto","keysA","keys","objectsNotEqual","hashMap","hash","HashProto","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","definitionDecorator","definitionKey","mergeObject","_a","_b","assignProperty","sourceProp","rule","unshift","destProp","configurable","resolveRule","getBubblingHandler","event","_bubblingHandlers","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend3","on","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","_i","names_1","split","self","queue","all","listSend2","listSend4","listSend5","f","listSend6","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","createIOPromise","initialize","abort","fn","onAbort","resolve","reject","promise","Promise","a_resolve","a_reject","Error","startIO","options","thenDo","abortIO","ioUpdate","_ioPromise","then","resp","triggerAndBubble","catch","err","console","error","eventSource","args","trigger","collection","getOwnerEndpoint","_owner","_endpoints","_ownerKey","setAttribute","record","isRoot","begin","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","toAttributeOptions","spec","attrSpec","has","ChainableAttributeSpec","type","Number","String","Boolean","inferType","Transactional","shared","hasCustomDefault","supportsDate","date","isNaN","Date","getTime","Integer","Math","round","doNothing","createAttribute","AnyType","createSharedTypeSpec","Attribute","_attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","ref","CompiledReference","local","tail","createWatcherFromRef","watcher","wrapWatcher","attrName","asProp","getMetadata","prop","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","push","_itemEvents","subscribe","free","owner","child","unset","_free","dispose","unsubscribe","sortElements","_comparator","sort","models","addIndex","index","id","removeIndex","updateIndex","previous","idAttribute","logAggregationError","addTransaction","items","nested","added","a_items","a_options","forceMerge","_byId","parse","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","slice","appendElements","needSort","at","length_1","j","moveElements","sortOrMoveElements","CollectionTransaction","emptySetTransaction","silent","len","src","_reallocateEmpty","silentOptions","setTransaction","_prevById","prevModels","toAdd","orderKept","sorted","_reallocate","reusedCount","removed","previous_1","_garbageCollect","children","children_1","freeAll","addedOrChanged","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","k","toPredicateFunction","iteratee","parseReference","collectionRef","resolveRefs","master","records","elements_1","el","delaySet","tools.notEqual","refs","transactionApi","toArray","_super","DefaultRecord","tslib_1.__extends","tslib_1.__decorate","Model","method","_this","View","_.uniqueId","_.extend","_.pick","viewOptions","_ensureElement","delegateEvents","Router","routes","_bindRoutes","History","handlers","checkUrl","_.bind","window","location","history","_sync","_xhr","xhr","sync","always","wrapError","addUnderscoreMethods","Mixin","attribute","methods","_.each","_","cb","defaultVal","addMethod","instance","_.matches","Nested","linkProperty","Namespace","set","toProps","tools.transform","setPrototypeOf","__proto__","__assign","n","levelToNumber","none","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","name_1","definition","names","name_2","o","protoProps","staticProps","defineMixin","tslib_1.__rest","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","concat","ctors","ctors_1","object","ignore","dontMix","getOwnPropertyNames","forEachOwnProp","mixinRules","protoValue","baseProto","function","caller","list","pipe","classFirst","classLast","EventMap","addEventsMap","bubbleEvents","EventDescriptor","event_1","event_2","handler","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","localEvents","properties","eventsMap","defineProperties","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","_validateNested","validate","each","eachError","splitTail","substr","pop","eventsApi.trigger3","eventsApi.on","eventsApi.off","_changeToken","_transaction","_isDirty","_validationError","cidPrefix","Transactional_1","endpoint","_endpoint","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","__inner_state__","data","deepGet","_defaultStore","val","hasPendingIO","fetch","getEndpoint","mapObject","enumerable","getValidationError","validationError","deepValidationError","eachValidationError","isValid","valueOf","toString","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","propagateChanges","forceAttributeChange","a_values","unknown","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","toJSON","changeEvents","defaultValue","tools.isValidJSON","JSON","stringify","isRequired","wrapIsRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","_has","DateType","timestamp","toISOString","msDatePattern","MSDateType","msDate","exec","TimestampType","microsoft","struct","minutesOffset","isoDatePattern","numericKeys","undefined","UTC","safeParseDate","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","IORecordMixin","save","json","isNew","tslib_1.__assign","read","destroy","remove","tools.isEmpty","_cidCounter","typeCheck","previousAttributes","_attributesArray","changedAttributes","diff","old","clear","nullify","forEachAttr","_toJSON","_parse","_attributesArray_1","copy","pinStore","deepClone","errors","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","createToJSON","attrsWithParse","filter","parseMixin","attrDef","compile","getAttributes","dynamicMixin","eventsApi.trigger2","_d","added_1","_e","removed_1","_count","CollectionRefsType","comparator","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","objOrId","find","mapped","count","last","a_index","add","reset","liveUpdates","enabled","filter_1","_liveUpdates","updated","aggregated","a_elements","previousModels","previousModels_1","toDispose","recordsOrIds","splice","notify","removeOne","pluck","modelOrId","shift","modelId","toggle","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","CollectionConstructor","SubsetOfCollection","subsetOfBehavior","resolvedWith","raw","getModelIds","addAll","toggleAll","defineSubsetCollection","Store","store","global","previousBackbone","Backbone","exported","$","jQuery","VERSION","noConflict","delegateEventSplitter","tagName","selector","$el","render","setElement","element","delegate","undelegateEvents","_.result","_.isFunction","eventName","className","optionalParam","namedParam","splatParam","escapeRegExp","route","_.isRegExp","_routeToRegExp","router","fragment","_extractParameters","execute","navigate","_.keys","replace","optional","RegExp","params","_.map","param","decodeURIComponent","routeStripper","rootStripper","pathStripper","started","interval","atRoot","pathname","getSearch","matchRoot","decodeFragment","decodeURI","href","getHash","getPath","charAt","getFragment","_usePushState","_wantsHashChange","start","hashChange","_hasHashChange","document","documentMode","_useHashChange","_wantsPushState","pushState","_hasPushState","iframe","createElement","style","display","tabIndex","body","iWindow","insertBefore","firstChild","contentWindow","open","close","addEventListener","attachEvent","_checkUrlInterval","setInterval","loadUrl","removeEventListener","detachEvent","removeChild","clearInterval","current","_.some","url","title","_updateHash","methodMap","patch","delete","errorPromise","Deferred","ajax","dataType","urlError","contentType","processData","textStatus","errorThrown","transactionalProto","tools.getBaseClass","RestCollection","urlRoot","_invalidate","success","a_model","RestModel","wait","callbackOpts","Sync","serverAttrs","_.clone","_.defer","base","encodeURIComponent","ModelMixin","pick","escape","_.escape","matches","_.iteratee","invert","inverted","pairs","chain","_.chain","CollectionMixin","where","findWhere","forEach","collect","foldl","inject","reduceRight","foldr","findIndex","findLastIndex","detect","select","any","include","includes","contains","invoke","max","min","size","take","initial","rest","drop","without","difference","shuffle","lastIndexOf","sample","partition","groupBy","countBy","sortBy","indexBy","RestStore","LazyStore","_resolved","self_1","objsToFetch_1","when","fetchOnce","objsToFetch_2","objsToClear_1","Type","TypeR.Messenger","TypeR","BaseStore"],"mappings":"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"}